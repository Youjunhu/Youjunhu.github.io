<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head>
   <title>Notes on tokamak equilibrium</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,1,charset=utf-8,html --> 
<meta name="src" content="tokamak_equilibrium.tex" /> 
<link rel="stylesheet" type="text/css" href="tokamak_equilibrium.css" /> 
</head><body 
>
   <div class="maketitle">
                                                                                

                                                                                
   <a 
 id="likesection.1"></a><a 
 id="x1-2r1"></a>
                                                                                

                                                                                
                                                                                

                                                                                

<h2 class="titleHead">Notes on tokamak equilibrium</h2>
<div class="author" >Youjun Hu<span 
class="cmr-7">1</span></div>
<div class="institute"> <span 
class="cmr-9">Institute of Plasma Physics, Chinese Academy of Sciences</span><br />
<span 
class="cmr-9">Email: yjhu@ipp.cas.cn </span></div>
<div class="thanks" ><br /><a 
 id="tk-1"></a><span class="thank-mark"><span 
class="cmmi-10">⋆</span></span><span 
class="cmti-10">Note: </span>This document has been written using GNU TE X<span 
class="cmcsc-10"><span 
class="small-caps">m</span><span 
class="small-caps">a</span><span 
class="small-caps">c</span><span 
class="small-caps">s</span></span> <span class="cite">[<a 
href="#XTeXmacs:website">14</a>]</span>.</div><a 
 id="Q1-1-1"></a><a 
 id="Q1-1-2"></a></div>
   <div 
class="abstract" 
>
     <span 
class="cmbx-9">Abstract.</span> <span 
class="cmr-9">This  document  discusses  the  free  boundary  tokamak  equilibrium  ﬁtting</span>
     <span 
class="cmr-9">problem, ﬁxed-boundary equilibrium problem, and magnetic coordinates.</span>
</div>
   <div class="tableofcontents">
    <span class="sectionToc" >1 <a 
href="#x1-10001" id="QQ2-1-3">Introduction</a></span>
<br />    <span class="sectionToc" >2 <a 
href="#x1-20002" id="QQ2-1-4"> Axisymmetric magnetic ﬁeld</a></span>
<br />    <span class="sectionToc" >3 <a 
href="#x1-170003" id="QQ2-1-25">Non-axisymmetric magnetic perturbations</a></span>
<br />    <span class="sectionToc" >4 <a 
href="#x1-180004" id="QQ2-1-26">Plasma current density in terms of <span 
class="cmmi-10">Ψ </span>and <span 
class="cmmi-10">g</span></a></span>
<br />    <span class="sectionToc" >5 <a 
href="#x1-210005" id="QQ2-1-29">Constraint of force-balance on magnetic ﬁeld</a></span>
<br />    <span class="sectionToc" >6 <a 
href="#x1-280006" id="QQ2-1-36">Numerical methods of reconstructing equilibrium magnetic ﬁeld</a></span>
<br />    <span class="sectionToc" >7 <a 
href="#x1-330007" id="QQ2-1-41">Fixed boundary equilibrium and choices of coordinates</a></span>
<br />    <span class="sectionToc" >8 <a 
href="#x1-340008" id="QQ2-1-42">Curvilinear coordinate system</a></span>
<br />    <span class="sectionToc" >9 <a 
href="#x1-450009" id="QQ2-1-53">Covariant/contravariant representation of equilibrium magnetic ﬁeld</a></span>
<br />    <span class="sectionToc" >10 <a 
href="#x1-4600010" id="QQ2-1-54">Magnetic surface coordinates (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>)</a></span>
<br />    <span class="sectionToc" >11 <a 
href="#x1-5900011" id="QQ2-1-68">Constructing magnetic surface coordinate system from discrete <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) data</a></span>
<br />    <span class="sectionToc" >12 <a 
href="#x1-6200012" id="QQ2-1-78">Constructing model tokamak magnetic ﬁeld</a></span>
<br />    <span class="sectionToc" >13 <a 
href="#x1-6300013" id="QQ2-1-79">Magnetic surface averaging</a></span>
<br />    <span class="sectionToc" >14 <a 
href="#x1-6600014" id="QQ2-1-82">Magnetic coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) with general toroidal angle <span 
class="cmmi-10">ζ</span></a></span>
<br />    <span class="sectionToc" >15 <a 
href="#x1-7700015" id="QQ2-1-93">Field-line-following coordinates</a></span>
<br />    <span class="sectionToc" >16 <a 
href="#x1-9400016" id="QQ2-1-123">Concentric-circular magnetic conﬁguration with a given safety factor proﬁle</a></span>
<br />    <span class="sectionToc" >17 <a 
href="#x1-10000017" id="QQ2-1-131">Fixed boundary tokamak equilibrium problem</a></span>
<br />    <span class="sectionToc" >18 <a 
href="#x1-11100018" id="QQ2-1-146">Misc contents</a></span>
<br />    <span class="sectionToc" >A <a 
href="#x1-123000A" id="QQ2-1-166"></a></span>
<br />    <span class="sectionToc" >B <a 
href="#x1-142000B" id="QQ2-1-188">Computing magnetic ﬁeld generated by coils</a></span>
<br />    <span class="sectionToc" >C <a 
href="#x1-147000C" id="QQ2-1-193">About this document</a></span>
<br />    <span class="likesectionToc" ><a 
href="#x1-148000C" id="QQ2-1-194">References</a></span>
   </div>
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-10001"></a>Introduction</h3>
                                                                                

                                                                                
<!--l. 39--><p class="noindent" >A routine in tokamak operation is to reconstruct magnetic ﬁeld under the constraints of MHD force
balance and various measurements. This kind of task can be done by various codes, e.g., EFIT. I
developed a similar code called <span 
class="cmtt-10">heq</span> (github.com/youjunhu/heq).
</p><!--l. 44--><p class="indent" >   I also discuss the ﬁxed-boundary equilibrium problem, where the boundary magnetic surface is
given and one is asked to solve the force-balance equation within that boundray.
</p><!--l. 48--><p class="indent" >   Another topic is how to construct spatial coordinates that conform to the shape of the magnetic
surfaces, based on discrete numerical equilibrium data output by the equilibrium reconstructing
codes.
</p><!--l. 52--><p class="indent" >   Let us begin with the basics.
</p><!--l. 54--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-20002"></a> Axisymmetric magnetic ﬁeld</h3>
<!--l. 56--><p class="noindent" >Due to the divergence-free nature of magnetic ﬁeld, i.e., <span 
class="cmsy-10">∇⋅</span> <span 
class="cmbx-10">B</span> = 0, magnetic ﬁeld can be expressed as
the curl of a vector ﬁeld,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-2001r1"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium0x.png" alt="B = ∇ × A,
" class="math-display"  /></center></td><td class="equation-label">(1)</td></tr></table>
<!--l. 60--><p class="nopar" >
where <span 
class="cmbx-10">A </span>is called the vector potential of <span 
class="cmbx-10">B</span>. In cylindrical coordinates (<span 
class="cmmi-10">R,ϕ,Z</span>), the above expression is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-2002r2"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium1x.png" alt="    ( 1∂A     ∂A  )    ( 1 ∂(RA  )   1∂A  )     (∂A     ∂A  )
B =   ----Z − ---ϕ Rˆ +  -------ϕ-− -----R  ˆZ +  ---R − --Z-  ˆϕ.
      R ∂ϕ    ∂Z         R   ∂R     R  ∂ϕ         ∂Z    ∂R
" class="math-display"  /></center></td><td class="equation-label">(2)</td></tr></table>
                                                                                

                                                                                
<!--l. 70--><p class="nopar" >
We consider axisymmetric magnetic ﬁeld. The axial symmetry means that, when expressed in the
cylindrical coordinate system (<span 
class="cmmi-10">R,ϕ,Z</span>), the components of <span 
class="cmbx-10">B</span>, namely <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">R</span></sub>, <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">Z</span></sub>, and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub>, are all
independent of <span 
class="cmmi-10">ϕ</span>. For this case, it can be proved that an axisymmetric vector potential <span 
class="cmbx-10">A </span>suﬃces for
expressing the magnetic ﬁeld, i.e., all the components of the vector potential <span 
class="cmbx-10">A </span>can also be taken
independent of <span 
class="cmmi-10">ϕ</span>. Using this, Eq. (<a 
href="#x1-2002r2">2<!--tex4ht:ref: 4-16-p1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-2003r3"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium2x.png" alt="                          (           )
     ∂A-ϕ ˆ  -1∂(RA-ϕ)ˆ    ∂AR-   ∂AZ-  ˆ
B = − ∂Z R + R   ∂R   Z +   ∂Z  −  ∂R   ϕ.
" class="math-display"  /></center></td><td class="equation-label">(3)</td></tr></table>
<!--l. 83--><p class="nopar" >
In tokamak literature, <img 
src="tokamak_equilibrium3x.png" alt="ˆϕ"  class="circ"  /> direction is called the toroidal direction, and (<span 
class="cmmi-10">R,Z</span>) planes (i.e., <span 
class="cmmi-10">ϕ </span>= const
planes) are called poloidal planes.
</p><!--l. 88--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-30002.1"></a>Poloidal magnetic ﬁeld</h4>
<!--l. 90--><p class="noindent" >Equation (<a 
href="#x1-2003r3">3<!--tex4ht:ref: 9-6-p1 --></a>) indicates that the two poloidal components of <span 
class="cmbx-10">B</span>, namely <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">R</span></sub> and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">Z</span></sub>, are
determined by a single component of <span 
class="cmbx-10">A</span>, namely <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub>. This motivates us to deﬁne a function
<span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>):
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-3001r4"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium4x.png" alt="Ψ (R, Z) ≡ RA ϕ(R,Z ).
" class="math-display"  /></center></td><td class="equation-label">(4)</td></tr></table>
<!--l. 96--><p class="nopar" >
Then Eq. (<a 
href="#x1-2003r3">3<!--tex4ht:ref: 9-6-p1 --></a>) implies the poloidal components, <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">R</span></sub> and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">Z</span></sub>, can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-3002r5"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium5x.png" alt="       1∂ Ψ
BR = −-----,
      R ∂Z
" class="math-display"  /></center></td><td class="equation-label">(5)</td></tr></table>
<!--l. 101--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-3003r6"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium6x.png" alt="      1 ∂Ψ
BZ =  ----.
      R ∂R
" class="math-display"  /></center></td><td class="equation-label">(6)</td></tr></table>
<!--l. 104--><p class="nopar" >
(Note that it is the property of being axisymmetric and divergence-free that enables us to express the
two components of <span 
class="cmbx-10">B</span>, namely <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">R</span></sub> and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">Z</span></sub>, in terms of a single function <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>).) Furthermore, it
is ready to prove that <span 
class="cmmi-10">Ψ </span>is constant along a magnetic ﬁeld line, i.e. <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">Ψ </span>= 0. [Proof:
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium7x.png" alt="           ( ∂Ψ     ∂Ψ  )
B ⋅∇ Ψ = B ⋅  ∂RRˆ+  ∂ZZˆ

      = − 1-∂Ψ-∂Ψ-+ 1-∂Ψ-∂Ψ-
          R ∂Z ∂R   R ∂R ∂Z
      = 0.                                         (7)
" class="math-display"  /></center>
</div>]
<!--l. 121--><p class="indent" >   The function <span 
class="cmmi-10">Ψ </span>is usually called the “poloidal ﬂux function” in tokamak literature because <span 
class="cmmi-10">Ψ </span>can be
related to the poloidal magnetic ﬂux, as we will discuss in Sec. <a 
href="#x1-90002.7">2.7<!--tex4ht:ref: 9-5-5 --></a>.
                                                                                

                                                                                
</p><!--l. 125--><p class="indent" >   Using Eqs. (<a 
href="#x1-3002r5">5<!--tex4ht:ref: 7-14-p1 --></a>) and (<a 
href="#x1-3003r6">6<!--tex4ht:ref: 6-9-a4 --></a>), the poloidal magnetic ﬁeld <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium8x.png" alt="Bp = BRRˆ +BZ ˆZ
       1∂ Ψ     1∂Ψ
   = −-----Rˆ+ -----ˆZ
     1R ∂Z     R ∂R
   = --∇Ψ × ˆϕ
     R
   = ∇Ψ × ∇ ϕ                                   (8)
" class="math-display"  /><a 
 id="x1-3005r8"></a></center>
</div>
<!--l. 135--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-40002.2"></a>Toroidal magnetic ﬁeld</h4>
<!--l. 137--><p class="noindent" >Next, let’s examine the toroidal component <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub>. Equation (<a 
href="#x1-2003r3">3<!--tex4ht:ref: 9-6-p1 --></a>) indicates that <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> involves both <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">R</span></sub> and
<span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">Z</span></sub>, which means that using the potential form does not enable useful simpliﬁcation for <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub>. Therfore
we will directly use <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub>. Deﬁne <span 
class="cmmi-10">g </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">RB</span><sub><span 
class="cmmi-7">ϕ</span></sub>(<span 
class="cmmi-10">R,Z</span>) (the reason that we deﬁne this quantity
will become clear when we discuss the forece balance), then the toroidal magnetic ﬁeld is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-4001r9"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium9x.png" alt="            g
Bϕ = Bϕϕˆ=  Rˆϕ = g∇ ϕ.
" class="math-display"  /></center></td><td class="equation-label">(9)</td></tr></table>
<!--l. 146--><p class="nopar" >
                                                                                

                                                                                
</p><!--l. 148--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-50002.3"></a>General form of axisymmetric magnetic ﬁeld</h4>
<!--l. 150--><p class="noindent" >Combining Eqs. (<a 
href="#x1-3005r8">8<!--tex4ht:ref: 20-5-9-p10 --></a>) and (<a 
href="#x1-4001r9">9<!--tex4ht:ref: 7-28-1 --></a>), we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium10x.png" alt="B = Bp + B ϕ

  = ∇ Ψ × ∇ϕ + g∇ϕ,                           (10)
" class="math-display"  /><a 
 id="x1-5001r10"></a></center>
</div>which is a general expression of axisymmetric magnetic ﬁeld. Expression (<a 
href="#x1-5001r10">10<!--tex4ht:ref: 7-28-6 --></a>) is a famous formula in
tokamak physics.
<!--l. 158--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-60002.4"></a>Gauge transform of <span 
class="cmmi-10">Ψ</span></h4>
<!--l. 160--><p class="noindent" >Let us discuss the gauge transformation of the vector potential <span 
class="cmbx-10">A </span>in the axisymmetric case. As is well
known, magnetic ﬁeld remains the same under the following gauge transformation:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-6001r11"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium11x.png" alt="Anew = A +∇f,
" class="math-display"  /></center></td><td class="equation-label">(11)</td></tr></table>
<!--l. 165--><p class="nopar" >
where <span 
class="cmmi-10">f </span>is an arbitrary scalar ﬁeld. Here we require that <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">f </span>be axisymmetric because, as mentioned
above, an axisymmetric vector potential suﬃces for describing an axisymmetric magnetic ﬁeld. In
cylindrical coordinates, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">f </span>is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-6002r12"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium12x.png" alt="∇f = -∂fRˆ+ -∂fˆZ + 1-∂fϕˆ.
     ∂R     ∂Z     R ∂ϕ
" class="math-display"  /></center></td><td class="equation-label">(12)</td></tr></table>
<!--l. 174--><p class="nopar" >
Since <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">f </span>is axisymmetric, it follows that all the three components of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">f </span>are independent of <span 
class="cmmi-10">ϕ</span>, i.e.,
<span 
class="cmmi-10">∂</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">f∕∂R∂ϕ </span>= 0, <span 
class="cmmi-10">∂</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">f∕∂Z∂ϕ </span>= 0, and <span 
class="cmmi-10">∂</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">f∕∂ϕ</span><sup><span 
class="cmr-7">2</span></sup> = 0, which implies that <span 
class="cmmi-10">∂f∕∂ϕ </span>is independent of <span 
class="cmmi-10">R</span>, <span 
class="cmmi-10">Z</span>,
and <span 
class="cmmi-10">ϕ</span>, i.e., <span 
class="cmmi-10">∂f∕∂ϕ </span> is actually a spatial constant. Using this, the <span 
class="cmmi-10">ϕ </span>component of the gauge
transformation (<a 
href="#x1-6001r11">11<!--tex4ht:ref: 7-25-1 --></a>) is written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium13x.png" alt="Anϕew= A ϕ +-1∂f-
           R ∂ϕ
    = A ϕ + C-,                             (13)
           R
" class="math-display"  /><a 
 id="x1-6003r13"></a></center>
</div>where <span 
class="cmmi-10">C </span>is a constant. The requirement of being axial symmetry greatly reduces the degree of freedom
of the gauge transformation for <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub>. Multiplying Eq. (<a 
href="#x1-6003r13">13<!--tex4ht:ref: 7-24-p1 --></a>) with <span 
class="cmmi-10">R</span>, we obtain the corresponding gauge
transformation for <span 
class="cmmi-10">Ψ</span>,
   <table 
class="equation"><tr><td><a 
 id="x1-6004r14"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium14x.png" alt="Ψ new = Ψ + C,
" class="math-display"  /></center></td><td class="equation-label">(14)</td></tr></table>
<!--l. 193--><p class="nopar" >
which indicates <span 
class="cmmi-10">Ψ </span>has the same gauge transformation as the electric potential, i.e., adding a constant.
Note that the deﬁnition <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) <span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">RA</span><sub><span 
class="cmmi-7">ϕ</span></sub> does not imply <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R </span>= 0<span 
class="cmmi-10">,Z</span>) = 0 because <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> can adopt 1<span 
class="cmmi-10">∕R</span>
dependence under the gauge transformation (<a 
href="#x1-6003r13">13<!--tex4ht:ref: 7-24-p1 --></a>). However, we are usually interested in the situation
                                                                                

                                                                                
where <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> is ﬁnite at <span 
class="cmmi-10">R </span>= 0 (and axisymmetry indicates that <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub>(<span 
class="cmmi-10">R </span>= 0<span 
class="cmmi-10">,Z</span>) is a spatial constant). In
this case, <span 
class="cmmi-10">Ψ </span>is zero at <span 
class="cmmi-10">R </span>= 0. This is the case we encounter in equilibrium reconstruction,
where magnetic ﬂux measurements are used to constrain the numerically reconstructed
<span 
class="cmmi-10">Ψ</span>.
</p><!--l. 204--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-70002.5"></a>Contours of <span 
class="cmmi-10">Ψ </span>in the poloidal plane</h4>
<!--l. 206--><p class="noindent" >Because <span 
class="cmmi-10">Ψ </span>is constant along a magnetic ﬁeld line and <span 
class="cmmi-10">Ψ </span>is independent of <span 
class="cmmi-10">ϕ</span>, it follows that the
projection of a magnetic ﬁeld line onto (<span 
class="cmmi-10">R,Z</span>) plane is a contour of <span 
class="cmmi-10">Ψ</span>. On the other hand,  are contours
of <span 
class="cmmi-10">Ψ </span>on (<span 
class="cmmi-10">R,Z</span>) plane also the projections of magnetic ﬁeld lines onto the plane? Yes, they are. [Proof. A
contour of <span 
class="cmmi-10">Ψ </span>on (<span 
class="cmmi-10">R,Z</span>) plane satisﬁes
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-7001r15"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium15x.png" alt="dΨ = 0,
" class="math-display"  /></center></td><td class="equation-label">(15)</td></tr></table>
<!--l. 214--><p class="nopar" >
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-7002r16"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium16x.png" alt="∂Ψ      ∂Ψ
---dR + ---dZ = 0.
∂R      ∂Z
" class="math-display"  /></center></td><td class="equation-label">(16)</td></tr></table>
<!--l. 219--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-7003r17"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium17x.png" alt="   1 ∂Ψ      1∂Ψ
⇒  R∂R-dR + R-∂Z-dZ = 0.
" class="math-display"  /></center></td><td class="equation-label">(17)</td></tr></table>
<!--l. 223--><p class="nopar" >
Using Eqs. (<a 
href="#x1-3002r5">5<!--tex4ht:ref: 7-14-p1 --></a>) and (<a 
href="#x1-3003r6">6<!--tex4ht:ref: 6-9-a4 --></a>), the above equation is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-7004r18"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium18x.png" alt="BZdR  − BRdZ = 0,
" class="math-display"  /></center></td><td class="equation-label">(18)</td></tr></table>
<!--l. 227--><p class="nopar" >
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-7005r19"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium19x.png" alt="dZ    BZ
dR-=  B--,
       R
" class="math-display"  /></center></td><td class="equation-label">(19)</td></tr></table>
<!--l. 231--><p class="nopar" >
which is the equation of the projection of a magnetic ﬁeld line in (<span 
class="cmmi-10">R,Z</span>) plane. This proves that
contours of <span 
class="cmmi-10">Ψ </span>are also the projections of magnetic ﬁeld lines in (<span 
class="cmmi-10">R,Z</span>) plane.]
                                                                                

                                                                                
</p><!--l. 236--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.6   </span> <a 
 id="x1-80002.6"></a>Magnetic surfaces</h4>
<!--l. 238--><p class="noindent" >For axial symmetry system, magnetic surfaces can be deﬁned in a trivial way. The axial symmetry of
tokamak magnetic ﬁeld allows us to introduce a surface of revolution that is generated by rotating the
projection of a magnetic ﬁeld line on (<span 
class="cmmi-10">R,Z</span>) plane around the axis of symmetry, <span 
class="cmmi-10">Z </span>axis. The unique
property of this revolution surface is that no ﬁeld line point-intersects it and a ﬁeld line
with one point on it will have the whole ﬁeld line on it. This revolution surface can be
called a magnetic surface. For instance, consider an arbitrary magnetic ﬁeld line, whose
projection on the poloidal plane is shown in Fig. <a 
href="#x1-80011">1<!--tex4ht:ref: 7-28-5 --></a>. A magnetic surface is generated by
rotating the projection line around the <span 
class="cmmi-10">Z </span>axis (some people disagree with this deﬁntion since
they only consider toroidal surfaces that are closed within a tokamak vessell as magnetic
surfaces.)
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-80011"></a>
                                                                                

                                                                                
<!--l. 252--><p class="noindent" > <img 
src="my_figure/home/yj/theory/tokamak_equilibrium/figures/axisymmetrical_magnetic_field-1b.png" alt="pict"  
 width="302.12874pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 1: </span><span  
class="content">A magnetic surface in tokamak is a revolution surface generated by rotating the projection
of a magnetic ﬁeld line in the poloidal plane [(<span 
class="cmmi-10">R,Z</span>) plane] around the <span 
class="cmmi-10">Z </span>axis. The projection is
not necessarily a closed curve in the poloidal plane, as is shown in this ﬁgure.</span></div><!--tex4ht:label?: x1-80011 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 260--><p class="indent" >   The value of <span 
class="cmmi-10">Ψ </span>is constant on a magnetic surface (since <span 
class="cmmi-10">Ψ </span>is constant along a magnetic ﬁeld
line and <span 
class="cmmi-10">Ψ </span>is independent of <span 
class="cmmi-10">ϕ</span>). On the other hand, the value of <span 
class="cmmi-10">Ψ </span>is usually diﬀerent on
diﬀerent magnetic surfaces. The above two facts enable <span 
class="cmmi-10">Ψ </span>to be used as labels of magnetic
surfaces.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.7   </span> <a 
 id="x1-90002.7"></a>Relation of <span 
class="cmmi-10">Ψ </span>with the poloidal magnetic ﬂux</h4>
<!--l. 268--><p class="noindent" >Note that <span 
class="cmmi-10">Ψ </span>is deﬁned by <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">RA</span><sub><span 
class="cmmi-7">ϕ</span></sub>, which is just a component of the vector potential <span 
class="cmbx-10">A</span>,
thereby having no obvious physical meaning. Next, we try to ﬁnd the physical meaning of
<span 
class="cmmi-10">Ψ</span>, i.e., some simple algebraic relation of <span 
class="cmmi-10">Ψ </span>with some quantity that can be measured in
experiments.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-90012"></a>
                                                                                

                                                                                
<!--l. 275--><p class="noindent" > <img 
src="my_figure/home/yj/theory/tokamak_equilibrium/figures/axisymmetrical_magnetic_field-3b.png" alt="pict"  
 width="301.125pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 2: </span><span  
class="content">The poloidal magnetic ﬂux <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub> between the two magnetic surfaces <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub> and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">2</span></sub> is given by
<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub> = 2<span 
class="cmmi-10">π</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub>).</span></div><!--tex4ht:label?: x1-90012 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 283--><p class="indent" >   In Fig. <a 
href="#x1-90012">2<!--tex4ht:ref: 9-8-p1 --></a>, there are two magnetic surfaces labeled, respectively, by <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub> and <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">2</span></sub>. Using
Gauss’s theorem in the toroidal volume between the two magnetic surface, we know that the poloidal
magnetic ﬂux through any toroidal ribbons between the two magnetic surfaces is equal to each other.
Next, we calculate this poloidal magnetic ﬂux. To make the calculation easy, we select a plane
perpendicular to the <span 
class="cmmi-10">Z </span>axis, as is shown by the dash line in Fig. <a 
href="#x1-80011">1<!--tex4ht:ref: 7-28-5 --></a>. In this case, only <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">Z</span></sub> contribute to
the poloidal magnetic ﬂux, which is written (the positive direction of the plane is chosen in the
direction of <img 
src="tokamak_equilibrium20x.png" alt="Zˆ"  class="circ"  />) </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium21x.png" alt="     ∫
       R2
Ψp =  R1 Bz (R, Z)2πRdR
     ∫ R2 1∂ Ψ
   =     -----2πRdR
      R1∫ R ∂R
         R2 ∂Ψ-
   = 2π  R1 ∂R dR
   = 2π[Ψ2 − Ψ1].                               (20)
" class="math-display"  /><a 
 id="x1-9002r20"></a></center>
</div>Equation (<a 
href="#x1-9002r20">20<!--tex4ht:ref: 7-24-2 --></a>) provides a simple physical meaning for <span 
class="cmmi-10">Ψ</span>, i.e., the diﬀerence of 2<span 
class="cmmi-10">πΨ </span>between two
magnetic surfaces is equal to the poloidal magnetic ﬂux enclosed by the two magnetic surfaces. Noting
that we are considering the axisymmetric case, the physical meaning of <span 
class="cmmi-10">Ψ </span>can also be stated as: the
diﬀerence of <span 
class="cmmi-10">Ψ </span>between two magnetic surfaces is equal to the poloidal magnetic ﬂux per radian. Due to
this relation, <span 
class="cmmi-10">Ψ </span>is usually called the “poloidal magnetic ﬂux function” in tokamak literature. Note that
it is the diﬀerence of <span 
class="cmmi-10">Ψ </span>between two locations that determines the the physical quantities <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub>, which is
consistent with the fact that gauge transformation (<a 
href="#x1-6004r14">14<!--tex4ht:ref: 7-24-p3 --></a>) dose not change the values of physical
quantities.
   <h4 class="subsectionHead"><span class="titlemark">2.8   </span> <a 
 id="x1-100002.8"></a>Measurement of poloidal magnetic ﬂux</h4>
<!--l. 314--><p class="noindent" >By measuring the voltage around a toroidal wire loop, we can obtain the time derivative of the poloidal
magnetic ﬂux though the loop and, after integrating over time, the poloidal magnetic ﬂux
itself.
</p><!--l. 318--><p class="indent" >   Suppose that the loop is located at (<span 
class="cmmi-10">R,Z</span>) and denote the magnetic ﬂux through the loop by
<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">pol</span></sub>(<span 
class="cmmi-10">R,Z,t</span>) (only the poloidal magnetic ﬁeld contribute to this ﬂux since the loop is in the toroidal
direction). Then Faraday’s law gives
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-10001r21"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium22x.png" alt="𝜀 = − dΨpol,
      dt
" class="math-display"  /></center></td><td class="equation-label">(21)</td></tr></table>
<!--l. 324--><p class="nopar" >
where <span 
class="cmmi-10">𝜀 </span>is the emf. If the loop is a coil with <span 
class="cmmi-10">N </span>turns, the induced voltage <span 
class="cmmi-10">V </span>in the coil is <span 
class="cmmi-10">N </span>times the
emf <span 
class="cmmi-10">𝜀</span>, i.e., <span 
class="cmmi-10">V </span>= <span 
class="cmmi-10">N𝜀</span>. Using this, Eq. (<a 
href="#x1-10001r21">21<!--tex4ht:ref: 8-16-e1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-10002r22"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium23x.png" alt="V = − N dΨpol.
         dt
" class="math-display"  /></center></td><td class="equation-label">(22)</td></tr></table>
<!--l. 330--><p class="nopar" >
Integrating the above equation over time, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-10003r23"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium24x.png" alt="                          1 ∫ t
Ψpol(R,Z,t) = Ψpol(R,Z, 0)−--   V dt.
                          N  0
" class="math-display"  /></center></td><td class="equation-label">(23)</td></tr></table>
<!--l. 335--><p class="nopar" >
The starting time <span 
class="cmmi-10">t </span>= 0 can be chosen at a time when no plasma is present and thus the initial value,
<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">pol</span></sub>(<span 
class="cmmi-10">R,Z,</span>0), is easy to obtain.
</p><!--l. 339--><p class="indent" >   As discussed in Sec. <a 
href="#x1-90002.7">2.7<!--tex4ht:ref: 9-5-5 --></a> ,the relation between <span 
class="cmmi-10">Ψ </span>and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">pol</span></sub> is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-10004r24"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium25x.png" alt="Ψpol(R,Z,t) = 2π[Ψ(R,Z,t)− Ψ(R = 0,Z,t)],
" class="math-display"  /></center></td><td class="equation-label">(24)</td></tr></table>
<!--l. 344--><p class="nopar" >
where <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R </span>= 0<span 
class="cmmi-10">,Z,t</span>), as discussed above, is zero. Then Eq. (<a 
href="#x1-10004r24">24<!--tex4ht:ref: 19-5-7-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-10005r25"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium26x.png" alt="           1--
Ψ(R,Z,t) = 2πΨpol(R,Z,t),
" class="math-display"  /></center></td><td class="equation-label">(25)</td></tr></table>
<!--l. 349--><p class="nopar" >
which tells us how to obtain <span 
class="cmmi-10">Ψ </span>form the measured <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">pol</span></sub>(<span 
class="cmmi-10">R,Z,t</span>), which in trun is inferred from the
measured voltage <span 
class="cmmi-10">V </span>, as is given by Eq. (<a 
href="#x1-10003r23">23<!--tex4ht:ref: 24-6-25-e1 --></a>).
</p><!--l. 354--><p class="indent" >   Note that the positive normal direction of the surface (where the magnetic ﬂux <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">pol</span></sub> is deﬁned) is
chosen in the <span 
class="cmbx-10">Z </span>direction.
</p><!--l. 357--><p class="indent" >   The above toroidal loop of wire used to measure poloidal magnetic ﬂux is often called “ﬂux
loop” by tokamak operators. There are usually many ﬂux loops (e.g. 35 on EAST<span class="cite">[<a 
href="#Xxiao2007">31</a>]</span>, 41 on
DIII-D) at diﬀerent locations in the poloidal plane (see Fig. <a 
href="#x1-100063">3<!--tex4ht:ref: 19-5-4-p1mm --></a>). The measured value of
poloidal ﬂux can be used as constraints in reconstructing magnetic conﬁguration by, e.g.
EFIT. With the feedback control (by adjusting the current in the poloidal ﬁeld coils), these
measurement, along with the poloidal ﬁeld measurement by magnetic probes, can be used to control
the shape of the last-closed-ﬂux-surface (LCFS), the distance of the LCFS from the ﬁrst
wall, and the X-point location. This is often called iso-ﬂux control, gap control, or X-point
control.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-100063"></a>
                                                                                

                                                                                
<!--l. 370--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/heq/doc/fig1b/p.png" alt="pict"  
 width="244.91501pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 3: </span><span  
class="content">Flux loops (circles) and magnetic probes (blue arows) on EAST tokamak. Arrows indicate
the positive normal direction of the probes.</span></div><!--tex4ht:label?: x1-100063 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">2.9   </span> <a 
 id="x1-110002.9"></a>Closed magnetic surfaces</h4>
<!--l. 378--><p class="noindent" >In most part of a tokamak plasma, contours of <span 
class="cmmi-10">Ψ </span>on (<span 
class="cmmi-10">R,Z</span>) plane are closed curves. As discussed above,
the contours of <span 
class="cmmi-10">Ψ </span>are the projection of magnetic lines on the poloidal plane. Closed contours of <span 
class="cmmi-10">Ψ</span>
implies closed magnetic surfaces, as shown in Fig <a 
href="#x1-110014">4<!--tex4ht:ref: 7-1-p101 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-110014"></a>
                                                                                

                                                                                
<!--l. 384--><p class="noindent" > <img 
src="my_figure/home/yj/theory/tokamak_equilibrium/figures/poloidal_flux-1.png" alt="pict"  
 width="384.43625pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 4: </span><span  
class="content">Closed magnetic surfaces (blue) and various toroidal surfaces used to deﬁne the poloidal
magnetic ﬂux. The magnetic ﬂux through the toroidal surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> and <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">3</span></sub> is equal to each other.
Also the magnetic ﬂux through <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">4</span></sub> and <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">5</span></sub> is equal to each other; the magnetic ﬂux through <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">0</span></sub>
and <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">1</span></sub> is equal to each other.</span></div><!--tex4ht:label?: x1-110014 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 392--><p class="indent" >   The innermost magnetic surface reduces to a curve, which is called magnetic axis (in Fig. <a 
href="#x1-110014">4<!--tex4ht:ref: 7-1-p101 --></a>, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>
labels the magnetic axis). Because the magnetic axis is the point of maximum/minimum of <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>),
the value of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span>is zero at the magnetic axis. As a result, the poloidal component of the equilibrium
magnetic ﬁeld is zero on magnetic axis (refer to Eq. (<a 
href="#x1-3005r8">8<!--tex4ht:ref: 20-5-9-p10 --></a>)), i.e., the magnetic ﬁeld has only toroidal
component there.
</p><!--l. 400--><p class="indent" >   As is discussed in Sec. <a 
href="#x1-90002.7">2.7<!--tex4ht:ref: 9-5-5 --></a>, the poloidal magnetic ﬂux enclosed by a magnetic surface <span 
class="cmmi-10">Ψ </span>(the poloidal
magnetic ﬂux through the toroidal surfaces <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub>) is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-11002r26"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium27x.png" alt="Ψp = 2π(Ψ0 − Ψ ),
" class="math-display"  /></center></td><td class="equation-label">(26)</td></tr></table>
<!--l. 405--><p class="nopar" >
where <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> is the value of <span 
class="cmmi-10">Ψ </span>at the magnetic axis. Here the positive direction of the surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> is deﬁned
to be in the clockwise direction when an observer looks along the direction of <img 
src="tokamak_equilibrium28x.png" alt="ˆϕ"  class="circ"  />. In practice, we need to
pay attention to the positive direction chosen (there can be a sign diﬀerence when choosing diﬀerent
positive directions).
</p><!--l. 412--><p class="indent" >   Also note, the poloidal magnetic ﬂux enclosed by a closed magnetic surface can have two diﬀerent
deﬁnitions, one of which is the the poloidal magnetic ﬂux through the surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> in Fig. <a 
href="#x1-110014">4<!--tex4ht:ref: 7-1-p101 --></a>, the other
one is the poloidal magnetic ﬂux through the central hole of the magnetic surface, i.e., the poloidal ﬂux
through <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">1</span></sub> in Fig. <a 
href="#x1-110014">4<!--tex4ht:ref: 7-1-p101 --></a>. In the latter case, as is discussed in Sec. <a 
href="#x1-100002.8">2.8<!--tex4ht:ref: 24-6-26-1 --></a>, the poloidal magnetic ﬂux is related
to <span 
class="cmmi-10">Ψ </span>by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-11003r27"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium29x.png" alt="Ψp = 2π(Ψ − Ψ(R = 0,Z )) = 2πΨ,
" class="math-display"  /></center></td><td class="equation-label">(27)</td></tr></table>
<!--l. 421--><p class="nopar" >
where the positive direction of the surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">1</span></sub> is in the clockwise direction.
                                                                                

                                                                                
</p><!--l. 425--><p class="indent" >   Also note that, since the poloidal magnetic ﬁeld can be written as <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ϕ</span>, the condition
<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">LCFS</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">axis</span></sub> <span 
class="cmmi-10">&#x003E; </span>0 means <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> points in the anticlockwise direction (viewed along <span 
class="cmmib-10">ϕ</span> direction), and
<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">LCFS</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">axis</span></sub> <span 
class="cmmi-10">&#x003C; </span>0 means <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> points in the clockwise direction.
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-120002.9"></a>Shape parameters of a closed magnetic surface</h5>
<!--l. 434--><p class="noindent" >Let us introduce parameters characterizing the shape of a magnetic surface in the poloidal plane. The
“midplane” is deﬁned as the plane that passes through the magnetic axis and is perpendicular to the
symmetric axis (<span 
class="cmmi-10">Z </span>axis). For a up-down symmetric (about the midplane) magnetic surface, its shape
can be roughly characterized by four parameters, namely, the <span 
class="cmmi-10">R </span>coordinate of the innermost and
outermost points in the midplane, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">in</span></sub> and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">out</span></sub>; the (<span 
class="cmmi-10">R,Z</span>) coordinators of the highest
point of the magnetic surface, (<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">top</span></sub><span 
class="cmmi-10">,Z</span><sub><span 
class="cmr-7">top</span></sub>). These four parameters are indicated in Fig.
<a 
href="#x1-120015">5<!--tex4ht:ref: 8-9-p1 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-120015"></a>
                                                                                

                                                                                
<!--l. 445--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/solovev_equilibrium/fig2/plt.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 5: </span><span  
class="content">Four parameters characterizing the shape of a ﬂux surface: the <span 
class="cmmi-10">R </span>coordinate of the
innermost and outermost points in the middle-plane, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">in</span></sub> and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">out</span></sub>; the (<span 
class="cmmi-10">R,Z</span>) coordinators of
the highest point of the ﬂux surface, (<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">top</span></sub><span 
class="cmmi-10">,Z</span><sub><span 
class="cmr-7">top</span></sub>).</span></div><!--tex4ht:label?: x1-120015 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 453--><p class="indent" >   In terms of these four parameters, we can deﬁne the major radius of a magnetic surface
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-12002r28"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium30x.png" alt="     Rin-+Rout
R0 =     2    ,
" class="math-display"  /></center></td><td class="equation-label">(28)</td></tr></table>
<!--l. 457--><p class="nopar" >
(which is the <span 
class="cmmi-10">R </span>coordinate of the geometric center of the magnetic surface), the minor radius of a
magnetic surface
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-12003r29"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium31x.png" alt="    Rout − Rin
a = ----2----,
" class="math-display"  /></center></td><td class="equation-label">(29)</td></tr></table>
<!--l. 462--><p class="nopar" >
the triangularity of a magnetic surface
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-12004r30"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium32x.png" alt="    R  − R
δt =--0---top,
        a
" class="math-display"  /></center></td><td class="equation-label">(30)</td></tr></table>
                                                                                

                                                                                
<!--l. 466--><p class="nopar" >
and, the ellipticity (elongation) of a magnetic surface
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-12005r31"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium33x.png" alt="   Ztop
κ =  a .
" class="math-display"  /></center></td><td class="equation-label">(31)</td></tr></table>
<!--l. 470--><p class="nopar" >
Usually, we specify the value of <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>, <span 
class="cmmi-10">a</span>, <span 
class="cmmi-10">δ</span><sub><span 
class="cmmi-7">t</span></sub>, and <span 
class="cmmi-10">κ</span>, instead of (<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">in</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmr-7">out</span></sub><span 
class="cmmi-10">,R</span><sub><span 
class="cmr-7">top</span></sub><span 
class="cmmi-10">,Z</span><sub><span 
class="cmr-7">top</span></sub>), to characterize the
shape of a magnetic surface. The value of the triangularity <span 
class="cmmi-10">δ</span><sub><span 
class="cmmi-7">t</span></sub> is usually positive in traditional tokamak
operations, but negative triangularity is achievable and potentially useful, which is under active
investigation.
</p><!--l. 478--><p class="indent" >   Besides, using <span 
class="cmmi-10">a </span>and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>, we can deﬁne another useful parameter <span 
class="cmmi-10">𝜀 </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">a∕R</span><sub><span 
class="cmr-7">0</span></sub>, which is called the
inverse aspect ratio.
</p><!--l. 481--><p class="indent" >   The four shape parameters for the typical Last-Closed-Flux-Surface (LCFS) of EAST tokamak are:
major radius <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>85<span 
class="cmmi-10">m </span>(can reach 1<span 
class="cmmi-10">.</span>9<span 
class="cmmi-10">m</span>), minor radius <span 
class="cmmi-10">a </span>= 0<span 
class="cmmi-10">.</span>45<span 
class="cmmi-10">m</span>, ellipticity <span 
class="cmmi-10">κ </span>= 1<span 
class="cmmi-10">.</span>8 (can
be in the range from 1.5 to 2.0), triangularity <span 
class="cmmi-10">δ</span><sub><span 
class="cmmi-7">t</span></sub> = 0<span 
class="cmmi-10">.</span>6 (can be in the range from 0.3 to
0.6). Note that the major radius <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> of the LCFS is usually diﬀerent from <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">axis</span></sub> (the <span 
class="cmmi-10">R</span>
coordinate of the magnetic axis). Usually we have <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">axis</span></sub> <span 
class="cmmi-10">&#x003E; R</span><sub><span 
class="cmr-7">0</span></sub> due to the so-called Shafranov
shift.
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.10   </span> <a 
 id="x1-130002.10"></a>Safety factor</h4>
<!--l. 491--><p class="noindent" >Magnetic ﬁeld lines on closed magnetic surfaces travel closed curves in a poloidal plane. For these ﬁeld
lines, we can deﬁne the safety factor <span 
class="cmmi-10">q</span>, which is the number of toroidal loops a magnetic ﬁeld line
travels when it makes one poloidal loop, i.e.
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-13001r32"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium34x.png" alt="q ≡ △ϕ-,
    2π
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(32)</td></tr></table>
<!--l. 497--><p class="nopar" >
where <span 
class="cmsy-10">△</span><span 
class="cmmi-10">ϕ </span>as the change of the toroidal angle when a magnetic ﬁeld line travels a full poloidal loop. The
safety factor can also be understood as the average pitch angle of a magnetic ﬁeld line in (<span 
class="cmmi-10">𝜃,ϕ</span>) plane of
a closed magnetic surface.
</p><!--l. 503--><p class="indent" >   For open ﬁeld line region (where a ﬁeld line touches the wall before its poloidal projection can close
itself), the “connection length” is often used to characterize the magnetic ﬁeld.
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-140002.10"></a>Expression of safety factor in terms of magnetic ﬁeld</h5>
<!--l. 509--><p class="noindent" >The equation of magnetic ﬁeld lines is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-14001r33"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium35x.png" alt="Rdϕ-= B-ϕ,
dℓp   Bp
" class="math-display"  /></center></td><td class="equation-label">(33)</td></tr></table>
<!--l. 512--><p class="nopar" >
where <span 
class="cmmi-10">dℓ</span><sub><span 
class="cmmi-7">p</span></sub> is the line element along the direction of <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> on the poloidal plane. Equation (<a 
href="#x1-14001r33">33<!--tex4ht:ref: 7-1-p2 --></a>) can be
arranged in the form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-14002r34"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium36x.png" alt="     1 B
dϕ = ----ϕdℓp,
     R Bp
" class="math-display"  /></center></td><td class="equation-label">(34)</td></tr></table>
<!--l. 517--><p class="nopar" >
which can be integrated over <span 
class="cmmi-10">dℓ</span><sub><span 
class="cmmi-7">p</span></sub> to give
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-14003r35"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium37x.png" alt="     ∮  1 B
△ϕ =    ---ϕdℓp,
        R Bp
" class="math-display"  /></center></td><td class="equation-label">(35)</td></tr></table>
<!--l. 521--><p class="nopar" >
where the line integration is along the poloidal magnetic ﬁeld (the contour of <span 
class="cmmi-10">Ψ </span>on the poloidal plane).
Using this, Eq. (<a 
href="#x1-13001r32">32<!--tex4ht:ref: 7-1-p3 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-14004r36"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium38x.png" alt="     1 ∮ 1 Bϕ
q = 2π-  R-B--dℓp.
             p
" class="math-display"  /></center></td><td class="equation-label">(36)</td></tr></table>
<!--l. 529--><p class="nopar" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-150002.10"></a>Expression of safety factor in terms of magnetic ﬂux</h5>
<!--l. 534--><p class="noindent" >The safety factor given by Eq. (<a 
href="#x1-14004r36">36<!--tex4ht:ref: 9-5-e1 --></a>) is expressed in terms of the components of the magnetic ﬁeld.
The safety factor can also be expressed in terms of the magnetic ﬂux. Deﬁne <span 
class="cmmi-10">ΔΨ</span><sub><span 
class="cmmi-7">p</span></sub> as the
poloidal magnetic ﬂux enclosed by two neighboring magnetic surface, then <span 
class="cmmi-10">ΔΨ</span><sub><span 
class="cmmi-7">p</span></sub> is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-15001r37"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium39x.png" alt="Δ Ψp = 2πR ΔxBp
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(37)</td></tr></table>
<!--l. 541--><p class="nopar" >
where <span 
class="cmmi-10">Δx </span>is the length of a line segment in the poloidal plane between the two magnetic surfaces,
which is perpendicular to the ﬁrst magnetic surface (so perpendicular to the <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub>). Note that <span 
class="cmmi-10">Δx</span>, as well
as <span 
class="cmmi-10">R </span>and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub>, generally depends on the poloidal location whereas <span 
class="cmmi-10">ΔΨ</span><sub><span 
class="cmmi-7">p</span></sub> is independent of the poloidal
location.
</p><!--l. 548--><p class="indent" >   Using Eq. (<a 
href="#x1-15001r37">37<!--tex4ht:ref: 7-9-dy --></a>), the poloidal magnetic ﬁeld is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-15002r38"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium40x.png" alt="     -1--Δ-Ψp
Bp = 2πR Δx  .
" class="math-display"  /></center></td><td class="equation-label">(38)</td></tr></table>
<!--l. 551--><p class="nopar" >
Substituting Eq. (<a 
href="#x1-15002r38">38<!--tex4ht:ref: 7-28 --></a>) into Eq. (<a 
href="#x1-14004r36">36<!--tex4ht:ref: 9-5-e1 --></a>), we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-15003r39"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium41x.png" alt="    1 ∮  1 Bϕ       1 ∮ 1 2πR ΔxB ϕ     ∮  ΔxB ϕ
q = 2π-  R-B--dℓp = 2π-  R----ΔΨ----dℓp =   Δ-Ψ--dℓp.
            p                  p              p
" class="math-display"  /></center></td><td class="equation-label">(39)</td></tr></table>
<!--l. 557--><p class="nopar" >
We know <span 
class="cmmi-10">ΔΨ</span><sub><span 
class="cmmi-7">p</span></sub> is a constant independent of the poloidal location, so <span 
class="cmmi-10">ΔΨ</span><sub><span 
class="cmmi-7">p</span></sub> can be taken outside the
integration to give
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-15004r40"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium42x.png" alt="        ∮
q =--1-   ΔxB  dℓ
   Δ Ψp       ϕ  p
" class="math-display"  /></center></td><td class="equation-label">(40)</td></tr></table>
<!--l. 563--><p class="nopar" >
It is ready to realise that the integral appearing in Eq. (<a 
href="#x1-15004r40">40<!--tex4ht:ref: 17-11-12-1 --></a>) is the toroidal magnetic ﬂux enclosed by
the two magnetic surfaces, <span 
class="cmmi-10">ΔΨ</span><sub><span 
class="cmmi-7">t</span></sub>. Using this, Eq. (<a 
href="#x1-15004r40">40<!--tex4ht:ref: 17-11-12-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-15005r41"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium43x.png" alt="q = ΔΨt-
    ΔΨp
" class="math-display"  /></center></td><td class="equation-label">(41)</td></tr></table>
<!--l. 569--><p class="nopar" >
Equation (<a 
href="#x1-15005r41">41<!--tex4ht:ref: 9-6-p2 --></a>) indicates that the safety factor of a magnetic surface is equal to the diﬀerential of the
toroidal magnetic ﬂux with respect to the poloidal magnetic ﬂux enclosed by the magnetic
surface.
</p><!--l. 574--><p class="indent" >    
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-160002.10"></a>Rational surfaces vs. irrational surfaces</h5>
<!--l. 578--><p class="noindent" >If the safety factor of a magnetic surface is a rational number, i.e., <span 
class="cmmi-10">q </span>= <span 
class="cmmi-10">m∕n</span>, where <span 
class="cmmi-10">m </span>and <span 
class="cmmi-10">n </span>are
integers, then this magnetic surface is called a rational surface, otherwise an irrational surface. A ﬁeld
line on a rational surface with <span 
class="cmmi-10">q </span>= <span 
class="cmmi-10">m∕n </span>closes itself after it travels <span 
class="cmmi-10">n </span>poloidal loops. An example of a
ﬁeld line on a rational surface is shown in Fig. <a 
href="#x1-160016">6<!--tex4ht:ref: 17-1-1-1 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-160016"></a>
                                                                                

                                                                                
<!--l. 585--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/nbi_fig/fig12/p.png" alt="pict"  
 width="264.99pt" />                                     <img 
src="my_figure/home/yj/project_new/nbi_fig/fig12b/p.png" alt="pict"  
 width="166.6225pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 6: </span><span  
class="content">Left: A magnetic ﬁeld line (blue) on a rational surface with <span 
class="cmmi-10">q </span>= 2<span 
class="cmmi-10">.</span>1 = 21<span 
class="cmmi-10">∕</span>10 (magnetic
ﬁeld is from EAST discharge #59954@3.1s). This ﬁeld line closes itself after traveling 21 toroidal
loops (meanwhile, it travels 10 poloidal loops). Right: The intersecting points of the magnetic
ﬁeld line with the <span 
class="cmmi-10">ϕ </span>= 0 plane when it is traveling toroidally. The sequence of the intersecting
points is indicated by the number labels. The 22nd intersecting point coincides with the 1st point
and then the intersecting points repeat themselves.</span></div><!--tex4ht:label?: x1-160016 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 596--><p class="indent" >    
</p>
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-170003"></a>Non-axisymmetric magnetic perturbations</h3>
<!--l. 600--><p class="noindent" >In the above, the magnetic ﬁeld is assumed to be axisymmetric. With this assumption, the poloidal
magnetic ﬁeld (having two components) can be expressed in terms of a single component of the vector
potential <span 
class="cmbx-10">A</span>, <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> (speciﬁcally via <span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmmi-10">R</span>). This kind of simpliﬁcation can not be achieved if the
axisymmetricity assumption is dropped, because other components of the vector potential (namely <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">R</span></sub>
and <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">Z</span></sub>) will appear in the expression of the poloidal magnetic ﬁeld. Let us re-examine Eq. (<a 
href="#x1-2002r2">2<!--tex4ht:ref: 4-16-p1 --></a>) for a
general magnetic perturbation: </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium44x.png" alt="     (              )     (                    )
      1-∂δAZ-   ∂δAϕ- ˆ     1-∂(R-δAϕ)-  1-∂δAR-  ˆ
δB  =  R  ∂ϕ  −   ∂Z   R +   R   ∂R    − R  ∂ϕ   Z
     (∂δAR    ∂δAZ )
   +  -∂Z-- − -∂R-- ϕˆ.                                       (42)
" class="math-display"  /><a 
 id="x1-17001r42"></a></center>
</div>When studying tearing modes and turbulence, most authors narrow the possible perturbations by
setting <span 
class="cmmi-10">δA</span><sub><span 
class="cmmi-7">R</span></sub> = <span 
class="cmmi-10">δA</span><sub><span 
class="cmmi-7">Z</span></sub> = 0, i.e.,
   <table 
class="equation"><tr><td><a 
 id="x1-17002r43"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium45x.png" alt="        1∂ δΨ
δBR = − R-∂Z-,
" class="math-display"  /></center></td><td class="equation-label">(43)</td></tr></table>
<!--l. 621--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-17003r44"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium46x.png" alt="δBZ  = 1-∂δΨ,
       R ∂R
" class="math-display"  /></center></td><td class="equation-label">(44)</td></tr></table>
<!--l. 624--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-17004r45"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium47x.png" alt="δBϕ = 0.
" class="math-display"  /></center></td><td class="equation-label">(45)</td></tr></table>
<!--l. 627--><p class="nopar" >
where <span 
class="cmmi-10">δΨ </span>= <span 
class="cmmi-10">RδA</span><sub><span 
class="cmmi-7">ϕ</span></sub>. Therefore this kind of magnetic perturbation can still be written in the same form
of the equilibrium poloidal magnetic ﬁeld:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-17005r46"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium48x.png" alt="δB = ∇ δΨ × ∇ϕ.
" class="math-display"  /></center></td><td class="equation-label">(46)</td></tr></table>
<!--l. 633--><p class="nopar" >
The above approximation is widely used in practice, e.g., tearing mode theory; turbulence simulation,
where <span 
class="cmmi-10">δA</span><sub><span 
class="cmmi-7">ϕ</span></sub> is replaced by <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub>. (Do we miss some magnetic perturbations that is important for plasma
transport when using the above speciﬁc form?)
</p><!--l. 639--><p class="indent" >   The total magnetic ﬁeld is then written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-17006r47"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium49x.png" alt="B = ∇ (Ψ + δΨ )× ∇ϕ + g∇ϕ.
" class="math-display"  /></center></td><td class="equation-label">(47)</td></tr></table>
<!--l. 642--><p class="nopar" >
**check**Can the projection of the total magnetic ﬁeld line in the poloidal plane can be traced by
tracing the contour of <span 
class="cmmi-10">Ψ </span>+ <span 
class="cmmi-10">δΨ</span>? No. The contours of <span 
class="cmmi-10">Ψ </span>+ <span 
class="cmmi-10">δΨ </span>will not show island structures in the
poloidal plane. To show the expected island structures, we need to subtract non-reconnecting poloidal
magnetic ﬁeld from the total poloidal ﬁeld. I will discuss this in Sec. (), where I will show that contours
of the so-called helical ﬂux will give the expected island structures near the resonant surfaces.**can be
worng, I have not checked this.
</p><!--l. 652--><p class="indent" >   Next, we go back to discuss the 2D case (i.e., assuming axisymmetry).
</p><!--l. 654--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-180004"></a>Plasma current density in terms of <span 
class="cmmi-10">Ψ </span>and <span 
class="cmmi-10">g</span></h3>
<!--l. 656--><p class="noindent" >When the displacement current term is neglectable (the case we consider here), the conductive current
is just another representation of the magnetic ﬁeld. Speciﬁcally, the current density can be written in
terms of the magnetic ﬁeld as (Ampère’s law):
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-18001r48"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium50x.png" alt="                                    (           )
μ J = ∇ ×B  = − ∂B-ϕˆR + 1-∂(RB-ϕ)ˆZ + ∂BR- − ∂BZ-  ˆϕ.
 0              ∂Z     R   ∂R         ∂Z    ∂R
" class="math-display"  /></center></td><td class="equation-label">(48)</td></tr></table>
<!--l. 666--><p class="nopar" >
</p><!--l. 668--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.1   </span> <a 
 id="x1-190004.1"></a>Poloidal current density</h4>
<!--l. 670--><p class="noindent" >Use Eq. (<a 
href="#x1-18001r48">48<!--tex4ht:ref: 3-11-p1 --></a>) and the deﬁnition <span 
class="cmmi-10">g </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">RB</span><sub><span 
class="cmmi-7">ϕ</span></sub>, the poloidal components of the current density, <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">Z</span></sub> and <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">R</span></sub>,
can be written as
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-19001r49"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium51x.png" alt="μ J  = −-1∂g-,
 0 R    R ∂Z
" class="math-display"  /></center></td><td class="equation-label">(49)</td></tr></table>
<!--l. 674--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-19002r50"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium52x.png" alt="μ0JZ =  1-∂g,
        R∂R
" class="math-display"  /></center></td><td class="equation-label">(50)</td></tr></table>
<!--l. 678--><p class="nopar" >
respectively.
</p><!--l. 681--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.2   </span> <a 
 id="x1-200004.2"></a>Toroidal current density</h4>
<!--l. 683--><p class="noindent" >Ampere’s law (<a 
href="#x1-18001r48">48<!--tex4ht:ref: 3-11-p1 --></a>) indicates the toroidal current density <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> is given by </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium53x.png" alt="μ0Jϕ = ∂BR − ∂BZ-
       ∂Z     ∂R   (     )
    = − 1-∂2Ψ-− -∂-  1-∂Ψ- .                      (51)
        R ∂Z2   ∂R   R ∂R
" class="math-display"  /><a 
 id="x1-20001r51"></a></center>
</div>Deﬁne <span 
class="cmsy-10">△</span><sup><span 
class="cmmi-7">⋆</span></sup> by
   <table 
class="equation"><tr><td><a 
 id="x1-20002r52"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium54x.png" alt="                (      )
  ∗   ∂2--   -∂-  1--∂-
△  ≡  ∂Z2 + R∂R   R ∂R  ,
" class="math-display"  /></center></td><td class="equation-label">(52)</td></tr></table>
<!--l. 697--><p class="nopar" >
which is the Laplace operator in cylindrical coordinates for the axisymmertic case, then Eq. (<a 
href="#x1-20001r51">51<!--tex4ht:ref: 9-5-1 --></a>) is
written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-20003r53"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium55x.png" alt="J  = − -1-△ ∗Ψ.
 ϕ     μ0R
" class="math-display"  /></center></td><td class="equation-label">(53)</td></tr></table>
<!--l. 702--><p class="nopar" >
(Many authors call Eq. (<a 
href="#x1-20003r53">53<!--tex4ht:ref: 6-9-a1 --></a>) the Grad-Shafranov equation. This is incorrect. This is just Ampere’s law,
which has nothing to do with the force-balance.)
</p><!--l. 707--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-210005"></a>Constraint of force-balance on magnetic ﬁeld</h3>
<!--l. 709--><p class="noindent" >Let us consider what constraint the force balance imposes on the axisymmetric magnetic ﬁeld discussed
above. The MHD momentum equation is given by
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-21001r54"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium56x.png" alt="  (           )
   ∂u-
ρ   ∂t + u ⋅∇u  = ρqE + J × B − ∇ ⋅ℙ
" class="math-display"  /></center></td><td class="equation-label">(54)</td></tr></table>
<!--l. 715--><p class="nopar" >
where <span 
class="cmmi-10">ρ</span>, <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">q</span></sub>, <span 
class="msbm-10">ℙ</span>, <span 
class="cmbx-10">J</span>, <span 
class="cmbx-10">E</span>, and <span 
class="cmbx-10">B </span>are mass density, charge density, thermal pressure tensor, current density,
electric ﬁeld, and magnetic ﬁeld, respectively. The electric ﬁeld force <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">q</span></sub><span 
class="cmbx-10">E </span>is usually ignored due to
either <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">q</span></sub> = 0 or <span 
class="cmbx-10">E </span>= 0. Further assume that there is no plasma ﬂow (<span 
class="cmbx-10">u </span>= 0, the ﬂow eﬀect is discussed
in <a 
href="#x1-125000A.2">A.2<!--tex4ht:ref: 20-4-7-p2 --></a>) and the plasma pressure is isotropic, then the steady state momentum equation (force balance
equation) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-21002r55"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium57x.png" alt="J × B = ∇P,
" class="math-display"  /></center></td><td class="equation-label">(55)</td></tr></table>
<!--l. 726--><p class="nopar" >
where <span 
class="cmmi-10">P </span>is the scalar plasma pressure.
</p><!--l. 729--><p class="indent" >   Is the force balance (<a 
href="#x1-21002r55">55<!--tex4ht:ref: 7-7-force --></a>) always satisﬁed in a real toakamak discharge? To answer this question, we
need to go back to the original momentum equation (<a 
href="#x1-21001r54">54<!--tex4ht:ref: 19-5-5-1 --></a>). The imbalance between <span 
class="cmbx-10">J </span><span 
class="cmsy-10">× </span><span 
class="cmbx-10">B </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">P </span>will
give rise to the compressional Alfven waves, the time-scale of which, <span 
class="cmmi-10">τ</span><sub><span 
class="cmmi-7">A</span></sub>, is much shorter than the
time-scale <span 
class="cmmi-10">τ </span>we are interested in. Therefore, on the time scale <span 
class="cmmi-10">τ </span>(and for slow ﬂow with <span 
class="cmbx-10">u </span><span 
class="cmmi-10">&#x003C; C</span><sub><span 
class="cmmi-7">s</span></sub>,
where <span 
class="cmmi-10">C</span><sub><span 
class="cmmi-7">s</span></sub> is the the sound speed), the leading order of the momentum equation is the force
balance (<a 
href="#x1-21002r55">55<!--tex4ht:ref: 7-7-force --></a>). (to be sure, I need to think about this again). This reasoning is from Youwen
Sun<span class="cite">[<a 
href="#Xysun2012">25</a>]</span>.
</p><!--l. 740--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.1   </span> <a 
 id="x1-220005.1"></a>Parallel force balance </h4>
<!--l. 742--><p class="noindent" >Consider the force balance in the direction of <span 
class="cmbx-10">B</span>. Dotting the equilibrium equation (<a 
href="#x1-21002r55">55<!--tex4ht:ref: 7-7-force --></a>) by <span 
class="cmbx-10">B</span>, we
obtain
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-22001r56"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium58x.png" alt="0 = B ⋅∇P,
" class="math-display"  /></center></td><td class="equation-label">(56)</td></tr></table>
<!--l. 746--><p class="nopar" >
which implies that <span 
class="cmmi-10">P </span>is constant along a magnetic ﬁeld line. Since <span 
class="cmmi-10">Ψ </span>is also constant along a magnetic
ﬁeld line, <span 
class="cmmi-10">P </span>can be expressed in terms of only <span 
class="cmmi-10">Ψ </span>on a single magnetic line. Note that this does not
necessarily mean <span 
class="cmmi-10">P </span>is a single-valued function of <span 
class="cmmi-10">Ψ</span>, (i.e. <span 
class="cmmi-10">P </span>= <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>)). This is because <span 
class="cmmi-10">P </span>still has the
freedom of taking diﬀerent values on diﬀerent magnetic ﬁeld lines with the same value of <span 
class="cmmi-10">Ψ</span>
while still satisfying <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">P </span>= 0. This situation can appear when there are saddle points (X
points) in <span 
class="cmmi-10">Ψ </span>contours (refer to Sec. <a 
href="#x1-133000A.10">A.10<!--tex4ht:ref: 11-2-p4 --></a>) and <span 
class="cmmi-10">P </span>takes diﬀerent functions of <span 
class="cmmi-10">Ψ </span>in islands of <span 
class="cmmi-10">Ψ</span>
sepearated by a X point. For pressure within a single island of <span 
class="cmmi-10">Ψ</span>, <span 
class="cmmi-10">P </span>= <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) can be safely
assumed.
</p><!--l. 759--><p class="indent" >   On the other hand, if <span 
class="cmmi-10">P </span>= <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>), then we obtain
</p>
   <table 
class="equation-star"><tr><td>
                             <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">P </span>= <img 
src="tokamak_equilibrium59x.png" alt="dP
---
dΨ"  class="frac" align="middle" /><span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">Ψ </span>= 0<span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 761--><p class="nopar" >
i.e., Eq. (<a 
href="#x1-22001r56">56<!--tex4ht:ref: 15-11-27-1 --></a>) is satisﬁed, indicating <span 
class="cmmi-10">P </span>= <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) is a suﬃcient condition for the force balance in the
parallel (to the magnetic ﬁeld) direction.
                                                                                

                                                                                
</p><!--l. 766--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.2   </span> <a 
 id="x1-230005.2"></a>Toroidal force balance</h4>
<!--l. 768--><p class="noindent" >Consider the force balance in the toroidal direction. The <span 
class="cmmi-10">ϕ </span>component of Eq. (<a 
href="#x1-21002r55">55<!--tex4ht:ref: 7-7-force --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-23001r57"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium60x.png" alt="J  B  − J B  = -1∂P-.
  Z R    R  Z  R  ∂ϕ
" class="math-display"  /></center></td><td class="equation-label">(57)</td></tr></table>
<!--l. 773--><p class="nopar" >
Since <span 
class="cmmi-10">P </span>= <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>), which implies <span 
class="cmmi-10">∂P∕∂ϕ </span>= 0, equation (<a 
href="#x1-23001r57">57<!--tex4ht:ref: 15-11-27-2 --></a>) reduces to
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-23002r58"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium61x.png" alt="JZBR − JRBZ  = 0
" class="math-display"  /></center></td><td class="equation-label">(58)</td></tr></table>
<!--l. 778--><p class="nopar" >
Using the expressions of the poloidal current density (<a 
href="#x1-19001r49">49<!--tex4ht:ref: 5-2-a2 --></a>) and (<a 
href="#x1-19002r50">50<!--tex4ht:ref: 5-2-a1 --></a>) in the force balance equation (<a 
href="#x1-23002r58">58<!--tex4ht:ref: 7-7-1 --></a>)
yields
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-23003r59"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium62x.png" alt="∂g-BR + ∂g-BZ = 0,
∂R      ∂Z
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(59)</td></tr></table>
<!--l. 784--><p class="nopar" >
which can be further written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-23004r60"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium63x.png" alt="B ⋅∇g = 0.
" class="math-display"  /></center></td><td class="equation-label">(60)</td></tr></table>
<!--l. 788--><p class="nopar" >
According to the same reasoning for the pressure, we conclude that <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>) is a suﬃcient
condition for the toroidal force balance. (The function <span 
class="cmmi-10">g </span>deﬁned here is usually called the
“poloidal current function” in tokamak literature. The reason for this name is discussed in Sec.
<a 
href="#x1-126000A.3">A.3<!--tex4ht:ref: 2-14-10 --></a>.)
</p><!--l. 795--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.3   </span> <a 
 id="x1-240005.3"></a>Force balance along the major radius</h4>
<!--l. 797--><p class="noindent" >Consider the force balance in <img 
src="tokamak_equilibrium64x.png" alt="Rˆ"  class="circ"  /> direction. The <img 
src="tokamak_equilibrium65x.png" alt="ˆR"  class="circ"  /> component of Eq. (<a 
href="#x1-21002r55">55<!--tex4ht:ref: 7-7-force --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-24001r61"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium66x.png" alt="              ∂P
JϕBZ − JZB ϕ =---
              ∂R
" class="math-display"  /></center></td><td class="equation-label">(61)</td></tr></table>
<!--l. 802--><p class="nopar" >
Using the expressions of the current density and magnetic ﬁeld [Eqs. (<a 
href="#x1-3003r6">6<!--tex4ht:ref: 6-9-a4 --></a>) and (<a 
href="#x1-19002r50">50<!--tex4ht:ref: 5-2-a1 --></a>)], equation (<a 
href="#x1-24001r61">61<!--tex4ht:ref: 7-8-radia --></a>) is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-24002r62"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium67x.png" alt="J  1-∂Ψ-− -1--∂g-g-= ∂P-.
 ϕ R ∂R   μ0R ∂R R   ∂R
" class="math-display"  /></center></td><td class="equation-label">(62)</td></tr></table>
<!--l. 809--><p class="nopar" >
Assuming the suﬃcient condition discussed above, i.e., <span 
class="cmmi-10">P </span>and <span 
class="cmmi-10">g </span>are a function of only <span 
class="cmmi-10">Ψ</span>, i.e., <span 
class="cmmi-10">P </span>= <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>)
and <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), Eq. (<a 
href="#x1-24002r62">62<!--tex4ht:ref: 3-30-1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-24003r63"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium68x.png" alt="Jϕ 1-∂Ψ-−-1--dg-∂Ψ-g-= dP-∂Ψ-,
  R ∂R   μ0R dΨ ∂R R   dΨ ∂R
" class="math-display"  /></center></td><td class="equation-label">(63)</td></tr></table>
<!--l. 817--><p class="nopar" >
which can be simpliﬁed to
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-24004r64"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium69x.png" alt="      dP     1  dg
Jϕ = R---+ -------g,
      dΨ   μ0R dΨ
" class="math-display"  /></center></td><td class="equation-label">(64)</td></tr></table>
<!--l. 822--><p class="nopar" >
which is the requirement of force-balance along the major radius. On the other hand, we know <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> can
be expressed in <span 
class="cmmi-10">Ψ </span>via Eq. (<a 
href="#x1-20003r53">53<!--tex4ht:ref: 6-9-a1 --></a>). Combining this with Eq. (<a 
href="#x1-24004r64">64<!--tex4ht:ref: 24-5-29-p4 --></a>) yields
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-24005r65"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium70x.png" alt="△∗Ψ = − μ0R2dP-− -dgg,
            dΨ   dΨ
" class="math-display"  /></center></td><td class="equation-label">(65)</td></tr></table>
<!--l. 829--><p class="nopar" >
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-24006r66"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium71x.png" alt="  2        (      )
-∂Ψ2 +R -∂-  1-∂Ψ-  = − μ0R2 dP-− dgg.
∂Z      ∂R   R ∂R           dΨ   dΨ
" class="math-display"  /></center></td><td class="equation-label">(66)</td></tr></table>
<!--l. 835--><p class="nopar" >
Equation (<a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>) is known as Grad-Shafranov (GS) equation.
</p><!--l. 838--><p class="indent" >   [Note that the <span 
class="cmmi-10">Z </span>component of the force balance equation is written
</p>
   <table 
class="equation-star"><tr><td>
<div class="array"> <table id="TBL-1" class="array" 
cellpadding="0" cellspacing="0"  
><colgroup id="TBL-1-1g"><col 
id="TBL-1-1" /></colgroup><tr  
 style="vertical-align:baseline;"><td  style="white-space:nowrap; text-align:left;" 
><div class="td11"><span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">R</span></sub><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">R</span></sub> = <img 
src="tokamak_equilibrium72x.png" alt="∂P-
∂Z"  class="frac" align="middle" />                         </div></td>
</tr><tr  
 style="vertical-align:baseline;"><td  style="white-space:nowrap; text-align:left;" 
><div class="td11"><span 
class="cmsy-10">⇒−</span><img 
src="tokamak_equilibrium73x.png" alt="-∂g-
∂Z"  class="frac" align="middle" /><img 
src="tokamak_equilibrium74x.png" alt="1-
R"  class="frac" align="middle" /><img 
src="tokamak_equilibrium75x.png" alt="-g
R"  class="frac" align="middle" /> <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium76x.png" alt="-1
R"  class="frac" align="middle" /><span 
class="cmsy-10">△</span><sup><span 
class="cmsy-7">∗</span></sup><span 
class="cmmi-10">Ψ</span><img 
src="tokamak_equilibrium77x.png" alt="1-
R"  class="frac" align="middle" /><img 
src="tokamak_equilibrium78x.png" alt="∂Ψ-
∂Z"  class="frac" align="middle" /> = <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><img 
src="tokamak_equilibrium79x.png" alt="dP-
dΨ"  class="frac" align="middle" /><img 
src="tokamak_equilibrium80x.png" alt="∂Ψ-
∂Z"  class="frac" align="middle" />    </div></td>
</tr><tr  
 style="vertical-align:baseline;"><td  style="white-space:nowrap; text-align:left;" 
><div class="td11"><span 
class="cmsy-10">⇒−</span><img 
src="tokamak_equilibrium81x.png" alt="-dg
dΨ"  class="frac" align="middle" /><img 
src="tokamak_equilibrium82x.png" alt="∂Ψ-
∂Z"  class="frac" align="middle" /><img 
src="tokamak_equilibrium83x.png" alt="1-
R"  class="frac" align="middle" /><img 
src="tokamak_equilibrium84x.png" alt="g-
R"  class="frac" align="middle" /> <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium85x.png" alt="1-
R"  class="frac" align="middle" /><span 
class="cmsy-10">△</span><sup><span 
class="cmsy-7">∗</span></sup><span 
class="cmmi-10">Ψ</span><img 
src="tokamak_equilibrium86x.png" alt="-1
R"  class="frac" align="middle" /><img 
src="tokamak_equilibrium87x.png" alt="∂Ψ-
∂Z"  class="frac" align="middle" /> = <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><img 
src="tokamak_equilibrium88x.png" alt="dP
dΨ"  class="frac" align="middle" /><img 
src="tokamak_equilibrium89x.png" alt="∂Ψ-
∂Z"  class="frac" align="middle" /></div></td>
</tr><tr  
 style="vertical-align:baseline;"><td  style="white-space:nowrap; text-align:left;" 
><div class="td11"><span 
class="cmsy-10">⇒−</span><img 
src="tokamak_equilibrium90x.png" alt="-dg
dΨ"  class="frac" align="middle" /><img 
src="tokamak_equilibrium91x.png" alt="1-
R"  class="frac" align="middle" /><img 
src="tokamak_equilibrium92x.png" alt="-g
R"  class="frac" align="middle" /> <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium93x.png" alt="-1
R"  class="frac" align="middle" /><span 
class="cmsy-10">△</span><sup><span 
class="cmsy-7">∗</span></sup><span 
class="cmmi-10">Ψ</span><img 
src="tokamak_equilibrium94x.png" alt="1-
R"  class="frac" align="middle" /> = <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><img 
src="tokamak_equilibrium95x.png" alt="dP
dΨ"  class="frac" align="middle" />            </div></td>
</tr><tr  
 style="vertical-align:baseline;"><td  style="white-space:nowrap; text-align:left;" 
><div class="td11"><span 
class="cmsy-10">⇒△</span><sup><span 
class="cmsy-7">∗</span></sup><span 
class="cmmi-10">Ψ </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">R</span><sup><span 
class="cmr-7">2</span></sup><img 
src="tokamak_equilibrium96x.png" alt="dP
dΨ"  class="frac" align="middle" /> <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium97x.png" alt="dg
dΨ"  class="frac" align="middle" /><span 
class="cmmi-10">g              </span></div></td></tr></table>                                            </div>
</td></tr></table>
                                                                                

                                                                                
<!--l. 853--><p class="nopar" >
which turns out to be identical with the Grad-Shafranov equation. This is not a coincidence. The
reason is that the force balance equation has been satisﬁed in three diﬀerent directions (namely, <img 
src="tokamak_equilibrium98x.png" alt="ˆϕ"  class="circ"  />, <img 
src="tokamak_equilibrium99x.png" alt="ˆR"  class="circ"  />,
and <span 
class="cmbx-10">B </span>direction) and thus it must be satisﬁed in all the directions.]
</p><!--l. 860--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.4   </span> <a 
 id="x1-250005.4"></a>Axisymmetric equilibrium magnetic ﬁeld</h4>
<!--l. 862--><p class="noindent" >A general axisymmetric magnetic ﬁeld (which does not necessarily satisfy the force balance), is given by
Eq. (<a 
href="#x1-5001r10">10<!--tex4ht:ref: 7-28-6 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-25001r67"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium100x.png" alt="B = ∇Ψ × ∇ ϕ+  g∇ϕ ,
    ◟--◝◜--◞   ◟◝◜◞
     poloidal   toroidal
" class="math-display"  /></center></td><td class="equation-label">(67)</td></tr></table>
<!--l. 867--><p class="nopar" >
For the above axisymmetric magnetic ﬁeld to be consistent with the force balance equation
(<a 
href="#x1-21002r55">55<!--tex4ht:ref: 7-7-force --></a>), there are additional requirements for <span 
class="cmmi-10">Ψ </span>and <span 
class="cmmi-10">g</span>. Speciﬁcally, <span 
class="cmmi-10">Ψ </span>is restricted by the GS
equation and <span 
class="cmmi-10">g </span>should be a function of only <span 
class="cmmi-10">Ψ</span>. Therefore an axisymmetric equilibrium
magnetic ﬁeld is fully determined by two functions, <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) and <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>). The <span 
class="cmmi-10">Ψ </span>is
determined by solving the GS equation with speciﬁed RHS source terms and boundary
conditions.
</p><!--l. 876--><p class="indent" >   The RHS source terms in the GS equation (<a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>) are <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), both of which must be speciﬁed
before the GS equation can be solved. For most cases, the source terms are nonlinear about <span 
class="cmmi-10">Ψ </span>and thus
the GS equation is a two-dimensional (in <span 
class="cmmi-10">R </span>and <span 
class="cmmi-10">Z</span>) nonlinear partial diﬀerential equation for
<span 
class="cmmi-10">Ψ</span>.
</p><!--l. 882--><p class="indent" >   For most choices of <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), the GS equation (<a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>) has to be solved numerically. For some
particular choices of <span 
class="cmmi-10">P </span>and <span 
class="cmmi-10">g </span>proﬁles, analytical solutions are available, one of which is the Solovév
equilibrium and is discussed in Appendix <a 
href="#x1-124000A.1">A.1<!--tex4ht:ref: 20-4-8-p1 --></a>.
</p><!--l. 887--><p class="indent" >   Note that we solve the GS equation in order to obtain the poloidal magnetic ﬂux <span 
class="cmmi-10">Ψ </span>and thus the
poloidal magnetic ﬁeld. The toroidal magnetic ﬁeld must be speciﬁed in some way before we can solve
the GS equation. There are several ways of specifying the toroidal magnetic ﬁeld: (1) given <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), (2)
given <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">j</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⟩</span>, (3) given the safety factor <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ψ</span>). There are simple relations between <span 
class="cmmi-10">g</span>, <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">j</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⟩</span>, and <span 
class="cmmi-10">q</span>, which
allows translation form one to another (discussed later). In transport simulations, <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">j</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⟩ </span>is
obtained from current drive models and neoclassical bootstrap current models. Note that
the speciﬁcation of the source terms (<span 
class="cmmi-10">P</span>, <span 
class="cmmi-10">g</span>, <span 
class="cmmi-10">q</span>, and <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">j</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⟩</span>) usually involve the unknown <span 
class="cmmi-10">Ψ</span>
(via not only the explicit presence of <span 
class="cmmi-10">Ψ</span>, but also the ﬂux-surface averaging which implicit
involves <span 
class="cmmi-10">Ψ</span>). This indicates that iterations are needed when numerically solving the GS
                                                                                

                                                                                
equation.
</p><!--l. 902--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.5   </span> <a 
 id="x1-260005.5"></a>Axisymmetric equilibrium current density</h4>
<!--l. 904--><p class="noindent" >Since <span 
class="cmbx-10">J </span>= <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup><span 
class="cmsy-10">∇× </span><span 
class="cmbx-10">B</span>, the current density <span 
class="cmbx-10">J </span>can be inferred from a given magnetic ﬁeld.
The components of <span 
class="cmbx-10">J </span>(expressed in terms of <span 
class="cmmi-10">g </span>and <span 
class="cmmi-10">Ψ</span>) are given by Eqs. (<a 
href="#x1-19001r49">49<!--tex4ht:ref: 5-2-a2 --></a>), (<a 
href="#x1-19002r50">50<!--tex4ht:ref: 5-2-a1 --></a>) and
(<a 
href="#x1-20003r53">53<!--tex4ht:ref: 6-9-a1 --></a>) and these expressions can be further simpliﬁed by using the equilibrium constraints,
such as <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmsy-10">△</span><sup><span 
class="cmsy-7">∗</span></sup><span 
class="cmmi-10">Ψ </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">R</span><sup><span 
class="cmr-7">2</span></sup><img 
src="tokamak_equilibrium101x.png" alt="dP-
dΨ"  class="frac" align="middle" /> <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium102x.png" alt="dg
dΨ"  class="frac" align="middle" /><span 
class="cmmi-10">g</span>. The simpliﬁed <span 
class="cmbx-10">J </span>expressions are given in
<a 
href="#x1-131000A.8">A.8<!--tex4ht:ref: 20-4-23-a1 --></a>.
</p><!--l. 913--><p class="indent" >   On the other hand, in the kinetic equilibrium reconstruction<span class="cite">[<a 
href="#Xli2013">19</a>]</span>, it is the current that is ﬁrst
(partially) speciﬁed (e.g., by summing sources of current drive and bootstrap current) and then
the current is used as constraints for the GS equation, i.e, constraints for the magnetic
ﬁeld.
</p><!--l. 918--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">5.6   </span> <a 
 id="x1-270005.6"></a>Equilibrium scaling</h4>
<!--l. 920--><p class="noindent" >The GS equation is given by Eq. (<a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-27001r68"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium103x.png" alt=" ∂2Ψ      ∂ ( 1 ∂Ψ )         dP   dg
---2 +R ---  -----  = − μ0R2---− --g.
∂Z      ∂R   R ∂R           dΨ   dΨ
" class="math-display"  /></center></td><td class="equation-label">(68)</td></tr></table>
<!--l. 925--><p class="nopar" >
If a solution to the GS equation is obtained, the solution can be scaled to obtain a family of solutions.
Given an equilibrium with <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>), <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>), <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), then it is ready to prove that <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">sΨ</span>, <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">s</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>),
and <span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmsy-10">±</span><span 
class="cmmi-10">sg</span>(<span 
class="cmmi-10">Ψ</span>) is also a solution to the GS equation, where <span 
class="cmmi-10">s </span>is a constant. In this case, both the
poloidal and toroidal magnetic ﬁelds are increased by a factor of <span 
class="cmmi-10">s</span>, and thus the safety factor remains
unchanged. Also note that the pressure is increased by <span 
class="cmmi-10">s</span><sup><span 
class="cmr-7">2</span></sup> factor and thus the value of <span 
class="cmmi-10">β </span>(the ratio
of the therm pressure to magnetic pressure) remains unchanged. Note that <span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmsy-10">±</span><span 
class="cmmi-10">sg</span>(<span 
class="cmmi-10">Ψ</span>),
which indicates that the direction of the toroidal magnetic ﬁeld can be reversed without
breaking the force balance. Also note that <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">sΨ </span>and <span 
class="cmmi-10">s </span>can be negative, which indicates
that the direction of the toroidal current can also be reversed without breaking the force
balance.
                                                                                

                                                                                
</p><!--l. 940--><p class="indent" >   The second kind of scaling is to set <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">Ψ</span>, <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>), and <span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">2</span></sub><sup><span 
class="cmr-7">2</span></sup> = <span 
class="cmmi-10">g</span><sup><span 
class="cmr-7">2</span></sup>(<span 
class="cmmi-10">Ψ</span>) + <span 
class="cmmi-10">c</span>. It is ready to prove
that the scaled expression is still a solution to the GS equation because <span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmsy-10">′ </span>= <span 
class="cmmi-10">gg</span><span 
class="cmsy-10">′</span>. This scaling keep
the pressure and the poloidal ﬁeld unchanged and thus the poloidal beta <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub> remains unchanged. This
scaling scales the toroidal ﬁeld and thus can be used to generate a family of equilibria with diﬀerent
proﬁles of safety factor.
</p><!--l. 948--><p class="indent" >   Another scaling, which is trivial, is to set <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">Ψ</span>, <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) + <span 
class="cmmi-10">c</span>, and <span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">2</span></sub> = <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>). This scaling can
be used to test the eﬀects of the pressure (not the pressure gradient) on various physical
processes.
</p><!--l. 952--><p class="indent" >   When a numerical equilibrium is obtained, one can use these scaling methods together to generate
new equilibria that satisfy particular global conditions. Note that the shape of magnetic surfaces of the
scaled equilibrium remains the same as the original one.
</p><!--l. 957--><p class="indent" >   The above scaling is made under the constraint that the the GS equation (<a 
href="#x1-27001r68">68<!--tex4ht:ref: 23-1-17-p1 --></a>), is satisﬁed. In
practice, we may scale <span 
class="cmmi-10">Ψ </span>by a factor while ﬁxing <span 
class="cmmi-10">g </span>and <span 
class="cmmi-10">P</span>. This does not satisfy the GS equation, but
allows more ﬂexibility in changing the the safety factor proﬁle. Scaling <span 
class="cmmi-10">Ψ </span>by a factor corresponds to
scaling the plasma current and the poloidal magnetic ﬁeld.
</p><!--l. 964--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-280006"></a>Numerical methods of reconstructing equilibrium magnetic ﬁeld</h3>
<!--l. 966--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.1   </span> <a 
 id="x1-290006.1"></a>By using integral form and Picard iteration</h4>
<!--l. 968--><p class="noindent" >Given all the toroidal currents, <span 
class="cmmi-10">Ψ </span>can be calculated using a formula similar to the Biot-Savart Law (see
(<a 
href="#x1-145007r667">667<!--tex4ht:ref: 24-5-29-p1 --></a>)):
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29001r69"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium104x.png" alt="         ∫     ′  ′         ′  ′   ′  ′  N∑c−1
Ψ(R,Z ) =   G(R ,Z ;R,Z)Jϕ(R ,Z )dR dZ  +     G(Ri,Zi;R,Z )Ii,
          Ω                              i=0
" class="math-display"  /></center></td><td class="equation-label">(69)</td></tr></table>
<!--l. 973--><p class="nopar" >
where <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> is the plasma toroidal current density, <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">i</span></sub> is the toroidal curent in No. <span 
class="cmmi-10">i </span>PF coil located at
(<span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,Z </span>= <span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">i</span></sub>), <span 
class="cmmi-10">G </span>is a function given by </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium105x.png" alt="      ′ ′
  G(R ,∫Z ,R,Z )
  μ0R-  2π--------------R′cosϕ′dϕ′-------------
=  4π  0  ∘ (Z − Z′)2 + (R− R ′cosϕ ′)2 + (R′sin ϕ′)2.          (70)
" class="math-display"  /><a 
 id="x1-29002r70"></a></center>
</div>On the other hand, the force-balance indicates that <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> can be expressed in terms of <span 
class="cmmi-10">Ψ </span>via Eq. (<a 
href="#x1-24004r64">64<!--tex4ht:ref: 24-5-29-p4 --></a>),
i.e.,
   <table 
class="equation"><tr><td><a 
 id="x1-29003r71"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium106x.png" alt="      dP     1  dg
Jϕ = R dΨ-+ μ-R-gdΨ-.
             0
" class="math-display"  /></center></td><td class="equation-label">(71)</td></tr></table>
<!--l. 988--><p class="nopar" >
Substituting this into Eq. (<a 
href="#x1-29001r69">69<!--tex4ht:ref: 10-31-1 --></a>) gives an implicit formula for <span 
class="cmmi-10">Ψ</span>, which can be iterated (assuuming an
initial guess of <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) on the rhs and assuming the function forms, <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), are known). Will
the iteration turn out to converge? We do not know for sure, and numerical experiments indicate it
does in some cases<span class="cite">[<a 
href="#Xlao1985">17</a>]</span>. Let us discuss these cases. The 1D functions, <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), are modeled as
polynomials in <span 
class="cmmi-10">Ψ </span>with coeﬃcients <span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">n</span></sub> and <span 
class="cmmi-10">β</span><sub><span 
class="cmr-7">0</span></sub> to be determined:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29004r72"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium107x.png" alt="dP (Ψ )
------= α0 + α1x+ α2x2 − (α0 + α1 + α2)x3,
  dΨ
" class="math-display"  /></center></td><td class="equation-label">(72)</td></tr></table>
<!--l. 1002--><p class="nopar" >
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29005r73"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium108x.png" alt="  dg
g--- = β0(1 − x),
 dΨ
" class="math-display"  /></center></td><td class="equation-label">(73)</td></tr></table>
<!--l. 1006--><p class="nopar" >
where <span 
class="cmmi-10">x </span>=<span class="overline"> <span 
class="cmmi-10">Ψ</span></span> = (<span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub>)<span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">B</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub>), <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub> and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">B</span></sub> are values of <span 
class="cmmi-10">Ψ </span>at the magnetic axis and LCFS
(values of <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub> and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">B</span></sub> are ﬁgured out from <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>)).
</p><!--l. 1011--><p class="indent" >   Choosing an initial guess of <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) on gridpoints, we can get the values of <span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">n</span></sub>, <span 
class="cmmi-10">β</span><sub><span 
class="cmr-7">0</span></sub>, and <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">i</span></sub> by
solving a least square problem that minimises the diﬀerence between quantities computed (from <span 
class="cmmi-10">Ψ </span>and
<span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">i</span></sub>) and the corresponding quantities measured in actual experiments. After this, the rhs of
Eq. (<a 
href="#x1-29001r69">69<!--tex4ht:ref: 10-31-1 --></a>) is fully known, and we can use this equation to update <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>). Then, using the
latest <span 
class="cmmi-10">Ψ</span>, we solve the least square problem again. Then we obtain new <span 
class="cmmi-10">Ψ </span>using Eq. (<a 
href="#x1-29001r69">69<!--tex4ht:ref: 10-31-1 --></a>)
again. We repeat the above procedure until convergecne in <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>). This is called Picard
iteration.
</p><!--l. 1021--><p class="indent" >   I use the above method in developing a numerical code called <span 
class="cmtt-10">HEQ</span>. The following subsection
discusses the least square problem in details.
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29006r74"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium109x.png" alt="  dg
gdxΔ-= β0(1− x),
" class="math-display"  /></center></td><td class="equation-label">(74)</td></tr></table>
<!--l. 1027--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29007r75"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium110x.png" alt="∫ x   dg     ∫ x
 0  gdxΔ-dx = 0 β0(1 − x )dx,
" class="math-display"  /></center></td><td class="equation-label">(75)</td></tr></table>
<!--l. 1031--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29008r76"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium111x.png" alt="∫ g(x)     ∫ x
     gdg =    Δβ0(1− x)dx,
 g(0)       0
" class="math-display"  /></center></td><td class="equation-label">(76)</td></tr></table>
<!--l. 1034--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29009r77"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium112x.png" alt="g2 g(x)      ∫ x
-2 |g(0) = Δ β0 (1− x)dx,
             0
" class="math-display"  /></center></td><td class="equation-label">(77)</td></tr></table>
<!--l. 1038--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-29010r78"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium113x.png" alt="             (      )
g2−  g20-= Δ β  x − x2
2    2      0     2
" class="math-display"  /></center></td><td class="equation-label">(78)</td></tr></table>
<!--l. 1042--><p class="nopar" >
</p><!--l. 1045--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.2   </span> <a 
 id="x1-300006.2"></a>Response matrix <span 
class="cmmi-10">Γ</span></h4>
<!--l. 1047--><p class="noindent" >Plugging expressions (<a 
href="#x1-29004r72">72<!--tex4ht:ref: 24-6-5-1 --></a>) and (<a 
href="#x1-29005r73">73<!--tex4ht:ref: 24-6-5-2 --></a>) into (<a 
href="#x1-29003r71">71<!--tex4ht:ref: 24-6-5-5 --></a>), and organizing the result according to the coeﬃcients
(<span 
class="cmmi-10">α</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,β</span><sub><span 
class="cmr-7">0</span></sub>), we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium114x.png" alt="Jϕ(R′,Z′) = R′[α0 + α1x +α2x2 − (α0 + α1 + α2)x3]+-1-β0(1− x)
                                               μ0R ′
               ′    3       ′    3       ′ 2   3      1−-x-
         = α0R (1− x )+ α1R (x− x )+ α2R (x  − x ) +β0 μ0R′ ,     (79)
" class="math-display"  /><a 
 id="x1-30001r79"></a></center>
</div>For notation ease, deﬁne
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                   <img 
src="tokamak_equilibrium115x.png" alt="(
|| b0(x) = R′(1− x3)
{ b1(x) = R′(x− x3)
|| b2(x) = R′(x2 − x3)
( b3(x) = (1− x)∕(μ0R ′)"  class="left" align="middle" /><img 
src="tokamak_equilibrium116x.png" alt="(
|| c0 = α0
{ c1 = α1
|| c2 = α2
( c3 = β0"  class="left" align="middle" />
</td></tr></table>
<!--l. 1067--><p class="nopar" >
then Eq. (<a 
href="#x1-30001r79">79<!--tex4ht:ref: 24-6-5-3 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30002r80"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium117x.png" alt="     3
    ∑
Jϕ =   cjbj(x).
    j=0
" class="math-display"  /></center></td><td class="equation-label">(80)</td></tr></table>
<!--l. 1071--><p class="nopar" >
Plugging expression (<a 
href="#x1-30002r80">80<!--tex4ht:ref: 24-6-4-p1 --></a>) into Eq. (<a 
href="#x1-29001r69">69<!--tex4ht:ref: 10-31-1 --></a>), we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium118x.png" alt="              ∫
         ∑3          ′ ′            ′  ′
Ψ(R,Z ) =   cj Ω G(R ,Z ,R,Z)bj(x)dR dZ
         j=0
         Nc∑−1    (c)  (c)
       +     G (Rj ,Zj ,R,Z )Ij.                         (81)
          j=0
" class="math-display"  /><a 
 id="x1-30003r81"></a></center>
</div>Deﬁne the free parameters as a column vector <span 
class="cmbx-10">u </span>= (<span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">,c</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,c</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,c</span><sub><span 
class="cmr-7">3</span></sub><span 
class="cmmi-10">,I</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,I</span><sub><span 
class="cmmi-7">N</span><sub><span 
class="cmmi-5">c</span></sub><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sub>)<sup><span 
class="cmmi-7">T</span></sup>, and <span 
class="cmmi-10">N </span>= 4 + <span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">c</span></sub>, i.e.,
the size of vector <span 
class="cmbx-10">u</span>, i.e., the number of free parameters. Then, at a given (<span 
class="cmmi-10">R,Z</span>), the rhs of Eq. (<a 
href="#x1-30003r81">81<!--tex4ht:ref: 24-6-5-p1 --></a>)
can be written as matrix-vector product, <span 
class="cmmi-10">Γu</span>. Denote the total number of measurements
of the poloidal ﬂux by <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">Ψ</span></sub>. Then matrix elements of <span 
class="cmmi-10">Γ </span>for (<span 
class="cmmi-10">i </span>= 0<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,M</span><sub><span 
class="cmmi-7">Ψ</span></sub> <span 
class="cmsy-10">− </span>1) are given
by:
   <table 
class="equation"><tr><td><a 
 id="x1-30004r82"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium119x.png" alt="     ∫
Γ ij =  G(R ′,Z′,R(iFL),Z (FiL))bj(x)dR′dZ′,
      Ω
" class="math-display"  /></center></td><td class="equation-label">(82)</td></tr></table>
<!--l. 1089--><p class="nopar" >
for (<span 
class="cmmi-10">j </span>= 0<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,</span>3), and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30005r83"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium120x.png" alt="Γ ij = G (R(jc)−4,Z(jc)−4,R(iFL),Z(iFL)),
" class="math-display"  /></center></td><td class="equation-label">(83)</td></tr></table>
<!--l. 1094--><p class="nopar" >
for (<span 
class="cmmi-10">j </span>= 4<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N </span><span 
class="cmsy-10">− </span>1) . Here (<span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmr-7">FL</span><span 
class="cmr-7">)</span></sup><span 
class="cmmi-10">,Z</span><sub><span 
class="cmmi-7">i</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmr-7">FL</span><span 
class="cmr-7">)</span></sup>) is the location where the <span 
class="cmmi-10">i</span>th ﬂux measurement is
made.
</p><!--l. 1098--><p class="indent" >   The matrix <span 
class="cmmi-10">Γ </span>is called “response matrix”, which is of shape (<span 
class="cmmi-10">M,N</span>), The value of <span 
class="cmmi-10">M </span>is equal
to number of measurements included (measurements are merged to <span 
class="cmmi-10">Γ </span>by row stacking).
We will include <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">Ψ</span></sub> measurements of the poloidal ﬂux, <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">B</span></sub> measurements of the poloidal
magnetic ﬁeld, and 1 measurement of plasma current. Then <span 
class="cmmi-10">M </span>= <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">Ψ</span></sub> + <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">B</span></sub> + 1. (For EAST,
<span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">Ψ</span></sub> = 35<span 
class="cmmi-10">,M</span><sub><span 
class="cmmi-7">B</span></sub> = 38.)
</p><!--l. 1105--><p class="indent" >    
</p><!--l. 1107--><p class="indent" >   Next, we consider the poloidal ﬁeld measurement:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30006r84"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium121x.png" alt="Bp (Ri,Zi) = Bp ⋅nˆi = BR ˆni,R + BZ ˆni,Z,
" class="math-display"  /></center></td><td class="equation-label">(84)</td></tr></table>
                                                                                

                                                                                
<!--l. 1111--><p class="nopar" >
where <img 
src="tokamak_equilibrium122x.png" alt="ˆn"  class="circ"  /><sub><span 
class="cmmi-7">i</span></sub> is the positive normal direction of the No. <span 
class="cmmi-10">i </span>magnetic probe, <img 
src="tokamak_equilibrium123x.png" alt="ˆn"  class="circ"  /><sub><span 
class="cmmi-7">i,R</span></sub> = <img 
src="tokamak_equilibrium124x.png" alt="ˆn"  class="circ"  /><sub><span 
class="cmmi-7">i</span></sub> <span 
class="cmsy-10">⋅</span><span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">R</span></sub>, <img 
src="tokamak_equilibrium125x.png" alt="ˆn"  class="circ"  /><sub><span 
class="cmmi-7">i,Z</span></sub> = <img 
src="tokamak_equilibrium126x.png" alt="ˆn"  class="circ"  /><sub><span 
class="cmmi-7">i</span></sub> <span 
class="cmsy-10">⋅</span><span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">Z</span></sub>. On
the other hand, <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub>(<span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,Z</span><sub><span 
class="cmmi-7">i</span></sub>) can be inferred from <span 
class="cmmi-10">Ψ </span>via
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30007r85"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium127x.png" alt="           ∑3   ∫                             Nc∑−1
Bp(Ri,Zi) =   cj   GB (R ′,Z ′,Ri,Zi)bj(x)dR′dZ′ +    GBIj.
           j=0   Ω                             j=0
" class="math-display"  /></center></td><td class="equation-label">(85)</td></tr></table>
<!--l. 1119--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30008r86"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium128x.png" alt="GB (R′,Z′,Ri,Zi) = GBR(R ′,Z ′,Ri,Zi)nˆi,R + GBZ (R′,Z′,Ri,Zi)ˆni,Z,
" class="math-display"  /></center></td><td class="equation-label">(86)</td></tr></table>
<!--l. 1124--><p class="nopar" >
and <span 
class="cmmi-10">G</span><sub><span 
class="cmmi-7">B</span><sub><span 
class="cmmi-5">R</span></sub></sub> and <span 
class="cmmi-10">G</span><sub><span 
class="cmmi-7">B</span><sub><span 
class="cmmi-5">Z</span></sub></sub> is given by Eq. (<a 
href="#x1-145015r671">671<!--tex4ht:ref: 24-6-6-3 --></a>) and (<a 
href="#x1-145016r672">672<!--tex4ht:ref: 24-6-6-4 --></a>). The rhs of Eq. (<a 
href="#x1-30007r85">85<!--tex4ht:ref: 24-6-6-1 --></a>) indicates that the matrix
elements of <span 
class="cmmi-10">Γ </span>for (<span 
class="cmmi-10">i </span>= <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">Ψ</span></sub><span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,M</span><sub><span 
class="cmmi-7">Ψ</span></sub> + <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">B</span></sub> <span 
class="cmsy-10">− </span>1) are given by:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30009r87"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium129x.png" alt="     ∫
Γ ij =  GB (R ′,Z ′,Ri,Zi)bj(x)dR′dZ′,
      Ω
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(87)</td></tr></table>
<!--l. 1131--><p class="nopar" >
for (<span 
class="cmmi-10">j </span>= 0<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,</span>3), and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30010r88"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium130x.png" alt="          (c)  (c)
Γ ij = GB (Rj−4,Zj−4,Ri,Zi),
" class="math-display"  /></center></td><td class="equation-label">(88)</td></tr></table>
<!--l. 1135--><p class="nopar" >
for (<span 
class="cmmi-10">j </span>= 4<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N </span><span 
class="cmsy-10">− </span>1) .
</p><!--l. 1138--><p class="indent" >   Next, we consider the constraint of plasma current. The plasma current <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub> can be inferred from <span 
class="cmmi-10">Ψ</span>
via
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30011r89"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium131x.png" alt="    ∫             3   ∫
Ip =   JϕdR′dZ′ = ∑ cj   bj(x)dR ′dZ′.
     Ω           j=0   Ω
" class="math-display"  /></center></td><td class="equation-label">(89)</td></tr></table>
<!--l. 1143--><p class="nopar" >
The rhs of Eq. (<a 
href="#x1-30011r89">89<!--tex4ht:ref: 24-6-6-6 --></a>) indicates that the matrix elements of <span 
class="cmmi-10">Γ </span>for <span 
class="cmmi-10">i </span>= <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">Ψ</span></sub> + <span 
class="cmmi-10">M</span><sub><span 
class="cmmi-7">B</span></sub> + 1 are given
by:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-30012r90"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium132x.png" alt="      ∫
Γ  =    b (x)dR ′dZ ′,
  ij    Ω j
" class="math-display"  /></center></td><td class="equation-label">(90)</td></tr></table>
<!--l. 1148--><p class="nopar" >
for (<span 
class="cmmi-10">j </span>= 0<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,</span>3), and zero for (<span 
class="cmmi-10">j </span>= 4<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,n </span><span 
class="cmsy-10">− </span>1) .
</p><!--l. 1151--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.3   </span> <a 
 id="x1-310006.3"></a>Algorithm summary</h4>
<!--l. 1153--><p class="noindent" >Step 0. Initial guess of <span 
class="cmmi-10">Ψ</span>: <span 
class="cmmi-10">Ψ</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">k</span><span 
class="cmr-7">)</span></sup> with <span 
class="cmmi-10">k </span>= 0.
</p><!--l. 1155--><p class="indent" >   Step 1. Compute elements of response matrix <span 
class="cmmi-10">Γ </span>using <span 
class="cmmi-10">Ψ</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">k</span><span 
class="cmr-7">)</span></sup>.
</p><!--l. 1157--><p class="indent" >   Step 2. Solve linear least-square problem to get (<span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,c</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,c</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,c</span><sub><span 
class="cmr-7">4</span></sub><span 
class="cmmi-10">,I</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,I</span><sub><span 
class="cmmi-7">N</span><sub><span 
class="cmmi-5">c</span></sub></sub>).
</p><!--l. 1160--><p class="indent" >   Step 3. Update <span 
class="cmmi-10">Ψ </span>using the Picard iteration:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-31001r91"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium133x.png" alt="        ∫                               N∑c
Ψ (k+1) =  GJ ϕ(R′,Ψ (k),c1,c2,c3,c4)dR′dZ′ +   GIn,
                                        n=1
" class="math-display"  /></center></td><td class="equation-label">(91)</td></tr></table>
<!--l. 1164--><p class="nopar" >
or in its discrete form:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-31002r92"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium134x.png" alt="                (          )
 (k+1)   ∑         ∑4                N∑c   (c)
Ψij    =    Gi′j′ij     cnbn,i′j′ dSi′j′ +   G n,ijIn.
        i′,j′       n=1                n=1
" class="math-display"  /></center></td><td class="equation-label">(92)</td></tr></table>
<!--l. 1169--><p class="nopar" >
</p><!--l. 1172--><p class="indent" >   Step 4: <span 
class="cmmi-10">k </span>= <span 
class="cmmi-10">k </span>+ 1 and goto Step 1.
                                                                                

                                                                                
</p><!--l. 1174--><p class="indent" >    
</p><!--l. 1176--><p class="indent" >   In Step 1, we ﬁrst search for the magnetic axis and boundary surface of <span 
class="cmmi-10">Ψ</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">k</span><span 
class="cmr-7">)</span></sup> so that
we can get the values of <span 
class="cmmi-10">Ψ</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">k</span><span 
class="cmr-7">)</span></sup> at those locations. These values are needed in computing
<span 
class="cmmi-10">x </span>= (<span 
class="cmmi-10">Ψ</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">k</span><span 
class="cmr-7">)</span></sup> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub>)<span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">B</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub>).
</p><!--l. 1181--><p class="indent" >    
</p><!--l. 1183--><p class="indent" >   A formula for computing <span 
class="cmmi-10">q </span>value at the magnetic axis [ref. P. M. Bellan’s paper]:
</p>
   <table 
class="equation-star"><tr><td>
                            <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">axis</span></sub> = <img 
src="tokamak_equilibrium135x.png" alt="e1∕2 + e−1∕2
---R-------
     axis"  class="frac" align="middle" /><img 
src="tokamak_equilibrium136x.png" alt=" Bϕaxis
μ-J----
 0 ϕaxis"  class="frac" align="middle" /><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 1186--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-31003r93"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium137x.png" alt="   (         )
     ∂2Ψ∕∂R2-
e =  ∂2Ψ∕∂Z2  axis.
" class="math-display"  /></center></td><td class="equation-label">(93)</td></tr></table>
<!--l. 1191--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
            <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span> <span 
class="cmr-7">axis</span></sub> = <span 
class="cmex-10">∑</span>
  <sub><span 
class="cmmi-7">j</span><span 
class="cmr-7">=0</span></sub><sup><span 
class="cmr-7">3</span></sup><span 
class="cmmi-10">c</span><sub>
<span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">b</span><sub><span 
class="cmmi-7">j</span></sub>(<span 
class="cmmi-10">x</span>) = <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">b</span><sub><span 
class="cmr-7">0</span></sub>(0) + <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">3</span></sub><span 
class="cmmi-10">b</span><sub><span 
class="cmr-7">3</span></sub>(0) = <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">axis</span></sub> + <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">3</span></sub><img 
src="tokamak_equilibrium138x.png" alt="---1---
μ0Raxis"  class="frac" align="middle" />
</td></tr></table>
<!--l. 1193--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-31004r94"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium139x.png" alt="q   = √-e+-1---g(0)- ,
 axis    eR2axisμ0J ϕaxis
" class="math-display"  /></center></td><td class="equation-label">(94)</td></tr></table>
<!--l. 1198--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-31005r95"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium140x.png" alt="√eR2   μ0 (             1  )     1
----axis--- c0Raxis + c3------ =  ----
(e+ 1)g(0)            μ0Raxis    qaxis
" class="math-display"  /></center></td><td class="equation-label">(95)</td></tr></table>
<!--l. 1204--><p class="nopar" >
</p><!--l. 1207--><p class="indent" >    
</p><!--l. 1209--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">6.4   </span> <a 
 id="x1-320006.4"></a>Solving by inverting the Laplace operator–to be deleted</h4>
                                                                                

                                                                                
<!--l. 1211--><p class="noindent" >If we want to invert the Laplace operator <span 
class="cmsy-10">△</span><sup><span 
class="cmsy-7">∗</span></sup> of the GS equation to solve for <span 
class="cmmi-10">Ψ</span>, we encounter two
issues: (1) the RHS of the GS equation involves functions of <span 
class="cmmi-10">Ψ</span>, where both the functions and <span 
class="cmmi-10">Ψ </span>are
unknown; (2) the values of <span 
class="cmmi-10">Ψ </span>on a given boundy should be prescribed, which in turn invovles two
issues: (a) how to choose the shape of the bounday? (b) how to know the value of <span 
class="cmmi-10">Ψ </span>on the boundary?
The answer to isssues (a) and (b) is that we can choose any boundy we like (e.g., rectangular region)
and guess the values of <span 
class="cmmi-10">Ψ </span>on it (which will be updated in iterations discussed later). The answer to
issue (1) is that the function forms are chosen by users, usually as polymials in <span 
class="cmmi-10">Ψ</span>, e.g.
<span class="cite">[<a 
href="#Xlao1985">17</a>]</span>
</p><!--l. 1222--><p class="indent" >   where <span 
class="cmmi-10">x </span>= (<span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub>)<span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">B</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub>), <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">M</span></sub> and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">B</span></sub> are values of <span 
class="cmmi-10">Ψ </span>at the magnetic axis and LCFS
(but the locations of the axis and LCFS are unknown), the free parameters <span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">n</span></sub> and <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">n</span></sub> are
assumed known (which will be later adjusted in the least-square method to make the resulting
solution approximately match some measurements and constraints imposed). To make the
RHS fully known, we need to guess values of <span 
class="cmmi-10">Ψ </span>in the inner region. Then inverting  <span 
class="cmsy-10">△</span><sup><span 
class="cmsy-7">∗</span></sup> to
get new <span 
class="cmmi-10">Ψ</span>. The values we obtained via inerting <span 
class="cmsy-10">△</span><sup><span 
class="cmsy-7">∗</span></sup> usually diﬀer from what we used in
the RHS, so we need to interate until convergence. We call this interation as the ﬁrst-level
iteration.
</p><!--l. 1233--><p class="indent" >   After the ﬁrst-level iteration coverges, we can calculate <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> through Eq. (<a 
href="#x1-24004r64">64<!--tex4ht:ref: 24-5-29-p4 --></a>) or Eq. (<a 
href="#x1-20003r53">53<!--tex4ht:ref: 6-9-a1 --></a>). After this,
all the current (current in the plasma, and current in the external coils, which are assumed to be known
and will be adjusted in the least-square method) perpendicular to the poloidal plane is known, we can
calculate the value of <span 
class="cmmi-10">Ψ </span>on the boundary, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>, by using the Green’s function method. If
<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub> calculated this way diﬀers from the initial guess of the value of <span 
class="cmmi-10">Ψ </span>on the boundary,
we need to iterate: use the <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub> calculated as a new guess value of <span 
class="cmmi-10">Ψ </span>on the boundary and
repeat the above procedures until convergence. We call this iteration as the second-level
iteration.<span class="cite">[<span 
class="cmbx-10">?</span>]</span>.
</p><!--l. 1245--><p class="indent" >   The thrid level iteration is to iterate over the free parameters <span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">n</span></sub>, <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">n</span></sub>, the PF coil currents, to make
the solution match match some measurements and constraints imposed in the least square sence. This
iteration is an optimization problem.
</p><!--l. 1250--><p class="indent" >    
</p><!--l. 1252--><p class="indent" >    
</p><!--l. 1254--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-330007"></a>Fixed boundary equilibrium and choices of coordinates</h3>
<!--l. 1256--><p class="noindent" >Plasma physists love to consider a kind of simpliﬁed problem: the ﬁxed boundary equilibrium problem,
where the shape of the boundary ﬂux surface is given (the value of <span 
class="cmmi-10">Ψ </span>is a constant on this boundary).
In dealing with the ﬁxed boundary problem, the curvilinear coordinate system is useful. Speciﬁcally, the
convenience is that the coordinates can be adjusted to make one of the coordinate surfaces
coincide with the given boundary ﬂux surface, so that the boundary condition becomes
trivial.
</p><!--l. 1264--><p class="indent" >   More generally, curvilinear coordinates can be ajusted to make coordinate surfaces coincide with
magnetic surfaces (dicussed later). This often simpliﬁes analysis of wave and transport problems,
especially when we properly choose the poloidal/toroidal coordinate to make magnetic ﬁeld lines look
like straight lines in terms of these coordinates.
</p><!--l. 1270--><p class="indent" >   Next section discusses the basic theory of curvilinear coordinates system<span class="cite">[<a 
href="#Xboozer2005">4</a>]</span>.
</p><!--l. 1273--><p class="indent" >   In many studies of tokamak plasmas, one need construct a curvilinear coordinate system
based on a given magnetic coﬁguration in order to make the problem amenable to analytical
methods or numerical methods. Speciﬁcally, many theories and numerical codes use the
                                                                                

                                                                                
curvilinear coordinate systems that are constructed with one coordinate surface coinciding with
magnetic surfaces. In these coordinate systems, we need to choose a poloidal coordinate <span 
class="cmmi-10">𝜃</span>
and a toroidal coordinate <span 
class="cmmi-10">ζ</span>. As metioned above, a particular choice for <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ζ </span>is one that
makes the magnetic ﬁeld lines be straight lines in (<span 
class="cmmi-10">𝜃,ζ</span>) plane. These kinds of coordinates
are often called magnetic coordinates. That is, “magnetic coordinates  are deﬁned so they
conform to the shape of the magnetic surfaces and trivialize the equations for the ﬁeld
lines.”
</p><!--l. 1286--><p class="indent" >   A further tuned magnetic coordinate system is the so-called ﬁeld aligned (or ﬁled-line following)
coordinate system, in which changing one of the three coordinates with the other two ﬁxed would
correspond to following a magnetic ﬁeld line. The ﬁeld aligned coordinates are discussed in Sec.
<a 
href="#x1-7700015">15<!--tex4ht:ref: 21-10-8-1 --></a>.
</p><!--l. 1292--><p class="indent" >   Next, let us discuss some general properties about coordinates transformation.
</p><!--l. 1294--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-340008"></a>Curvilinear coordinate system</h3>
<!--l. 1296--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x1-350008.1"></a>Coordinates transformation</h4>
<!--l. 1298--><p class="noindent" >In the Cartesian coordinates, a point is described by its coordinates (<span 
class="cmmi-10">x,y,z</span>), which, in the vector form,
is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-35001r96"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium141x.png" alt="r = xˆx+ yˆy + zˆz,
" class="math-display"  /></center></td><td class="equation-label">(96)</td></tr></table>
<!--l. 1302--><p class="nopar" >
where <span 
class="cmbx-10">r </span>is the location vector of the point; <img 
src="tokamak_equilibrium142x.png" alt="ˆx"  class="circ"  />, <img 
src="tokamak_equilibrium143x.png" alt="ˆy"  class="circ"  />, and <img 
src="tokamak_equilibrium144x.png" alt="ˆz"  class="circ"  /> are the basis vectors of the Cartesian
coordinates, which are constant, independent of spactial location. The transformation between the
Cartesian coordinates system, (<span 
class="cmmi-10">x,y,z</span>), and a general coordinates system, (<span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,x</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,x</span><sub><span 
class="cmr-7">3</span></sub>), can be expressed
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-35002r97"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium145x.png" alt="r = x(x1,x2,x3)ˆx + y(x1,x2,x3)ˆy+ z(x1,x2,x3)ˆz.
" class="math-display"  /></center></td><td class="equation-label">(97)</td></tr></table>
<!--l. 1311--><p class="nopar" >
For example, cylindrical coordinates (<span 
class="cmmi-10">R,ϕ,Z</span>) can be considered as a general coordinate systems, which
are deﬁned by  <span 
class="cmbx-10">r </span>= <span 
class="cmmi-10">R</span> cos<span 
class="cmmi-10">ϕ</span><img 
src="tokamak_equilibrium146x.png" alt="ˆx"  class="circ"  /> + <span 
class="cmmi-10">R</span> sin<span 
class="cmmi-10">ϕ</span><img 
src="tokamak_equilibrium147x.png" alt="ˆy"  class="circ"  /> + <span 
class="cmmi-10">Z</span><img 
src="tokamak_equilibrium148x.png" alt="ˆz"  class="circ"  />.
</p><!--l. 1316--><p class="indent" >   The transformation function in Eq. (<a 
href="#x1-35002r97">97<!--tex4ht:ref: 11-8-10dd --></a>) can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-35003r98"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium149x.png" alt="x = x(x1,x2,x3)
y = y(x1,x2,x3)
z = z(x1,x2,x3)
" class="math-display"  /></center></td><td class="equation-label">(98)</td></tr></table>
<!--l. 1323--><p class="nopar" >
</p><!--l. 1325--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x1-360008.2"></a>Jacobian</h4>
<!--l. 1327--><p class="noindent" >A useful quality characterizing coordinate transformation is the Jacobian determinant (or simply called
Jacobian), which, for the transformation in Eq. (<a 
href="#x1-35003r98">98<!--tex4ht:ref: 11-8-10 --></a>), is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-36001r99"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium150x.png" alt="    |           |
    || ∂∂xx-∂∂xx- ∂∂xx-||
𝒥 = || ∂1y-∂y2 ∂3y-||,
    || ∂x∂1z-∂∂xz2 ∂x∂3z-||
      ∂x1 ∂x2 ∂x3
" class="math-display"  /></center></td><td class="equation-label">(99)</td></tr></table>
<!--l. 1339--><p class="nopar" >
which can also be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-36002r100"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium151x.png" alt="     ∂r    ∂r   ∂r
𝒥 =  ---× ----⋅----.
     ∂x1  ∂x2  ∂x3
" class="math-display"  /></center></td><td class="equation-label">(100)</td></tr></table>
<!--l. 1345--><p class="nopar" >
It is easy to prove that the Jacobian <span 
class="cmsy-10">𝒥 </span>in Eq. (<a 
href="#x1-36002r100">100<!--tex4ht:ref: 10-21-p3 --></a>) can also be written (the derivation is given in my
notes on Jacobian)
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-36003r101"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium152x.png" alt="                    −1
𝒥  = (∇x1 × ∇x2 ⋅∇x3 ) .
" class="math-display"  /></center></td><td class="equation-label">(101)</td></tr></table>
<!--l. 1351--><p class="nopar" >
Conventionally, the Jacobian of the transformation from the Cartesian coordinates to a particular
coordinate system <span 
class="cmmi-10">σ </span>is called the Jacobian of <span 
class="cmmi-10">σ</span>, without explitly mentioning that this transformation is
with respect to the Cartesian coordinates.
</p><!--l. 1357--><p class="indent" >   Using the deﬁntion in Eq. (<a 
href="#x1-36001r99">99<!--tex4ht:ref: 21-11-29-1 --></a>), the Jacobian <span 
class="cmsy-10">𝒥 </span>of the Cartesian coordinates can be calculated,
yielding 1. Likewise, the Jacobian of the cylindrical coordinates (<span 
class="cmmi-10">R,ϕ,Z</span>) can be calculated as follows:
</p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium153x.png" alt="    |        |  |                    |
    ||∂∂xR-∂∂xϕ ∂∂xZ||  || ∂R∂cRosϕ-∂Rc∂oϕsϕ ∂R∂cZosϕ-||
𝒥 = ||∂∂yR-∂∂yϕ ∂∂yZ||= || ∂R∂sRinϕ-∂R∂siϕnϕ ∂R∂sZinϕ-||
    ||∂z-∂z ∂z||  ||  ∂Z-    ∂Z-   ∂Z-  ||
    |∂R ∂ϕ ∂Z     |∂R     ∂ϕ    ∂Z
    ||cosϕ − R sinϕ 0||
  = ||sinϕ  R cos ϕ 0||= R
    | 0     0    1|
" class="math-display"  /></center>
</div>If the Jacobian of a coordinate system is greater than zero, it is called a right-handed coordinate
system. Otherwise it is called a left-handed system.
<!--l. 1386--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x1-370008.3"></a>Orthogonality relation between two sets of basis vectors</h4>
<!--l. 1388--><p class="noindent" >In a curvilinear coordinate system (<span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,x</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,x</span><sub><span 
class="cmr-7">3</span></sub>), there are two kinds of basis vectors: <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sub><span 
class="cmmi-7">i</span></sub> and
<span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂x</span><sub><span 
class="cmmi-7">i</span></sub>, with <span 
class="cmmi-10">i </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span>3<span 
class="cmmi-10">. </span>These two kinds of basis vectors satisfy the following orthogonality
relation:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-37001r102"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium154x.png" alt="     ∂r
∇xi ⋅∂x--= δij,
       j
" class="math-display"  /></center></td><td class="equation-label">(102)</td></tr></table>
<!--l. 1395--><p class="nopar" >
where <span 
class="cmmi-10">δ</span><sub><span 
class="cmmi-7">ij</span></sub> is the Kronical delta function. [Proof: Working in a Cartesian coordinate system (<span 
class="cmmi-10">x,y,z</span>) with
the corresponding basis vectors denoted by (<img 
src="tokamak_equilibrium155x.png" alt="ˆx"  class="circ"  /><span 
class="cmmi-10">,</span><img 
src="tokamak_equilibrium156x.png" alt="ˆy"  class="circ"  /><span 
class="cmmi-10">,</span><img 
src="tokamak_equilibrium157x.png" alt="ˆz"  class="circ"  />), then the left-hand side of Eq. (<a 
href="#x1-37001r102">102<!--tex4ht:ref: 4-6-e1 --></a>) can be written
as </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium158x.png" alt="     ∂r   [( ∂xi)    ( ∂xi)    ( ∂xi)  ] [ ∂x      ∂ˆx    ∂y     ∂ ˆy   ∂z      ∂ˆz ]
∇xi ⋅∂x-=    ∂x-  ˆx+   ∂y-  ˆy+   ∂z-  ˆz ⋅ ∂x--ˆx+ x∂x--+ ∂x-yˆ+ y∂x--+ ∂x-ˆz +z ∂x--
       j  [(    )    (    )    (    )  ] [   j       j    j       j   ] j       j
        =    ∂xi  ˆx+   ∂xi  ˆy+   ∂xi  ˆz ⋅ -∂x-ˆx+ 0+  ∂y-ˆy+ 0 + ∂z-ˆz+ 0        (103)
             ∂x        ∂y        ∂z       ∂xj        ∂xj       ∂xj
           ∂xi∂x--  ∂xi-∂y-  ∂xi-∂z-
        =  ∂x ∂xj + ∂y ∂xj + ∂z ∂xj
           ∂xi
        =  ∂x--                                                               (104)
             j
        = δij,
" class="math-display"  /><a 
 id="x1-37002r104"></a></center>
</div>where the second equality is due to <span 
class="cmmi-10">∂</span><img 
src="tokamak_equilibrium159x.png" alt="ˆx"  class="circ"  /><span 
class="cmmi-10">∕∂x</span><sup><span 
class="cmmi-7">j</span></sup> = 0<span 
class="cmmi-10">,∂</span><img 
src="tokamak_equilibrium160x.png" alt="ˆy"  class="circ"  /><span 
class="cmmi-10">∕∂x</span><sup><span 
class="cmmi-7">j</span></sup> = 0<span 
class="cmmi-10">,∂</span><img 
src="tokamak_equilibrium161x.png" alt="ˆz"  class="circ"  /><span 
class="cmmi-10">∕∂x</span><sup><span 
class="cmmi-7">j</span></sup> = 0 since <img 
src="tokamak_equilibrium162x.png" alt="ˆx"  class="circ"  /><span 
class="cmmi-10">,</span><img 
src="tokamak_equilibrium163x.png" alt="ˆy"  class="circ"  /><span 
class="cmmi-10">,</span><img 
src="tokamak_equilibrium164x.png" alt="ˆz"  class="circ"  /> are
constant vectors independent of spatial location; the chain rule has been used in obtaining Eq.
(<a 
href="#x1-37002r104">104<!--tex4ht:ref: 18-10-10-p1 --></a>)]
<!--l. 1428--><p class="indent" >   [The cylindrical coordinate system (<span 
class="cmmi-10">R,ϕ,Z</span>) is an example of general coordinates. As an exercise, we
can verify that the cylindrical coordinates have the property given in Eq. (<a 
href="#x1-37001r102">102<!--tex4ht:ref: 4-6-e1 --></a>). In this case,
<span 
class="cmmi-10">x </span>= <span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub> cos<span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">2</span></sub>, <span 
class="cmmi-10">y </span>= <span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub> sin<span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">2</span></sub>, <span 
class="cmmi-10">z </span>= <span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">3</span></sub>, where <span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">R</span>, <span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">2</span></sub> <span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">ϕ</span>, <span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">3</span></sub> <span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">Z</span>.]
</p><!--l. 1434--><p class="indent" >   It can be proved that <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sup><span 
class="cmmi-7">i</span></sup> is a contravariant vector while <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂x</span><sup><span 
class="cmmi-7">i</span></sup> is a covariant vector (I do not
prove this and do not bother with the meaning of these names, just using this as a naming scheme for
easy reference).
</p><!--l. 1439--><p class="indent" >   The orthogonality relation in Eq. (<a 
href="#x1-37001r102">102<!--tex4ht:ref: 4-6-e1 --></a>) is fundamental to the theory of general coordinates. The
orthogonality relation allows one to write the covariant basis vectors in terms of contravariant basis
vectors and vice versa. For example, the orthogonality relation tells that <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂x</span><sub><span 
class="cmr-7">1</span></sub> is orthogonal to <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">2</span></sub>
and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">3</span></sub>, thus, <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂x</span><sub><span 
class="cmr-7">1</span></sub> can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-37003r105"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium165x.png" alt=" ∂r
----= A∇x2 × ∇x3,
∂x1
" class="math-display"  /></center></td><td class="equation-label">(105)</td></tr></table>
<!--l. 1448--><p class="nopar" >
where <span 
class="cmmi-10">A </span>is a unknown variable to be determined. To determine <span 
class="cmmi-10">A</span>, dotting Eq. (<a 
href="#x1-37003r105">105<!--tex4ht:ref: 9-7-4 --></a>) by <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub>, and using
the orthogonality relation again, we obtain
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-37004r106"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium166x.png" alt="1 = A (∇x2 × ∇x3)⋅∇x1,
" class="math-display"  /></center></td><td class="equation-label">(106)</td></tr></table>
<!--l. 1454--><p class="nopar" >
which gives </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium167x.png" alt="           1
A = (∇x--×-∇x--)⋅∇x--
       2     3     1
 = 𝒥                                         (107)
" class="math-display"  /></center>
</div>Thus <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂x</span><sub><span 
class="cmr-7">1</span></sub> is written, in terms of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">2</span></sub>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">3</span></sub>, as
   <table 
class="equation"><tr><td><a 
 id="x1-37006r108"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium168x.png" alt=" ∂r
∂x--= 𝒥 ∇x2 × ∇x3.
  1
" class="math-display"  /></center></td><td class="equation-label">(108)</td></tr></table>
<!--l. 1466--><p class="nopar" >
Similarly, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-37007r109"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium169x.png" alt="-∂r-= 𝒥 ∇x  × ∇x
∂x2       3     1
" class="math-display"  /></center></td><td class="equation-label">(109)</td></tr></table>
<!--l. 1471--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-37008r110"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium170x.png" alt="-∂r-= 𝒥 ∇x1 × ∇x2.
∂x3
" class="math-display"  /></center></td><td class="equation-label">(110)</td></tr></table>
<!--l. 1476--><p class="nopar" >
Equations (<a 
href="#x1-37006r108">108<!--tex4ht:ref: 9-8-1 --></a>)-(<a 
href="#x1-37008r110">110<!--tex4ht:ref: 9-8-3 --></a>) can be generally written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-37009r111"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium171x.png" alt=" ∂r
--- = 𝒥∇xj × ∇xk,
∂xi
" class="math-display"  /></center></td><td class="equation-label">(111)</td></tr></table>
<!--l. 1481--><p class="nopar" >
where (<span 
class="cmmi-10">i,j,k</span>) represents the cyclic order in the variables (<span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">,x</span><sub><span 
class="cmr-7">2</span></sub><span 
class="cmmi-10">,x</span><sub><span 
class="cmr-7">3</span></sub>). Equation (<a 
href="#x1-37009r111">111<!--tex4ht:ref: 11-18-1 --></a>) expresses the
covariant basis vectors in terms of the contravariant basis vectors. On the other hand, from Eq.
(<a 
href="#x1-37006r108">108<!--tex4ht:ref: 9-8-1 --></a>)-(<a 
href="#x1-37008r110">110<!--tex4ht:ref: 9-8-3 --></a>), we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-37010r112"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium172x.png" alt="∇x  = 𝒥− 1 ∂r-×-∂r-,
   i      ∂xj  ∂xk
" class="math-display"  /></center></td><td class="equation-label">(112)</td></tr></table>
<!--l. 1489--><p class="nopar" >
which expresses the contravariant basis vectors in terms of the covariant basis vectors.
</p><!--l. 1493--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.4   </span> <a 
 id="x1-380008.4"></a>An example: (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates</h4>
<!--l. 1495--><p class="noindent" >Suppose (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) is an arbitrary general coordinate system. Following Einstein’s notation, contravariant
basis vectors are denoted with upper indices as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium173x.png" alt="eψ ≡ ∇ ψ; e𝜃 ≡ ∇𝜃; eζ ≡ ∇ζ.                    (113)
" class="math-display"  /></center>
</div>and the covariant basis vectors are denoted with low indices as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium174x.png" alt="     ∂r              ∂r
eψ ≡ --; e𝜃 ≡ ∂∂r𝜃; eζ ≡-.                       (114)
     ∂ψ              ∂ζ
" class="math-display"  /></center>
</div>Then the orthogonality relation, Eq. (<a 
href="#x1-37001r102">102<!--tex4ht:ref: 4-6-e1 --></a>), is written as
   <table 
class="equation"><tr><td><a 
 id="x1-38003r115"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium175x.png" alt="eα ⋅eβ = δαβ.
" class="math-display"  /></center></td><td class="equation-label">(115)</td></tr></table>
<!--l. 1511--><p class="nopar" >
In term of the contravairant basis vectors, <span 
class="cmbx-10">A </span>is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38004r116"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium176x.png" alt="        ψ      𝜃     ζ
A  = Aψe  + A𝜃e + A ζe ,
" class="math-display"  /></center></td><td class="equation-label">(116)</td></tr></table>
<!--l. 1516--><p class="nopar" >
where the components are easily obtained by taking scalar product with <span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">ψ</span></sub><span 
class="cmmi-10">,</span><span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">𝜃</span></sub><span 
class="cmmi-10">,</span>and<span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">ζ</span></sub>, yielding
<span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ψ</span></sub> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">ψ</span></sub>, <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">𝜃</span></sub> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">𝜃</span></sub>, and <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ζ</span></sub> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">ζ</span></sub>. Similarly, in term of the covariant basis vectors, <span 
class="cmbx-10">A </span>is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38005r117"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium177x.png" alt="A  = Aψeψ + A𝜃e𝜃 + A ζeζ,
" class="math-display"  /></center></td><td class="equation-label">(117)</td></tr></table>
<!--l. 1526--><p class="nopar" >
where <span 
class="cmmi-10">A</span><sup><span 
class="cmmi-7">ψ</span></sup> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">e</span><sup><span 
class="cmmi-7">ψ</span></sup>, <span 
class="cmmi-10">A</span><sup><span 
class="cmmi-7">𝜃</span></sup> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">e</span><sup><span 
class="cmmi-7">𝜃</span></sup>, and <span 
class="cmmi-10">A</span><sup><span 
class="cmmi-7">ζ</span></sup> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">e</span><sup><span 
class="cmmi-7">ζ</span></sup>.
</p><!--l. 1531--><p class="indent" >   Using the above notation, the relation in Eq. (<a 
href="#x1-37009r111">111<!--tex4ht:ref: 11-18-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38006r118"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium178x.png" alt="        𝜃   ζ
eψ = 𝒥 e × e
" class="math-display"  /></center></td><td class="equation-label">(118)</td></tr></table>
<!--l. 1535--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38007r119"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium179x.png" alt="e𝜃 = 𝒥eζ × eψ
" class="math-display"  /></center></td><td class="equation-label">(119)</td></tr></table>
<!--l. 1539--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38008r120"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium180x.png" alt="eζ = 𝒥eψ × e𝜃
" class="math-display"  /></center></td><td class="equation-label">(120)</td></tr></table>
<!--l. 1543--><p class="nopar" >
where  <span 
class="cmsy-10">𝒥 </span>= [(<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃</span>) <span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ζ</span>]<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup>. Similarly, the relation in Eq. (<a 
href="#x1-37010r112">112<!--tex4ht:ref: 20-10-15-a1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38009r121"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium181x.png" alt="eψ = 𝒥 −1e𝜃 × eζ
" class="math-display"  /></center></td><td class="equation-label">(121)</td></tr></table>
<!--l. 1550--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38010r122"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium182x.png" alt=" 𝜃    − 1
e  = 𝒥  eζ × eψ
" class="math-display"  /></center></td><td class="equation-label">(122)</td></tr></table>
<!--l. 1554--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-38011r123"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium183x.png" alt=" ζ    − 1
e  = 𝒥  eψ × e𝜃
" class="math-display"  /></center></td><td class="equation-label">(123)</td></tr></table>
<!--l. 1558--><p class="nopar" >
                                                                                

                                                                                
</p><!--l. 1561--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.5   </span> <a 
 id="x1-390008.5"></a>Gradient and directional derivative in general coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>)</h4>
<!--l. 1563--><p class="noindent" >The gradient of a scalar function <span 
class="cmmi-10">f</span>(<span 
class="cmmi-10">ψ,𝜃,ζ</span>) is readily calculated from the chain rule,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-39001r124"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium184x.png" alt="      ∂f      ∂f     ∂f
∇f =  --∇ ψ + --∇ 𝜃+ ---∇ζ.
      ∂ψ      ∂𝜃     ∂ ζ
" class="math-display"  /></center></td><td class="equation-label">(124)</td></tr></table>
<!--l. 1569--><p class="nopar" >
Note that the gradient of a scalar function is in the covariant representation. The inverse form of this
expression is obtained by dotting the above equation respectively by the three contravariant basis
vectors, yielding
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-39002r125"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium185x.png" alt="∂f-= (𝒥 ∇𝜃 ×∇ ζ)⋅∇f =  ∂r-⋅∇f
∂ψ                     ∂ψ
" class="math-display"  /></center></td><td class="equation-label">(125)</td></tr></table>
<!--l. 1577--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-39003r126"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium186x.png" alt="∂f-= (𝒥 ∇ζ ×∇ ψ)⋅∇f  = ∂r-⋅∇f
∂𝜃                     ∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(126)</td></tr></table>
<!--l. 1582--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-39004r127"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium187x.png" alt="∂f-= (𝒥 ∇ψ × ∇𝜃)⋅∇f  = ∂r-⋅∇f
∂ζ                     ∂ζ
" class="math-display"  /></center></td><td class="equation-label">(127)</td></tr></table>
<!--l. 1587--><p class="nopar" >
Using Eq. (<a 
href="#x1-39001r124">124<!--tex4ht:ref: 5-6-5 --></a>), the directional derivative in the direction of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-39005r128"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium188x.png" alt="∇ ψ ⋅∇f = |∇ ψ|2∂f-+ (∇𝜃 ⋅∇ψ)∂f-+ (∇ ζ ⋅∇ ψ)∂f.
               ∂ψ            ∂𝜃           ∂ζ
" class="math-display"  /></center></td><td class="equation-label">(128)</td></tr></table>
<!--l. 1594--><p class="nopar" >
</p><!--l. 1597--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.6   </span> <a 
 id="x1-400008.6"></a>Divergence operator in general coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>)</h4>
<!--l. 1599--><p class="noindent" >To calculate the divergence of a vector, it is desired that the vector should be in the contravariant form
because we can make use of the fact:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-40001r129"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium189x.png" alt="∇ ⋅(∇ α× ∇ β) = 0,
" class="math-display"  /></center></td><td class="equation-label">(129)</td></tr></table>
<!--l. 1603--><p class="nopar" >
for any scalar quantities <span 
class="cmmi-10">α </span>and <span 
class="cmmi-10">β</span>. Therefore we write vector <span 
class="cmbx-10">A </span>as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-40002r130"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium190x.png" alt="     (ψ)            (𝜃)             (ζ)
A = A   𝒥∇ 𝜃× ∇ ζ + A 𝒥 ∇ ζ × ∇ ψ+ A  𝒥∇ ψ × ∇𝜃,
" class="math-display"  /></center></td><td class="equation-label">(130)</td></tr></table>
<!--l. 1610--><p class="nopar" >
where <span 
class="cmmi-10">A</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">ψ</span><span 
class="cmr-7">)</span></sup> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ψ</span>, <span 
class="cmmi-10">A</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">𝜃</span><span 
class="cmr-7">)</span></sup> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃</span>, <span 
class="cmmi-10">A</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">ζ</span><span 
class="cmr-7">)</span></sup> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ζ</span>.   Then the divergence of <span 
class="cmbx-10">A </span>is readily calculated
as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium191x.png" alt="∇  ⋅A  = (∇ 𝜃× ∇ ζ)⋅∇ (A (ψ)𝒥 )+ (∇ ζ × ∇ ψ)⋅∇ (A(𝜃)𝒥 )+ (∇ψ × ∇𝜃) ⋅∇(A(ζ)𝒥 ) (131)
        1 ( ∂A(ψ)𝒥   ∂A (𝜃)𝒥   ∂A (ζ)𝒥 )
      = 𝒥-  --∂ψ---+ --∂𝜃---+ --∂ζ--- ,                               (132)
" class="math-display"  /><a 
 id="x1-40003r132"></a></center>
</div>where the second equality is obtained by using Eqs. (<a 
href="#x1-39002r125">125<!--tex4ht:ref: 4-6-1 --></a>), (<a 
href="#x1-39003r126">126<!--tex4ht:ref: 4-6-2 --></a>), and (<a 
href="#x1-39004r127">127<!--tex4ht:ref: 4-6-3 --></a>).
                                                                                

                                                                                
<!--l. 1627--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.7   </span> <a 
 id="x1-410008.7"></a>Laplacian operator in general coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>)</h4>
<!--l. 1629--><p class="noindent" >The Laplacian operator is deﬁned by <span 
class="cmsy-10">∇</span><sup><span 
class="cmr-7">2</span></sup> <span 
class="cmsy-10">≡∇⋅∇</span>. Then <span 
class="cmsy-10">∇</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">f </span>is written as (<span 
class="cmmi-10">f </span>is an arbitrary function)
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium192x.png" alt="∇2f = ∇ ⋅∇f
         ( ∂f      ∂f     ∂f   )
    = ∇ ⋅ ∂-ψ∇ ψ+  ∂𝜃∇ 𝜃+ ∂ζ-∇ζ  .                  (133)
" class="math-display"  /><a 
 id="x1-41001r133"></a></center>
</div>To proceed, we can use the divergence formula (<a 
href="#x1-40003r132">132<!--tex4ht:ref: 6-8-e5 --></a>) to express the divergence in the above expression.
However, the vector in the above (blue term) is not in the covariant form desired by the divergence
formula (<a 
href="#x1-40003r132">132<!--tex4ht:ref: 6-8-e5 --></a>). If we want to directly use the formula (<a 
href="#x1-40003r132">132<!--tex4ht:ref: 6-8-e5 --></a>), we need to transform the vector (blue term
in expression (<a 
href="#x1-41001r133">133<!--tex4ht:ref: 19-1-15-1 --></a>)) to the covariant form. This process seems to be a little complicated. Therefore, I
choose not to use this method. Instead, I try to simplify expression (<a 
href="#x1-41001r133">133<!--tex4ht:ref: 19-1-15-1 --></a>) by using basic vector
identities: <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium193x.png" alt="  2     ( ∂f)         ( ∂f)         (∂f )
∇ f = ∇   ∂ψ- ⋅∇ ψ+ ∇   ∂𝜃- ⋅∇ 𝜃+ ∇  -∂ζ  ⋅∇ζ
        ∂f       ∂f      ∂f
      + --∇2 ψ + --∇2 𝜃+ ---∇2ζ.                          (134)
        ∂ψ       ∂𝜃      ∂ζ
" class="math-display"  /></center>
</div>Using the gradient formula, the above expression is further written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium194x.png" alt="∇2f = ∂2f-|∇ ψ|2 +-∂2f-∇ ψ⋅∇ 𝜃+ -∂2f-∇ ψ⋅∇ ζ
      ∂ψ2        ∂ψ ∂𝜃         ∂ψ ∂ζ
         ∂2f          ∂2f    2   ∂2f
      + ∂𝜃∂ψ-∇𝜃 ⋅∇ ψ + ∂𝜃2|∇𝜃| + ∂𝜃∂ζ-∇𝜃 ⋅∇ζ
         ∂2f           ∂2f          ∂2f
      + -----∇ζ ⋅∇ψ + ----∇ ζ ⋅∇ 𝜃+---2|∇ ζ|2
        ∂ζ∂ψ          ∂ζ∂𝜃         ∂ ζ
      + ∂f-∇2ψ + ∂f∇2 𝜃+ ∂f-∇2ζ,                         (135)
        ∂ψ       ∂𝜃      ∂ζ
" class="math-display"  /></center>
</div>and can be simpliﬁed as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium195x.png" alt="        2           2              2
∇2f =  ∂-f2|∇ψ |2 + 2-∂-f-∇ ψ⋅∇ 𝜃+ 2-∂-f-∇ ψ⋅∇ ζ
       ∂ψ         ∂ ψ∂𝜃          ∂ ψ∂ζ
      + ∂2f|∇ 𝜃|2 + 2-∂2f-∇𝜃 ⋅∇ζ
        ∂𝜃2        ∂𝜃∂ ζ
        ∂2f    2
      + ∂ζ2|∇ ζ|
        ∂f       ∂f      ∂f
      + ---∇2ψ + --∇2 𝜃+ ---∇2ζ.                          (136)
        ∂ψ       ∂𝜃       ∂ζ
" class="math-display"  /></center>
</div>Assume (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) are ﬁeld-line following coordinates with <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂𝜃 </span>along the ﬁeld line direction, then
neglect all the parallel derivatives, i.e., derivative over <span 
class="cmmi-10">𝜃</span>, then the above expression is reduced to
<div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium196x.png" alt="∇2f = ∂2f|∇ ψ|2 + 2 ∂2f-∇ ψ ⋅∇ζ + ∂2f|∇ζ|2
      ∂ψ2         ∂ψ∂ζ          ∂ζ2
       ∂f-  2   ∂f- 2
      +∂ ψ∇ ψ + ∂ ζ∇ ζ.                                (137)
" class="math-display"  /></center>
</div>This approximation reduces the Laplacian operator from being three-dimensional to being
two-dimensional. This approximation is often called the high-<span 
class="cmmi-10">n </span>approximation, where <span 
class="cmmi-10">n </span>is the toroidal
mode number (mode number along <span 
class="cmmi-10">ζ </span>direction).
<!--l. 1702--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.8   </span> <a 
 id="x1-420008.8"></a>Curl operator in general coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>)</h4>
<!--l. 1704--><p class="noindent" >To take the curl of a vector, it should be in the covariant representation since we can make use of the
fact that <span 
class="cmsy-10">∇×∇</span><span 
class="cmmi-10">α </span>= 0. Thus the curl of <span 
class="cmbx-10">A </span>is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium197x.png" alt="∇ × A = ∇ × (A1∇ψ + A2∇ 𝜃+ A3∇ ζ)
      = ∇A1 × ∇ ψ+ ∇A2  × ∇𝜃+ ∇A3  × ∇ζ
        ( ∂A      ∂A    )        ( ∂A       ∂A    )        ( ∂A       ∂A    )
      =   --1∇ 𝜃+ ---1∇ζ  × ∇ ψ+   ---2∇ψ + ---2∇ζ  × ∇ 𝜃+   --3∇ ψ+  --3∇ 𝜃  ×∇ ζ
          ∂(𝜃       ∂ζ )             ∂ψ(      ∂ζ  )           ∂ψ  (    ∂𝜃    )
      = 1-  ∂A2-− ∂A1- 𝒥 ∇ ψ× ∇ 𝜃+ -1  ∂A1-− ∂A3-  𝒥∇ ζ × ∇ ψ + 1  ∂A3-− ∂A2- 𝒥 ∇𝜃 ×(1∇3ζ8.)
        𝒥   ∂ ψ    ∂𝜃              𝒥    ∂ζ    ∂ψ               𝒥   ∂𝜃    ∂ ζ
" class="math-display"  /><a 
 id="x1-42001r138"></a></center>
</div>Note that taking the curl of a vector in the covariant form leaves the vector in the contravariant
form.
<!--l. 1729--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.9   </span> <a 
 id="x1-430008.9"></a>Metric tensor for general coordinate system</h4>
<!--l. 1731--><p class="noindent" >Consider a general coordinate system (<span 
class="cmmi-10">ψ,𝜃,ζ</span>). I deﬁne the metric tensor as the transformation matrix
between the covariant basis vectors and the contravariant ones. Equations (<a 
href="#x1-37009r111">111<!--tex4ht:ref: 11-18-1 --></a>) and (<a 
href="#x1-37010r112">112<!--tex4ht:ref: 20-10-15-a1 --></a>) express the
relation between the two sets of basis vectors using cross product. Next, let us express the relation in
matrix from. To obtain the metric matrix, we write the contrariant basis vectors in terms of the
covariant ones, such as
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-43001r139"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium198x.png" alt="      1            2             3
∇ψ = a 𝒥 ∇𝜃× ∇ ζ + a 𝒥 ∇ζ × ∇ψ + a 𝒥∇ ψ × ∇𝜃.
" class="math-display"  /></center></td><td class="equation-label">(139)</td></tr></table>
<!--l. 1742--><p class="nopar" >
Taking the scalar product respectively with <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ</span>, Eq. (<a 
href="#x1-43001r139">139<!--tex4ht:ref: 3-18-a1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43002r140"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium199x.png" alt=" 1      2
a = |∇ψ |,
" class="math-display"  /></center></td><td class="equation-label">(140)</td></tr></table>
<!--l. 1747--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43003r141"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium200x.png" alt="a2 = ∇ ψ⋅∇ 𝜃,
" class="math-display"  /></center></td><td class="equation-label">(141)</td></tr></table>
<!--l. 1750--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43004r142"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium201x.png" alt=" 3
a = ∇ ψ⋅∇ ζ.
" class="math-display"  /></center></td><td class="equation-label">(142)</td></tr></table>
<!--l. 1753--><p class="nopar" >
Similarly, we write
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43005r143"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium202x.png" alt="∇ 𝜃 = b1𝒥∇ 𝜃× ∇ ζ + b2𝒥∇ ζ × ∇ ψ + b3𝒥 ∇ψ × ∇ 𝜃,
" class="math-display"  /></center></td><td class="equation-label">(143)</td></tr></table>
<!--l. 1759--><p class="nopar" >
Taking the scalar product with <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ</span>, respectively, the above becomes
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43006r144"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium203x.png" alt="b1 = ∇ 𝜃⋅∇ ψ
" class="math-display"  /></center></td><td class="equation-label">(144)</td></tr></table>
<!--l. 1764--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43007r145"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium204x.png" alt=" 2      2
b = |∇𝜃| ,
" class="math-display"  /></center></td><td class="equation-label">(145)</td></tr></table>
<!--l. 1767--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43008r146"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium205x.png" alt="b3 = ∇ 𝜃⋅∇ ζ.
" class="math-display"  /></center></td><td class="equation-label">(146)</td></tr></table>
<!--l. 1770--><p class="nopar" >
The same situation applies for the <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ </span>basis vector,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43009r147"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium206x.png" alt="∇ ζ = c1∇𝜃 × ∇ζ𝒥 + c2∇ζ × ∇ψ 𝒥 + c3∇ ψ × ∇𝜃𝒥 ,
" class="math-display"  /></center></td><td class="equation-label">(147)</td></tr></table>
<!--l. 1776--><p class="nopar" >
Taking the scalar product with <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ</span>, respectively, the above equation becomes
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43010r148"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium207x.png" alt=" 1
c = ∇ ζ ⋅∇ ψ
" class="math-display"  /></center></td><td class="equation-label">(148)</td></tr></table>
<!--l. 1781--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43011r149"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium208x.png" alt="c2 = ∇ ζ ⋅∇ 𝜃
" class="math-display"  /></center></td><td class="equation-label">(149)</td></tr></table>
<!--l. 1784--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43012r150"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium209x.png" alt="c3 = |∇ ζ|2
" class="math-display"  /></center></td><td class="equation-label">(150)</td></tr></table>
<!--l. 1787--><p class="nopar" >
Summarizing the above results in matrix form, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43013r151"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium210x.png" alt="(     )   (                      ) (           )
  ∇ ψ        |∇ ψ|2 ∇ ψ⋅∇ 𝜃 ∇ ψ ⋅∇ζ    ∇𝜃 ×∇ ζ𝒥
(  ∇𝜃 ) = ( ∇𝜃 ⋅∇ψ  |∇𝜃|2  ∇𝜃 ⋅∇ ζ) ( ∇ ζ × ∇ ψ𝒥 )
   ∇ζ       ∇ζ ⋅∇ψ ∇ ζ ⋅∇ 𝜃 |∇ ζ|2     ∇ ψ × ∇𝜃𝒥
" class="math-display"  /></center></td><td class="equation-label">(151)</td></tr></table>
<!--l. 1806--><p class="nopar" >
Similarly, to convert contravariant basis vector to covariant one, we write
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43014r152"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium211x.png" alt="∇𝜃 × ∇ζ𝒥 = d1∇ ψ+ d2∇ 𝜃+ d3∇ ζ
" class="math-display"  /></center></td><td class="equation-label">(152)</td></tr></table>
<!--l. 1811--><p class="nopar" >
Taking the scalar product respectively with <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ζ</span><span 
class="cmsy-10">𝒥 </span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ</span><span 
class="cmsy-10">𝒥 </span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃</span><span 
class="cmsy-10">𝒥 </span>, the above
equation becomes
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43015r153"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium212x.png" alt="d1 = |∇ 𝜃× ∇ ζ|2𝒥 2
" class="math-display"  /></center></td><td class="equation-label">(153)</td></tr></table>
<!--l. 1817--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43016r154"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium213x.png" alt="d2 = (∇ 𝜃× ∇ ζ𝒥)⋅(∇ ζ × ∇ ψ𝒥)
" class="math-display"  /></center></td><td class="equation-label">(154)</td></tr></table>
<!--l. 1821--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43017r155"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium214x.png" alt="d3 = (∇ 𝜃× ∇ ζ𝒥)⋅(∇ ψ× ∇ 𝜃𝒥)
" class="math-display"  /></center></td><td class="equation-label">(155)</td></tr></table>
<!--l. 1825--><p class="nopar" >
For the second contravariant basis vector
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43018r156"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium215x.png" alt="∇ϕ × ∇ψ 𝒥 = e1∇ ψ + e2∇ 𝜃+ e3∇ ζ
" class="math-display"  /></center></td><td class="equation-label">(156)</td></tr></table>
<!--l. 1830--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43019r157"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium216x.png" alt="                          2
e1 = (∇ ζ × ∇ ψ)⋅(∇ 𝜃× ∇ ζ)𝒥
" class="math-display"  /></center></td><td class="equation-label">(157)</td></tr></table>
<!--l. 1834--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43020r158"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium217x.png" alt="e2 = (∇ ζ × ∇ ψ)⋅(∇ ζ × ∇ψ )𝒥 2
" class="math-display"  /></center></td><td class="equation-label">(158)</td></tr></table>
<!--l. 1838--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43021r159"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium218x.png" alt="e3 = (∇ ζ × ∇ ψ)⋅(∇ ψ× ∇ 𝜃)𝒥 2
" class="math-display"  /></center></td><td class="equation-label">(159)</td></tr></table>
<!--l. 1842--><p class="nopar" >
For the third contravariant basis vector
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43022r160"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium219x.png" alt="∇ψ × ∇𝜃𝒥  = f1∇ ψ + f2∇ 𝜃+ f3∇ ζ
" class="math-display"  /></center></td><td class="equation-label">(160)</td></tr></table>
<!--l. 1847--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43023r161"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium220x.png" alt="f1 = (∇ψ × ∇𝜃)⋅(∇ 𝜃× ∇ ζ)𝒥 2
" class="math-display"  /></center></td><td class="equation-label">(161)</td></tr></table>
<!--l. 1851--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43024r162"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium221x.png" alt="f2 = (∇ ψ × ∇𝜃)⋅(∇ ζ × ∇ψ )𝒥 2
" class="math-display"  /></center></td><td class="equation-label">(162)</td></tr></table>
<!--l. 1855--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43025r163"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium222x.png" alt="f3 = (∇ ψ × ∇𝜃)⋅(∇ ψ× ∇ 𝜃)𝒥 2
" class="math-display"  /></center></td><td class="equation-label">(163)</td></tr></table>
<!--l. 1859--><p class="nopar" >
Summarizing these results, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-43026r164"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium223x.png" alt="(          )      (    )
  ∇𝜃 × ∇ζ𝒥          ∇ψ
( ∇ζ × ∇ψ𝒥 )  = M ( ∇ 𝜃) ,
  ∇ψ × ∇𝜃𝒥          ∇ ζ
" class="math-display"  /></center></td><td class="equation-label">(164)</td></tr></table>
<!--l. 1871--><p class="nopar" >
where
</p>
   <table 
class="equation-star"><tr><td>
 <span 
class="cmmi-10">M </span>= <img 
src="tokamak_equilibrium224x.png" alt="(               2 2                           2                      2)
(      |∇𝜃 × ∇ζ| 𝒥     2 (∇𝜃 × ∇ζ)⋅(∇ ζ × ∇ψ )𝒥 2 (∇𝜃 ×∇ ζ)⋅(∇ψ × ∇ 𝜃)𝒥 2)
  (∇ζ × ∇ψ )⋅(∇𝜃 ×∇ ζ)𝒥2 (∇ ζ × ∇ ψ)⋅(∇ ζ × ∇ ψ)𝒥2 (∇ ζ × ∇ ψ)⋅(∇ ψ× ∇ 𝜃)𝒥2
  (∇ ψ× ∇ 𝜃)⋅(∇𝜃× ∇ ζ)𝒥  (∇ ψ × ∇𝜃)⋅(∇ ζ × ∇ ψ)𝒥 (∇ ψ × ∇𝜃)⋅(∇ ψ× ∇ 𝜃)𝒥"  class="left" align="middle" /><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 1886--><p class="nopar" >
This matrix and the matrix in Eqs. (<a 
href="#x1-43013r151">151<!--tex4ht:ref: 7-10-1 --></a>) should be the inverse of each other. It is ready to prove this
by directly calculating the product of the two matrix.
                                                                                

                                                                                
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-440008.9"></a>Special case: metric tensor for (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinate system</h5>
<!--l. 1894--><p class="noindent" >Suppose that (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) are arbitrary general coordinates except that <span 
class="cmmi-10">ϕ </span>is the usual toroidal angle in
cylindrical coordinates. Then <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>= 1<span 
class="cmmi-10">∕R</span><img 
src="tokamak_equilibrium225x.png" alt="ˆϕ"  class="circ"  /> is perpendicular to both <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>. Using this, Eq. (<a 
href="#x1-43013r151">151<!--tex4ht:ref: 7-10-1 --></a>) is
simpliﬁed to
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-44001r165"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium226x.png" alt="( ∇ψ )   (  |∇ ψ|2 ∇ ψ ⋅∇𝜃  0  ) ( ∇ 𝜃× ∇ ϕ𝒥 )
( ∇𝜃 ) = ( ∇ ψ⋅∇ 𝜃 |∇ 𝜃|2   0  ) ( ∇ ϕ× ∇ ψ𝒥 )
  ∇ϕ          0      0    1∕R2    ∇ ψ× ∇ 𝜃𝒥
" class="math-display"  /></center></td><td class="equation-label">(165)</td></tr></table>
<!--l. 1912--><p class="nopar" >
Similarly, Eq. (<a 
href="#x1-43026r164">164<!--tex4ht:ref: 9-5-e1m --></a>) is simpliﬁed to
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-44002r166"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium227x.png" alt="(  ∇𝜃× ∇ ϕ𝒥 )   (   |∇𝜃|2𝒥2∕R2   − ∇ 𝜃⋅∇ ψ𝒥 2∕R2 0 ) ( ∇ ψ)
( ∇ ϕ× ∇ ψ𝒥 ) = ( − ∇ψ ⋅∇ 𝜃𝒥2∕R2   |∇ ψ|2𝒥 2∕R2   0 ) ( ∇ 𝜃)
  ∇ ψ × ∇𝜃𝒥              0             0       R2     ∇ ϕ
" class="math-display"  /></center></td><td class="equation-label">(166)</td></tr></table>
<!--l. 1930--><p class="nopar" >
[Note that the matrix in Eqs. (<a 
href="#x1-44001r165">165<!--tex4ht:ref: 4-13-p3 --></a>) and (<a 
href="#x1-44002r166">166<!--tex4ht:ref: 4-13-p4 --></a>) should be the inverse of each other. The product of the
two matrix,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-44003r167"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium228x.png" alt="(                                 ) (                    )
    |∇ 𝜃|2𝒥 2∕R2  − ∇ 𝜃⋅∇ψ 𝒥2∕R2  0      |∇ ψ|2 ∇ ψ⋅∇ 𝜃  0
( − ∇ ψ ⋅∇𝜃𝒥 2∕R2   𝒥R22|∇ψ |2     0 ) ( ∇ψ ⋅∇𝜃  |∇𝜃|2   0  ) ,
        0              0       R2        0      0   1∕R2
" class="math-display"  /></center></td><td class="equation-label">(167)</td></tr></table>
<!--l. 1945--><p class="nopar" >
can be calculated to give
</p>
   <table 
class="equation-star"><tr><td>
                                   <img 
src="tokamak_equilibrium229x.png" alt="(       )
  A  0 0
(  0 A 0 )
   0 0 1"  class="left" align="middle" /><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 1951--><p class="nopar" >
where
</p>
   <table 
class="equation-star"><tr><td>
                       <span 
class="cmmi-10">A </span>= <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">𝜃</span><span 
class="cmsy-10">|</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">ψ</span><span 
class="cmsy-10">|</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmsy-10">𝒥</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">∕R</span><sup><span 
class="cmr-7">2</span></sup> <span 
class="cmsy-10">− </span>(<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ψ</span>)<sup><span 
class="cmr-7">2</span></sup><span 
class="cmsy-10">𝒥</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">.</span>
</td></tr></table>
<!--l. 1954--><p class="nopar" >
By using the deﬁnition of the Jacobian in Eq. (<a 
href="#x1-36003r101">101<!--tex4ht:ref: 10-21-p4 --></a>), it is easy to verify that <span 
class="cmmi-10">A </span>= 1, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-44004r168"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium230x.png" alt="                         2
|∇𝜃|2|∇ ψ|2 − (∇𝜃 ⋅∇ ψ)2 = R-,
                        𝒥2
" class="math-display"  /></center></td><td class="equation-label">(168)</td></tr></table>
<!--l. 1960--><p class="nopar" >
]
</p><!--l. 1963--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">9   </span> <a 
 id="x1-450009"></a>Covariant/contravariant representation of equilibrium magnetic ﬁeld</h3>
<!--l. 1965--><p class="noindent" >The axisymmetric equilibrium magnetic ﬁeld is given by Eq. (<a 
href="#x1-25001r67">67<!--tex4ht:ref: 4-15-p3 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-45001r169"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium231x.png" alt="B = ∇ Ψ × ∇ϕ + g∇ϕ.
" class="math-display"  /></center></td><td class="equation-label">(169)</td></tr></table>
<!--l. 1969--><p class="nopar" >
In a general coordinate system (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) (not necessarily magnetic surface coordinates), the above
expression can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-45002r170"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium232x.png" alt="B  = − Ψψ∇ ϕ× ∇ ψ − Ψ𝜃∇ϕ × ∇𝜃 + g∇ϕ,
" class="math-display"  /></center></td><td class="equation-label">(170)</td></tr></table>
                                                                                

                                                                                
<!--l. 1975--><p class="nopar" >
where the subscripts denote the partial derivatives with the corresponding subscripts. Note that Eq.
(<a 
href="#x1-45002r170">170<!--tex4ht:ref: 4-25-2 --></a>) is a mixed representation, which involves both covariant and contravariant basis vectors.
Equation (<a 
href="#x1-45002r170">170<!--tex4ht:ref: 4-25-2 --></a>) can be converted to the contravariant form by using the metric tensor,
giving
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-45003r171"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium233x.png" alt="                               𝒥
B = − Ψψ∇ ϕ ×∇ ψ − Ψ𝜃∇ϕ × ∇𝜃 + g-2∇ ψ × ∇𝜃.
                               R
" class="math-display"  /></center></td><td class="equation-label">(171)</td></tr></table>
<!--l. 1985--><p class="nopar" >
Similarly, Eq. (<a 
href="#x1-45002r170">170<!--tex4ht:ref: 4-25-2 --></a>) can also be transformed to the covariant form, giving
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-45004r172"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium234x.png" alt="    (                        )      (                          )
B =  Ψ  𝒥-∇ ψ ⋅∇𝜃 + Ψ 𝒥-|∇ 𝜃|2  ∇ψ +  − Ψ -𝒥-|∇ ψ|2 − Ψ-𝒥-∇𝜃 ⋅∇ψ  ∇ 𝜃+ g∇ ϕ.
       ψR2           𝜃R2                ψR2         𝜃R2
" class="math-display"  /></center></td><td class="equation-label">(172)</td></tr></table>
<!--l. 1995--><p class="nopar" >
For the convenience of notation, deﬁne
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-45005r173"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium235x.png" alt="hαβ = 𝒥-∇ α⋅∇ β,
      R2
" class="math-display"  /></center></td><td class="equation-label">(173)</td></tr></table>
<!--l. 2000--><p class="nopar" >
then Eq. (<a 
href="#x1-45004r172">172<!--tex4ht:ref: 7-26-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-45006r174"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium236x.png" alt="B  = (Ψψh ψ𝜃 + Ψ𝜃h𝜃𝜃)∇ ψ + (− Ψψhψψ − Ψ𝜃hψ𝜃)∇𝜃 + g∇ ϕ.
" class="math-display"  /></center></td><td class="equation-label">(174)</td></tr></table>
<!--l. 2006--><p class="nopar" >
</p><!--l. 2008--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">10   </span> <a 
 id="x1-4600010"></a>Magnetic surface coordinates (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>)</h3>
<!--l. 2010--><p class="noindent" >A coordinate system (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>), where <span 
class="cmmi-10">ϕ </span>is the usual cylindrical toroidal angle, is called a magnetic
surface coordinate system if <span 
class="cmmi-10">Ψ </span>is a function of only <span 
class="cmmi-10">ψ</span>, i.e., <span 
class="cmmi-10">∂Ψ∕∂𝜃 </span>= 0 (we also have <span 
class="cmmi-10">∂Ψ∕∂ϕ </span>= 0 since we
are considering axially symmetrical case). In terms of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates, the contravariant form of
the magnetic ﬁeld, Eq. (<a 
href="#x1-45003r171">171<!--tex4ht:ref: 3-13-p10 --></a>), is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-46001r175"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium237x.png" alt="                   𝒥
B = − Ψ ′∇ ϕ× ∇ ψ +g-2∇ ψ ×∇ 𝜃,
                   R
" class="math-display"  /></center></td><td class="equation-label">(175)</td></tr></table>
<!--l. 2019--><p class="nopar" >
where <span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">′≡ </span><span 
class="cmmi-10">dΨ∕dψ</span>. The covariant form of the magnetic ﬁeld, Eq. (<a 
href="#x1-45004r172">172<!--tex4ht:ref: 7-26-1 --></a>), is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-46002r176"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium238x.png" alt="    (            )      (           )
B =   Ψ′ 𝒥-∇ ψ ⋅∇𝜃 ∇ψ +  − Ψ′ 𝒥-|∇ ψ|2 ∇ 𝜃+ g∇ ϕ.
        R2                   R2
" class="math-display"  /></center></td><td class="equation-label">(176)</td></tr></table>
<!--l. 2027--><p class="nopar" >
</p><!--l. 2029--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.1   </span> <a 
 id="x1-4700010.1"></a>Local safety factor</h4>
<!--l. 2031--><p class="noindent" >The local safety factor <img 
src="tokamak_equilibrium239x.png" alt="ˆq"  class="circ"  /> is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-47001r177"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium240x.png" alt="   B ⋅∇ ϕ
ˆq =------,
   B ⋅∇ 𝜃
" class="math-display"  /></center></td><td class="equation-label">(177)</td></tr></table>
<!--l. 2035--><p class="nopar" >
which characterizes the local pitch angle of a magnetic ﬁeld line in (<span 
class="cmmi-10">𝜃,ϕ</span>) plane of a magnetic surface.
Substituting the contravariant representation of the magnetic ﬁeld, Eq. (<a 
href="#x1-46001r175">175<!--tex4ht:ref: 12-21-p1 --></a>), into the above equation,
the local safety factor is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-47002r178"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium241x.png" alt="ˆq(ψ,𝜃) = − g2-𝒥′.
          R  Ψ
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(178)</td></tr></table>
<!--l. 2043--><p class="nopar" >
Note that the expression <img 
src="tokamak_equilibrium242x.png" alt="ˆq"  class="circ"  /> in Eq. (<a 
href="#x1-47002r178">178<!--tex4ht:ref: 12-25-1 --></a>) depends on the Jacobian <span 
class="cmsy-10">𝒥 </span>. This is because the
deﬁnition of <img 
src="tokamak_equilibrium243x.png" alt="ˆq"  class="circ"  /> depends on the deﬁnition of <span 
class="cmmi-10">𝜃</span>, which in turn depends on the the Jacobian
<span 
class="cmsy-10">𝒥 </span>.
</p><!--l. 2049--><p class="indent" >   In terms of <img 
src="tokamak_equilibrium244x.png" alt="ˆq"  class="circ"  /> , the contravariant form of the magnetic ﬁeld, Eq. (<a 
href="#x1-46001r175">175<!--tex4ht:ref: 12-21-p1 --></a>), is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-47003r179"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium245x.png" alt="       ′
B = − Ψ (∇ϕ × ∇ψ + ˆq∇ψ × ∇ 𝜃).
" class="math-display"  /></center></td><td class="equation-label">(179)</td></tr></table>
<!--l. 2054--><p class="nopar" >
and the parallel diﬀerential operator <span 
class="cmbx-10">B</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">⋅∇ </span>is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-47004r180"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium246x.png" alt="                                             (         )
B0 ⋅∇ = − Ψ′(∇ ϕ× ∇ ψ + ˆq∇ ψ × ∇𝜃)⋅∇ = − Ψ′𝒥 −1 -∂-+ ˆq-∂- .
                                              ∂ 𝜃   ∂ϕ
" class="math-display"  /></center></td><td class="equation-label">(180)</td></tr></table>
<!--l. 2062--><p class="nopar" >
If <img 
src="tokamak_equilibrium247x.png" alt="ˆq"  class="circ"  /> happens to be independent of <span 
class="cmmi-10">𝜃 </span>(i.e., ﬁeld lines are straight in (<span 
class="cmmi-10">𝜃,ϕ</span>) plane), then the above operator
becomes a constant coeﬃcient diﬀerential oprator (after divided by <span 
class="cmsy-10">𝒥</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup>). This simpliﬁcation is useful
because diﬀerent poloidal harmonics are decoupled in this case. We will discuss this issue futher in Sec.
<a 
href="#x1-6600014">14<!--tex4ht:ref: 23-12-27-1 --></a>.
</p><!--l. 2070--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.2   </span> <a 
 id="x1-4800010.2"></a>Global safety factor</h4>
<!--l. 2072--><p class="noindent" >The global safety factor deﬁned in Eq. (<a 
href="#x1-14004r36">36<!--tex4ht:ref: 9-5-e1 --></a>) is actually the poloidal average of the local safety factor,
i.e., </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium248x.png" alt="          ∫ 2π
q(ψ) ≡ -1-    ˆqd𝜃                              (181)
       2π  0
        -1-g-∫ 2π 𝒥--
     = −2π Ψ′  0  R2d𝜃.                        (182)
" class="math-display"  /><a 
 id="x1-48001r181"></a><a 
 id="x1-48001r182"></a></center>
</div>Note that <span 
class="cmmi-10">q </span>and <img 
src="tokamak_equilibrium249x.png" alt="ˆq"  class="circ"  /> deﬁned this way can be negative, which depends on the choice of the positive
direction of <span 
class="cmmi-10">ϕ </span>and <span 
class="cmmi-10">𝜃 </span>coordinates (note that the safety factor given in G-eqdsk ﬁle is always positive, i.e.
it is the absolute value of the safety factor deﬁned here).
<!--l. 2085--><p class="indent" >   Next, let us transform the <span 
class="cmmi-10">𝜃 </span>integration in expression (<a 
href="#x1-48001r182">182<!--tex4ht:ref: 7-11-p1 --></a>) to a curve integral in the
poloidal plane. Using the relation <span 
class="cmmi-10">dℓ</span><sub><span 
class="cmmi-7">p</span></sub> and <span 
class="cmmi-10">d𝜃 </span>[Eq. (<a 
href="#x1-49004r190">190<!--tex4ht:ref: 5-30-p1 --></a>)], expression (<a 
href="#x1-48001r182">182<!--tex4ht:ref: 7-11-p1 --></a>) is further written
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium250x.png" alt="             ∮
q(ψ) = − 1-g′  sign(𝒥 )-dℓp--
        2πΨ        ∮  R|∇ψ |
    = − 1-g-sign(𝒥)   -dℓp--.                     (183)
        2π sign(Ψ ′)   R |∇ Ψ|
" class="math-display"  /><a 
 id="x1-48002r183"></a></center>
</div>Expression (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>) is used in the GTAW code to numerically calculate the value of <span 
class="cmmi-10">q </span>on magnetic surfaces
(as a benchmarking of the <span 
class="cmmi-10">q </span>proﬁle speciﬁed in the G-eqdsk ﬁle). Expression (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>) can also be
considered as a relation between <span 
class="cmmi-10">q </span>and <span 
class="cmmi-10">g</span>. In the equilibrium problem where <span 
class="cmmi-10">q </span>is given (ﬁxed-q
equilibrium), we can use expression (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>) to obtain the corresponding <span 
class="cmmi-10">g </span>(which explicitly appears in the
GS equation):
   <table 
class="equation"><tr><td><a 
 id="x1-48003r184"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium251x.png" alt="        ( ∮ --dℓp--)−1 sign(Ψ′)
g = − 2πq   R |∇ Ψ|    sign(𝒥 ).
" class="math-display"  /></center></td><td class="equation-label">(184)</td></tr></table>
<!--l. 2104--><p class="nopar" >
We note that expression (<a 
href="#x1-48003r184">184<!--tex4ht:ref: 20-4-7-p1 --></a>) involves magnetic surface averaging, which is unknown before we know
<span 
class="cmmi-10">Ψ</span>. Therefore iteration is usually needed in solving the ﬁxed-q equilibrium (i.e., we guess the unknown
<span 
class="cmmi-10">Ψ</span>, so that the magnetic surface averaging in expression (<a 
href="#x1-48003r184">184<!--tex4ht:ref: 20-4-7-p1 --></a>) can be performed, yielding the values of
<span 
class="cmmi-10">g</span>.)
</p><!--l. 2111--><p class="indent" >   Using <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span><span 
class="cmmi-10">∕R </span>and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmmi-10">g∕R</span>,  the absolute value of <span 
class="cmmi-10">q </span>in expression (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>) is written
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium252x.png" alt="        ∮
|q| =-1-g  --dℓp-.                           (185)
    2π    R |∇ Ψ|
     1 ∮  1|Bϕ|
  = 2π-  R--Bp-dℓp                          (186)
" class="math-display"  /></center>
</div>which is the familiar formula we see in textbooks.
<!--l. 2120--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.3   </span> <a 
 id="x1-4900010.3"></a>Relation between Jacobian and poloidal angle <span 
class="cmmi-10">𝜃</span></h4>
<!--l. 2122--><p class="noindent" >Given the deﬁnition of a magnetic surface coordinate system (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>), the Jacobian of this system is
fully determined. On the other hand, given the deﬁnition of <span 
class="cmmi-10">ψ</span>, <span 
class="cmmi-10">ϕ</span>, and the Jacobian, the deﬁnition of <span 
class="cmmi-10">𝜃</span>
is fully determined (can have some trivial shifting freedoms). Next, let us discuss how to calculate <span 
class="cmmi-10">𝜃 </span>in
this case. In (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates, a line element is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-49001r187"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium253x.png" alt="dl =-∂rdψ + ∂rd𝜃 + ∂rdϕ
    ∂ψ      ∂𝜃     ∂ϕ
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(187)</td></tr></table>
<!--l. 2132--><p class="nopar" >
The line element that lies on a magnetic surface (i.e., <span 
class="cmmi-10">dψ </span>= 0) and in a poloidal plane (i.e., <span 
class="cmmi-10">dϕ </span>= 0) is
then written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium254x.png" alt="     ∂r-
dℓp = ∂ 𝜃d𝜃
   = 𝒥 ∇ϕ × ∇ ψd𝜃.                          (188)
" class="math-display"  /></center>
</div>We use the convention that <span 
class="cmmi-10">dℓ</span><sub><span 
class="cmmi-7">p</span></sub> and <span 
class="cmmi-10">d𝜃 </span>take the same sign, i.e.,
   <table 
class="equation"><tr><td><a 
 id="x1-49003r189"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium255x.png" alt="dℓp = |𝒥 ∇ϕ × ∇ψ |d𝜃.
" class="math-display"  /></center></td><td class="equation-label">(189)</td></tr></table>
<!--l. 2143--><p class="nopar" >
Using the fact that <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>are orthogonal and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>= <img 
src="tokamak_equilibrium256x.png" alt="ˆϕ"  class="circ"  /><span 
class="cmmi-10">∕R</span>, the above equation is written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-49004r190"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium257x.png" alt="       R
d𝜃 = ------dlp
     |𝒥 ∇ ψ|
" class="math-display"  /></center></td><td class="equation-label">(190)</td></tr></table>
                                                                                

                                                                                
<!--l. 2148--><p class="nopar" >
Given <span 
class="cmsy-10">|𝒥∇</span><span 
class="cmmi-10">ψ</span><span 
class="cmsy-10">|</span>, Eq. (<a 
href="#x1-49004r190">190<!--tex4ht:ref: 5-30-p1 --></a>) can be integrated to determine the <span 
class="cmmi-10">𝜃 </span>coordinate of points on a magnetic
surface.
</p><!--l. 2152--><p class="indent" >   —–
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-49005r191"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium258x.png" alt="-  ∫ 𝜃       ∫ 𝜃 g--𝒥
δ = 0 ˆqd𝜃 = − 0  R2Ψ ′d𝜃
" class="math-display"  /></center></td><td class="equation-label">(191)</td></tr></table>
<!--l. 2156--><p class="nopar" >
</p><!--l. 2158--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.4   </span> <a 
 id="x1-5000010.4"></a>Calculating poloidal angle</h4>
<!--l. 2160--><p class="noindent" >Once <span 
class="cmsy-10">|𝒥∇</span><span 
class="cmmi-10">ψ</span><span 
class="cmsy-10">| </span>is known, the value of <span 
class="cmmi-10">𝜃 </span>of a point can be obtained by integrating expression (<a 
href="#x1-49004r190">190<!--tex4ht:ref: 5-30-p1 --></a>),
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-50001r192"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium259x.png" alt="           ∫ xi,j   R
𝜃i,j = 𝜃ref,j +     -----dlp,
            xref,j |𝒥 ∇ψ |
" class="math-display"  /></center></td><td class="equation-label">(192)</td></tr></table>
<!--l. 2166--><p class="nopar" >
where the curve integration is along the contour <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">j</span></sub>, <span 
class="cmbx-10">x</span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub> is a reference point on the contour,
where value of the poloidal angle is chosen as <span 
class="cmmi-10">𝜃</span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub>. The choice of the positive direction of <span 
class="cmmi-10">𝜃 </span>is up to
users. Depending on the positive direction chosen, the sign of the Jacobian of the constructed
coordinates can have a sign diﬀerence from the <span 
class="cmsy-10">𝒥 </span>appearing in Eq. (<a 
href="#x1-50001r192">192<!--tex4ht:ref: 12-31-1 --></a>). Denote the Jacobian of the
constructed coordinates by <span 
class="cmsy-10">𝒥′</span>, then
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-50002r193"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium260x.png" alt="𝒥′ = ± 𝒥
" class="math-display"  /></center></td><td class="equation-label">(193)</td></tr></table>
<!--l. 2177--><p class="nopar" >
This sign can be determined after the radial coordinate and the positive direction of the poloidal angle
are chosen. In <span 
class="cmtt-10">GTAW </span>code, I choose the positive direction of <span 
class="cmmi-10">𝜃 </span>to be in anticlockwise direction when
observers look along the direction of <img 
src="tokamak_equilibrium261x.png" alt="ˆϕ"  class="circ"  />. To achieve this, the line integration in Eq. (<a 
href="#x1-50001r192">192<!--tex4ht:ref: 12-31-1 --></a>) should be
along the anticlockwise direction. (I use the determination of the direction matrix, a well known
method in graphic theory, to determine the direction from a given set of discrete points on a magnetic
surface.)
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-5100010.4"></a>Normalized poloidal angle</h5>
<!--l. 2189--><p class="noindent" >The span of <span 
class="cmmi-10">𝜃 </span>deﬁned by Eq. (<a 
href="#x1-50001r192">192<!--tex4ht:ref: 12-31-1 --></a>) is usually not 2<span 
class="cmmi-10">π </span>in one poloidal loop. This poloidal angle can be
scaled by <span 
class="cmmi-10">s</span>(<span 
class="cmmi-10">ψ</span>) to deﬁne a new poloidal coordinate <span class="overline"><span 
class="cmmi-10">𝜃</span></span>, whose span is 2<span 
class="cmmi-10">π </span>in one poloidal loop, where <span 
class="cmmi-10">s</span>(<span 
class="cmmi-10">ψ</span>)
is a magnetic surface function given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-51001r194"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium262x.png" alt="s(ψ) = ∮--2π----.
        |𝒥R∇ψ|dlp
" class="math-display"  /></center></td><td class="equation-label">(194)</td></tr></table>
<!--l. 2195--><p class="nopar" >
Then <span class="overline"><span 
class="cmmi-10">𝜃</span></span> is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium263x.png" alt="-
𝜃i,j = s(ψj)𝜃i,j
          (       ∫ xi,j        )
   = s(ψj) 𝜃ref,j +     --R---dlp
                   xref,j|𝒥∇ ψ|
     -          ∫ xi,j --R---
   = 𝜃ref,j + s(ψj) x    |𝒥 ∇ψ |dlp,                     (195)
                  ref,j
" class="math-display"  /><a 
 id="x1-51002r195"></a></center>
</div>where <span class="overline"><span 
class="cmmi-10">𝜃</span></span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub> = <span 
class="cmmi-10">s</span>(<span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">j</span></sub>)<span 
class="cmmi-10">𝜃</span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub>. Sine we have modiﬁed the deﬁnition of the poloidal angle, the Jacobian of the
new coordinates (<span 
class="cmmi-10">ψ,</span><span class="overline"><span 
class="cmmi-10">𝜃</span></span><span 
class="cmmi-10">,ϕ</span>) is diﬀerent from that of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>). The Jacobian <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub> of the new coordinates
(<span 
class="cmmi-10">ψ,</span><span class="overline"><span 
class="cmmi-10">𝜃</span></span><span 
class="cmmi-10">,ϕ</span>) is written as
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium264x.png" alt="       ------1-------
𝒥new ≡ (∇ ψ × ∇𝜃)⋅∇ ϕ
               1
    =  {∇ψ-×-∇[s(ψ)𝜃]}⋅∇-ϕ-

    =  -1--------1-------
       s(ψ )(∇ψ × ∇𝜃)⋅∇ ϕ
    =  -1--𝒥′
       s(ψ )
        -1--
    = ± s(ψ)𝒥                                   (196)
" class="math-display"  /><a 
 id="x1-51003r196"></a></center>
</div>The Jacobian <span 
class="cmsy-10">𝒥 </span>can be set to various forms to achieve various poloidal coordinates, which will be
discussed in the next section. After the Jacobian and the radial coordinate <span 
class="cmmi-10">ψ </span>is chosen, all the
quantities on the right-hand side of Eq. (<a 
href="#x1-51002r195">195<!--tex4ht:ref: 10-25-p1 --></a>) are known and the integration can be performed to
obtain the value of <span class="overline"><span 
class="cmmi-10">𝜃</span></span><sub><span 
class="cmmi-7">i,j</span></sub> of each point on each ﬂux surface.
<!--l. 2230--><p class="indent" >   [The reference points <span 
class="cmbx-10">x</span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub> and the values of poloidal angle at these points can be chosen by users.
One choice of the reference points <span 
class="cmbx-10">x</span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub> are those points on the horizontal ray in the midplane that
starts from the magnetic axis and points to the low ﬁled side of the device and <span class="overline"><span 
class="cmmi-10">𝜃</span></span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub> at these
points is chosen as zero (this is my choice in the <span 
class="cmtt-10">GTAW </span>code). In the <span 
class="cmtt-10">TEK </span>code, the reference
points are chosen at the high-ﬁeld side of the midplane and <span class="overline"><span 
class="cmmi-10">𝜃</span></span><sub><span 
class="cmr-7">ref</span><span 
class="cmmi-7">,j</span></sub> = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>at the reference
points.]
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-5200010.4"></a>Jacobian for equal-arc-length poloidal angle</h5>
                                                                                

                                                                                
<!--l. 2242--><p class="noindent" >If the Jacobian <span 
class="cmsy-10">𝒥 </span>is chosen to be of the following form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-52001r197"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium265x.png" alt="      R
𝒥 = ---- .
    |∇ ψ|
" class="math-display"  /></center></td><td class="equation-label">(197)</td></tr></table>
<!--l. 2245--><p class="nopar" >
Then <span class="overline"><span 
class="cmmi-10">𝜃</span></span><sub><span 
class="cmmi-7">i,j</span></sub> in Eq. (<a 
href="#x1-51002r195">195<!--tex4ht:ref: 10-25-p1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-52002r198"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium266x.png" alt="                 ∫
𝜃   = 𝜃   + ∮2π--  xi,jdl.
 i,j    ref,j    dlp  xref,j p
" class="math-display"  /></center></td><td class="equation-label">(198)</td></tr></table>
<!--l. 2251--><p class="nopar" >
and the Jacobian of new coordinates (<span 
class="cmmi-10">ψ,</span><span class="overline"><span 
class="cmmi-10">𝜃</span></span><span 
class="cmmi-10">,ϕ</span>), <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub>, which is given by Eq. (<a 
href="#x1-51003r196">196<!--tex4ht:ref: 10-25-p7 --></a>), now takes the
form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-52003r199"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium267x.png" alt="        ∮ dl  R      ∮ dl  R  dΨ
𝒥new = ±---p-----= ± ---p--------.
         2π  |∇ ψ|     2π  |∇ Ψ|dψ
" class="math-display"  /></center></td><td class="equation-label">(199)</td></tr></table>
                                                                                

                                                                                
<!--l. 2259--><p class="nopar" >
Equation (<a 
href="#x1-52002r198">198<!--tex4ht:ref: 7-18-e2 --></a>) indicates a set of poloidal points with equal arc intervals corresponds to a set
of uniform <span 
class="cmmi-10">𝜃</span><sub><span 
class="cmmi-7">i</span></sub> points. Therefore this choice of the Jacobian is called the equal-arc-length
Jacobian. Note that Eq. (<a 
href="#x1-52002r198">198<!--tex4ht:ref: 7-18-e2 --></a>) does not involve the radial coordinate <span 
class="cmmi-10">ψ</span>. Therefore the values
of <span 
class="cmmi-10">𝜃 </span>of points on any magnetic surface can be determined before the radial coordinate is
chosen.
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-5300010.4"></a>Jacobian for equal-volume poloidal angle (Hamada coordinate)</h5>
<!--l. 2269--><p class="noindent" >The volume element in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates is given by <span 
class="cmmi-10">dV </span>= <span 
class="cmsy-10">|𝒥|</span><span 
class="cmmi-10">d𝜃dϕdψ</span>. If we choose a Jacobian that
is independent of <span 
class="cmmi-10">𝜃</span>, then uniform <span 
class="cmmi-10">𝜃 </span>grids will correspond to grids with uniform volume interval. In this
case, <span 
class="cmsy-10">𝒥 </span>is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-53001r200"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium268x.png" alt="𝒥 = h (ψ ),
" class="math-display"  /></center></td><td class="equation-label">(200)</td></tr></table>
<!--l. 2275--><p class="nopar" >
where <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>) is a function independent of <span 
class="cmmi-10">𝜃</span>. Then <span class="overline"><span 
class="cmmi-10">𝜃</span></span><sub><span 
class="cmmi-7">i,j</span></sub> in Eq. (<a 
href="#x1-51002r195">195<!--tex4ht:ref: 10-25-p1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-53002r201"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium269x.png" alt="-    -        2π    ∫ xi,j  R
𝜃i,j = 𝜃ref,j + ∮-R--dl      |∇ψ|dlp
             |∇ψ| p  xref,j
" class="math-display"  /></center></td><td class="equation-label">(201)</td></tr></table>
<!--l. 2282--><p class="nopar" >
and the Jacobian of the new coordinates (<span 
class="cmmi-10">ψ,</span><span class="overline"><span 
class="cmmi-10">𝜃</span></span><span 
class="cmmi-10">,ϕ</span>), <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub>,  is given by Eq. (<a 
href="#x1-51003r196">196<!--tex4ht:ref: 10-25-p7 --></a>), which now takes the
following form:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-53003r202"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium270x.png" alt="         1 ∮   R
𝒥new = ± 2π-  |∇-ψ|dlp.
" class="math-display"  /></center></td><td class="equation-label">(202)</td></tr></table>
<!--l. 2289--><p class="nopar" >
Note that both <span class="overline"><span 
class="cmmi-10">𝜃</span></span><sub><span 
class="cmmi-7">i,j</span></sub> and <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub> are independent of the function <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>) introduced in Eq. (<a 
href="#x1-53001r200">200<!--tex4ht:ref: 17-10-19-1 --></a>). (<span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>) is
eliminated by the normalization procedure speciﬁed in Sec. <a 
href="#x1-5100010.4">10.4<!--tex4ht:ref: 17-10-19-2 --></a> due to the fact that <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>) is constant
on a magnetic surface.) The equal-volume poloidal angle is also called Hamada poloidal
angle.
</p><!--l. 2297--><p class="indent" >   The equal-volume poloidal angle is useful in achieving loading balance for parallel particle
simulations. Assume that markers are loaded uniform in space and the poloidal angle is domain
decomposed and assigned to diﬀerent MPI process. Then the equal-volume poloidal angle can
make marker number in each MPI process be equal to each other and thus work loading to
each process be equal. (**check**If the domain decomposition is also applied to the radial
direction, to achieve loading balance, then the radial coordinate <span 
class="cmmi-10">ψ </span>should be chosen in a way
that makes <span 
class="cmex-10">∮</span>
 (<span 
class="cmmi-10">R∕</span><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">dl</span><sub><span 
class="cmmi-7">p</span></sub> be independent of <span 
class="cmmi-10">ψ</span>, so that <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub> in Eq. (<a 
href="#x1-53003r202">202<!--tex4ht:ref: 19-4-11-p3 --></a>) is constant in
space.**)
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-5400010.4"></a>Jacobian of Boozer’s poloidal angle</h5>
<!--l. 2310--><p class="noindent" >If the Jacobian <span 
class="cmsy-10">𝒥 </span>is chosen to be of the Boozer form:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-54001r203"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium271x.png" alt="         h(ψ)
𝒥(ψ,𝜃) = -B2-.
" class="math-display"  /></center></td><td class="equation-label">(203)</td></tr></table>
<!--l. 2313--><p class="nopar" >
then the poloidal angle in Eq. (<a 
href="#x1-51002r195">195<!--tex4ht:ref: 10-25-p1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-54002r204"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium272x.png" alt="                    ∫ xi,j  2
𝜃i,j = 𝜃ref,j + ∮-B22πR--      B-R-dlp.
              |∇-ψ|dlp xref,j |∇ ψ|
" class="math-display"  /></center></td><td class="equation-label">(204)</td></tr></table>
<!--l. 2319--><p class="nopar" >
The ﬁnal Jacobian is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-54003r205"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium273x.png" alt="        ∮  2
          B|∇-Rψ|dlp 1
𝒥new = ±---2π---B2-.
" class="math-display"  /></center></td><td class="equation-label">(205)</td></tr></table>
<!--l. 2324--><p class="nopar" >
The usefullness of Boozer poloidal angle will be further discussed in Sec. <a 
href="#x1-7400014.8">14.8<!--tex4ht:ref: 23-12-26-1 --></a> after we introduce a
gneralized toroidal angle.
</p><!--l. 2328--><p class="indent" >    
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-5500010.4"></a>Jacobian for PEST poloidal angle (straight-ﬁeld-line poloidal angle)</h5>
<!--l. 2333--><p class="noindent" >If the Jacobian <span 
class="cmsy-10">𝒥 </span>is chosen to be of the following form
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                                  <span 
class="cmsy-10">𝒥 </span>(<span 
class="cmmi-10">ψ,𝜃</span>) = <span 
class="cmmi-10">R</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 2334--><p class="nopar" >
then Eq. (<a 
href="#x1-47002r178">178<!--tex4ht:ref: 12-25-1 --></a>) implies that the local safety factor, <img 
src="tokamak_equilibrium274x.png" alt="ˆq"  class="circ"  /> (<span 
class="cmmi-10">ψ,𝜃</span>) = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">g∕Ψ</span><span 
class="cmsy-10">′</span>, is a magnetic surface function, i.e.,
the magnetic ﬁeld lines are straight in (<span 
class="cmmi-10">ψ,𝜃</span>) plane. Then the poloidal angle in Eq. (<a 
href="#x1-51002r195">195<!--tex4ht:ref: 10-25-p1 --></a>) is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-55001r206"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium275x.png" alt="                     ∫ xi,j
𝜃i,j = 𝜃ref,j + ∮-2π---      --1--dlp,
              R1|∇-ψ|dlp xref,j R|∇ψ |
" class="math-display"  /></center></td><td class="equation-label">(206)</td></tr></table>
<!--l. 2344--><p class="nopar" >
The Jacobian <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub> given by Eq. (<a 
href="#x1-51003r196">196<!--tex4ht:ref: 10-25-p7 --></a>) now takes the form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-55002r207"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium276x.png" alt="          ∮
         2  R|1∇ψ|dlp
𝒥new = ±R  ---2π----.
" class="math-display"  /></center></td><td class="equation-label">(207)</td></tr></table>
<!--l. 2350--><p class="nopar" >
Let us denote an arbitrary poloidal angle by <span 
class="cmmi-10">𝜃 </span>and the above straight-ﬁeld-line poloidal angle by <span 
class="cmmi-10">𝜗</span>,
then it is ready to ﬁnd the following relation between <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">𝜗</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-55003r208"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium277x.png" alt="            ∫ 𝜃
𝜗 = 𝜗ref,j + 1    qˆd𝜃,
           q 𝜃ref,j
" class="math-display"  /></center></td><td class="equation-label">(208)</td></tr></table>
<!--l. 2357--><p class="nopar" >
where <img 
src="tokamak_equilibrium278x.png" alt="ˆq"  class="circ"  /> is the local safety factor corresponding to the arbitrary poloidal angle <span 
class="cmmi-10">𝜃</span>, i.e.,
<img 
src="tokamak_equilibrium279x.png" alt="ˆq"  class="circ"  /> = <span 
class="cmbx-10">B</span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ϕ∕</span>(<span 
class="cmbx-10">B</span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃</span>). [Proof: Using <span 
class="cmmi-10">d𝜃 </span>= <img 
src="tokamak_equilibrium280x.png" alt="|𝒥R∇ψ-|"  class="frac" align="middle" /><span 
class="cmmi-10">dl</span><sub><span 
class="cmmi-7">p</span></sub>, the poloidal angle <span 
class="cmmi-10">𝜗 </span>given in Eq. (<a 
href="#x1-55001r206">206<!--tex4ht:ref: 18-9-27-p1 --></a>) is written as
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium281x.png" alt="                    ∫ x
𝜗 = 𝜗   + ∮---2π---    i,j--1---dl
     ref,j    R|1∇ψ|dlp  xref,jR |∇ ψ| p
                2π      ∫ xi,j   1   |𝒥 ∇ψ |
  = 𝜗ref,j + ∮--1--|𝒥∇ψ|--      -----------d𝜃
            R|∇ψ|--R--d𝜃 xref,j R|∇ψ |  R
          --2π---∫ xi,j|𝒥-|
  = 𝜗ref,j + ∮ |𝒥|d𝜃 x   R2 d𝜃.                            (209)
            R2     ref,j
" class="math-display"  /></center>
</div>Using <img 
src="tokamak_equilibrium282x.png" alt="ˆq"  class="circ"  /> = <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium283x.png" alt="g-
R2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium284x.png" alt="𝒥-
Ψ′"  class="frac" align="middle" />, where <span 
class="cmsy-10">𝒥 </span>is the Jacobian of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates, then the above <span 
class="cmmi-10">𝜗 </span>is reduced to
expression (<a 
href="#x1-55003r208">208<!--tex4ht:ref: 18-9-27-p4 --></a>).]
<!--l. 2379--><p class="indent" >   Note that Boozer poloidal angle is very close to the poloidal angel disccused here because the two
Jacobians are very similar:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-55005r210"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium285x.png" alt="𝒥  = -12-∼ R2.
     B
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(210)</td></tr></table>
<!--l. 2383--><p class="nopar" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-5600010.4"></a>Comparison between diﬀerent types of poloidal angle</h5>
<!--l. 2388--><p class="noindent" > 
</p><!--l. 2390--><p class="indent" >   All Jacobians introduced above can be written in a general form:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-56001r211"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium286x.png" alt="         i
𝒥  = --R-j-k,
     |∇ ψ| B
" class="math-display"  /></center></td><td class="equation-label">(211)</td></tr></table>
<!--l. 2393--><p class="nopar" >
The choice of (<span 
class="cmmi-10">i </span>= 2<span 
class="cmmi-10">,j </span>= <span 
class="cmmi-10">k </span>= 0) gives the PEST coordinate, (<span 
class="cmmi-10">i </span>= <span 
class="cmmi-10">j </span>= 0<span 
class="cmmi-10">,k </span>= 2) give the Boozer
coordinate, (<span 
class="cmmi-10">i </span>= <span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,k </span>= 0) gives the equal-arc coordinate, (<span 
class="cmmi-10">i </span>= <span 
class="cmmi-10">j </span>= <span 
class="cmmi-10">k </span>= 0) gives the Hammada
coordinate.
</p><!--l. 2398--><p class="indent" >    
</p><!--l. 2400--><p class="indent" >   Figure <a 
href="#x1-560027">7<!--tex4ht:ref: 8-23-1 --></a> compares the equal-arc-poloidal angle and the straight-line poloidal angle, which shows
that the resolution of the straight-line poloidal angle is not good near the low-ﬁeld-side midplane. Since
ballooning modes take larger amplitude near the low-ﬁeld-side midplane, better resolution is desired
there. This is one reason that I often avoid using the straight-line poloidal angle in my numerical
codes.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-560027"></a>
                                                                                

                                                                                
<!--l. 2408--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig161/out1.png" alt="pict"  
 width="113.42375pt" /> <img 
src="my_figure/home/yj/project_new/read_gfile/fig161/out2.png" alt="pict"  
 width="113.42375pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 7: </span><span  
class="content">The equal-arc poloidal angle (left) and the straight-line poloidal angle (right) for EAST
equilibrium #38300@3.9s. The blue lines correspond to the equal-<span 
class="cmmi-10">𝜃 </span>lines, with uniform <span 
class="cmmi-10">𝜃 </span>interval
between neighbour lines. The red lines correspond to the magnetic surfaces, which start from
<img 
src="tokamak_equilibrium287x.png" alt="∘ Ψ--
    t"  class="sqrt"  /> = 0<span 
class="cmmi-10">.</span>01714 (the innermost magnetic surface) and end at <img 
src="tokamak_equilibrium288x.png" alt="∘ Ψ--
    t"  class="sqrt"  />  = 0<span 
class="cmmi-10">.</span>9851 (the boundary
magnetic surface), and are equally spaced in <img 
src="tokamak_equilibrium289x.png" alt="∘ ---
  Ψt"  class="sqrt"  />.</span></div><!--tex4ht:label?: x1-560027 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x1-5700010.4"></a>Veriﬁcation of Jacobian</h5>
<!--l. 2421--><p class="noindent" >After the magnetic coordinates are constructed, we can evaluate the Jacobian <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub> by using directly
the deﬁnition of the Jacobian, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-57001r212"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium290x.png" alt="       ------1-------
𝒥new = (∇ψ × ∇ 𝜃) ⋅∇ϕ ,
" class="math-display"  /></center></td><td class="equation-label">(212)</td></tr></table>
<!--l. 2427--><p class="nopar" >
which can be further written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-57002r213"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium291x.png" alt="𝒥new = R (R 𝜃Zψ − RψZ𝜃),
" class="math-display"  /></center></td><td class="equation-label">(213)</td></tr></table>
<!--l. 2432--><p class="nopar" >
where the partial diﬀerential can be evaluated by using numerical diﬀerential schemes. The results
obtained by this way should agree with results obtained from the analytical form of the Jacobian. This
consistency check provide a veriﬁcation for the correctness of the theory derivation and numerical
implementation. In evaluating the Jacobian by using the analytical form, we may need to evaluate <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>,
which ﬁnally reduces to evaluating <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ</span>. The value of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>is obtained numerically based on the
numerical data of <span 
class="cmmi-10">Ψ </span>given in cylindrical coordinate grids. Then the cubic spline interpolating
formula is used to obtain the value of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>at desired points. (<span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub> calculated by the second
method (i.e. using analytic form) is used in the GTAW code; the ﬁrst methods are also
implemented in the code for the benchmark purpose.) In the following sections, for notation
ease, the Jacobiban of the constructed coordinate system will be denoted by <span 
class="cmsy-10">𝒥 </span>, rather than
<span 
class="cmsy-10">𝒥</span><sub><span 
class="cmr-7">new</span></sub>.
                                                                                

                                                                                
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-5800010.4"></a>Radial coordinate</h5>
<!--l. 2451--><p class="noindent" >The radial coordinate <span 
class="cmmi-10">ψ </span>can be chosen to be various surface function, e.g., volume, poloidal or toroidal
magnetic ﬂux within a magnetic surface. The frequently used radial coordinates include <span class="overline"><span 
class="cmmi-10">Ψ</span></span>, and <img 
src="tokamak_equilibrium292x.png" alt="√ Ψ-"  class="sqrt"  />,
where <span class="overline"><span 
class="cmmi-10">Ψ</span></span> is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58001r214"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium293x.png" alt="--  Ψ-−-Ψ0-
Ψ = Ψa − Ψ0,
" class="math-display"  /></center></td><td class="equation-label">(214)</td></tr></table>
<!--l. 2457--><p class="nopar" >
where <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">a</span></sub> are the values of <span 
class="cmmi-10">Ψ </span>at the magnetic axis and LCFS, respectively. Other choices of the
radial coordinates: the toroidal magnetic ﬂux and its square root, <span class="overline"><span 
class="cmmi-10">Ψ</span></span><sub><span 
class="cmmi-7">t</span></sub>, and <img 
src="tokamak_equilibrium294x.png" alt="∘ ---
  Ψt"  class="sqrt"  />, where <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">t</span></sub> and <span class="overline"><span 
class="cmmi-10">Ψ</span></span><sub><span 
class="cmmi-7">t</span></sub> are
deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58002r215"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium295x.png" alt="dΨt
dΨ- = 2πq,Ψt(0) = 0
" class="math-display"  /></center></td><td class="equation-label">(215)</td></tr></table>
<!--l. 2465--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58003r216"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium296x.png" alt="Ψ-=  -Ψt-,
 t   Ψt(1)
" class="math-display"  /></center></td><td class="equation-label">(216)</td></tr></table>
<!--l. 2469--><p class="nopar" >
respectively, where <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">t</span></sub>(0) and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">t</span></sub>(1) are the values of <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">t</span></sub> at the magnetic axis and LCFS,
respectively.
</p><!--l. 2473--><p class="indent" >   If <span 
class="cmmi-10">ψ </span>= <img 
src="tokamak_equilibrium297x.png" alt="  ---
∘ Ψt"  class="sqrt"  />, then
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58004r217"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium298x.png" alt="dΨ   dΨ dΨ     1 dΨ     1  dΨ dΨ-    1
---= -----t = ------t= ------t--t-= ---Ψt(1)2ψ
dψ   dΨtdψ    2πq dψ   2πq dΨtdψ    2πq
" class="math-display"  /></center></td><td class="equation-label">(217)</td></tr></table>
<!--l. 2479--><p class="nopar" >
The cylindrical coordinates (<span 
class="cmmi-10">R,ϕ,Z</span>) is a right-hand system, with the positive direction
of <span 
class="cmmi-10">Z </span>pointing vertically up. In GTAW code, the positive direction of <span 
class="cmmi-10">𝜃 </span>is chosen in the
anticlockwise direction when observers look along the direction of <img 
src="tokamak_equilibrium299x.png" alt="ˆ
ϕ"  class="circ"  />. Then the deﬁnition
<span 
class="cmsy-10">𝒥</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup> = <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ϕ </span>indicates that (1) <span 
class="cmsy-10">𝒥 </span>is negative if <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>points from the magnetic axis to LCFS;
(2) <span 
class="cmsy-10">𝒥 </span>is positive if <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>points from the LCFS to the magnetic axis. This can be used to
determine the sign of Jacobian after using the analytical formula to obtain the absolute value of
Jacobian.
</p><!--l. 2491--><p class="indent" >   If <span 
class="cmmi-10">ψ </span>=<span class="overline"> <span 
class="cmmi-10">Ψ</span></span> or <span 
class="cmmi-10">ψ </span>= <img 
src="tokamak_equilibrium300x.png" alt="√ --
  Ψ"  class="sqrt"  />, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>points from the magnetic axis to LCFS.
</p><!--l. 2494--><p class="indent" >   The volume between magnetic surfaces can also be used as a radial coordinate. The diﬀerential
volume element is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58005r218"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium301x.png" alt="d3V = 𝒥 dψd𝜃dϕ.
" class="math-display"  /></center></td><td class="equation-label">(218)</td></tr></table>
<!--l. 2498--><p class="nopar" >
Integrating over the toroidal angle, we obtain
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58006r219"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium302x.png" alt=" 2
d V = 2π𝒥dψd 𝜃
" class="math-display"  /></center></td><td class="equation-label">(219)</td></tr></table>
<!--l. 2502--><p class="nopar" >
Further integrating over the poloidal angle, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58007r220"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium303x.png" alt=" 1         ∮
d V = 2πdψ   𝒥 d𝜃,
" class="math-display"  /></center></td><td class="equation-label">(220)</td></tr></table>
<!--l. 2506--><p class="nopar" >
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-58008r221"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium304x.png" alt="d1V      ∮
----= 2π   𝒥 d𝜃.
 dψ
" class="math-display"  /></center></td><td class="equation-label">(221)</td></tr></table>
<!--l. 2510--><p class="nopar" >
In codes I wrote, I stick to using <span class="overline"><span 
class="cmmi-10">Ψ</span></span> as the radial coordinate when doing computation, and transform to
other radial coordinates when presenting the results if needed.
                                                                                

                                                                                
</p><!--l. 2515--><p class="indent" >    
</p><!--l. 2518--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">11   </span> <a 
 id="x1-5900011"></a>Constructing magnetic surface coordinate system from discrete <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) data</h3>
<!--l. 2520--><p class="noindent" >Given an axisymmetric tokamak equilibrium in (<span 
class="cmmi-10">R,ϕ,Z</span>) coordinates (e.g., 2D data <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) on a
rectangular grids (<span 
class="cmmi-10">R,Z</span>) in G-ﬁle), we can construct a magnetic surface coordinates (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) by the
following two steps. (1) Find out a series of magnetic surfaces on (<span 
class="cmmi-10">R,Z</span>) plane and select radial
coordinates for each magnetic surface (e.g. the poloidal ﬂux within each magnetic surface). (2) Specify
the Jacobian or some property that we want the poloidal angle to have. Then calculate the poloidal
angle of each point on each ﬂux surface (on the <span 
class="cmmi-10">ϕ </span>= const plane) by using Eq. (<a 
href="#x1-49004r190">190<!--tex4ht:ref: 5-30-p1 --></a>) (if the Jacobian is
speciﬁed) or some method speciﬁed by us to achieve some property we prefer for the poloidal angle (if a
Jacobian is not directly speciﬁed). Then we obtain the magnetic surface coordinates system
(<span 
class="cmmi-10">ψ,𝜃,ϕ</span>).
</p><!--l. 2533--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">11.1   </span> <a 
 id="x1-6000011.1"></a>Finding magnetic surfaces</h4>
<!--l. 2535--><p class="noindent" >Two-dimensional data <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) on a rectangular grids (<span 
class="cmmi-10">R,Z</span>) is read from the G_EQDSK ﬁle (G-ﬁle) of
EFIT code. Based on the 2D array data, I use 2D cubic spline interpolation to construct a interpolating
function <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>). To construct a magnetic surface coordinate system, I need to ﬁnd the contours
of <span 
class="cmmi-10">Ψ</span>, i.e., magnetic surfaces. The values of <span 
class="cmmi-10">Ψ </span>on the magnetic axis, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>, and the value of <span 
class="cmmi-10">Ψ </span>on the last
closed ﬂux surface (LCFS), <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>, are given in G-ﬁle. Using these two values, I construct a
1D array “psival” with value of elements changing uniform from <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> to <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>. Then I try to
ﬁnd the contours of <span 
class="cmmi-10">Ψ </span>with contour level value ranging from <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> to <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>. This is done in the
following way: construct a series of straight line (in the poloidal plane) that starts from the
location of the magnetic axis and ends at one of the points on the LCFS. Combine the
straight line equation, <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>), with the interpolating function <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>), we obtain a
one variable function <span 
class="cmmi-10">h </span>= <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>(<span 
class="cmmi-10">R</span>)). Then ﬁnding the location where <span 
class="cmmi-10">Ψ </span>is equal to a
speciﬁed value <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">i</span></sub>, is reduced to ﬁnding the root of the equation <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>(<span 
class="cmmi-10">R</span>)) <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">i</span></sub> = 0.
Since this is a one variable equation, the root can be easily found by using simple root
ﬁnding scheme, such as bisection method (bisection method is used in GTAW code). After
ﬁnding the roots for each value in the array “psival” on each straight lines, the process of
ﬁnding the contours of <span 
class="cmmi-10">Ψ </span>is ﬁnished. The contours of <span 
class="cmmi-10">Ψ </span>found this way are plotted in Fig.
<a 
href="#x1-600018">8<!--tex4ht:ref: 4-3-p2 --></a>.
</p><!--l. 2558--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-600018"></a>
                                                                                

                                                                                
<!--l. 2561--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig1/contour.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 8: </span><span  
class="content">Veriﬁcation of the numerical code that calculates the contours of the poloidal ﬂux <span 
class="cmmi-10">Ψ</span>. The
bold line in the ﬁgure indicates the LCFS. The contour lines (solid lines) given by the gnuplot
program agrees well with the results I calculate by using interpolation and root-ﬁnding method
(the two sets of contours are indistinguishable in this scale). My code only calculate the contour
lines within the LCFS, while those given by gnuplot contains additional contour lines below the
X point and on the left top in the ﬁgure. Eqdisk ﬁle of the equilibrium was provided by Dr.
Guoqiang Li (ﬁlename: g013606.07104).</span></div><!--tex4ht:label?: x1-600018 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2573--><p class="indent" >    
</p><!--l. 2575--><p class="indent" >   In the above, we mentioned that the point of magnetic axis and points on the LCFS are needed to
construct the straight lines. In G-ﬁle, points on LCFS are given explicitly in an array. The location of
magnetic axis is also explicitly given in G-ﬁle. It is obvious that some of the straight lines <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>)
that pass through the location of magnetic axis and points on the LCFS will have very large or even
inﬁnite slope. On these lines, ﬁnding the accurate root of the equation <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>(<span 
class="cmmi-10">R</span>)) <span 
class="cmsy-10">−</span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">i</span></sub> = 0 is diﬃcult
or even impossible. The way to avoid this situation is obvious: switch to use function <span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span>(<span 
class="cmmi-10">Z</span>)
instead of <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>) when the slope of <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>) is large (the switch condition I used is
<span 
class="cmsy-10">|</span><span 
class="cmmi-10">dZ∕dR</span><span 
class="cmsy-10">| </span><span 
class="cmmi-10">&#x003E; </span>1).
</p><!--l. 2586--><p class="indent" >   In constructing the ﬂux surface coordinate with desired Jacobian, we will need the absolute value of
the gradient of <span 
class="cmmi-10">Ψ</span>, <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span>, on some speciﬁed spatial points. To achieve this, we need to construct a
interpolating function for <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span>. The <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-60002r222"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium305x.png" alt="       ∘ ----------------
         (∂ Ψ)2   (∂ Ψ)2
|∇Ψ | =   ---   +  ---  ,
          ∂R       ∂Z
" class="math-display"  /></center></td><td class="equation-label">(222)</td></tr></table>
<!--l. 2594--><p class="nopar" >
By using the center diﬀerence scheme to evaluate the partial derivatives with respect to <span 
class="cmmi-10">R </span>and <span 
class="cmmi-10">Z </span>in the
above equation (using one side diﬀerence scheme for the points on the rectangular boundary), we can
obtain an 2D array for the value of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on the rectangular (<span 
class="cmmi-10">R,Z</span>) grids. Using this 2D array,
we can construct an interpolating function for <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span>by using the cubic spline interpolation
scheme.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-600039"></a>
                                                                                

                                                                                
<!--l. 2603--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig2/plt.png" alt="pict"  
 width="180.67499pt" /> <img 
src="my_figure/home/yj/project_new/read_gfile/fig40/plt.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 9: </span><span  
class="content">Grid points (the intersecting points of two curves in the ﬁgure) corresponding to uniform
poloidal ﬂux and uniform poloidal arc length for EAST equilibrium shot 13606 at 7.1s (left)
(G-ﬁle name: g013606.07104) and shot 38300 at 3.9s (right) (G-ﬁle name: g038300.03900).</span></div><!--tex4ht:label?: x1-600039 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-6000410"></a>
                                                                                

                                                                                
<!--l. 2611--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/p2.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 10: </span><span  
class="content"><span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>as a function of the poloidal angle. The diﬀerent lines corresponds to the values
of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on diﬀerent magnetic surfaces. The stars correspond to the values on the boundary
magnetic surface while the plus signs correspond to the value on the innermost magnetic surface
(the magnetic surface adjacent to the magnetic axis). The equilibrium is for EAST shot 38300
at 3.9s.</span></div><!--tex4ht:label?: x1-6000410 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-6000511"></a>
                                                                                

                                                                                
<!--l. 2621--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/p3.png" alt="pict"  
 width="251.94124pt" />                             <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/p4.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 11: </span><span  
class="content">The Poloidal magnetic ﬁeld <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span><span 
class="cmmi-10">∕R </span>(left) and toroidal magnetic ﬁeld <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmmi-10">g∕R</span>
(right) as a function of the poloidal angle. The diﬀerent lines corresponds to the values on diﬀerent
magnetic surfaces. The stars correspond to the values on the boundary magnetic surface while
the plus signs correspond to the value on the innermost magnetic surface (the magnetic surface
adjacent to the magnetic axis). The equilibrium is for EAST shot 38300 at 3.9s.</span></div><!--tex4ht:label?: x1-6000511 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2631--><p class="indent" >    
</p><!--l. 2633--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-6000612"></a>
                                                                                

                                                                                
<!--l. 2636--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/tmp.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 12: </span><span  
class="content">Equal-arc Jacobian as a function of the poloidal angle on diﬀerent magnetic surfaces.
The dotted line corresponds to the values of Jacobian on the boundary magnetic surface. The
equilibrium is for EAST shot 38300 at 3.9s.</span></div><!--tex4ht:label?: x1-6000612 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-6000713"></a>
                                                                                

                                                                                
<!--l. 2644--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig32/tmp.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 13: </span><span  
class="content"><span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>as a function of the poloidal angle. The diﬀerent lines corresponds to values of
<span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on diﬀerent magnetic surfaces. The stars correspond to the values of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on the boundary
magnetic surface while the plus signs correspond to the value on the innermost magnetic surface
(the magnetic surface adjacent to the magnetic axis). The equilibrium is a Solovev equilibrium.</span></div><!--tex4ht:label?: x1-6000713 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2653--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-6000814"></a>
                                                                                

                                                                                
<!--l. 2656--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig29/tmp.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 14:  </span><span  
class="content">Jacobian  on  diﬀerent  magnetic  surfaces  as  a  function  of  the  poloidal  angle.  The
equilibrium  is  a  Solovev  equilibrium  and  the  Jacobian  is  an  equal-arc  Jacobian.  The  stars
correspond to the values of Jacobian on the boundary magnetic surface while the plus signs
correspond to the value on the innermost magnetic surface (the magnetic surface adjacent to the
magnetic axis).</span></div><!--tex4ht:label?: x1-6000814 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2665--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">11.2   </span> <a 
 id="x1-6100011.2"></a>Expression of metric elements of magnetic coordinates (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>)</h4>
<!--l. 2670--><p class="noindent" >Metric elements of the (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates, e.g., <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃</span>, are often needed in practical calculations.
Next, we express these metric elements in terms of the cylindrical coordinates (<span 
class="cmmi-10">R,Z</span>) and their partial
derivatives with respect to <span 
class="cmmi-10">ψ </span>and <span 
class="cmmi-10">𝜃</span>. Note that, in this case, the coordinate system is (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) while <span 
class="cmmi-10">R</span>
and <span 
class="cmmi-10">Z </span>are functions of <span 
class="cmmi-10">ψ </span>and <span 
class="cmmi-10">𝜃</span>, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61001r223"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium306x.png" alt="R = R (ψ,𝜃),
" class="math-display"  /></center></td><td class="equation-label">(223)</td></tr></table>
<!--l. 2678--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61002r224"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium307x.png" alt="Z = R (ψ,𝜃).
" class="math-display"  /></center></td><td class="equation-label">(224)</td></tr></table>
<!--l. 2681--><p class="nopar" >
Then <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">R </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Z </span>are written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61003r225"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium308x.png" alt="      ˆ
∇R  = R = Rψ∇ ψ + R𝜃∇ 𝜃,
" class="math-display"  /></center></td><td class="equation-label">(225)</td></tr></table>
<!--l. 2686--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61004r226"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium309x.png" alt="∇Z  = ˆZ = Zψ∇ ψ + Z𝜃∇𝜃,
" class="math-display"  /></center></td><td class="equation-label">(226)</td></tr></table>
<!--l. 2690--><p class="nopar" >
wehre <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">ψ</span></sub> <span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">∂R∕∂ψ</span>, etc. Equations (<a 
href="#x1-61003r225">225<!--tex4ht:ref: 4-19-e10 --></a>) and (<a 
href="#x1-61004r226">226<!--tex4ht:ref: 4-19-e11 --></a>) can be solved to give
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61005r227"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium310x.png" alt="           1
∇ψ =  R-Z--−-Z-R--(Z 𝜃Rˆ − R 𝜃ˆZ),
       ψ 𝜃    ψ 𝜃
" class="math-display"  /></center></td><td class="equation-label">(227)</td></tr></table>
<!--l. 2696--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61006r228"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium311x.png" alt="     -----1------    ˆ     ˆ
∇𝜃 = ZψR 𝜃 − R ψZ𝜃(ZψR − R ψZ).
" class="math-display"  /></center></td><td class="equation-label">(228)</td></tr></table>
<!--l. 2700--><p class="nopar" >
Using the above expressions, the Jacobian of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates, <span 
class="cmsy-10">𝒥 </span>, is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium312x.png" alt="  −1
𝒥    = ∇ψ × ∇𝜃 ⋅∇ϕ
     = −-------1-------(Z  R ˆϕ − R Z  ˆϕ)× ϕˆ
        (RψZ 𝜃 − ZψR 𝜃)2 𝜃 ψ     𝜃 ψ     R
               1
     = −(Z𝜃R-ψ −-R-𝜃Z-ψ)R,                                (229)
" class="math-display"  /></center>
</div>i.e.,
   <table 
class="equation"><tr><td><a 
 id="x1-61008r230"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium313x.png" alt="𝒥 = R (R 𝜃Zψ − R ψZ𝜃).
" class="math-display"  /></center></td><td class="equation-label">(230)</td></tr></table>
<!--l. 2714--><p class="nopar" >
Using this, Expressions (<a 
href="#x1-61005r227">227<!--tex4ht:ref: 4-19-e2 --></a>) and (<a 
href="#x1-61006r228">228<!--tex4ht:ref: 4-19-e3 --></a>) are written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61009r231"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium314x.png" alt="        R
∇ ψ = − 𝒥 (Z 𝜃Rˆ− R 𝜃ˆZ)
" class="math-display"  /></center></td><td class="equation-label">(231)</td></tr></table>
<!--l. 2719--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61010r232"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium315x.png" alt="∇𝜃 = R-(ZψRˆ− R ψˆZ).
     𝒥
" class="math-display"  /></center></td><td class="equation-label">(232)</td></tr></table>
<!--l. 2724--><p class="nopar" >
Then the elements of the metric matrix are written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61011r233"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium316x.png" alt="        R2
|∇ψ|2 = 𝒥2(Z2𝜃 + R2𝜃),
" class="math-display"  /></center></td><td class="equation-label">(233)</td></tr></table>
<!--l. 2729--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61012r234"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium317x.png" alt="|∇ 𝜃|2 = R2-(Z2 +R2 ),
       𝒥 2  ψ    ψ
" class="math-display"  /></center></td><td class="equation-label">(234)</td></tr></table>
<!--l. 2733--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61013r235"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium318x.png" alt="            2
∇ψ ⋅∇ 𝜃 = − R-(Z 𝜃Z ψ + R 𝜃Rψ).
           𝒥2
" class="math-display"  /></center></td><td class="equation-label">(235)</td></tr></table>
<!--l. 2738--><p class="nopar" >
Equations (<a 
href="#x1-61011r233">233<!--tex4ht:ref: 4-19-e7 --></a>), (<a 
href="#x1-61012r234">234<!--tex4ht:ref: 4-19-e8 --></a>), and (<a 
href="#x1-61013r235">235<!--tex4ht:ref: 4-19-e9 --></a>) are the expressions of the metric elements in terms of <span 
class="cmmi-10">R</span>, <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">ψ</span></sub>, <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">𝜃</span></sub>, <span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">ψ</span></sub>,
and <span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">𝜃</span></sub>. [Combining the above results, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61014r236"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium319x.png" alt="∇ψ ⋅∇ 𝜃    Z Z  + R R
-----2-= − -𝜃--ψ2---𝜃2-ψ.
 |∇ ψ|         Z𝜃 + R 𝜃
" class="math-display"  /></center></td><td class="equation-label">(236)</td></tr></table>
<!--l. 2746--><p class="nopar" >
Equation (<a 
href="#x1-61013r235">235<!--tex4ht:ref: 4-19-e9 --></a>) is used in GTAW code. Using the above results, <span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">αβ</span></sup> = <img 
src="tokamak_equilibrium320x.png" alt="𝒥-
R2"  class="frac" align="middle" /><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">α </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">β </span>are written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61015r237"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium321x.png" alt="       𝒥         1
hψ ψ =--2|∇ψ|2 = -(Z2𝜃 + R2𝜃)
      R          𝒥
" class="math-display"  /></center></td><td class="equation-label">(237)</td></tr></table>
<!--l. 2753--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61016r238"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium322x.png" alt="      𝒥         1
h𝜃𝜃 = -2|∇ 𝜃|2 = -(Z2ψ + R2ψ ),
      R         𝒥
" class="math-display"  /></center></td><td class="equation-label">(238)</td></tr></table>
<!--l. 2757--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-61017r239"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium323x.png" alt="      𝒥             1
hψ𝜃 = R2-∇ψ ⋅∇ 𝜃 = − 𝒥-(Z 𝜃Z ψ + R 𝜃Rψ)
" class="math-display"  /></center></td><td class="equation-label">(239)</td></tr></table>
<!--l. 2761--><p class="nopar" >
As a side product of the above results, we can calculate the arc length in the poloidal plane along a
constant <span 
class="cmmi-10">ψ </span>surface, <span 
class="cmmi-10">dℓ</span><sub><span 
class="cmmi-7">p</span></sub>, which is expressed as </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium324x.png" alt="     ∘ ------------
dℓp =  (dR)2 + (dZ)2
     ∘ -------------2---------------2
   =   (Rψdψ + R𝜃d𝜃) + (Zψdψ + Z𝜃d𝜃) .
" class="math-display"  /></center>
</div>Note that <span 
class="cmmi-10">dψ </span>= 0 since we are considering the arc length along a constant <span 
class="cmmi-10">ψ </span>surface in (<span 
class="cmmi-10">R,Z</span>) plane.
Then the above expression is reduced to <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium325x.png" alt="      ∘------2--------2
dℓp = ∘(R-𝜃d𝜃)- +(Z𝜃d𝜃)
    =  R2 + Z2d𝜃
         𝜃   𝜃
    = |𝒥-∇-ψ|d𝜃,                                (240)
        R
" class="math-display"  /><a 
 id="x1-61019r240"></a></center>
</div>which agrees with Eq. (<a 
href="#x1-49004r190">190<!--tex4ht:ref: 5-30-p1 --></a>).]
<!--l. 2781--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">12   </span> <a 
 id="x1-6200012"></a>Constructing model tokamak magnetic ﬁeld</h3>
<!--l. 2783--><p class="noindent" >In some cases (e.g., turbulence simulation), model tokamak magnetic ﬁeld, which is not an exact
solution to the GS equation, is often used. In the model, the safety factor proﬁle <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span>),
toroidal ﬁeld function <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">ψ</span>), and the magnetic surface shape (<span 
class="cmmi-10">R</span>(<span 
class="cmmi-10">ψ,𝜃</span>)<span 
class="cmmi-10">,Z</span>(<span 
class="cmmi-10">ψ,𝜃</span>)) are given. To
use this model in a simulation, we need to calculate its poloidal magnetic ﬁeld, which is
determined by the poloidal magnetic ﬂux function <span 
class="cmmi-10">Ψ</span>. To determine <span 
class="cmmi-10">Ψ</span>, we need to use Eq. (<a 
href="#x1-48001r182">182<!--tex4ht:ref: 7-11-p1 --></a>),
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-62001r241"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium326x.png" alt="         1 g ∫ 2π 𝒥
q(ψ) = −2π-Ψ′     R2d𝜃,
               0
" class="math-display"  /></center></td><td class="equation-label">(241)</td></tr></table>
<!--l. 2794--><p class="nopar" >
and re-organize the formula as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-62002r242"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium327x.png" alt="              ∫
dΨ-= − -1-g(ψ-)  2π-𝒥-d𝜃,
dψ     2π q(ψ ) 0  R2
" class="math-display"  /></center></td><td class="equation-label">(242)</td></tr></table>
<!--l. 2799--><p class="nopar" >
which can be integrated to obtain <span 
class="cmmi-10">Ψ </span>and thus the poloidal magnetic ﬁeld <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ϕ</span>, where
<span 
class="cmsy-10">𝒥 </span>= [(<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃</span>) <span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ϕ</span>]<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup>. The toroidal magnetic ﬁeld can be obtained from <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">ψ</span>) by <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmmi-10">g∕R</span>. In most
papers, <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">ψ</span>) is chosen to be a constant.
</p><!--l. 2806--><p class="indent" >   A typical magnetic surface shape used in simulations is the Miller shape, which is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-62003r243"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium328x.png" alt="                          −1
R (r,𝜃) = R0 (r)+ r cos[𝜃+ (sin δ(r))sin𝜃]
Z (r,𝜃) = κ(r)rsin 𝜃
" class="math-display"  /></center></td><td class="equation-label">(243)</td></tr></table>
                                                                                

                                                                                
<!--l. 2814--><p class="nopar" >
where <span 
class="cmmi-10">r </span>= <span 
class="cmmi-10">ψ </span>is the radial coordinate, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">r</span>), <span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">r</span>), and <span 
class="cmmi-10">κ</span><sub><span 
class="cmmi-7">r</span></sub>(<span 
class="cmmi-10">r</span>) are the Shafronov shift, triangularity, and
elongation proﬁles, which can be arbitrarily speciﬁed. For the special case of <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> being a constant,
<span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">r</span>) = 0, and <span 
class="cmmi-10">κ</span>(<span 
class="cmmi-10">r</span>) = 1, this shape reduces to a concentric-circular magnetic ﬁeld. An example of
calculating the poloidal ﬁeld of the model ﬁeld is given in Sec. <a 
href="#x1-9400016">16<!--tex4ht:ref: 19-4-8-p1 --></a>. This kind of model ﬁeld can be
called theoretical physicists’ tokamak. Computational physicists often use this model for
code benchmarking purpose. The famous DIII-D cyclone base case is an example, which
was extensively used for benchmarking gyrokinetic simulation of ion temperature driven
turbulence.
</p><!--l. 2826--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">13   </span> <a 
 id="x1-6300013"></a>Magnetic surface averaging</h3>
<!--l. 2828--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">13.1   </span> <a 
 id="x1-6400013.1"></a>Deﬁnition</h4>
<!--l. 2830--><p class="noindent" >The magnetic surface average of a physical quantity <span 
class="cmmi-10">G</span>(<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-64001r244"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium329x.png" alt="           ( ∫ ∫ ∫ Gd3V  )
⟨G ⟩ ≡ ΔliΨm→0  ∫-∫ ∫ΔΨ-3--- ,
                 Δ Ψ d V
" class="math-display"  /></center></td><td class="equation-label">(244)</td></tr></table>
<!--l. 2836--><p class="nopar" >
where the volume integration is over a small volume between two adjacent ﬂux surfaces with <span 
class="cmmi-10">Ψ </span>diﬀering
by <span 
class="cmsy-10">△</span><span 
class="cmmi-10">Ψ</span>. [This formula (with ﬁnite <span 
class="cmmi-10">ΔΨ</span>) is used in <span 
class="cmtt-10">TEK</span> code to calculate the radial heat
ﬂux.]
</p><!--l. 2842--><p class="indent" >   The above 3D volume integration can also be written as a 2D surface integration. The diﬀerential
volume element is given by <span 
class="cmmi-10">d</span><sup><span 
class="cmr-7">3</span></sup><span 
class="cmmi-10">V </span>= <span 
class="cmsy-10">|𝒥|</span><span 
class="cmmi-10">dψd𝜃dϕ</span>, where <span 
class="cmsy-10">𝒥 </span>is the Jacobian of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates. Using
this, equation (<a 
href="#x1-64001r244">244<!--tex4ht:ref: 6-14-2 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium330x.png" alt="          ( ∫ ∫ ∫             )
⟨G⟩ = lim    -∫ ∫-Δ∫Ψ-G|𝒥-|dψd𝜃dϕ
     Δ Ψ→0       ΔΨ |𝒥 |dψd 𝜃dϕ
      ∫ ∫ G|𝒥|d𝜃dϕ
   =  ∫-∫--------,                                 (245)
          |𝒥 |d𝜃dϕ
" class="math-display"  /><a 
 id="x1-64002r245"></a></center>
</div>which is a 2D averaging over a magnetic surface and thus is called magnetic surface average. Note that
the surface averaging of any <span 
class="cmmi-10">n</span><span 
class="cmmi-10">≠</span>0 harmonic is zero (<span 
class="cmmi-10">n </span>is the toroidal mode number). Therefore the
magnetic surface average contains only the contribution from the <span 
class="cmmi-10">n </span>= 0 component, i.e., axisymmetric
component. (On the other hand, <span 
class="cmmi-10">m</span><span 
class="cmmi-10">≠</span>0 poloidal harmonics of <span 
class="cmmi-10">G </span>can contribute to the surface average
since the Jacobian has a poloidal angle dependence.) Using this and noting that <span 
class="cmsy-10">𝒥 </span>is axisymmetric,
then expression (<a 
href="#x1-64002r245">245<!--tex4ht:ref: 23-1-4-1 --></a>) is written as
   <table 
class="equation"><tr><td><a 
 id="x1-64003r246"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium331x.png" alt="      ∫
      -G0(ψ,𝜃)|𝒥|d𝜃-
⟨G⟩ =    ∫ |𝒥 |d𝜃    ,
" class="math-display"  /></center></td><td class="equation-label">(246)</td></tr></table>
<!--l. 2866--><p class="nopar" >
where <span 
class="cmmi-10">G</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">𝜃</span>) is deﬁned by the following Fourier expansion:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-64004r247"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium332x.png" alt="     +∑∞
G =      Gn(ψ,𝜃)exp(− inϕ).
    n=−∞
" class="math-display"  /></center></td><td class="equation-label">(247)</td></tr></table>
<!--l. 2870--><p class="nopar" >
</p><!--l. 2873--><p class="indent" >   _________________________________________________________________________________________________________________________
</p><!--l. 2875--><p class="indent" >   “Zonal” and “mean” components
                                                                                

                                                                                
</p><!--l. 2877--><p class="indent" >   <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">G</span><span 
class="cmsy-10">⟩ </span>is sometimes called the “zonal” component of <span 
class="cmmi-10">G </span>if the radial wavelength of <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">G</span><span 
class="cmsy-10">⟩ </span>is much smaller
than the equilibrium scale length. If the radial wavelength of <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">G</span><span 
class="cmsy-10">⟩ </span>is comparable to the equilibrium scale
length, <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">G</span><span 
class="cmsy-10">⟩ </span>is usually called “mean” component in tokamak literature. For example, mean ﬂows are of
system space scale and thus are easy to be observed in experiments. On the other hand, the “zonal”
ﬂow, which usually refers to the turbulence generated secondary ﬂow, is of much smaller radial scale
(the radial wavelength of zonal ﬂow is of several Larmor radius) and thus is diﬃcult to observe in
experiments.
</p><!--l. 2887--><p class="indent" >   _________________________________________________________________________________________________________________________
</p><!--l. 2889--><p class="indent" >   Sometimes, we do not want the Jacobian to explicitly appear in the formula. This can be achieved
by writing the diﬀerential volume element as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-64005r248"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium333x.png" alt=" 3        -dΨ--
d V = Rd ϕ|∇ Ψ|dlp.
" class="math-display"  /></center></td><td class="equation-label">(248)</td></tr></table>
<!--l. 2893--><p class="nopar" >
Using <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span><span 
class="cmmi-10">∕R</span>, the volume element is further written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-64006r249"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium334x.png" alt=" 3      dΨ
d V = dϕB--dlp
          p
" class="math-display"  /></center></td><td class="equation-label">(249)</td></tr></table>
<!--l. 2897--><p class="nopar" >
Using this, the averaging deﬁned in Eq. (<a 
href="#x1-64001r244">244<!--tex4ht:ref: 6-14-2 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium335x.png" alt="           ∫ ∫ ∫
           ----Δ-Ψ Gd-ϕdBΨpdlp
⟨G ⟩ = ΔlΨim→0 ∫ ∫ ∫  dϕdΨdlp
      ∫ ∫   1   ΔΨ   Bp
      ---G-Bpdϕdlp
    =  ∫ ∫B1 dϕdlp .                              (250)
            p
" class="math-display"  /></center>
</div>If <span 
class="cmmi-10">G </span>is axisymmetric, then the above equation is written as
   <table 
class="equation"><tr><td><a 
 id="x1-64008r251"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium336x.png" alt="      ∮
      --GB1p-dlp
⟨G ⟩ = ∮ 1-dlp .
         Bp
" class="math-display"  /></center></td><td class="equation-label">(251)</td></tr></table>
<!--l. 2910--><p class="nopar" >
(Equation (<a 
href="#x1-64008r251">251<!--tex4ht:ref: 10-16-3 --></a>) is used in the GTAW code to calculate the magnetic surface averaging.) Using Eq.
(<a 
href="#x1-49004r190">190<!--tex4ht:ref: 5-30-p1 --></a>) and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span><span 
class="cmmi-10">∕R</span>, equation (<a 
href="#x1-64008r251">251<!--tex4ht:ref: 10-16-3 --></a>) can also be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-64009r252"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium337x.png" alt="     ∫
      02π G|𝒥|d𝜃
⟨G ⟩ =-∫2π|𝒥-|d𝜃-.
       0
" class="math-display"  /></center></td><td class="equation-label">(252)</td></tr></table>
<!--l. 2917--><p class="nopar" >
Using the expression of the volume element <span 
class="cmmi-10">dτ </span>= <span 
class="cmsy-10">|𝒥|</span><span 
class="cmmi-10">d𝜃dϕdψ</span>, the volume within a magnetic surface is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-64010r253"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium338x.png" alt="       ∫      ∫               ∫ ψ ∫ 2π
V (ψ) =  dτ =   |𝒥|d𝜃dϕdψ = 2π ψ   0  |𝒥 |d𝜃dψ.
                                0
" class="math-display"  /></center></td><td class="equation-label">(253)</td></tr></table>
<!--l. 2924--><p class="nopar" >
Using this, the diﬀerential of <span 
class="cmmi-10">V </span>with respect to <span 
class="cmmi-10">ψ </span>is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-64011r254"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium339x.png" alt=" ′   dV     ∫ 2π
V ≡  dψ-= 2π    |𝒥|d𝜃.
             0
" class="math-display"  /></center></td><td class="equation-label">(254)</td></tr></table>
<!--l. 2929--><p class="nopar" >
Using this, Eq. (<a 
href="#x1-64009r252">252<!--tex4ht:ref: 3-18-a1m --></a>) is written as
</p>
   <table 
class="equation-star"><tr><td>
                              <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">G</span><span 
class="cmsy-10">⟩ </span>= <img 
src="tokamak_equilibrium340x.png" alt="2π-
V ′"  class="frac" align="middle" /><span 
class="cmex-10">∫</span>
    <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span><span 
class="cmmi-7">π</span></sup><span 
class="cmmi-10">G</span><span 
class="cmsy-10">|𝒥|</span><span 
class="cmmi-10">d𝜃</span>
</td></tr></table>
<!--l. 2932--><p class="nopar" >
                                                                                

                                                                                
</p><!--l. 2935--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">13.2   </span> <a 
 id="x1-6500013.2"></a>Flux Surface Functions—to be deleted</h4>
<!--l. 2937--><p class="noindent" >Next, examine the meaning of the following volume integral
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-65001r255"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium341x.png" alt="       ∫
D(ψ) ≡   B ⋅∇ 𝜃dτ,
        V
" class="math-display"  /></center></td><td class="equation-label">(255)</td></tr></table>
<!--l. 2940--><p class="nopar" >
where the volume <span 
class="cmmi-10">V </span>= <span 
class="cmmi-10">V </span>(<span 
class="cmmi-10">ψ</span>) is the volume within the magnetic surface labeled by <span 
class="cmmi-10">ψ</span>. Using <span 
class="cmsy-10">∇⋅ </span><span 
class="cmbx-10">B </span>= 0,
the quantity <span 
class="cmmi-10">D </span>can be further written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-65002r256"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium342x.png" alt="     ∫
D  =   ∇ ⋅(𝜃B )dτ.
      V
" class="math-display"  /></center></td><td class="equation-label">(256)</td></tr></table>
<!--l. 2946--><p class="nopar" >
Note that <span 
class="cmmi-10">𝜃 </span>is not a single-value function of the spacial points. In order to evaluate the integration in
Eq. (<a 
href="#x1-65002r256">256<!--tex4ht:ref: 4-17-p1 --></a>), we need to select one branch of <span 
class="cmmi-10">𝜃</span>, which can be chosen to be 0 <span 
class="msam-10">≤ </span><span 
class="cmmi-10">𝜃 &#x003C; </span>2<span 
class="cmmi-10">π</span>. Note that function
<span 
class="cmmi-10">𝜃 </span>= <span 
class="cmmi-10">𝜃</span>(<span 
class="cmmi-10">R,Z</span>) is not continuous in the vicinity of the contour of <span 
class="cmmi-10">𝜃 </span>= 0. Next, we want to use the Gauss’s
theorem to convert the above volume integration to surface integration. Noting the discontinuity of the
integrand <span 
class="cmmi-10">𝜃</span><span 
class="cmbx-10">B </span>in the vicinity of the contour of <span 
class="cmmi-10">𝜃 </span>= 0, the volume should be cut along the contour, thus,
generating two surfaces. Denote these two surfaces by <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">1</span></sub> and <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub>, then equation (<a 
href="#x1-65002r256">256<!--tex4ht:ref: 4-17-p1 --></a>) is written as
</p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium343x.png" alt="    ∫           ∫          ∫
D =    𝜃B ⋅dS +    𝜃B ⋅dS+     𝜃B ⋅dS,
     S1          S2         S3
" class="math-display"  /></center>
</div>where the direction of surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">1</span></sub> is in the negative direction of <span 
class="cmmi-10">𝜃</span>, the direction of <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> is in the positive
direction of <span 
class="cmmi-10">𝜃</span>, and the surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">3</span></sub> is the toroidal magnetic surface <span 
class="cmmi-10">ψ </span>= <span 
class="cmmi-10">ψ</span><sub><span 
class="cmr-7">0</span></sub>. The surface
integration through <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">3</span></sub> is obviously zero since <span 
class="cmbx-10">B </span>lies in this surface. Therefore, we have
<div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium344x.png" alt="     ∫          ∫
D  =    𝜃B ⋅dS+    𝜃B ⋅dS + 0
     ∫S1        ∫S2

   =  S1 0B ⋅dS+ S2 2πB ⋅dS
       ∫
   = 2π   B ⋅dS.                                  (257)
        S2
" class="math-display"  /><a 
 id="x1-65004r257"></a></center>
</div>Eq. (<a 
href="#x1-65004r257">257<!--tex4ht:ref: 4-18-4 --></a>) indicates that <span 
class="cmmi-10">D </span>is 2<span 
class="cmmi-10">π </span>times the magnetic ﬂux through the <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> surface. Thus, the poloidal ﬂux
through <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> is written as
   <table 
class="equation"><tr><td><a 
 id="x1-65005r258"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium345x.png" alt="      1     1 ∫
Ψp = --D  = ---  B ⋅∇ 𝜃dτ.
     2π     2π V
" class="math-display"  /></center></td><td class="equation-label">(258)</td></tr></table>
                                                                                

                                                                                
<!--l. 2979--><p class="nopar" >
Using the expression of the volume element <span 
class="cmmi-10">dτ </span>= <span 
class="cmsy-10">|𝒥|</span><span 
class="cmmi-10">d𝜃dϕdψ</span>, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub> can be further written in terms of ﬂux
surface averaged quantities. </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium346x.png" alt="      1 ∫
Ψp = 2π-  B ⋅∇ 𝜃|𝒥 |d𝜃dϕd ψ
     ∫ ψ V ∫ 2π
   =    dψ     B ⋅∇𝜃|𝒥|d𝜃
     ∫0    ∫0
       ψ     2π  ′
   =  0 dψ  0  Ψ ∇ψ × ∇ϕ ⋅∇ 𝜃|𝒥 |d𝜃
             ∫ ψ   ∫ 2π
   = − sign(𝒥)    dψ    Ψ ′(ψ)d𝜃
              0∫    0
   = − 2π sign(𝒥) ψ Ψ′(ψ )dψ
                0
   = − 2π sign(𝒥)[Ψ(ψ)− Ψ(0)].                        (259)
" class="math-display"  /><a 
 id="x1-65006r259"></a></center>
</div>Note that the sign of the Jacobian appears in Eq. (<a 
href="#x1-65006r259">259<!--tex4ht:ref: 4-10-p11 --></a>), which is due to the positive direction of surface
<span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> is determined by the positive direction of <span 
class="cmmi-10">𝜃</span>, which in turn is determined by the sign of the Jacobian
(In my code, however, the positive direction of <span 
class="cmmi-10">𝜃 </span>is chosen by me and the sign of the Jacobian is
determined by the positive direction of <span 
class="cmmi-10">𝜃</span>). We can verify the sign of Eq. (<a 
href="#x1-65006r259">259<!--tex4ht:ref: 4-10-p11 --></a>) is exactly consistent with
that in Eq. (<a 
href="#x1-11002r26">26<!--tex4ht:ref: 12-30-2 --></a>).
<!--l. 3005--><p class="indent" >   Similarly, the toroidal ﬂux within a ﬂux surface is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-65007r260"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium347x.png" alt="     1 ∫
Ψt =---   B ⋅∇ ϕdτ,
    2π  V
" class="math-display"  /></center></td><td class="equation-label">(260)</td></tr></table>
<!--l. 3008--><p class="nopar" >
the poloidal current within a ﬂux surface is written as
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-65008r261"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium348x.png" alt="         ∫
K(ψ) = 1--  J ⋅∇𝜃dτ,
       2π  V
" class="math-display"  /></center></td><td class="equation-label">(261)</td></tr></table>
<!--l. 3012--><p class="nopar" >
and toroidal current within a ﬂux surface is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-65009r262"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium349x.png" alt="         ∫
I(ψ) =-1-   J⋅∇ ϕdτ.
      2π  V
" class="math-display"  /></center></td><td class="equation-label">(262)</td></tr></table>
<!--l. 3017--><p class="nopar" >
(**check**)The toroidal magnetic ﬂux is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium350x.png" alt="       ∫
Ψt =-1-  B ⋅∇ ϕ|𝒥 |d𝜃dϕdψ
    2∫π    ∫
      ψ     2π -1-
  =  0 dψ  0  gR2 |𝒥 |d𝜃
    ∫ ψ[ V ′⟨ 1 ⟩ ]
  =     g---  -2-  dψ.                         (263)
     0   2π   R
" class="math-display"  /><a 
 id="x1-65010r263"></a></center>
                                                                                

                                                                                
</div>
   <table 
class="equation-star"><tr><td>
                               <span 
class="cmsy-10">⇒ </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">t</span></sub><span 
class="cmsy-10">′ </span>= <span 
class="cmmi-10">g</span><img 
src="tokamak_equilibrium351x.png" alt="  ′
V--
2π"  class="frac" align="middle" /><img 
src="tokamak_equilibrium352x.png" alt="⟨   ⟩
  1--
  R2"  class="left" align="middle" />
</td></tr></table>
<!--l. 3028--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                               <span 
class="cmsy-10">⇒</span><img 
src="tokamak_equilibrium353x.png" alt="dΨ
--t
dV"  class="frac" align="middle" /> = <span 
class="cmmi-10">g</span><img 
src="tokamak_equilibrium354x.png" alt="1
---
2π"  class="frac" align="middle" /><img 
src="tokamak_equilibrium355x.png" alt="⟨  1 ⟩
  -2-
  R"  class="left" align="middle" />
</td></tr></table>
<!--l. 3030--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-65011r264"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium356x.png" alt="   dΨ    g  1  ⟨ 1 ⟩
⇒  ---= ------- --2 .
   dV   2πq 2π  R
" class="math-display"  /></center></td><td class="equation-label">(264)</td></tr></table>
                                                                                

                                                                                
<!--l. 3034--><p class="nopar" >
Next, calculate the derivative of the toroidal ﬂux with respect to the poloidal ﬂux. </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium357x.png" alt="dΨt-  Ψt′
dΨp = Ψp′
            ′  ⟨   ⟩
    = − -gV2-′- -12 ,                         (265)
        (2π) Ψ   R
" class="math-display"  /><a 
 id="x1-65012r265"></a></center>
</div>Comparing this result with Eq. (<a 
href="#x1-110001r465">465<!--tex4ht:ref: 12-21-p2 --></a>) indicates that it is equal to the safety factor, i.e.,
   <table 
class="equation"><tr><td><a 
 id="x1-65013r266"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium358x.png" alt="dΨt-
dΨp = q(ψ).
" class="math-display"  /></center></td><td class="equation-label">(266)</td></tr></table>
<!--l. 3046--><p class="nopar" >
By using the contravariant representation of current density (<a 
href="#x1-112001r497">497<!--tex4ht:ref: 4-16-p2 --></a>), the poloidal current within a
magnetic surface is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium359x.png" alt="          ∫
K(ψ) = -1-  J⋅∇ 𝜃𝒥 d𝜃dϕd ψ
       2π∫
     = 1-- (− g′)∇ϕ × ∇ ψ⋅∇ 𝜃𝒥d𝜃dψ
       μ0
        -1-∫  ′
     = −μ0   g d𝜃dψ
           ∫ ψ
     = − 2π   g′dψ
        μ0  0
     = − 2π-[g(ψ)− g(0)].                             (267)
        μ0
" class="math-display"  /></center>
</div>Note that the poloidal current is proportional to <span 
class="cmmi-10">g</span>, which explains why <span 
class="cmmi-10">g </span>is sometimes called poloidal
current function in tokamak literature.
   <table 
class="equation-star"><tr><td>
            <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium360x.png" alt="[(          )    (            ) ]
   Ψ′ 𝒥-|∇ ψ|2  +   Ψ′ 𝒥-∇ ψ ⋅∇ 𝜃
     R2       ψ      R2        𝜃"  class="left" align="middle" /><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">g</span><span 
class="cmsy-10">′∇</span><span 
class="cmmi-10">ϕ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ,</span>
</td></tr></table>
<!--l. 3063--><p class="nopar" >
The toroidal current is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium361x.png" alt="          ∫
Iϕ(ψ) =-1-  J ⋅∇ϕ 𝒥d𝜃dϕdψ
       2π       [                               ]
           1  ∫  (  ′ 𝒥    2)    ( ′ 𝒥        )
     = − 2πμ--    Ψ R2-|∇ψ|    +  Ψ R2-∇ψ ⋅∇ 𝜃   ∇ ψ × ∇𝜃⋅∇ ϕ𝒥 d𝜃dϕdψ
            0 [(          )  ψ (            ) ]𝜃
         1--∫     ′ 𝒥    2       ′ 𝒥-
     = − μ0     Ψ R2 |∇ ψ|  ψ +  Ψ R2 ∇ψ ⋅∇ 𝜃 𝜃 d𝜃dψ
            ∫ [(          ) ]
     = − 1--    Ψ ′ 𝒥-|∇ ψ|2   d𝜃dψ
         μ0       R2       ψ
            ∫ 2π  ∫ ψ   (          )
     = − 1--    d𝜃   dψ  Ψ ′ 𝒥-|∇ ψ|2
         μ0  0     0       R2       ψ
         1  ∫ 2π  (  ′ 𝒥    2   )
     = − μ0-    d𝜃 Ψ R2-|∇ ψ| − 0  .                                   (268)
             0
" class="math-display"  /><a 
 id="x1-65015r268"></a></center>
</div>The last equality is due to <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>= 0 at <span 
class="cmmi-10">ψ </span>= 0. By using the ﬂux surface average operator, Eq. (<a 
href="#x1-65015r268">268<!--tex4ht:ref: 4-17-e1 --></a>) is
written
   <table 
class="equation"><tr><td><a 
 id="x1-65016r269"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium362x.png" alt="           ′ ′⟨     2⟩
Iϕ(ψ) = − V-Ψ-  |∇-ψ|- .
         2πμ0    R2
" class="math-display"  /></center></td><td class="equation-label">(269)</td></tr></table>
<!--l. 3089--><p class="nopar" >
</p><!--l. 3092--><p class="indent" >   Next, calculate another useful surface-averaged quantity, </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium363x.png" alt="          ⟨   [(          )    (            ) ]⟩
            g2-  1Ψ′ 𝒥-|∇ψ |2  +  1Ψ ′∇ ψ⋅∇ 𝜃 𝒥
-⟨J-⋅B⟩--  --𝒥---g--R2------ψ----g---------R2-𝜃---
⟨B⋅∇ ϕ⟩ =                μ0⟨g∕R2⟩
          2π∫ 2π     [(1   𝒥     )    (1          𝒥) ]
          V′ 0  d𝜃g2  gΨ ′R2 |∇ ψ|2 ψ + gΨ ′∇ ψ ⋅∇𝜃R2  𝜃
        = -----------------------−2-------------------
                    [(      μ0g⟨R)  ⟩ (            ) ]
          2π′g2∫ 2π d𝜃  1Ψ ′ 𝒥2|∇ ψ|2 +  1Ψ ′∇ ψ ⋅∇𝜃-𝒥2
        = V----0------g--R--------ψ---g---------R---𝜃-
                            μ0g⟨R −2⟩
          2π ∫ 2π   [(1  ′ 𝒥    2) ]
          V′g 0  d𝜃  gΨ  R2|∇ ψ|  ψ
        = ---------μ-⟨R−2⟩---------
             ∫     [0(           ) ]
          2Vπ′g 02π d𝜃  1gΨ ′ 𝒥R2|∇ ψ|2
        = -----------------------ψ-                           (270)
                   μ0⟨R−2⟩
" class="math-display"  /></center>
</div>The diﬀerential with respect to <span 
class="cmmi-10">ψ </span>and the integration with respect to <span 
class="cmmi-10">𝜃 </span>can be interchanged, yielding
<div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium364x.png" alt="          2π [ 1  (∫2π   𝒥     ) ]
 ⟨J ⋅B⟩    V′g  gΨ′  0 d𝜃 R2|∇ ψ|2  ψ
⟨B-⋅∇ϕ⟩-= ---------μ-⟨R−2⟩---------
             [      0⟨    2⟩]
          V1′g  1gΨ′V′ |∇Rψ2|
        = ----------−2------ψ
                μ0⟨R[ ⟩′ ′⟨     2⟩]
        = ----g----- Ψ-V-  |∇ψ|-                     (271)
          μ0V ′⟨R−2⟩   g     R2    ψ
" class="math-display"  /></center>
</div>
<!--l. 3132--><p class="indent" >    
</p><!--l. 3135--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">14   </span> <a 
 id="x1-6600014"></a>Magnetic coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) with general toroidal angle <span 
class="cmmi-10">ζ</span></h3>
                                                                                

                                                                                
<!--l. 3137--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.1   </span> <a 
 id="x1-6700014.1"></a>General toroidal angle <span 
class="cmmi-10">ζ</span></h4>
<!--l. 3139--><p class="noindent" >In Sec. <a 
href="#x1-4700010.1">10.1<!--tex4ht:ref: 7-25-e5 --></a>, we introduced the local safety factor <img 
src="tokamak_equilibrium365x.png" alt="ˆq"  class="circ"  /> (<span 
class="cmmi-10">ψ,𝜃</span>). Equation (<a 
href="#x1-47002r178">178<!--tex4ht:ref: 12-25-1 --></a>) indicates that if the Jacobian
is chosen to be of the particular form <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">R</span><sup><span 
class="cmr-7">2</span></sup>, then the local safety factor is independent of <span 
class="cmmi-10">𝜃</span>, i.e.,
magnetic line is straight in (<span 
class="cmmi-10">𝜃,ϕ</span>) plane. On the other hand, if we want to make ﬁeld line straight
in (<span 
class="cmmi-10">𝜃,ϕ</span>) plane, the Jacobian must be chosen to be of the speciﬁc form <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">R</span><sup><span 
class="cmr-7">2</span></sup>. We
note that, as mentioned in Sec. <a 
href="#x1-4900010.3">10.3<!--tex4ht:ref: 3-13-p7 --></a>, the poloidal angle is fully determined by the choice of
the Jacobian. The speciﬁc choice of <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">α</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">R</span><sup><span 
class="cmr-7">2</span></sup> is usually too restrictive for achieve a
desired poloidal resolution (for example, the equal-arc poloidal angle can not be achieved
by this choice of Jacobian). Is there any way that we can make the ﬁeld line straight in a
coordinate system at the same time ensure that the Jacobian can be freely adjusted to obtain
desired poloidal angle? The answer is yes. The obvious way to achieve this is to deﬁne a new
toroidal angle <span 
class="cmmi-10">ζ </span>that generalizes the usual toroidal angle <span 
class="cmmi-10">ϕ</span>. Deﬁne a new toroidal angle <span 
class="cmmi-10">ζ</span>
by<span class="cite">[<a 
href="#Xcheng1987">10</a>]</span>
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-67001r272"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium366x.png" alt="ζ = ϕ− q(ψ)δ(ψ,𝜃),
" class="math-display"  /></center></td><td class="equation-label">(272)</td></tr></table>
<!--l. 3157--><p class="nopar" >
where <span 
class="cmmi-10">δ </span>= <span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">ψ,𝜃</span>) is a unknown function to be determined by the constraint of ﬁeld line being straight
in (<span 
class="cmmi-10">𝜃,ζ</span>) plane. Using Eq. (<a 
href="#x1-47003r179">179<!--tex4ht:ref: 18-3-9-a1 --></a>), the new local safety factor in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates is written as
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium367x.png" alt="ˆqnew ≡ B-⋅∇-ζ
      B ⋅∇ 𝜃
    = (∇-ϕ×-∇-ψ+-ˆq∇-ψ-×∇-𝜃)⋅∇-ζ
      (∇ ϕ× ∇ ψ+ ˆq∇ ψ ×∇ 𝜃)⋅∇ 𝜃
      ∇-ϕ×-∇-ψ-⋅∇ζ-+qˆ∇-ψ-×-∇𝜃-⋅∇ζ
    =        (∇ϕ × ∇ψ )⋅∇𝜃
      ∇ ϕ× ∇ ψ ⋅∇(− qδ)+ ˆq∇ ψ ×∇ 𝜃⋅∇ ϕ
    = -------------------------------
               (∇ϕ × ∇ψ )⋅∇𝜃
    = − q∂δ+ ˆq.                                       (273)
         ∂𝜃
" class="math-display"  /><a 
 id="x1-67002r273"></a></center>
</div>To make the new local safety factor be independent of <span 
class="cmmi-10">𝜃</span>, the right-hand side of Eq. (<a 
href="#x1-67002r273">273<!--tex4ht:ref: 6-24-5 --></a>) should be
independent of <span 
class="cmmi-10">𝜃</span>, i.e.,
   <table 
class="equation"><tr><td><a 
 id="x1-67003r274"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium368x.png" alt="   ∂δ
− q---+qˆ= c(ψ ),
   ∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(274)</td></tr></table>
<!--l. 3182--><p class="nopar" >
where <span 
class="cmmi-10">c</span>(<span 
class="cmmi-10">ψ</span>) can be an arbitrary function of <span 
class="cmmi-10">ψ</span>. A convenient choice for <span 
class="cmmi-10">c</span>(<span 
class="cmmi-10">ψ</span>) is <span 
class="cmmi-10">c</span>(<span 
class="cmmi-10">ψ</span>) = <span 
class="cmmi-10">q</span>, i.e., making the
new local safety factor be equal to the original global safety factor, i.e., <img 
src="tokamak_equilibrium369x.png" alt="ˆq"  class="circ"  /> <sub><span 
class="cmr-7">new</span></sub> = <span 
class="cmmi-10">q</span>. In this case, equation
(<a 
href="#x1-67003r274">274<!--tex4ht:ref: 6-24-8 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-67004r275"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium370x.png" alt="∂δ   ˆq
---= -− 1,
∂𝜃   q
" class="math-display"  /></center></td><td class="equation-label">(275)</td></tr></table>
<!--l. 3190--><p class="nopar" >
which, on a magnetic surface labed by <span 
class="cmmi-10">ψ</span>, can be integrated over <span 
class="cmmi-10">𝜃 </span>to give
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-67005r276"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium371x.png" alt="                              ∫ 𝜃
δ(ψ,𝜃) = δ(ψ,𝜃ref)− (𝜃− 𝜃ref)+ 1    ˆqd𝜃,
                            q  𝜃ref
" class="math-display"  /></center></td><td class="equation-label">(276)</td></tr></table>
<!--l. 3197--><p class="nopar" >
where <span 
class="cmmi-10">𝜃</span><sub><span 
class="cmr-7">ref</span></sub> is an starting poloidal angle arbitrarily chosen for the integration, and <span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">ψ,𝜃</span><sub><span 
class="cmr-7">ref</span></sub>) is the
constant of integration. In the following, both <span 
class="cmmi-10">𝜃</span><sub><span 
class="cmr-7">ref</span></sub> and <span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">ψ,𝜃</span><sub><span 
class="cmr-7">ref</span></sub>) will be chosen to be zero. Then the
above equations is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-67006r277"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium372x.png" alt="          ∫ 𝜃
δ = − 𝜃 + 1  qˆd𝜃.
         q 0
" class="math-display"  /></center></td><td class="equation-label">(277)</td></tr></table>
<!--l. 3206--><p class="nopar" >
Substituting the above expression into the deﬁnition of <span 
class="cmmi-10">ζ </span>(Eq. <a 
href="#x1-67001r272">272<!--tex4ht:ref: 5-13-e10 --></a>), we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-67007r278"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium373x.png" alt="           ∫ 𝜃
ζ = ϕ + q𝜃−   ˆqd𝜃,
            0
" class="math-display"  /></center></td><td class="equation-label">(278)</td></tr></table>
                                                                                

                                                                                
<!--l. 3212--><p class="nopar" >
which is the formula for calculating the general toroidal angle. If <span 
class="cmmi-10">𝜃 </span>is a straight-ﬁeld line poloidal angle,
then <span 
class="cmmi-10">ζ </span>in Eq. (<a 
href="#x1-67007r278">278<!--tex4ht:ref: 17-4-11-1 --></a>) reduces to the usual toroidal angle <span 
class="cmmi-10">ϕ</span>.
</p><!--l. 3217--><p class="indent" >   In summary, magnetic ﬁeld line is straight in (<span 
class="cmmi-10">𝜃,ζ</span>) plane with slope being <span 
class="cmmi-10">q </span>if <span 
class="cmmi-10">ζ </span>is deﬁned by Eq.
(<a 
href="#x1-67007r278">278<!--tex4ht:ref: 17-4-11-1 --></a>). In this method, we make the ﬁeld line straight by deﬁning a new toroidal angle, instead of
requiring the Jacobian to take particular forms. Thus, the freedom of choosing the form of
the Jacobian is still available to be used later to choose a good poloidal angle coordinate.
Note that the Jacobian of the new coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) is equal to that of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>). [Proof:
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium374x.png" alt="𝒥 −ne1w = ∇ψ × ∇ 𝜃⋅∇ ζ
     = ∇ψ × ∇ 𝜃⋅∇ (ϕ − qδ)
     = ∇ψ × ∇ 𝜃⋅∇ ϕ− ∇ ψ× ∇ 𝜃⋅∇ (qδ)

     = ∇ψ × ∇ 𝜃⋅∇ ϕ− 0
     = 𝒥− 1.
" class="math-display"  /></center>
</div>] Also note that <span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">ψ,𝜃</span>) deﬁned by Eq. (<a 
href="#x1-67006r277">277<!--tex4ht:ref: 17-3-18-2 --></a>) is a periodic function of <span 
class="cmmi-10">𝜃</span>. [Proof: Equation (<a 
href="#x1-67006r277">277<!--tex4ht:ref: 17-3-18-2 --></a>) implies
that <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium375x.png" alt="             1∫ 𝜃+2π
δ(ψ,𝜃+ 2π) = -      ˆqd𝜃− (𝜃− 𝜃ref)− 2π
             q∫0                      ∫
          =  1  𝜃ˆqd𝜃 − (𝜃 − 𝜃 )− 2π + 1 𝜃+2πqˆd𝜃
             q 0           ref       q  𝜃
                         1∫ 𝜃+2π
          = δ(ψ,𝜃)− 2π + q      ˆqd𝜃
                           𝜃
          = δ(ψ,𝜃).                                        (279)
" class="math-display"  /></center>
</div>]
                                                                                

                                                                                
<!--l. 3248--><p class="indent" >   [In numerical implementation, the term <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><img 
src="tokamak_equilibrium376x.png" alt="B-⋅∇ϕ
B ⋅∇𝜃"  class="frac" align="middle" /><span 
class="cmmi-10">d𝜃 </span>appearing in <span 
class="cmmi-10">δ </span>is computed by using
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium377x.png" alt="∫ 𝜃           ∫ 𝜃         ∫ 𝜃
   B-⋅∇-ϕd𝜃 =    -g-𝒥-d𝜃 =    g--1 -R--dlp
 0 B ⋅∇ 𝜃      0 R2 Ψ′     0  R2Ψ ′|∇ ψ|
              ∫ 𝜃 g 1
            =    R-|∇-Ψ|dlp
              ∫0 𝜃
            =    1-Bϕdℓp.                               (280)
               0 R Bp
" class="math-display"  /></center>
</div>
<!--l. 3262--><p class="indent" >   For later use, from Eq. (<a 
href="#x1-67006r277">277<!--tex4ht:ref: 17-3-18-2 --></a>), we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium378x.png" alt="            (   )∫ 𝜃             ∫ 𝜃
∂(δq) = −-d- -g′    -𝒥2d𝜃− -g′ ∂-   𝒥-2d𝜃− dq-𝜃.           (281)
 ∂ψ      dψ  Ψ    0 R      Ψ  ∂ψ  0 R      dψ
" class="math-display"  /><a 
 id="x1-67011r281"></a></center>
</div>This formula is used in GTAW code, where the derivative <span 
class="cmmi-10">∂</span>(<span 
class="cmmi-10">g∕Ψ</span><span 
class="cmsy-10">′</span>)<span 
class="cmmi-10">∕∂ψ </span>is calculated numerically by
using the central diﬀerence scheme.]
<!--l. 3274--><p class="indent" >    
</p><!--l. 3277--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.2   </span> <a 
 id="x1-6800014.2"></a> Contravariant form of magnetic ﬁeld in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates</h4>
<!--l. 3279--><p class="noindent" >Recall that the contravariant form of the magnetic ﬁeld in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates is given by Eq. (<a 
href="#x1-47003r179">179<!--tex4ht:ref: 18-3-9-a1 --></a>),
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-68001r282"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium379x.png" alt="       ′
B = − Ψ (∇ϕ × ∇ψ + ˆq∇ψ × ∇ 𝜃).
" class="math-display"  /></center></td><td class="equation-label">(282)</td></tr></table>
<!--l. 3284--><p class="nopar" >
Next, let us derive the corresponding form in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates. Using the deﬁnition of <span 
class="cmmi-10">ζ</span>, equation
(<a 
href="#x1-68001r282">282<!--tex4ht:ref: 6-24-p10 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium380x.png" alt="       ′                ′
B = − Ψ ∇ (ζ + qδ)× ∇ψ − Ψ ˆq∇ψ × ∇ 𝜃
  = − Ψ ′∇ ζ × ∇ ψ − Ψ ′∇ (qδ) × ∇ψ − Ψ′ˆq∇ψ × ∇𝜃
       ′           ′∂-δ           ′
  = − Ψ ∇ ζ × ∇ ψ − Ψ q∂ 𝜃∇𝜃 × ∇ψ − Ψ ˆq∇ψ × ∇𝜃           (283)
" class="math-display"  /></center>
</div>Using Eq. (<a 
href="#x1-67004r275">275<!--tex4ht:ref: 11-12-p1 --></a>), the above equation is simpliﬁed as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium381x.png" alt="B  = − Ψ′(∇ζ × ∇ψ + q∇ψ × ∇ 𝜃).                    (284)
" class="math-display"  /><a 
 id="x1-68003r284"></a></center>
</div>Equation (<a 
href="#x1-68003r284">284<!--tex4ht:ref: 3-13-p3 --></a>) is the contravariant form of the magnetic ﬁeld in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates.
<!--l. 3306--><p class="indent" >   The expression of the magnetic ﬁeld in Eq. (<a 
href="#x1-68003r284">284<!--tex4ht:ref: 3-13-p3 --></a>) can be rewritten in terms of the ﬂux function <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub>
and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">t</span></sub> discussed in Sec. <a 
href="#x1-6500013.2">13.2<!--tex4ht:ref: 7-25-e1 --></a>. Equation (<a 
href="#x1-68003r284">284<!--tex4ht:ref: 3-13-p3 --></a>) is
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-68004r285"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium382x.png" alt="B = ∇ Ψ × ∇ ζ + q∇ 𝜃× ∇ Ψ,
" class="math-display"  /></center></td><td class="equation-label">(285)</td></tr></table>
<!--l. 3312--><p class="nopar" >
which, by using Eq. (<a 
href="#x1-65006r259">259<!--tex4ht:ref: 4-10-p11 --></a>), i.e., <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span>= <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕</span>(2<span 
class="cmmi-10">π</span>), is rewritten as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-68005r286"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium383x.png" alt="B = -1-(∇ζ ×∇ Ψ + q∇ Ψ × ∇ 𝜃),
    2π         p      p
" class="math-display"  /></center></td><td class="equation-label">(286)</td></tr></table>
<!--l. 3318--><p class="nopar" >
which, by using Eq. (<a 
href="#x1-65013r266">266<!--tex4ht:ref: 5-14-3 --></a>), i.e., <span 
class="cmmi-10">q </span>= <span 
class="cmmi-10">dΨ</span><sub><span 
class="cmmi-7">t</span></sub><span 
class="cmmi-10">∕dΨ</span><sub><span 
class="cmmi-7">p</span></sub>, is further written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-68006r287"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium384x.png" alt="     1
B = 2π(∇ ζ × ∇ Ψp + ∇ Ψt × ∇𝜃).
" class="math-display"  /></center></td><td class="equation-label">(287)</td></tr></table>
<!--l. 3324--><p class="nopar" >
                                                                                

                                                                                
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.3   </span> <a 
 id="x1-6900014.3"></a>Relation between the partial derivatives in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) and (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates</h4>
<!--l. 3328--><p class="noindent" >Noting the simple fact that
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-69001r288"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium385x.png" alt=" d      d
---=  ------,
dx    d(x + c)
" class="math-display"  /></center></td><td class="equation-label">(288)</td></tr></table>
<!--l. 3331--><p class="nopar" >
where <span 
class="cmmi-10">c </span>is a constant, we conclude that
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-69002r289"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium386x.png" alt="(   )     (    )
  ∂f-       ∂f-
  ∂ζ  ψ,𝜃 =  ∂ϕ  ψ,𝜃 ,
" class="math-display"  /></center></td><td class="equation-label">(289)</td></tr></table>
<!--l. 3336--><p class="nopar" >
(since <span 
class="cmmi-10">ϕ </span>= <span 
class="cmmi-10">ζ </span>+ <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">ψ,𝜃</span>), where the part <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">ψ,𝜃</span>) acts as a constant when we hold <span 
class="cmmi-10">ψ </span>and <span 
class="cmmi-10">𝜃</span>
constant), i.e., the symmetry property with respect to the new toroidal angle <span 
class="cmmi-10">ζ </span>is identical with the one
with respect to the old toroidal angle <span 
class="cmmi-10">ϕ</span>. On the other hand, generally,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-69003r290"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium387x.png" alt="(    )     (   )
  ∂f-       -∂f
  ∂ψ  𝜃,ζ ⁄=  ∂ ψ  𝜃,ϕ
" class="math-display"  /></center></td><td class="equation-label">(290)</td></tr></table>
<!--l. 3345--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-69004r291"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium388x.png" alt="(   )     (    )
  ∂f-       ∂f-
  ∂𝜃 ψ,ζ ⁄=  ∂𝜃  ψ,ϕ .
" class="math-display"  /></center></td><td class="equation-label">(291)</td></tr></table>
<!--l. 3350--><p class="nopar" >
In the special case that <span 
class="cmmi-10">f </span>is axisymmetric (i.e., <span 
class="cmmi-10">f </span>is independent of <span 
class="cmmi-10">ϕ </span>in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates), then two
sides of Eqs. (<a 
href="#x1-69003r290">290<!--tex4ht:ref: 6-28-1 --></a>) and (<a 
href="#x1-69004r291">291<!--tex4ht:ref: 6-28-2 --></a>) are equal to each other. Note that the partial derivatives <span 
class="cmmi-10">∂∕∂ψ </span>and <span 
class="cmmi-10">∂∕∂𝜃</span>
in Sec. <a 
href="#x1-6700014.1">14.1<!--tex4ht:ref: 6-25-3 --></a> and <a 
href="#x1-6800014.2">14.2<!--tex4ht:ref: 6-25-4 --></a> are taken in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates. Because the quantities involved in Sec. <a 
href="#x1-6700014.1">14.1<!--tex4ht:ref: 6-25-3 --></a> and
<a 
href="#x1-6800014.2">14.2<!--tex4ht:ref: 6-25-4 --></a> are axisymmetric, these partial derivatives are equal to their counterparts in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>)
coordinates.
</p><!--l. 3360--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.4   </span> <a 
 id="x1-7000014.4"></a>Steps to construct a straight-line magnetic coordinate system</h4>
<!--l. 3362--><p class="noindent" >In Sec. <a 
href="#x1-5900011">11<!--tex4ht:ref: 6-25-1 --></a>, we have provided the steps to construct the magnetic surface coordinate system (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>).
Only one additional step is needed to construct the straight-line ﬂux coordinate system (<span 
class="cmmi-10">ψ,𝜃,ζ</span>). The
additional step is to calculate the generalized toroidal angle <span 
class="cmmi-10">ζ </span>according to Eq. (<a 
href="#x1-67001r272">272<!--tex4ht:ref: 5-13-e10 --></a>), where <span 
class="cmmi-10">δ </span>is
obtained from Eq. (<a 
href="#x1-67006r277">277<!--tex4ht:ref: 17-3-18-2 --></a>). Also note that the Jacobian of (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates happens to be equal to
that of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates.
</p><!--l. 3371--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.5   </span> <a 
 id="x1-7100014.5"></a>Form of operator <span 
class="cmmi-10">B </span><span 
class="cmsy-10">⋅∇ </span>in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates</h4>
<!--l. 3373--><p class="noindent" >The usefulness of the contravariant form [Eq. (<a 
href="#x1-68003r284">284<!--tex4ht:ref: 3-13-p3 --></a>] of the magnetic ﬁeld lies in that it allows a simple
form of <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇ </span>operator in a coordinate system. (The operator <span 
class="cmbx-10">B</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">⋅∇ </span>is usually called magnetic
diﬀerential operator.) In (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinate system, by using the contravariant form Eq. (<a 
href="#x1-68003r284">284<!--tex4ht:ref: 3-13-p3 --></a>), the
operator is written as </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium389x.png" alt="            ′                       ′
B ⋅∇f  = − Ψ (∇ζ ×( ∇ψ )⋅∇f(ψ),𝜃,ζ)− Ψ q(∇ψ × ∇ 𝜃)⋅∇f(ψ,𝜃,ζ)
            ′ −1  ∂--  -∂-
       = − Ψ 𝒥    ∂𝜃 + q∂ ζ f.                                  (292)
" class="math-display"  /><a 
 id="x1-71001r292"></a></center>
</div>Next, consider the solution of the following magnetic diﬀerential equation:
   <table 
class="equation"><tr><td><a 
 id="x1-71002r293"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium390x.png" alt="B ⋅∇f = h.
" class="math-display"  /></center></td><td class="equation-label">(293)</td></tr></table>
<!--l. 3389--><p class="nopar" >
where <span 
class="cmmi-10">h </span>= <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ,𝜃,ζ</span>) is some known function. Using Eq. (<a 
href="#x1-71001r292">292<!--tex4ht:ref: 4-7-a4 --></a>), the magnetic diﬀerential equation is
written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-71003r294"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium391x.png" alt="( ∂        ∂)       1
  --+ q(ψ)--- f = − -′𝒥h(ψ,𝜃,ζ).
  ∂𝜃      ∂ζ        Ψ
" class="math-display"  /></center></td><td class="equation-label">(294)</td></tr></table>
<!--l. 3396--><p class="nopar" >
Note that the coeﬃcients before the two partial derivatives of the above equation are all independent of
<span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ζ</span>. This indicates that diﬀerent Fourier harmonics in <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ζ </span>are decoupled. As a result of this
fact, if <span 
class="cmmi-10">f </span>is Fourier expanded as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-71004r295"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium392x.png" alt="          ∑
f(ψ,𝜃,ζ) =   fmn(ψ)ei(m𝜃−nζ),
          m,n
" class="math-display"  /></center></td><td class="equation-label">(295)</td></tr></table>
<!--l. 3404--><p class="nopar" >
(note that, following the convention adopted in tokamak literature<span class="cite">[<a 
href="#Xcheng1987">10</a>]</span>, the Fourier harmonics are
chosen to be <span 
class="cmmi-10">e</span><sup><span 
class="cmmi-7">i</span><span 
class="cmr-7">(</span><span 
class="cmmi-7">m𝜃</span><span 
class="cmsy-7">−</span><span 
class="cmmi-7">nζ</span><span 
class="cmr-7">)</span></sup>, instead of <span 
class="cmmi-10">e</span><sup><span 
class="cmmi-7">i</span><span 
class="cmr-7">(</span><span 
class="cmmi-7">m𝜃</span><span 
class="cmr-7">+</span><span 
class="cmmi-7">nζ</span><span 
class="cmr-7">)</span></sup>), and the right-hand side is expanded as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-71005r296"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium393x.png" alt="                ∑
− 1′𝒥 h(ψ, 𝜃,ζ) =    γmn(ψ)ei(m𝜃−nζ),
  Ψ             m,n
" class="math-display"  /></center></td><td class="equation-label">(296)</td></tr></table>
<!--l. 3412--><p class="nopar" >
then Eq. (<a 
href="#x1-71003r294">294<!--tex4ht:ref: 4-7-a3 --></a>) can be readily solved to give
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-71006r297"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium394x.png" alt="         γ
fmn = ----mn--.
      i[m − nq]
" class="math-display"  /></center></td><td class="equation-label">(297)</td></tr></table>
<!--l. 3416--><p class="nopar" >
The usefulness of the straight line magnetic coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) lies in that, as mentioned previously, it
makes the coeﬃcients before the two partial derivatives both independent of <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ζ</span>, thus, allowing a
simple solution to the magnetic diﬀerential equation.
                                                                                

                                                                                
</p><!--l. 3422--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.6   </span> <a 
 id="x1-7200014.6"></a>Resonant surface of a perturbation</h4>
<!--l. 3424--><p class="noindent" >Equation (<a 
href="#x1-71006r297">297<!--tex4ht:ref: 10-6-e1 --></a>) indicates that, for the diﬀerential equation (<a 
href="#x1-71002r293">293<!--tex4ht:ref: 17-4-27-1 --></a>), there is a resonant response to a
perturbation <span 
class="cmmi-10">e</span><sup><span 
class="cmmi-7">i</span><span 
class="cmr-7">(</span><span 
class="cmmi-7">m𝜃</span><span 
class="cmsy-7">−</span><span 
class="cmmi-7">nζ</span><span 
class="cmr-7">)</span></sup> on a magnetic surface with <span 
class="cmmi-10">m </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">nq </span>= 0. Therefore, the magnetic surface with
<span 
class="cmmi-10">q </span>= <span 
class="cmmi-10">m∕n </span>is called the “resonant surface” for the perturbation <span 
class="cmmi-10">e</span><sup><span 
class="cmmi-7">i</span><span 
class="cmr-7">(</span><span 
class="cmmi-7">m𝜃</span><span 
class="cmsy-7">−</span><span 
class="cmmi-7">nζ</span><span 
class="cmr-7">)</span></sup>.
</p><!--l. 3430--><p class="indent" >   The phase change of the perturbation <span 
class="cmmi-10">e</span><sup><span 
class="cmmi-7">i</span><span 
class="cmr-7">(</span><span 
class="cmmi-7">m𝜃</span><span 
class="cmsy-7">−</span><span 
class="cmmi-7">nζ</span><span 
class="cmr-7">)</span></sup> along a magnetic ﬁeld is given by <span 
class="cmmi-10">mΔ𝜃 </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">nΔζ</span>,
which can be written as <span 
class="cmmi-10">Δ𝜃</span>(<span 
class="cmmi-10">m</span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">nq</span>). Since <span 
class="cmmi-10">m</span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">nq </span>= 0 on a resonant surface, this indicates that there
is no phase change along a magnetic ﬁeld line on a resonant surface, i.e., the parallel wavenumber <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub> is
zero on a resonant surface.
</p><!--l. 3437--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.7   </span> <a 
 id="x1-7300014.7"></a>Helical angle used in tearing mode theory</h4>
<!--l. 3439--><p class="noindent" >Next, we discuss a special poloidal angle, which is useful in describling a perturnbation of single
harmonic (<span 
class="cmmi-10">m,n</span>). This poloidal angle is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-73001r298"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium395x.png" alt="χ = 𝜃−  nζ,
        m
" class="math-display"  /></center></td><td class="equation-label">(298)</td></tr></table>
<!--l. 3443--><p class="nopar" >
where (<span 
class="cmmi-10">m,n</span>) are the mode numbers of the perturbation. The poloidal angle <span 
class="cmmi-10">χ </span>is often called helical
angle and is special in that its deﬁnition is associated with a perturbation (the mode numbers of the
perturbation appear in the deﬁnition) while the deﬁnition of the poloidal angles discussed previously
only involve the equilibrium quantities.
</p><!--l. 3450--><p class="indent" >   The poloidal angle <span 
class="cmmi-10">χ </span>is designed to make 3D perturbations of the form <span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">f</span>(<span 
class="cmmi-10">ψ,m𝜃 </span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">nζ</span>) reduce to
2D perturbations, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-73002r299"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium396x.png" alt="  |
∂f||
∂ζ|ψ,χ = 0.
" class="math-display"  /></center></td><td class="equation-label">(299)</td></tr></table>
<!--l. 3454--><p class="nopar" >
</p><!--l. 3457--><p class="indent" >   It is ready to verify that the Jacobian of coordinates (<span 
class="cmmi-10">ψ,χ,ζ</span>) is equal to that of coordinates (<span 
class="cmmi-10">ψ,𝜃,ζ</span>)
[proof: (<span 
class="cmsy-10">𝒥′</span>)<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup> = <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">χ </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ζ </span>= <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span>(<span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">nζ∕m</span>) <span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ζ </span>= <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ζ </span>= <span 
class="cmsy-10">𝒥</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup>].
</p><!--l. 3463--><p class="indent" >   The component of <span 
class="cmbx-10">B </span>along <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">χ </span>direction (i.e., the covariant component) is written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium397x.png" alt=" (χ)
B   ≡ B ⋅∇ χ
    = − Ψ′(∇ ζ × ∇ ψ + q∇ ψ × ∇𝜃)⋅∇ (𝜃− nζ∕m )
    = − Ψ′(∇ ζ × ∇ ψ ⋅∇𝜃)+ Ψ ′ n(q∇ψ × ∇ 𝜃⋅∇ ζ)
                           m
    = − Ψ′𝒥−1 + Ψ′ n-q𝒥−1
            ( nq  m)
    = Ψ ′𝒥 −1  --− 1  .                                   (300)
              m
" class="math-display"  /><a 
 id="x1-73003r300"></a></center>
</div>At the resonant surface <span 
class="cmmi-10">q </span>= <span 
class="cmmi-10">m∕n</span>, equation (<a 
href="#x1-73003r300">300<!--tex4ht:ref: 1-10-1 --></a>) implies <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">χ</span><span 
class="cmr-7">)</span></sup> = 0. The direction <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">χ </span>deﬁnes the
reconnecting component of the magnetic ﬁeld?
<!--l. 3481--><p class="indent" >   On the other hand, the component of <span 
class="cmbx-10">B </span>along <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃 </span>direction is written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium398x.png" alt=" (𝜃)
B   ≡ B ⋅∇𝜃
    = − Ψ ′(∇ ζ × ∇ ψ+ q∇ ψ× ∇ 𝜃)⋅∇ 𝜃
    = − Ψ ′∇ ζ × ∇ ψ⋅∇ 𝜃
         ′ −1
    = − Ψ 𝒥  .                                      (301)
" class="math-display"  /><a 
 id="x1-73004r301"></a></center>
</div>Using (<a 
href="#x1-73004r301">301<!--tex4ht:ref: 5-13-1b --></a>) and (<a 
href="#x1-73003r300">300<!--tex4ht:ref: 1-10-1 --></a>), the relation between <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">𝜃</span><span 
class="cmr-7">)</span></sup> and <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">χ</span><span 
class="cmr-7">)</span></sup> is written as
   <table 
class="equation"><tr><td><a 
 id="x1-73005r302"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium399x.png" alt="          (    nq)
B (χ) = B (𝜃) 1 − m- .
" class="math-display"  /></center></td><td class="equation-label">(302)</td></tr></table>
<!--l. 3495--><p class="nopar" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.8   </span> <a 
 id="x1-7400014.8"></a>Covariant form of magnetic ﬁeld in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinate system</h4>
<!--l. 3499--><p class="noindent" >In the above, we have obtained the covariant form of the magnetic ﬁeld in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates (i.e., Eq.
(<a 
href="#x1-46002r176">176<!--tex4ht:ref: 5-6-2 --></a>)). Next, we derive the corresponding form in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinate. In order to do this, we need to
express the <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>basis vector in terms of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ </span>basis vectors. Using the deﬁnition of the
generalized toroidal angle, we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium400x.png" alt="g∇ ϕ = g∇ (ζ + qδ)
    = g∇ ζ + gq∇ δ+ gδ∇q
               (             )
    = g∇ ζ + gq ∂δ-∇ψ + ∂δ-∇𝜃  + gδq′∇ ψ
      (         ∂ψ)     ∂𝜃
          ∂δ-     ′        ∂δ-
    =   gq∂ψ + gδq  ∇ ψ+ gq∂𝜃 ∇𝜃 + g∇ ζ
        ∂(qδ)        ∂δ
    = g -∂ψ-∇ ψ + gq ∂𝜃∇ 𝜃+ g∇ζ.                        (303)
" class="math-display"  /><a 
 id="x1-74001r303"></a></center>
</div>Using Eq. (<a 
href="#x1-74001r303">303<!--tex4ht:ref: 5-6-1 --></a>), the covariant form of the magnetic ﬁeld, Eq. (<a 
href="#x1-46002r176">176<!--tex4ht:ref: 5-6-2 --></a>), is written as
   <table 
class="equation"><tr><td><a 
 id="x1-74002r304"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium401x.png" alt="     (                    )      (                )
       ′ 𝒥-          ∂(qδ)          ∂δ-   ′ 𝒥-   2
B =   Ψ R2 ∇ψ ⋅∇𝜃 + g ∂ψ   ∇ ψ +  gq∂𝜃 − Ψ R2|∇ψ |  ∇𝜃 + g∇ζ.
" class="math-display"  /></center></td><td class="equation-label">(304)</td></tr></table>
<!--l. 3526--><p class="nopar" >
This expression can be further simpliﬁed by using equation (<a 
href="#x1-67004r275">275<!--tex4ht:ref: 11-12-p1 --></a>) to eliminate <span 
class="cmmi-10">∂δ∕∂𝜃</span>, which gives
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium402x.png" alt="     (                    )      (                    )
B  =  Ψ′ 𝒥-∇ψ ⋅∇ 𝜃+ g∂(qδ) ∇ ψ +  − g2− gqR2-− Ψ ′|∇ψ |2  𝒥-∇ 𝜃+ g∇ ζ
        R2            ∂ψ            Ψ′     𝒥            R2
     ( ′ 𝒥           ∂(qδ))      (  g2 + |∇ Ψ|2   R2 ) 𝒥
   =  Ψ R2-∇ψ ⋅∇ 𝜃+ g-∂ψ-- ∇ ψ +  − ---Ψ-′---− gq-𝒥-  R2∇ 𝜃+ g∇ ζ.   (305)
" class="math-display"  /></center>
</div>Using <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">2</span></sup> = (<span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span><sup><span 
class="cmr-7">2</span></sup> + <span 
class="cmmi-10">g</span><sup><span 
class="cmr-7">2</span></sup>)<span 
class="cmmi-10">∕R</span><sup><span 
class="cmr-7">2</span></sup>, the above equation is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium403x.png" alt="    (                    )      (              )
      ′-𝒥-          ∂(qδ)          B2R2-    R2-  𝒥--
B =  Ψ R2 ∇ψ ⋅∇ 𝜃+ g ∂ψ   ∇ ψ +  −  Ψ ′ − gq 𝒥   R2∇ 𝜃+ g∇ ζ
    (   𝒥           ∂(qδ))      (  B2      )
  =  Ψ′R2-∇ψ ⋅∇ 𝜃+ g-∂ψ-- ∇ ψ +  − Ψ′ 𝒥 − gq ∇ 𝜃+ g∇ζ.           (306)
" class="math-display"  /><a 
 id="x1-74004r306"></a></center>
</div>Equation (<a 
href="#x1-74004r306">306<!--tex4ht:ref: 5-6-4 --></a>) is the covariant form of the magnetic ﬁeld in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinate system. For the
particular choice of the radial coordinate <span 
class="cmmi-10">ψ </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">Ψ </span>and the Jacobian <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">∕B</span><sup><span 
class="cmr-7">2</span></sup> (i.e., Boozer’s
Jacobian, discussed in Sec. <a 
href="#x1-7500014.9">14.9<!--tex4ht:ref: 18-5-1-p1 --></a>), equation (<a 
href="#x1-74004r306">306<!--tex4ht:ref: 5-6-4 --></a>) reduces to
   <table 
class="equation"><tr><td><a 
 id="x1-74005r307"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium404x.png" alt="    (                    )
B =   −-𝒥2∇ψ ⋅∇ 𝜃+ g∂(qδ) ∇ ψ + I(ψ )∇ 𝜃+ g(ψ)∇ ζ,
       R             ∂ψ
" class="math-display"  /></center></td><td class="equation-label">(307)</td></tr></table>
<!--l. 3561--><p class="nopar" >
with <span 
class="cmmi-10">I</span>(<span 
class="cmmi-10">ψ</span>) = <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>) <span 
class="cmsy-10">− </span><span 
class="cmmi-10">gq</span>. The magnetic ﬁeld expression in Eq. (<a 
href="#x1-74005r307">307<!--tex4ht:ref: 9-10-1 --></a>) frequently appears in tokamak
literature<span class="cite">[<a 
href="#Xwhite1984">29</a>]</span>. In this form, the coeﬃcients before both <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃 </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ </span>depends on only the radial
coordinate. In terms of <span 
class="cmmi-10">I</span>(<span 
class="cmmi-10">ψ</span>), the Jabobian can also be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-74006r308"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium405x.png" alt="𝒥  = gq+-I.
      B2
" class="math-display"  /></center></td><td class="equation-label">(308)</td></tr></table>
<!--l. 3569--><p class="nopar" >
</p><!--l. 3573--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.9   </span> <a 
 id="x1-7500014.9"></a>Form of operator (<span 
class="cmmi-10">B </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ∕B</span><sup><span 
class="cmr-7">2</span></sup>) <span 
class="cmsy-10">⋅∇ </span>in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates</h4>
<!--l. 3575--><p class="noindent" >In solving the MHD eigenmode equations in toroidal geometries, besides the <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇ </span>operator, we will
also encounter another surface operator (<span 
class="cmbx-10">B</span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ∕B</span><sup><span 
class="cmr-7">2</span></sup>) <span 
class="cmsy-10">⋅∇</span>. Next, we derive the form of the this operator
in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinate system. Using the covariant form of the equilibrium magnetic ﬁeld [Eq.  (<a 
href="#x1-74004r306">306<!--tex4ht:ref: 5-6-4 --></a>)],
we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-75001r309"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium406x.png" alt="             (          )
B-×-∇-ψ   -1-   B2-                 -g-
  B2    = B2  − Ψ ′ 𝒥 − gq ∇ 𝜃× ∇ ψ+ B2 ∇ ζ × ∇ ψ.
" class="math-display"  /></center></td><td class="equation-label">(309)</td></tr></table>
<!--l. 3585--><p class="nopar" >
Using this, the (<span 
class="cmbx-10">B </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ∕B</span><sup><span 
class="cmr-7">2</span></sup>) <span 
class="cmsy-10">⋅∇ </span>operator is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium407x.png" alt="                (         )
B-×-∇-ψ      -1- B2-         − 1 ∂- -g-  −1 ∂-
  B2    ⋅∇ = B2   Ψ′ 𝒥 + gq 𝒥   ∂ζ + B2 𝒥  ∂𝜃             (310)
             ( 1    𝒥 −1 ) ∂     𝒥−1 ∂
           =  --′ + g-2-q  ---+g --2---,                  (311)
              Ψ      B     ∂ζ    B   ∂𝜃
" class="math-display"  /><a 
 id="x1-75002r311"></a></center>
</div>which is the form of the operator in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinate system.
<!--l. 3600--><p class="indent" >   Examining Eq. (<a 
href="#x1-75002r311">311<!--tex4ht:ref: 5-9-a3 --></a>), we ﬁnd that the coeﬃcients before the two partial derivatives will be
independent of <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ζ </span>if the Jacobian <span 
class="cmsy-10">𝒥 </span>is chosen to be of the form <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">∕B</span><sup><span 
class="cmr-7">2</span></sup>, where <span 
class="cmmi-10">h </span>is some
magnetic surface function. It is obvious that the independence of the coeﬃcients on <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ζ </span>will be
advantageous to some applications. The coordinate system (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) with the particular choice of
<span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">h</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">∕B</span><sup><span 
class="cmr-7">2</span></sup> is called the Boozer coordinates. The usefulness of the new toroidal angle <span 
class="cmmi-10">ζ </span>is highlighted
in Boozer’s choice of the Jacobian, which makes both <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇ </span>and (<span 
class="cmbx-10">B </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ∕B</span><sup><span 
class="cmr-7">2</span></sup>) <span 
class="cmsy-10">⋅∇ </span>be a
constant-coeﬃcient diﬀerential operator. For other choices of the Jacobian, only the <span 
class="cmbx-10">B</span><span 
class="cmsy-10">⋅∇ </span>operator is a
constant-coeﬃcient diﬀerential operator.
</p><!--l. 3614--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.10   </span> <a 
 id="x1-7600014.10"></a>Radial diﬀerential operator</h4>
<!--l. 3616--><p class="noindent" >In solving the MHD eigenmode equations in toroidal geometry, we also need the radial
diﬀerential operator <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">⋅∇</span>. Next, we derive the form of the operator in (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates.
Using
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                          <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">f </span>= <img 
src="tokamak_equilibrium408x.png" alt="∂f-
∂ψ"  class="frac" align="middle" /><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>+ <img 
src="tokamak_equilibrium409x.png" alt="∂f-
∂ 𝜃"  class="frac" align="middle" /><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃 </span>+ <img 
src="tokamak_equilibrium410x.png" alt="∂f-
∂ζ"  class="frac" align="middle" /><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ,</span>
</td></tr></table>
<!--l. 3621--><p class="nopar" >
the radial diﬀerential operator is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium411x.png" alt="∇ ψ ⋅∇f = |∇ ψ|2∂f-+ (∇𝜃 ⋅∇ ψ)∂f-+ (∇ζ ⋅∇ψ )∂f-
               ∂ψ           ∂ 𝜃           ∂ζ
              2∂f-          ∂f-                     ∂f-
        = |∇ ψ| ∂ψ + (∇𝜃 ⋅∇ ψ)∂ 𝜃 + {∇ [ϕ − qδ(ψ,𝜃)]⋅∇ ψ}∂ζ
               ∂f           ∂f            ∂f
        = |∇ ψ|2∂ψ-+ (∇𝜃 ⋅∇ ψ)∂-𝜃 − ∇ [qδ]⋅∇ ψ∂ζ

        = |∇ ψ|2∂f-+ (∇𝜃 ⋅∇ ψ)∂f-− [q∇δ +δ∇q ]⋅∇ψ ∂f-
               ∂ψ           ∂ 𝜃  [ (            ∂ζ)        ]
        = |∇ ψ|2∂f-+ (∇𝜃 ⋅∇ ψ)∂f-−  q  ∂δ-∇ψ + ∂δ∇ 𝜃  + δq′∇ ψ ⋅∇ ψ∂f-
               ∂ψ           ∂ 𝜃      ∂ψ      ∂𝜃                  ∂ζ
              2∂f           ∂f   [∂ (qδ)    2   ∂δ       ] ∂f
        = |∇ ψ| ∂ψ-+ (∇𝜃 ⋅∇ ψ)∂-𝜃 − -∂-ψ-|∇ψ| + q∂𝜃-∇𝜃 ⋅∇ψ  ∂ζ,        (312)
" class="math-display"  /><a 
 id="x1-76001r312"></a></center>
</div>where <span 
class="cmmi-10">∂</span>(<span 
class="cmmi-10">qδ</span>)<span 
class="cmmi-10">∕∂ψ </span>and <span 
class="cmmi-10">q∂δ∕∂𝜃 </span>are given respectively by Eqs. (<a 
href="#x1-67011r281">281<!--tex4ht:ref: 6-25-a1 --></a>) and (<a 
href="#x1-67004r275">275<!--tex4ht:ref: 11-12-p1 --></a>). Using the above formula,
<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ζ </span>is written as
   <table 
class="equation"><tr><td><a 
 id="x1-76002r313"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium412x.png" alt="            [∂(qδ)        ∂δ       ]
∇ ψ ⋅∇ζ = −  -----|∇ ψ|2 + q--∇ 𝜃⋅∇ ψ .
              ∂ψ          ∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(313)</td></tr></table>
<!--l. 3657--><p class="nopar" >
This formula is used in GTAW code.
                                                                                

                                                                                
</p><!--l. 3660--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">15   </span> <a 
 id="x1-7700015"></a>Field-line-following coordinates</h3>
<!--l. 3663--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">15.1   </span> <a 
 id="x1-7800015.1"></a>Deﬁnition of the ﬁeld-line-following coordinates (<span 
class="cmmi-10">ψ,𝜃,α</span>)</h4>
<!--l. 3665--><p class="noindent" >In (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates, a magnetic ﬁeld line is straight in (<span 
class="cmmi-10">𝜃,ζ</span>) plane with slope being <span 
class="cmmi-10">q</span>. Then the
equation for a magnetic ﬁeld line is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78001r314"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium413x.png" alt="ζ = q𝜃 + α,
" class="math-display"  /></center></td><td class="equation-label">(314)</td></tr></table>
<!--l. 3670--><p class="nopar" >
where <span 
class="cmmi-10">α </span>is a constant in (<span 
class="cmmi-10">𝜃,ζ</span>) plane and can be used to label magnetic ﬁeld lines on a magnetic surface.
This motivates us to use <span 
class="cmmi-10">α</span>, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78002r315"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium414x.png" alt="α ≡ ζ − q𝜃,
" class="math-display"  /></center></td><td class="equation-label">(315)</td></tr></table>
<!--l. 3676--><p class="nopar" >
to replace <span 
class="cmmi-10">ζ</span>. Then the magnetic ﬁeld in Eq. (<a 
href="#x1-68003r284">284<!--tex4ht:ref: 3-13-p3 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78003r316"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium415x.png" alt="B = Ψ ′∇ ψ × ∇α,
" class="math-display"  /></center></td><td class="equation-label">(316)</td></tr></table>
<!--l. 3681--><p class="nopar" >
which is called the Clebsch form. The direction
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78004r317"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium416x.png" alt="∂r|ψ,α = 𝒥∇ α× ∇ ψ,
∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(317)</td></tr></table>
<!--l. 3686--><p class="nopar" >
is parallel (or anti-parallel) to the magnetic ﬁeld direction. Due to this fact, (<span 
class="cmmi-10">ψ,𝜃,α</span>) coordinates are
usually called “ﬁeld-line-following coordinates” or “ﬁeld-aligned coordinates” <span class="cite">[<a 
href="#Xbeer1995">2</a>, <a 
href="#Xychen2003">6</a>]</span>.
</p><!--l. 3692--><p class="indent" >   Equation (<a 
href="#x1-78003r316">316<!--tex4ht:ref: 10-9-p1 --></a>) implies that
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78005r318"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium417x.png" alt="B ⋅∇α = 0,
" class="math-display"  /></center></td><td class="equation-label">(318)</td></tr></table>
<!--l. 3695--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78006r319"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium418x.png" alt="B ⋅∇ψ = 0,
" class="math-display"  /></center></td><td class="equation-label">(319)</td></tr></table>
<!--l. 3699--><p class="nopar" >
i.e., both <span 
class="cmmi-10">α </span>and <span 
class="cmmi-10">ψ </span>are constant along a magnetic ﬁeld line. Taking scalar product of Eq. (<a 
href="#x1-78003r316">316<!--tex4ht:ref: 10-9-p1 --></a>) with <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>,
we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78007r320"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium419x.png" alt="          Ψ ′
B ⋅∇ 𝜃 = − 𝒥-,
" class="math-display"  /></center></td><td class="equation-label">(320)</td></tr></table>
<!--l. 3704--><p class="nopar" >
which is nonzero, i.e., only <span 
class="cmmi-10">𝜃 </span>among (<span 
class="cmmi-10">ψ,𝜃,α</span>) is changing along a magnetic ﬁeld line. (Here
<span 
class="cmsy-10">𝒥 </span>= (<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α</span>)<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup> is the Jacobian of the coordinate system (<span 
class="cmmi-10">ψ,𝜃,α</span>), which happens to be equal to
the Jacobian of (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates.)
</p><!--l. 3711--><p class="indent" >   Using Eq. (<a 
href="#x1-78003r316">316<!--tex4ht:ref: 10-9-p1 --></a>), the magnetic diﬀerential operator <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇ </span>in the new coordinate system (<span 
class="cmmi-10">ψ,𝜃,α</span>) is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-78008r321"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium420x.png" alt="         Ψ ′∂
B ⋅∇f  = −-- --f,
          𝒥 ∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(321)</td></tr></table>
<!--l. 3716--><p class="nopar" >
which is just a partial derivative over <span 
class="cmmi-10">𝜃</span>, as is expected, since only <span 
class="cmmi-10">𝜃 </span>is changing along a magnetic ﬁeld
line.
                                                                                

                                                                                
</p><!--l. 3720--><p class="indent" >   By the way, note that (<span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α</span>)<span 
class="cmmi-10">∕</span>(<span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃</span>) = 0, i.e., the magnetic ﬁeld lines are straight with zero
slope on (<span 
class="cmmi-10">𝜃,α</span>) plane.
</p><!--l. 3724--><p class="indent" >   Using Eqs. (<a 
href="#x1-78002r315">315<!--tex4ht:ref: 17-3-18-1 --></a>) and (<a 
href="#x1-67007r278">278<!--tex4ht:ref: 17-4-11-1 --></a>), <span 
class="cmmi-10">α </span>can be written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium421x.png" alt="       ∫
         𝜃
α = ϕ − 0 ˆqd𝜃,                            (322)
" class="math-display"  /><a 
 id="x1-78009r322"></a></center>
</div>where <img 
src="tokamak_equilibrium422x.png" alt="ˆq"  class="circ"  /> = <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ϕ∕</span><span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃 </span>is the local safety factor. (If we choose the straight-ﬁeld-line <span 
class="cmmi-10">𝜃</span>, then <span 
class="cmmi-10">α </span>is
written as <span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">q𝜃</span>.) Deﬁne <span class="overline"><span 
class="cmmi-10">δ</span></span> = <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><img 
src="tokamak_equilibrium423x.png" alt="ˆq"  class="circ"  /> <span 
class="cmmi-10">d𝜃</span>, which is called <span 
class="cmtt-10">tor</span><span 
class="cmtt-10">_shift</span> in <span 
class="cmtt-10">TEK</span> code, then <span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">−</span><span class="overline"><span 
class="cmmi-10">δ</span></span>. In
<span 
class="cmtt-10">TEK</span>, I choose <span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">∈ </span>[<span 
class="cmsy-10">−</span><span 
class="cmmi-10">π,π</span>) with <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>corresponding to the high-ﬁeld-side midplane, and <span 
class="cmmi-10">𝜃 </span>is increasing
along the counter-clockwise direction viewed along <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ</span>.  The <span 
class="cmmi-10">𝜃 </span>cut, i.e., <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">±</span><span 
class="cmmi-10">π </span>is far away from the
low-ﬁeld-side where ballooning modes often have larger amplitude. The (<span 
class="cmmi-10">x,y</span>) grid near the <span 
class="cmmi-10">𝜃 </span>cut is
highly twisted in real space and interplation is needed in mapping physical quantity from the
grid at <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>plane to that at <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π</span>. Numerical errors more likely appear there. So
we prefer that the <span 
class="cmmi-10">𝜃 </span>cut is located in less important area (area where mode amplitude is
small).
<!--l. 3744--><p class="indent" >   It is widely believed that turbulence responsible for energy transport in tokamak plasmas usually
has <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">≪ </span><span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">⊥</span></sub>, where <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub> and <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">⊥</span></sub> are the parallel and perpendicular wavenumbers, respectively. Due to
this elongated structure along the parallel direction, less grids can be used in the parallel direction than
that in the perpendicular direction in turbulence simulation. In this case, the ﬁeld-aligned coordinates
(<span 
class="cmmi-10">ψ,𝜃,α</span>) provide suitable coordinates to be used, where less gridpoints can be used for <span 
class="cmmi-10">𝜃 </span>coordinate in
simulations and even some <span 
class="cmmi-10">∂∕∂𝜃 </span>derivatives can be neglected (high-n approximation), which
simpliﬁes the equations that need to be solved. There is another reason why almost all
gyrokinetic codes use ﬁeld-aligned coordinates: the  stability of numerical algorthims is improved
when we use coarse grids in the parallel direction because the parallel Courant condition
(for explicit schemes) <span 
class="cmmi-10">Δt </span><span 
class="msam-10">≤ </span><span 
class="cmmi-10">ΔL</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">∕v</span><sub><span 
class="cmsy-7">∥</span></sub> can be more easily satisﬁed (especially for the cases
with kinetic electrons), where <span 
class="cmmi-10">ΔL</span><sub><span 
class="cmsy-7">∥</span></sub> is the parallel grid spacing, which is larger when coarse
grids are used in the parallel direction. This is also mentioned in Ref. <span class="cite">[<a 
href="#Xottaviani2011">22</a>]</span> and it seems
to be right from my experiences of testing several algorithm but a strict test is needed
to verify this. This can also be understood in the following way: the coarse parallel grid
automatically ﬁlters out physically irrelevant but numerically problematic high-<span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub> modes,
permitting much longer time steps for explicit time stepping, in both particle and ﬂuid
codes<span class="cite">[<a 
href="#Xdimits1993">12</a>]</span>.
</p><!--l. 3769--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">15.2   </span> <a 
 id="x1-7900015.2"></a>Some discussions</h4>
<!--l. 3771--><p class="noindent" >The fact <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α </span>= 0 implies that <span 
class="cmmi-10">α </span>is constant along a magnetic ﬁeld line. At ﬁrst glance, a
magnetic line on an irrational surface seems to sample all the points on the surface. This
                                                                                

                                                                                
seems to indicate that <span 
class="cmmi-10">α </span>is a ﬂux surface label for irrational surface. However, <span 
class="cmmi-10">α </span>must be a
non-ﬂux-surface-function so that it can provide a suitable toroidal coordinate. I had once been confused
by this conﬂict for a long time. The key point to resolve this confusion is to realize that it is
wrong to say there is only one magnetic line on an irrational surface, i.e. it is wrong to say a
magnetic line on an irrational surface samples all the points on the surface. There are still
inﬁnite number of magnetic ﬁeld lines that can not be connected with each other on an
irrational surface. Then the fact <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α </span>= 0 does not imply that <span 
class="cmmi-10">α </span>must be the same on
these diﬀerent magnetic ﬁeld lines. In fact, although <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α </span>= 0, the gradient of <span 
class="cmmi-10">α </span>on a
ﬂux-surface along the perpendicular (to <span 
class="cmbx-10">B</span>) direction is nonzero, i.e., <span 
class="cmbx-10">B </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α</span><span 
class="cmmi-10">≠</span>0. [Proof:
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium424x.png" alt="B × ∇ Ψ ⋅∇α = ∇Ψ × ∇ α⋅B
               2
            = B                                 (323)
" class="math-display"  /></center>
</div>which is obviously nonzero.] This indicates that <span 
class="cmmi-10">α </span>is not constant on a ﬂux-surface.
<!--l. 3795--><p class="indent" >   In (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>is perpendicular to <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>. However, in ﬁeld-line-following coordinates
(<span 
class="cmmi-10">ψ,𝜃,α</span>), <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">α </span>is not perpendicular to <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ</span>. Therefore <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">α </span>is not along the binormal direction
<span 
class="cmbx-10">B </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ</span>.
</p><!--l. 3802--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">15.3   </span> <a 
 id="x1-8000015.3"></a>Expression of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">α</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">α </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃</span></h4>
<!--l. 3804--><p class="noindent" >The generalized toroidal angle <span 
class="cmmi-10">α </span>is deﬁned by Eq. (<a 
href="#x1-78009r322">322<!--tex4ht:ref: 17-9-15-1 --></a>), i.e., <span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ </span><span 
class="cmsy-10">−</span><span class="overline"><span 
class="cmmi-10">δ</span></span>, where <span class="overline"><span 
class="cmmi-10">δ</span></span> = <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><img 
src="tokamak_equilibrium425x.png" alt="ˆq"  class="circ"  /> <span 
class="cmmi-10">d𝜃</span>. The
gradient of <span 
class="cmmi-10">α </span>is then written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium426x.png" alt="∇ α = ∇ ϕ− ∇ δ
      ˆ    -       -
   =  ϕ-− ∂δ∇ ψ − ∂δ∇ 𝜃.                       (324)
      R   ∂ψ      ∂𝜃
" class="math-display"  /><a 
 id="x1-80001r324"></a></center>
                                                                                

                                                                                
</div>Then
   <table 
class="equation"><tr><td><a 
 id="x1-80002r325"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium427x.png" alt="            ∂δ        ∂δ
∇ ψ ⋅∇α = − --|∇ψ |2 − --∇ ψ⋅∇ 𝜃
            ∂ψ        ∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(325)</td></tr></table>
<!--l. 3818--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-80003r326"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium428x.png" alt="            -           -
∇α ⋅∇ 𝜃 = − ∂δ∇ ψ ⋅∇𝜃 − ∂δ|∇𝜃|2
           ∂ψ          ∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(326)</td></tr></table>
<!--l. 3823--><p class="nopar" >
Another method of computing the above quantities: Using Eqs. (<a 
href="#x1-61009r231">231<!--tex4ht:ref: 6-9-e1 --></a>) and (<a 
href="#x1-61010r232">232<!--tex4ht:ref: 6-9-e2 --></a>), expression (<a 
href="#x1-80001r324">324<!--tex4ht:ref: 24-4-25-p1 --></a>) is
written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium429x.png" alt="           -                  -
      ˆϕ-  ∂δ-R-   ˆ     ˆ   ∂-δR-   ˆ      ˆ
∇ α = R + ∂ψ 𝒥 (Z 𝜃R − R𝜃Z)− ∂ 𝜃𝒥 (ZψR − Rψ Z)
      ˆϕ   ( ∂δR      ∂δR    )    ( ∂δ R      ∂δR    )
   =  --+  -----Z𝜃 − ----Zψ  Rˆ+   ----R ψ −-----R 𝜃 ˆZ.        (327)
      R    ∂ψ 𝒥      ∂𝜃𝒥           ∂𝜃𝒥      ∂ ψ𝒥
" class="math-display"  /></center>
                                                                                

                                                                                
</div>(Note that <span 
class="cmmi-10">∂</span><span class="overline"><span 
class="cmmi-10">δ</span></span><span 
class="cmmi-10">∕∂ψ </span>is discontinuous across the <span 
class="cmmi-10">𝜃 </span>cut.) Then <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium430x.png" alt="         (                )  [    (  -         -    )     (  -         -    )  ]
             R-  ˆ   R-  ˆ    ϕˆ    ∂δ-R-     ∂δR-    ˆ     ∂δR-     ∂-δR-    ˆ
∇ψ ⋅∇ α =  − 𝒥 Z 𝜃R + 𝒥 R𝜃Z ⋅ R  +  ∂ψ 𝒥 Z𝜃 − ∂𝜃𝒥 Zψ  R +   ∂𝜃𝒥 R ψ − ∂ψ 𝒥 R𝜃 Z
               (  -         -    )        (  -        -     )
       = − R-Z𝜃  ∂δ-R-Z𝜃 − ∂δR-Zψ  + R-R 𝜃  ∂δR-Rψ − ∂δ-R-R𝜃  .             (328)
           𝒥     ∂ψ 𝒥      ∂𝜃𝒥       𝒥      ∂𝜃𝒥      ∂ψ 𝒥
" class="math-display"  /></center>
</div>
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium431x.png" alt="         [    (  -         -    )     (  -         -    )   ] (               )
∇α ⋅∇ 𝜃 = ϕˆ +  ∂δ-R-Z −  ∂δR-Z   ˆR +   ∂δR-R  − ∂-δR-R   ˆZ. ⋅  R-Z Rˆ−  RR  ˆZ
          R     ∂ψ 𝒥  𝜃   ∂𝜃𝒥  ψ        ∂𝜃𝒥   ψ  ∂ψ 𝒥  𝜃        𝒥  ψ     𝒥  ψ
         (  -        -     )        ( -         -     )
       =   ∂δ-RZ 𝜃 − ∂δ-R-Zψ R-Zψ −  ∂δ-R-Rψ − ∂δ-R-R𝜃  R-Rψ.               (329)
           ∂ψ 𝒥     ∂𝜃 𝒥     𝒥       ∂𝜃 𝒥      ∂ψ 𝒥     𝒥
" class="math-display"  /></center>
</div>The ﬁgures below plot the spatial variation of some quantities.
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8000715"></a>
                                                                                

                                                                                
<!--l. 3884--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15/p.png" alt="pict"  
 width="266.9975pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15b/p.png" alt="pict"  
 width="271.0125pt" />
</p><!--l. 3886--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig14b/p.png" alt="pict"  
 width="266.9975pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig14/p.png" alt="pict"  
 width="268.00125pt" />
</p><!--l. 3888--><p class="noindent" > 
</p><!--l. 3890--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig14g/p.png" alt="pict"  
 width="266.9975pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig14f/p.png" alt="pict"  
 width="276.03125pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 15: </span><span  
class="content">The value of <span 
class="cmmi-10">𝜃</span>, <span 
class="cmmi-10">α </span>and their gradients on an annulus on the poloidal plane (<span 
class="cmmi-10">R,Z</span>). Note
that <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃 </span>is single-valued while <span 
class="cmmi-10">∂α∕∂R </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">α </span>are multi-valued and thus there is a jump near
the branch cut when a single branch is chosen.</span></div><!--tex4ht:label?: x1-8000715 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8000816"></a>
                                                                                

                                                                                
<!--l. 3899--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig14c/p.png" alt="pict"  
 width="266.9975pt" />
</p><!--l. 3901--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig16/p.png" alt="pict"  
 width="268.00125pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig16b/p.png" alt="pict"  
 width="271.0125pt" />
</p><!--l. 3903--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig14d/p.png" alt="pict"  
 width="268.00125pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig14e/p.png" alt="pict"  
 width="268.00125pt" />
</p><!--l. 3905--><p class="noindent" > 
<br /> </p><div class="caption" 
><span class="id">Fig. 16: </span><span  
class="content">The same as Fig. <a 
href="#x1-8000715">15<!--tex4ht:ref: 17-11-10-p1 --></a>, but gradients are computed in cylindrical coordinates. The results
agrees with those of Fig. <a 
href="#x1-8000715">15<!--tex4ht:ref: 17-11-10-p1 --></a>, which provides the conﬁdence in the correctness of the numerical
implementation.</span></div><!--tex4ht:label?: x1-8000816 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3912--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">15.4   </span> <a 
 id="x1-8100015.4"></a>Field-aligned coordinates in GEM<span class="cite">[<a 
href="#Xychen2007">7</a>]</span> and GENE<span class="cite">[<a 
href="#Xgorler2016">13</a>]</span> codes</h4>
<!--l. 3917--><p class="noindent" >In GEM<span class="cite">[<a 
href="#Xychen2007">7</a>]</span> and GENE<span class="cite">[<a 
href="#Xgorler2016">13</a>]</span> codes, the ﬁeld-aligned coordinates (<span 
class="cmmi-10">x,y,z</span>) are deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-81001r330"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium432x.png" alt="x = r− r0,
" class="math-display"  /></center></td><td class="equation-label">(330)</td></tr></table>
<!--l. 3921--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-81002r331"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium433x.png" alt="     r0
y = α q-,
      0
" class="math-display"  /></center></td><td class="equation-label">(331)</td></tr></table>
<!--l. 3924--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-81003r332"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium434x.png" alt="z = 𝜃q0R0,
" class="math-display"  /></center></td><td class="equation-label">(332)</td></tr></table>
<!--l. 3927--><p class="nopar" >
where <span 
class="cmmi-10">r </span>is an arbitrary ﬂux surface label with length dimension, which is often chosen in <span 
class="cmtt-10">GEM </span>to be the
minor radius of a magnetic surface in the midplane. Here <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub> and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> are constant quantities of length
dimension, <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub> is the minor radius of a reference magnetic surface (usually corresponding to the center of
the radial simulation box), <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> is the major radius of the magnetic axis, <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> is the safety factor value on
the <span 
class="cmmi-10">r </span>= <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub> surface. The constant length <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> introduced in the deﬁnition of <span 
class="cmmi-10">z </span>is to make <span 
class="cmmi-10">z</span>
approximately correspond to the length along the ﬁeld line in the large-aspect ratio limit. The constant
length <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕q</span><sub><span 
class="cmr-7">0</span></sub> introduced in the deﬁnition of <span 
class="cmmi-10">y </span>is to make <span 
class="cmmi-10">y </span>corresponds to the arc-length in
the poloidal plane traced by a ﬁeld line when its usual toroidal angle increment <span 
class="cmmi-10">Δϕ </span>is <span 
class="cmmi-10">α</span>.
This explanation makes <span 
class="cmmi-10">y </span>look like a poloidal coordinate whereas <span 
class="cmmi-10">y </span>is actually a toroidal
coordinate.
</p><!--l. 3942--><p class="indent" >   Next, let us calculate the wave number along the <span 
class="cmmi-10">y </span>direction, <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub>, for a mode with toroidal wave
number <span 
class="cmmi-10">n</span>. The wavelength along the <span 
class="cmmi-10">y </span>direction, <span 
class="cmmi-10">λ</span><sub><span 
class="cmmi-7">y</span></sub>, is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-81004r333"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium435x.png" alt="    2π-r0
λy = n q0.
" class="math-display"  /></center></td><td class="equation-label">(333)</td></tr></table>
<!--l. 3947--><p class="nopar" >
Then the wavenumber <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-81005r334"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium436x.png" alt="     2π   nq
ky = --=  --0.
     λy   r0
" class="math-display"  /></center></td><td class="equation-label">(334)</td></tr></table>
<!--l. 3951--><p class="nopar" >
On the other hand, the poloidal wavenumber <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">𝜃</span></sub> is given by
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-81006r335"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium437x.png" alt="    2π-   --2π---  m-
k𝜃 = λ 𝜃 ≈ 2πr0∕m = r0.
" class="math-display"  /></center></td><td class="equation-label">(335)</td></tr></table>
<!--l. 3956--><p class="nopar" >
where <span 
class="cmmi-10">m </span>is the poloidal mode number of the mode in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates. If the mode has the property
<span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">≈ </span>0, i.e., <span 
class="cmmi-10">m </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">nq</span><sub><span 
class="cmr-7">0</span></sub>, then <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">𝜃</span></sub> is equal to the <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub>. The motivation of introducing the constant length
<span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕q</span><sub><span 
class="cmr-7">0</span></sub> in the deﬁnition of <span 
class="cmmi-10">y </span>is to make <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">𝜃</span></sub> for a mode with <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">≈ </span>0.
</p><!--l. 3963--><p class="indent" >   Some authors call <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> or <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">𝜃</span></sub> by the name “binormal wavenumber”, which is not an appropriate name
in my opinion. Some authors call <span 
class="cmmi-10">y </span>the binormal direction, which is also an inappropriate name since
neither <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y </span>nor <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂y </span>is along the binormal direction <span 
class="cmbx-10">B</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ψ</span>.
</p><!--l. 3969--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">15.5   </span> <a 
 id="x1-8200015.5"></a>Visualization of gridpoints in ﬁeld aligned coordinate system</h4>
<!--l. 3971--><p class="noindent" >In this section, I try to visualize gridpoints in the ﬁeld aligned coordinates. The directions of the
covariant basis vectors of (<span 
class="cmmi-10">ψ,𝜃,α</span>) coordinates are as follows:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-82001r336"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium438x.png" alt="∂r
∂α-|ψ,𝜃 −→ usualtoroidaldirection,ϕˆ,
" class="math-display"  /></center></td><td class="equation-label">(336)</td></tr></table>
<!--l. 3978--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-82002r337"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium439x.png" alt="∂r-|ψ,α −→ (parallel or antiparallelto)ﬁeld linedirection
∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(337)</td></tr></table>
<!--l. 3983--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-82003r338"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium440x.png" alt="∂r|   −→ combination ofthe usualradialand toroidaldirection
∂ψ 𝜃,α
" class="math-display"  /></center></td><td class="equation-label">(338)</td></tr></table>
<!--l. 3988--><p class="nopar" >
Here <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> is a combination of the usual radial and toroidal direction, which needs some
clariﬁcation. Note that, <span 
class="cmmi-10">ϕ </span>is related to <span 
class="cmmi-10">α </span>by Eq. (<a 
href="#x1-78009r322">322<!--tex4ht:ref: 17-9-15-1 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-82004r339"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium441x.png" alt="       ∫ 𝜃B ⋅∇ ϕ
ϕ = α +   ------d𝜃 ≈ α+ q(ψ)𝜃,
        0 B ⋅∇ 𝜃
" class="math-display"  /></center></td><td class="equation-label">(339)</td></tr></table>
<!--l. 3997--><p class="nopar" >
(where the second equality becomes exact if <span 
class="cmmi-10">𝜃 </span>is the straight-ﬁeld-line poloidal angle deﬁned in Sec.
<a 
href="#x1-5500010.4">10.4<!--tex4ht:ref: 17-10-30-1 --></a>.), which indicates that, for <span 
class="cmmi-10">q</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">≠</span>0 and <span 
class="cmmi-10">𝜃</span><span 
class="cmmi-10">≠</span>0, the usual toroidal angle <span 
class="cmmi-10">ϕ </span>is changing when changing
<span 
class="cmmi-10">ψ </span>and holding <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">α </span>ﬁxed. Figure <a 
href="#x1-8200517">17<!--tex4ht:ref: 17-9-16-1 --></a>b shows how the usual toroidal angle <span 
class="cmmi-10">ϕ </span>changes when we change
<span 
class="cmmi-10">ψ </span>and hold <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">α </span>ﬁxed.
</p>
                                                                                

                                                                                
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8200517"></a>
                                                                                

                                                                                
<!--l. 4006--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2b2/p.png" alt="pict"  
 width="113.42375pt" />                   <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2f/p.png" alt="pict"  
 width="256.96pt" />
</p><!--l. 4008--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2r1/p.png" alt="pict"  
 width="256.96pt" />                             <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2/p.png" alt="pict"  
 width="256.96pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 17: </span><span  
class="content">(a): A <span 
class="cmmi-10">𝜃 </span>contour on <span 
class="cmmi-10">ϕ </span>= 0 plane. Here <span 
class="cmmi-10">𝜃 </span>= 9<span 
class="cmsy-10">×</span>2<span 
class="cmmi-10">π∕</span>63.  This is the direction of <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,ϕ</span></sub>.
(b): <span 
class="cmmi-10">ψ </span>coordinate lines in (<span 
class="cmmi-10">ψ,𝜃,α</span>) coordinates ( <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> are the tangent lines to these curves)
on the isosurface of <span 
class="cmmi-10">𝜃 </span>= 9 <span 
class="cmsy-10">× </span>2<span 
class="cmmi-10">π∕</span>63. Here diﬀerent lines correspond to diﬀerent values of <span 
class="cmmi-10">α</span>. (c): <span 
class="cmmi-10">α</span>
coordinate lines (<span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂α</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ψ,𝜃</span></sub> are tangent lines to these curves), which are along the usual toroidal
direction <img 
src="tokamak_equilibrium442x.png" alt="ˆϕ"  class="circ"  />. (d): Grid on the isosurface of <span 
class="cmmi-10">𝜃 </span>= 9<span 
class="cmsy-10">×</span>2<span 
class="cmmi-10">π∕</span>63, where the red lines are <span 
class="cmmi-10">α </span>coordinate lines
while the blue lines are <span 
class="cmmi-10">ψ </span>coordinate lines. Magnetic ﬁeld from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x1-8200517 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4024--><p class="indent" >   The relation <span 
class="cmmi-10">ϕ </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">α </span>+ <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">𝜃 </span>given by Eq. (<a 
href="#x1-82004r339">339<!--tex4ht:ref: 17-10-30-2 --></a>) indicates that the toroidal shift along <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">α,𝜃</span></sub> for a
radial change form <span 
class="cmmi-10">ψ</span><sub><span 
class="cmr-7">1</span></sub> to <span 
class="cmmi-10">ψ</span><sub><span 
class="cmr-7">2</span></sub> is given by (<span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span><sub><span 
class="cmr-7">2</span></sub>) <span 
class="cmsy-10">− </span><span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span><sub><span 
class="cmr-7">2</span></sub>))<span 
class="cmmi-10">𝜃</span>, which is larger on <span 
class="cmmi-10">𝜃 </span>isosurface with larger
value of <span 
class="cmmi-10">𝜃</span>. An example for this is shown in Fig. <a 
href="#x1-8200618">18<!--tex4ht:ref: 17-10-30-5 --></a> for <span 
class="cmmi-10">𝜃 </span>= 19 <span 
class="cmsy-10">× </span>2<span 
class="cmmi-10">π∕</span>63, where <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">α,𝜃</span></sub> has larger
toroidal shift than that in Fig. <a 
href="#x1-8200517">17<!--tex4ht:ref: 17-9-16-1 --></a> for <span 
class="cmmi-10">𝜃 </span>= 9 <span 
class="cmsy-10">× </span>2<span 
class="cmmi-10">π∕</span>63.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8200618"></a>
                                                                                

                                                                                
<!--l. 4035--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2b3/p.png" alt="pict"  
 width="113.42375pt" />                   <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2d/p.png" alt="pict"  
 width="250.9375pt" />
</p><!--l. 4037--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2e/p.png" alt="pict"  
 width="250.9375pt" />                             <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2c/p.png" alt="pict"  
 width="250.9375pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 18: </span><span  
class="content">(a) <span 
class="cmmi-10">𝜃 </span>= 19 <span 
class="cmsy-10">× </span>2<span 
class="cmmi-10">π∕</span>63 contour on <span 
class="cmmi-10">ϕ </span>= 0 plane, (b) <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ </span>curves, (c) <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂α </span>curves on
isosurface of <span 
class="cmmi-10">𝜃 </span>= 19<span 
class="cmsy-10">×</span>2<span 
class="cmmi-10">π∕</span>63. <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂α </span>lines are identical with <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ϕ </span>lines. (d): Grid on the isosurface
of <span 
class="cmmi-10">𝜃 </span>= 19 <span 
class="cmsy-10">× </span>2<span 
class="cmmi-10">π∕</span>63, which are the combinations of <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ </span>curves and <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂α </span>curves.</span></div><!--tex4ht:label?: x1-8200618 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4048--><p class="indent" >    
</p><!--l. 4050--><p class="indent" >   The <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> curves can be understood from another perspective. Examine a family of magnetic
ﬁeld lines that start from <span 
class="cmmi-10">𝜃 </span>= 0 and <span 
class="cmmi-10">ϕ </span>= <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">1</span></sub> but diﬀerent radial coordinates. These starting points all
have the same value of <span 
class="cmmi-10">α</span>, which is equal to <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">1</span></sub>. When following these ﬁeld lines to another isosurfce of
<span 
class="cmmi-10">𝜃</span>, the intersecting points of these ﬁeld lines with the <span 
class="cmmi-10">𝜃 </span>isosurface will trace out a <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> line with
<span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">1</span></sub>. Examine another family of magnetic ﬁeld lines similar to the above but with the
starting toroidal angle <span 
class="cmmi-10">ϕ </span>= <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">2</span></sub>. They will trace out another <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> line (with <span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">2</span></sub>)
on the <span 
class="cmmi-10">𝜃 </span>isosurface. Continue the process, we ﬁnally get those curves in Fig. <a 
href="#x1-8200517">17<!--tex4ht:ref: 17-9-16-1 --></a>b and Fig.
<a 
href="#x1-8200618">18<!--tex4ht:ref: 17-10-30-5 --></a>b.
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-8300015.5"></a>Radial wavenumber in ﬁeld-aligned coordinates (<span 
class="cmmi-10">ψ,𝜃,α</span>)</h5>
<!--l. 4067--><p class="noindent" >For a harmonic in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates given by <span 
class="cmmi-10">A</span>(<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) = exp(<span 
class="cmmi-10">ik</span><sub><span 
class="cmmi-7">ψ</span></sub><span 
class="cmmi-10">ψ </span>+ <span 
class="cmmi-10">im𝜃 </span>+ <span 
class="cmmi-10">inϕ</span>), the radial wave
number is <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub>. Let us calculate the corresponding radial wavenumber <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub><sup><span 
class="cmmi-7">⋆</span></sup> in the new coordinates
(<span 
class="cmmi-10">ψ,𝜃,α</span>), which is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-83001r340"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium443x.png" alt="           |
k⋆ = ∂phase||   ,
 ψ     ∂ψ  |𝜃,α
" class="math-display"  /></center></td><td class="equation-label">(340)</td></tr></table>
<!--l. 4075--><p class="nopar" >
where the phase is given by phase = <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub><span 
class="cmmi-10">ψ </span>+ <span 
class="cmmi-10">m𝜃 </span>+ <span 
class="cmmi-10">nϕ</span>. Then the above expression is written as
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium444x.png" alt="                     |
k ⋆=  ∂(kψ-ψ+-m-𝜃+-nϕ-)||
 ψ          ∂ψ       |𝜃,α
            ∂ϕ||
   = kψ + n ∂ψ||                                 (341)
               𝜃,α
" class="math-display"  /></center>
                                                                                

                                                                                
</div>Using  Using <span 
class="cmmi-10">ϕ </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">α </span>+ <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span>)<span 
class="cmmi-10">𝜃</span>, the above expression is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium445x.png" alt="k⋆ψ = kψ + nq′𝜃,                           (342)
" class="math-display"  /></center>
</div>where <span 
class="cmmi-10">q</span><span 
class="cmsy-10">′ </span>= <span 
class="cmmi-10">dq∕dψ</span>. This result indicates that, compared with the radial wavenumber in coordinate
system (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>), the radial wavenumber in the new coordinate system (<span 
class="cmmi-10">ψ,𝜃,α</span>) has an increment <span 
class="cmmi-10">n𝜃q</span><span 
class="cmsy-10">′</span>.
For nonzero magnetic shear (<span 
class="cmmi-10">q</span><span 
class="cmsy-10">′</span><span 
class="cmmi-10">≠</span>0) and nonzero poloidal location (<span 
class="cmmi-10">𝜃</span><span 
class="cmmi-10">≠</span>0), the increment <span 
class="cmmi-10">n𝜃q</span><span 
class="cmsy-10">′ </span>can be large
for modes with toroidal mode number <span 
class="cmmi-10">n </span><span 
class="cmsy-10">≫ </span>1. Then we need to use more radial grid number (compared
what is needed in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates) to resolve the radial variation. This is one of disadvantage of
using ﬁeld-aligned coordinates. If the saving associated with using less parallel grid number out-weights
the cost associated with using more radial grid number, we obtain a net saving in using the ﬁeld-aligned
coordinates.
<!--l. 4101--><p class="indent" >   Let us examine how many <span 
class="cmmi-10">ψ </span>grid points are needed to resolve the <span 
class="cmmi-10">ψ </span>dependence in (<span 
class="cmmi-10">ψ,𝜃,α</span>)
coordinates on the high-ﬁeld side (<span 
class="cmmi-10">𝜃 </span>= <span 
class="cmmi-10">π</span>). Assume <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub> <span 
class="cmsy-10">≈ </span>0, then <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub><sup><span 
class="cmmi-7">⋆</span></sup> at <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmmi-10">π </span>is given by <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub><sup><span 
class="cmmi-7">⋆</span></sup> = <span 
class="cmmi-10">nπq</span><span 
class="cmsy-10">′</span>.
The corresponding wave-length is given by <span 
class="cmmi-10">λ</span><sub><span 
class="cmmi-7">ψ</span></sub><sup><span 
class="cmmi-7">⋆</span></sup> = 2<span 
class="cmmi-10">π∕k</span><sub><span 
class="cmmi-7">ψ</span></sub><sup><span 
class="cmmi-7">⋆</span></sup>. The grid spacing <span 
class="cmmi-10">Δψ </span>should be less
than half of this wave-length (sampling theorem). Then the grid number should satisfy
that
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-83004r343"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium446x.png" alt=" ⋆   L ψ    Lψ      ′
Nψ = Δ-ψ ≥ λ⋆∕2-= nq Lψ,
            ψ
" class="math-display"  /></center></td><td class="equation-label">(343)</td></tr></table>
<!--l. 4111--><p class="nopar" >
where <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">ψ</span></sub> is the radial width of the computational domain.
</p><!--l. 4114--><p class="indent" >   The number of Fourier harmonics that need to be included is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-83005r344"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium447x.png" alt="        k⋆       ′
Nk ⋆ψ = --ψ---= nq-Lψ.
       2π∕Lψ     2
" class="math-display"  /></center></td><td class="equation-label">(344)</td></tr></table>
<!--l. 4118--><p class="nopar" >
For DIII-D cyclone base case, choose the radial coordinate <span 
class="cmmi-10">ψ </span>as <span 
class="cmmi-10">r</span>. At the radial location
<span 
class="cmmi-10">ψ </span>= <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub> = 0<span 
class="cmmi-10">.</span>24<span 
class="cmmi-10">m</span>, <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>4, <span 
class="cmmi-10">ŝ</span><sub><span 
class="cmr-7">0</span></sub> = 0<span 
class="cmmi-10">.</span>78, then <span 
class="cmmi-10">q</span><span 
class="cmsy-10">′</span><sub><span 
class="cmr-7">0</span></sub> = <span 
class="cmmi-10">s</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕r</span><sub><span 
class="cmr-7">0</span></sub> = 4<span 
class="cmmi-10">.</span>5<span 
class="cmmi-10">m</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup>. Then <span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">r</span></sub><sup><span 
class="cmmi-7">⋆</span></sup> = <span 
class="cmmi-10">n</span><span 
class="cmsy-10">× </span>0<span 
class="cmmi-10">.</span>45 for the radial
width <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">r</span></sub> = 0<span 
class="cmmi-10">.</span>10<span 
class="cmmi-10">m</span>.
</p><!--l. 4124--><p class="indent" >    
</p><!--l. 4126--><p class="indent" >   Figure <a 
href="#x1-8300619">19<!--tex4ht:ref: 17-11-10-1 --></a> plots <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> lines on the <span 
class="cmmi-10">𝜃 </span>= 0<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">π </span>isosurfaces, which are chosen to be on the
low-ﬁeld-side midplane. On <span 
class="cmmi-10">𝜃 </span>= 0 surface, <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> lines are identical to <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,ϕ</span></sub> lines. On <span 
class="cmmi-10">𝜃 </span>= 2<span 
class="cmmi-10">π</span>
surface, each <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> line has large <span 
class="cmmi-10">ϕ </span>shift. In old version of my code, <span 
class="cmmi-10">𝜃 </span>= 0<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">π </span>surfaces
are chosen as the <span 
class="cmmi-10">𝜃 </span>cuts (in the new version <span 
class="cmmi-10">𝜃 </span>= [<span 
class="cmsy-10">−</span><span 
class="cmmi-10">π,π</span>]). A connection condition for the
perturbations is needed between these two surfaces. This connection condition is discussed in Sec.
<a 
href="#x1-8400015.5">15.5<!--tex4ht:ref: 17-11-10-3 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8300619"></a>
                                                                                

                                                                                
<!--l. 4139--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2jr1/p.png" alt="pict"  
 width="113.42375pt" />             <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2fr1/p.png" alt="pict"  
 width="240.9pt" />
</p><!--l. 4141--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2fr2/p.png" alt="pict"  
 width="241.90375pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 19: </span><span  
class="content">(a) <span 
class="cmmi-10">𝜃 </span>= 0 contour (blue line) in <span 
class="cmmi-10">ϕ </span>= 0 plane; (b) a series of <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> curves (with
<span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">j</span></sub> = <span 
class="cmmi-10">j</span>2<span 
class="cmmi-10">π∕</span>20, <span 
class="cmmi-10">j </span>= 0<span 
class="cmmi-10">,</span>1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,</span>20) on <span 
class="cmmi-10">𝜃 </span>= 0 isosurface, (c) a single <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ψ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">𝜃,α</span></sub> curve (with <span 
class="cmmi-10">α </span>= 0)
on  <span 
class="cmmi-10">𝜃  </span>=  2<span 
class="cmmi-10">π </span>isosurface.  This  curve  ﬁnish  about  4  torodial  loops  because  (<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">max</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">min</span></sub>)2<span 
class="cmmi-10">π  </span>=
(5<span 
class="cmmi-10">.</span>56 <span 
class="cmsy-10">− </span>1<span 
class="cmmi-10">.</span>79) <span 
class="cmsy-10">× </span>2<span 
class="cmmi-10">π </span><span 
class="cmsy-10">≈ </span>4 <span 
class="cmsy-10">× </span>2<span 
class="cmmi-10">π</span>. The radial range is <span 
class="cmmi-10">ψ </span>= 0<span 
class="cmmi-10">.</span>2 <span 
class="cmsy-10">→ </span>0<span 
class="cmmi-10">.</span>9, where <span 
class="cmmi-10">ψ </span>is the normalized
poloidal magnetic ﬂux. Magnetic ﬁeld from EAST discharge #59954@3.03s (gﬁle g059954.003030
provided by Hao BaoLong).</span></div><!--tex4ht:label?: x1-8300619 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x1-8400015.5"></a>Periodic conditions of physical quantity along <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">α </span>in ﬁeld-line-following coordinates
(<span 
class="cmmi-10">ψ,𝜃,α</span>)</h5>
<!--l. 4158--><p class="noindent" >Since (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) and (<span 
class="cmmi-10">ψ,𝜃 </span>+ 2<span 
class="cmmi-10">π,ϕ</span>) correspond to the same spatial point, a real space continuous quantity
<span 
class="cmmi-10">f </span>expressed in terms of coordinates (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>), i.e., <span 
class="cmmi-10">f </span>= <span 
class="cmmi-10">f</span>(<span 
class="cmmi-10">ψ,𝜃,ϕ</span>), must satisfy the following periodic
conditions along <span 
class="cmmi-10">𝜃</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84001r345"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium448x.png" alt="f(ψ,𝜃 +2π,ϕ ) = f(ψ,𝜃,ϕ).
" class="math-display"  /></center></td><td class="equation-label">(345)</td></tr></table>
<!--l. 4164--><p class="nopar" >
Since (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) and (<span 
class="cmmi-10">ψ,𝜃,ϕ </span>+ 2<span 
class="cmmi-10">π</span>) correspond to the same spatial point, <span 
class="cmmi-10">f </span>must satisfy the following
periodic conditions along <span 
class="cmmi-10">ϕ</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84002r346"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium449x.png" alt="f(ψ,𝜃,ϕ +2π ) = f(ψ,𝜃,ϕ).
" class="math-display"  /></center></td><td class="equation-label">(346)</td></tr></table>
<!--l. 4170--><p class="nopar" >
Since (<span 
class="cmmi-10">ψ,𝜃,α</span>) and (<span 
class="cmmi-10">ψ,𝜃,α </span>+ 2<span 
class="cmmi-10">π</span>) correspond to the same spatial point, a real space continuous quantity
<span 
class="cmmi-10">g </span>expressed in terms of ﬁeld-line-following coordinates (<span 
class="cmmi-10">ψ,𝜃,α</span>), i.e., <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">ψ,𝜃,α</span>), must satisfy the
following periodic condition along <span 
class="cmmi-10">α</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84003r347"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium450x.png" alt="g(ψ,𝜃,α +2π ) = g(ψ,𝜃,α).
" class="math-display"  /></center></td><td class="equation-label">(347)</td></tr></table>
<!--l. 4178--><p class="nopar" >
However, generally there is no periodic condition along <span 
class="cmmi-10">𝜃</span>,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84004r348"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium451x.png" alt="g(ψ,𝜃+ 2π,α ) ⁄= g(ψ,𝜃,α),
" class="math-display"  /></center></td><td class="equation-label">(348)</td></tr></table>
<!--l. 4182--><p class="nopar" >
because <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">1</span></sub> = (<span 
class="cmmi-10">ψ,𝜃,α</span>) and <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub> = (<span 
class="cmmi-10">ψ,𝜃 </span>+ 2<span 
class="cmmi-10">π,α</span>) are generally not the same spatial point. In fact,
equation (<a 
href="#x1-78009r322">322<!--tex4ht:ref: 17-9-15-1 --></a>) implies, for point <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">1</span></sub>, its toroidal angle <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">1</span></sub> is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84005r349"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium452x.png" alt="        ∫ 𝜃B ⋅∇ ϕ
ϕ1 = α +   B-⋅∇-𝜃d𝜃,
         0
" class="math-display"  /></center></td><td class="equation-label">(349)</td></tr></table>
<!--l. 4190--><p class="nopar" >
while for point <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub>, its toroidal angle <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">2</span></sub> is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84006r350"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium453x.png" alt="        ∫ 𝜃+2π B ⋅∇ϕ
ϕ2 = α +       ------d𝜃 = ϕ1 + 2πq,
          0    B ⋅∇𝜃
" class="math-display"  /></center></td><td class="equation-label">(350)</td></tr></table>
<!--l. 4195--><p class="nopar" >
i.e., <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">1</span></sub> and <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmr-7">2</span></sub> are diﬀerent by 2<span 
class="cmmi-10">πq</span>. From this, we know that (<span 
class="cmmi-10">ψ,𝜃,α</span>) and (<span 
class="cmmi-10">ψ,𝜃 </span>+ 2<span 
class="cmmi-10">π,α </span><span 
class="cmsy-10">− </span>2<span 
class="cmmi-10">πq</span>)
correspond to the same spatial point. Therefore we have the following periodic condition:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84007r351"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium454x.png" alt="g(ψ,𝜃,α) = g(ψ, 𝜃+ 2π,α− 2πq),
" class="math-display"  /></center></td><td class="equation-label">(351)</td></tr></table>
<!--l. 4203--><p class="nopar" >
or equivalently
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-84008r352"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium455x.png" alt="g(ψ,𝜃 + 2π,α) = g(ψ,𝜃,α+ 2πq).
" class="math-display"  /></center></td><td class="equation-label">(352)</td></tr></table>
<!--l. 4208--><p class="nopar" >
                                                                                

                                                                                
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-8500015.5"></a>Numerical implementation of periodic condition (351)</h5>
<!--l. 4213--><p class="noindent" >For the fully kinetic ion module of GEM code that I am developing, <span 
class="cmmi-10">𝜃 </span>is chosen in the range [0 : 2<span 
class="cmmi-10">π</span>].
The condition (<a 
href="#x1-84008r352">352<!--tex4ht:ref: 21-9-30-1 --></a>) imposes the following boundary condition:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-85001r353"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium456x.png" alt="g(ψ,2π,α) = g(ψ,0,α + 2πq).
" class="math-display"  /></center></td><td class="equation-label">(353)</td></tr></table>
<!--l. 4218--><p class="nopar" >
If <span 
class="cmmi-10">α </span>is on a grid, <span 
class="cmmi-10">α </span>+ 2<span 
class="cmmi-10">πq </span>is usually not on a grid. Therefore, to get the value of <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">ψ,</span>0<span 
class="cmmi-10">,α </span>+ 2<span 
class="cmmi-10">πq</span>), an
interpolation of the discrete date over the generalized toroidal angle <span 
class="cmmi-10">α </span>(or equivalently <span 
class="cmmi-10">ϕ</span>) is needed, as
is shown in Fig. <a 
href="#x1-8500220">20<!--tex4ht:ref: 17-11-2-1 --></a>.
</p><!--l. 4225--><p class="indent" >    
</p><!--l. 4227--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8500220"></a>
                                                                                

                                                                                
<!--l. 4230--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2fr3/p.png" alt="pict"  
 width="250.9375pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 20: </span><span  
class="content">Twenty magnetic ﬁeld lines (on <span 
class="cmmi-10">ψ </span>= 0<span 
class="cmmi-10">.</span>2 magnetic surface) starting at diﬀerent toroidal
angle (blue points) on the midplane (<span 
class="cmmi-10">𝜃 </span>= 0) go a full poloidal loop (i.e., <span 
class="cmmi-10">Δ𝜃 </span>= 2<span 
class="cmmi-10">π</span>), arriving
at a toroidal angle (red points) which are diﬀerent from their respective starting toroidal angle.
The ﬁeld values on the red points can be obtained by interpolating the ﬁeld values on the blue
points. The safety factor of the magnetic surface <span 
class="cmmi-10">q </span>= 1<span 
class="cmmi-10">.</span>79. Magnetic ﬁeld from EAST discharge
#59954@3.03s.</span></div><!--tex4ht:label?: x1-8500220 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4241--><p class="indent" >    
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-8600015.5"></a><span 
class="cmmi-10">α </span>contours on a magnetic surface</h5>
<!--l. 4245--><p class="noindent" >Figure <a 
href="#x1-8600121">21<!--tex4ht:ref: 17-10-29-1 --></a> compares a small number of <span 
class="cmmi-10">ϕ </span>contours and <span 
class="cmmi-10">α </span>contours on a magnetic surface.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8600121"></a>
                                                                                

                                                                                
<!--l. 4249--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3e/p.png" alt="pict"  
 width="242.9075pt" />                             <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3d/p.png" alt="pict"  
 width="242.9075pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 21: </span><span  
class="content">Comparison between a series of <span 
class="cmmi-10">ϕ </span>contours (left) and a series of <span 
class="cmmi-10">α </span>contours (right) on
a magnetic surface. Here contour levels are <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmmi-7">j</span></sub> = <span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">j</span></sub> = (<span 
class="cmmi-10">j </span><span 
class="cmsy-10">− </span>1)2<span 
class="cmmi-10">π∕</span>4<span 
class="cmmi-10">∕</span>(10 <span 
class="cmsy-10">− </span>1) with <span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,</span>10,
i.e., only 1<span 
class="cmmi-10">∕</span>4 of the full torus. Every <span 
class="cmmi-10">ϕ </span>and <span 
class="cmmi-10">α </span>contour start from the lower-ﬁeld-side midplane
and go one poloidal loop.  Magnetic ﬁeld from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x1-8600121 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4258--><p class="indent" >   As is shown in the left panel of Fig. <a 
href="#x1-8600121">21<!--tex4ht:ref: 17-10-29-1 --></a>, with <span 
class="cmmi-10">ϕ </span>ﬁxed, an <span 
class="cmmi-10">𝜃 </span>curve reaches its starting
point when <span 
class="cmmi-10">𝜃 </span>changes from zero to 2<span 
class="cmmi-10">π</span>. However, as shown in the right panel of Fig. <a 
href="#x1-8600121">21<!--tex4ht:ref: 17-10-29-1 --></a>,
with <span 
class="cmmi-10">α </span>ﬁxed, an <span 
class="cmmi-10">𝜃 </span>curve (i.e. a magnetic ﬁeld line) does not necessarily reach its starting
point when <span 
class="cmmi-10">𝜃 </span>changes from zero to 2<span 
class="cmmi-10">π</span>. There is a toroidal shift, 2<span 
class="cmmi-10">πq</span>, between the starting
point and ending point. Therefore there is generally no periodic condition along <span 
class="cmmi-10">𝜃 </span>since
<span 
class="cmmi-10">q </span>is not always an integer. A mixed periodic condition involves both <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">α </span>is given in
(<a 
href="#x1-84007r351">351<!--tex4ht:ref: 17-11-2-p1 --></a>).
</p><!--l. 4268--><p class="indent" >   In ﬁeld-line-following coordinates (<span 
class="cmmi-10">ψ,𝜃,α</span>), a toroidal harmonic of a physical perturbation can be
written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-86002r354"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium457x.png" alt="δA (ψ,𝜃,α) = δA0(ψ)cos(m′𝜃+ nα + α0)
" class="math-display"  /></center></td><td class="equation-label">(354)</td></tr></table>
<!--l. 4273--><p class="nopar" >
where <span 
class="cmmi-10">n </span>is the toroidal mode number, <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′</span>, which is not necessary an integer, is introduced to
describe the variation along a ﬁeld line. The periodic condition given by Eq. (<a 
href="#x1-84007r351">351<!--tex4ht:ref: 17-11-2-p1 --></a>) requires
that
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-86003r355"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium458x.png" alt="cos(m ′𝜃+ n α+ α0) = cos[m′(𝜃 + 2π)+ n(α− 2πq) +α0 ],
" class="math-display"  /></center></td><td class="equation-label">(355)</td></tr></table>
<!--l. 4280--><p class="nopar" >
To satisfy the above condition, we can choose
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-86004r356"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium459x.png" alt="m′2π− n2πq = N 2π,
" class="math-display"  /></center></td><td class="equation-label">(356)</td></tr></table>
<!--l. 4284--><p class="nopar" >
where <span 
class="cmmi-10">N </span>is an arbitrary integer, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-86005r357"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium460x.png" alt="  ′
m  = N + nq.
" class="math-display"  /></center></td><td class="equation-label">(357)</td></tr></table>
<!--l. 4288--><p class="nopar" >
We are interested in perturbation with a slow variation along the ﬁeld line direction (i.e., along
<span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂𝜃</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ψ,α</span></sub>) and thus we want the value of <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′ </span>to be small. One of the possible small values given
by expression (<a 
href="#x1-86005r357">357<!--tex4ht:ref: 17-12-16-5 --></a>) is to choose <span 
class="cmmi-10">N </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">n </span><span 
class="cmsy-10">×</span> NINT((<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">max</span></sub> + <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">min</span></sub>)<span 
class="cmmi-10">∕</span>2), so that <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′ </span>is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-86006r358"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium461x.png" alt="                     ( q   + q   )
m ′(ψ ) = nq− n × NINT  -max---min- ,
                           2
" class="math-display"  /></center></td><td class="equation-label">(358)</td></tr></table>
<!--l. 4297--><p class="nopar" >
where NINT is a function that return the nearest integer of its argument, <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">max</span></sub> and <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">min</span></sub> is the maximal
and minimal value of the safety factor in the radial region in which we are interested. [In the past, I
choose <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">ψ</span>) = <span 
class="cmmi-10">nq </span><span 
class="cmsy-10">−</span> NINT(<span 
class="cmmi-10">nq</span>). However, <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">ψ</span>) in this case is not a continuous function of <span 
class="cmmi-10">ψ </span>and thus
is not physical.] This form is used to set the initial density perturbation in the fully kinetic code I am
                                                                                

                                                                                
developing. Note that <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′ </span>in Eq. (<a 
href="#x1-86006r358">358<!--tex4ht:ref: 18-5-4-p1 --></a>) depends on the radial coordinate <span 
class="cmmi-10">ψ </span>through <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span>). Also note that
<span 
class="cmmi-10">m</span><span 
class="cmsy-10">′ </span>here is diﬀerent from the poloidal mode number <span 
class="cmmi-10">m </span>in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinate system. It is ready to show
that the perturbation given by Eq. (<a 
href="#x1-86002r354">354<!--tex4ht:ref: 17-10-30-e1 --></a>) with <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′∼ </span>1 and <span 
class="cmmi-10">n </span><span 
class="cmsy-10">≫ </span>1 has large poloidal mode
number <span 
class="cmmi-10">m </span>when expressed in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates. [Proof: Expression (<a 
href="#x1-86002r354">354<!--tex4ht:ref: 17-10-30-e1 --></a>) can be written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-86007r359"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium462x.png" alt="δA = δA0 (ψ )cos[m′𝜃+ n(ϕ − δ(ψ,𝜃))+ α0]
" class="math-display"  /></center></td><td class="equation-label">(359)</td></tr></table>
<!--l. 4314--><p class="nopar" >
Assume that <span 
class="cmmi-10">𝜃 </span>is the straight-ﬁeld-line poloidal angle in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinate system, then <span class="overline"><span 
class="cmmi-10">δ</span></span>(<span 
class="cmmi-10">ψ,𝜃</span>) = <span 
class="cmmi-10">q𝜃</span>
and the above equation is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-86008r360"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium463x.png" alt="δA = δA0(ψ)cos[(m ′ − nq )𝜃 + nϕ+ α0],
" class="math-display"  /></center></td><td class="equation-label">(360)</td></tr></table>
<!--l. 4320--><p class="nopar" >
which indicates the poloidal mode number <span 
class="cmmi-10">m </span>in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates is given by <span 
class="cmmi-10">m </span>= <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′−</span><span 
class="cmmi-10">nq</span>. For the
case with <span 
class="cmmi-10">m</span><span 
class="cmsy-10">′∼ </span>1 and <span 
class="cmmi-10">n </span><span 
class="cmsy-10">≫ </span>1, <span 
class="cmmi-10">m </span>is much larger than one.]
</p><!--l. 4325--><p class="indent" >   Since <span 
class="cmmi-10">α </span>contours on a magnetic surface are magnetic ﬁeld lines, they span out the 3D shape of
magnetic surface when there are many <span 
class="cmmi-10">α </span>contours on a magnetic surface, as is shown by the right-panel
of Fig. <a 
href="#x1-8600922">22<!--tex4ht:ref: 17-10-29-e1 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8600922"></a>
                                                                                

                                                                                
<!--l. 4331--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3c/p.png" alt="pict"  
 width="242.9075pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3b/p.png" alt="pict"  
 width="242.9075pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 22: </span><span  
class="content">Comparison between a series of <span 
class="cmmi-10">ϕ </span>contours(left) and a series of <span 
class="cmmi-10">α </span>contours (left) on a
magnetic surface. The <span 
class="cmmi-10">α </span>contours correspond to magnetic ﬁeld lines. Here the <span 
class="cmmi-10">α </span>values of adjacent
<span 
class="cmmi-10">α </span>contours diﬀer by <span 
class="cmmi-10">dα </span>= 2<span 
class="cmmi-10">π∕</span>20 and each <span 
class="cmmi-10">α </span>contour goes one full poloidal loop. Magnetic ﬁeld
from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x1-8600922 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4340--><p class="indent" >    
</p><!--l. 4342--><p class="indent" >    
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-8700015.5"></a><span 
class="cmmi-10">α </span>contours in a toroidal annulus</h5>
<!--l. 4346--><p class="noindent" >Figure <a 
href="#x1-8700123">23<!--tex4ht:ref: 17-9-18-1 --></a> compares the <span 
class="cmmi-10">ϕ </span>coordinate surface of (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates with the <span 
class="cmmi-10">α </span>coordinate surface of
(<span 
class="cmmi-10">ψ,𝜃,α</span>) coordinates.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8700123"></a>
                                                                                

                                                                                
<!--l. 4351--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3g/p.png" alt="pict"  
 width="242.90749pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3f/p.png" alt="pict"  
 width="238.89249pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 23: </span><span  
class="content">Comparison between isosurface of <span 
class="cmmi-10">ϕ </span>= 2<span 
class="cmmi-10">π∕</span>8 (projection of magnetic ﬁeld lines onto
<span 
class="cmmi-10">ϕ </span>= 2<span 
class="cmmi-10">π∕</span>8 plane) and isosurface of <span 
class="cmmi-10">α </span>= 2<span 
class="cmmi-10">π∕</span>8. The <span 
class="cmmi-10">α </span>isosurface is made of a family of contours of
<span 
class="cmmi-10">α </span>= 2<span 
class="cmmi-10">π∕</span>8, which are all magnetic ﬁeld lines. These ﬁeld lines are traced by starting from a series
of points on the low-ﬁeld-side midplane (<span 
class="cmmi-10">𝜃 </span>= 0) at diﬀerent radial locations and the ﬁeld lines
are followed by one poloidal loop. The radial range is given by <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">N</span></sub> <span 
class="cmsy-10">∈ </span>[0<span 
class="cmmi-10">.</span>4 : 0<span 
class="cmmi-10">.</span>5], where <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">N</span></sub> is the
normalized poloidal magnetic ﬂux. Magnetic ﬁeld from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x1-8700123 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4363--><p class="indent" >    
</p><!--l. 4365--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8700224"></a>
                                                                                

                                                                                
<!--l. 4368--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3i/p.png" alt="pict"  
 width="242.90749pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3h/p.png" alt="pict"  
 width="263.98625pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 24: </span><span  
class="content">The same plot as in Fig. <a 
href="#x1-8700123">23<!--tex4ht:ref: 17-9-18-1 --></a> but with a larger radial range. <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">N</span></sub> <span 
class="cmsy-10">∈ </span>[0<span 
class="cmmi-10">.</span>4 : 0<span 
class="cmmi-10">.</span>7], where <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">N</span></sub>
is the normalized poloidal magnetic ﬂux.</span></div><!--tex4ht:label?: x1-8700224 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8700325"></a>
                                                                                

                                                                                
<!--l. 4375--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15c/p.png" alt="pict"  
 width="268.00125pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15d/p.png" alt="pict"  
 width="268.00125pt" />
</p><!--l. 4377--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15e/p.png" alt="pict"  
 width="266.9975pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15f/p.png" alt="pict"  
 width="266.9975pt" />
</p><!--l. 4379--><p class="noindent" > 
<br /> </p><div class="caption" 
><span class="id">Fig. 25: </span><span  
class="content">Values of <span 
class="cmmi-10">𝜃 </span>and <span class="overline"><span 
class="cmmi-10">δ</span></span> <span 
class="cmsy-10">≡</span><span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><img 
src="tokamak_equilibrium464x.png" alt="qˆ"  class="circ"  /> <span 
class="cmmi-10">d𝜃 </span>on an annulus in the poloidal plane (<span 
class="cmmi-10">R,Z</span>). Upper panel:
using magnetic coordinates. Lower panel: comparison with the results computed in cylindricall
coordinates. Both <span 
class="cmmi-10">𝜃 </span>and <span class="overline"><span 
class="cmmi-10">δ</span></span> are discontinuous at the <span 
class="cmmi-10">𝜃 </span>cut, <span 
class="cmmi-10">𝜃 </span>=  <span 
class="cmsy-10">±</span><span 
class="cmmi-10">π</span>, which is chosen on the
high-ﬁeld-side.</span></div><!--tex4ht:label?: x1-8700325 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4388--><p class="indent" >    
</p><!--l. 4390--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-8700426"></a>
                                                                                

                                                                                
<!--l. 4393--><p class="noindent" > <img 
src="my_figure/home/yj/theory/tek/etg_paper/grid/fig2/3.png" alt="pict"  
 width="401.5pt" />
</p><!--l. 4395--><p class="noindent" > 
</p><!--l. 4397--><p class="noindent" > <img 
src="my_figure/home/yj/theory/tek/etg_paper/grid/fig2/4.png" alt="pict"  
 width="401.5pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 26: </span><span  
class="content">Upper pannel: 2D grid (<span 
class="cmmi-10">ψ,𝜃</span>) of resolution (27<span 
class="cmmi-10">,</span>33) for a ﬁxed value of <span 
class="cmmi-10">α</span>. Lower pannel:
3D grid (<span 
class="cmmi-10">ψ,α,𝜃</span>) of resolution (27<span 
class="cmmi-10">,</span>4<span 
class="cmmi-10">,</span>33) for a toroidal wedge of 2<span 
class="cmmi-10">π∕</span>40. The blue lines are ﬁeld
lines. The 3D grid is generated by rotating the 2D grid toroidally. Only 3 ﬁeld-lines are shown
for both cases.</span></div><!--tex4ht:label?: x1-8700426 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4405--><p class="indent" >    
</p><!--l. 4407--><p class="indent" >    
</p><!--l. 4409--><p class="indent" >   The above grid is often called “ﬂux-tube”, since it is created by following ﬁeld lines, and it looks like
a tube if the ﬁeld lines are very near to each other (e.g., when we choose a very narrow radial and
toroidal region to start from). Since no magnetic ﬁeld line passes through the sides of the tube, the
ﬂux through any cross section of the tube is equal. The term “ﬂux tube” is often used in
astrophysics.
</p><!--l. 4416--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">15.6   </span> <a 
 id="x1-8800015.6"></a>Field-line-following mesh in gyrokinetic turbulence simulation codes</h4>
<!--l. 4421--><p class="noindent" >Most gyrokinetic simulation codes use ﬁeld-line-following coordinates in constructing spatial mesh. The
mesh is conceptually generated by the following three steps: (1) selecting some initial points; (2) tracing
out magnetic-ﬁeld-lines passing through these points; (3) choose the intersecting points of these
ﬁeld-lines with a series of chosen surfaces as the ﬁnal grid-points. The initial points and the chosen
surfaces diﬀer among various codes and thus the resulting grid diﬀers. Next, let us discuss some
examples.
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-8900015.6"></a>Mesh in GENE, GYRO, and GEM codes</h5>
<!--l. 4431--><p class="noindent" >Given the deﬁnition of (<span 
class="cmmi-10">ψ,𝜃</span>) coordinates, choose toroidally symmetrical points (can be a toroidal
wedge) in <span 
class="cmmi-10">𝜃 </span>= 0 plane (<span 
class="cmmi-10">𝜃 </span>= 0 plane is usually chosen to be the low-ﬁeld-side midplane). Then trace out
the magnetic-ﬁeld-lines passing through these points for one poloidal circuit (usually chosen in the
range <span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">∈ </span>[<span 
class="cmsy-10">−</span><span 
class="cmmi-10">π,π</span>]) and record the intersection points of these ﬁeld-lines with various <span 
class="cmmi-10">𝜃 </span>= const planes.
Note that the gridpoints in <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>plane usually do not coincide those in <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π </span>plane
due to the toroidal shift arising when the safety factor is irrational. Interpolation can be
used to map physical variables deﬁned on gridpoints in <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>plane to those in <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π</span>
plane.
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-9000015.6"></a>Mesh in GTC and GTS codes<span class="cite">[<a 
href="#Xwxwang2006">27</a>]</span></h5>
<!--l. 4445--><p class="noindent" >Given the deﬁnition of (<span 
class="cmmi-10">ψ,𝜃</span>) coordinates, 2D grid-points can be chosen on <span 
class="cmmi-10">ϕ </span>= 0 plane based on (<span 
class="cmmi-10">ψ,𝜃</span>)
coordinates. Then trace out the magnetic-ﬁeld-lines starting from these points for one toroidal circuit
and record the intersection points of these ﬁeld-lines with <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmmi-7">j</span></sub> = <span 
class="cmmi-10">jΔϕ </span>planes, where <span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N</span><sub><span 
class="cmmi-7">t</span></sub> <span 
class="cmsy-10">− </span>1,
<span 
class="cmmi-10">Δϕ </span>= 2<span 
class="cmmi-10">π∕</span>(<span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">t</span></sub> <span 
class="cmsy-10">− </span>1). It is obvious that the resulting mesh are not toroidally symmetrical.
And also the grids on <span 
class="cmmi-10">ϕ </span>= 0 plane diﬀer from those on <span 
class="cmmi-10">ϕ </span>= 2<span 
class="cmmi-10">π </span>plane. Interpolation can
be used to mapping physical variables deﬁned on grid-points of <span 
class="cmmi-10">ϕ </span>= 0 to those of <span 
class="cmmi-10">ϕ </span>= 2<span 
class="cmmi-10">π</span>
plane. In this case, the number of “toroidal grid-points” <span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">t</span></sub> (i.e., the number of poloidal
planes) is actually the number of grid-points in the parallel direction within one toroidal
circuit.
                                                                                

                                                                                
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-9100015.6"></a>Mesh in XGC1 code ***check**</h5>
<!--l. 4460--><p class="noindent" ><span 
class="cmtt-10">XGC1 </span>can handle the region outside of the LCFS. Here we only discuss the region inside the LCFS. At
each radial gridpoint on <span 
class="cmmi-10">ϕ </span>= 0 plane, follow the magnetic ﬁeld line starting form this point for one
poloidal loop and record the intersection points of this ﬁeld-line with <span 
class="cmmi-10">ϕ</span><sub><span 
class="cmmi-7">j</span></sub> = <span 
class="cmmi-10">jΔϕ </span>planes, where
<span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N</span><sub><span 
class="cmmi-7">t</span></sub>, <span 
class="cmmi-10">Δϕ </span>= 2<span 
class="cmmi-10">π∕N</span><sub><span 
class="cmmi-7">t</span></sub>. For the case <span 
class="cmmi-10">q &#x003E; </span>1, one magnetic-ﬁeld-line will have more than one
intersection points on some poloidal planes. Repeat tracing the ﬁeld line for each radial location.
Then project (toroidally) all the intersection points on diﬀerent poloidal planes to a single
poloidal plane and rotate (toroidally) these 2D grids to deﬁne a 3D grid that are toroidally
symmetrical.
</p><!--l. 4472--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">15.7   </span> <a 
 id="x1-9200015.7"></a>Numerical veriﬁcation of the ﬁeld-aligned coordinates</h4>
<!--l. 4474--><p class="noindent" >The generalized toroidal angle <span 
class="cmmi-10">α </span>is numerically calculated in my code. To verify <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α </span>= 0 along a
magnetic ﬁeld-line, ﬁgure <a 
href="#x1-9200127">27<!--tex4ht:ref: 17-10-2-p1 --></a> plots the values of <span 
class="cmmi-10">α </span>along a magnetic ﬁeld line, which indicates that <span 
class="cmmi-10">α </span>is
constant. This indicates the numerical implementation of the ﬁeld-aligned coordinates is
correct.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-9200127"></a>
                                                                                

                                                                                
<!--l. 4481--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/lorentz_ions/figures/fig4b/p.png" alt="pict"  
 width="102.38249pt" /> <img 
src="my_figure/home/yj/project_new/lorentz_ions/figures/fig4/p.png" alt="pict"  
 width="218.8175pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 27: </span><span  
class="content">Left: Projection of a ﬁeld line on the poloidal plane. Right: the value of <span 
class="cmmi-10">Δ </span>and <span 
class="cmmi-10">α </span>along
the magnetic ﬁeld line. Here <span 
class="cmmi-10">α </span>is deﬁned by <span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">Δ</span>, where <span 
class="cmmi-10">ϕ </span>is the usual cylindrical toroidal
angle and <span 
class="cmmi-10">Δ </span>= <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><img 
src="tokamak_equilibrium465x.png" alt="B⋅∇-ϕ
B⋅∇ 𝜃"  class="frac" align="middle" /><span 
class="cmmi-10">d𝜃</span>.</span></div><!--tex4ht:label?: x1-9200127 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4490--><p class="indent" >    
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-9300015.7"></a>Binormal wavenumber</h5>
<!--l. 4494--><p class="noindent" >Let us introduce the binormal wavenumber, which is frequently used in presenting turbulence
simulation results. Deﬁne the binormal direction <span 
class="cmbx-10">s </span>by
</p>
   <table 
class="equation-star"><tr><td>
                                  <span 
class="cmbx-10">s </span>= <img 
src="tokamak_equilibrium466x.png" alt="B-×-∇-Ψ-
|B × ∇ Ψ|"  class="frac" align="middle" /><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 4498--><p class="nopar" >
which is a unit vector lying on a magnetic surface and perpendicular to <span 
class="cmbx-10">B</span>. The binormal wavenumber
of a mode is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-93001r361"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium467x.png" alt="kbn = s⋅∇p,
" class="math-display"  /></center></td><td class="equation-label">(361)</td></tr></table>
<!--l. 4503--><p class="nopar" >
where <span 
class="cmmi-10">p </span>is the phase of the mode. Consider a mode given by exp(<span 
class="cmmi-10">ik</span><sub><span 
class="cmmi-7">ψ</span></sub><span 
class="cmmi-10">ψ </span>+ <span 
class="cmmi-10">im𝜃 </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">inζ</span>), then the phase
<span 
class="cmmi-10">p </span>= <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub><span 
class="cmmi-10">ψ </span>+ <span 
class="cmmi-10">m𝜃 </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">nζ</span>. Then <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">bn</span></sub> is written as </p><div class="eqnarray">
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium468x.png" alt="kbn = B-×-∇-Ψ-⋅∇ (kψ ψ+ m 𝜃− nζ)
      |B × ∇ Ψ|
      B-×-∇-Ψ-
   =  |B × ∇ Ψ| ⋅∇ (m 𝜃 − n ζ),                       (362)
" class="math-display"  /></center>
</div>where the radial phase <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">ψ</span></sub><span 
class="cmmi-10">ψ </span>does not appear since <span 
class="cmbx-10">B </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ψ </span>= 0. The above expression can be
further written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium469x.png" alt="kbn =----1--- [mB  × ∇Ψ ⋅∇ 𝜃− nB × ∇Ψ ⋅∇ ζ]
     |B × ∇Ψ |
     ----1---
   = |B × ∇Ψ |[mB  ⋅∇Ψ × ∇ 𝜃− nB ⋅∇Ψ × ∇ ζ]
        nB⋅   [m                   ]
   = |B-×-∇Ψ-| n-∇Ψ × ∇ 𝜃− ∇ Ψ × ∇ ζ .                  (363)
" class="math-display"  /><a 
 id="x1-93003r363"></a></center>
</div>Equation (<a 
href="#x1-93003r363">363<!--tex4ht:ref: 18-8-23-1 --></a>) is the general expression of the binormal wavenumber. On the resonant surface of the
mode, i.e., <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">ψ</span>) = <span 
class="cmmi-10">m∕n</span>, then the above expression is written as
   <table 
class="equation"><tr><td><a 
 id="x1-93004r364"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium470x.png" alt="       nB ⋅
kbn = |B-×∇-Ψ|[q∇Ψ × ∇𝜃 − ∇Ψ × ∇ ζ].
" class="math-display"  /></center></td><td class="equation-label">(364)</td></tr></table>
<!--l. 4533--><p class="nopar" >
Using Eq. (<a 
href="#x1-68003r284">284<!--tex4ht:ref: 18-8-22-p1 --></a>), i.e., <span 
class="cmbx-10">B </span>= <span 
class="cmsy-10">−</span>(<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ζ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">Ψ </span>+ <span 
class="cmmi-10">q</span><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃</span>), the above expression is written as
</p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium471x.png" alt="       − nB⋅
kbn = |B-×-∇-Ψ|B

   = − n-B---
        |∇Ψ |
" class="math-display"  /></center>
</div>Using <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span><span 
class="cmmi-10">∕R</span>, the above equation is written
   <table 
class="equation"><tr><td><a 
 id="x1-93006r365"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium472x.png" alt="kbn = − n-B--
        RBp
" class="math-display"  /></center></td><td class="equation-label">(365)</td></tr></table>
<!--l. 4545--><p class="nopar" >
which indicates the binormal wavenumber generally depends on the poloidal angle. For large
aspect-ratio tokamak, we have <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">B</span>, <span 
class="cmmi-10">q </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmmi-10">r∕</span>(<span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">R</span>). Then Eq. (<a 
href="#x1-93006r365">365<!--tex4ht:ref: 17-11-3-1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-93007r366"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium473x.png" alt="       nq
kbn ≈ − --,
       r
" class="math-display"  /></center></td><td class="equation-label">(366)</td></tr></table>
<!--l. 4551--><p class="nopar" >
which indicates the binormal wavenumber are approximately independent of the poloidal angle. Since
<span 
class="cmmi-10">m </span>= <span 
class="cmmi-10">nq </span>on a resonant surface, the above equation is written <span 
class="cmsy-10">|</span><span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">bn</span></sub><span 
class="cmsy-10">|≈ </span><span 
class="cmmi-10">m∕r</span>, which is the usual poloidal
wave number. Due to this relation, the binormal wavenumber <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">bn</span></sub> is often called the poloidal
wavenumber and denoted by <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">𝜃</span></sub> in papers on tokamak turbulence. In the GENE code, <span 
class="cmmi-10">y </span>coordinate is
deﬁned by <span 
class="cmmi-10">y </span>= <span 
class="cmmi-10">αr</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕q</span><sub><span 
class="cmr-7">0</span></sub>. Then the <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> of a mode of toroidal mode number <span 
class="cmmi-10">n </span>is given by <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> = 2<span 
class="cmmi-10">π∕λ</span><sub><span 
class="cmmi-7">y</span></sub>
                                                                                

                                                                                
where <span 
class="cmmi-10">λ</span><sub><span 
class="cmmi-7">y</span></sub> = <span 
class="cmmi-10">λ</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕q</span><sub><span 
class="cmr-7">0</span></sub> and <span 
class="cmmi-10">λ</span><sub><span 
class="cmmi-7">α</span></sub> = 2<span 
class="cmmi-10">π∕n</span>. Then <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> is written as <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> = <span 
class="cmmi-10">nq</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕r</span><sub><span 
class="cmr-7">0</span></sub>, which is similar
to the binormal deﬁned above. For this reason, <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">y</span></sub> of GENE code is also called binormal
wave-vector, which is in fact not reasonable because neither <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂y </span>or <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y </span>is along the binormal
direction.
</p><!--l. 4566--><p class="indent" >    
</p><!--l. 4569--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">16   </span> <a 
 id="x1-9400016"></a>Concentric-circular magnetic conﬁguration with a given safety factor proﬁle</h3>
<!--l. 4571--><p class="noindent" >Assume magnetic surfaces of a magnetic conﬁguration are known and given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94001r367"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium474x.png" alt="R (r,𝜃) = R0 + rcos𝜃,
" class="math-display"  /></center></td><td class="equation-label">(367)</td></tr></table>
<!--l. 4574--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94002r368"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium475x.png" alt="Z(r,𝜃) = rsin 𝜃,
" class="math-display"  /></center></td><td class="equation-label">(368)</td></tr></table>
<!--l. 4577--><p class="nopar" >
where (<span 
class="cmmi-10">r,𝜃</span>) are two parameters and <span 
class="cmmi-10">r </span>is magnetic surface label (i.e., <span 
class="cmmi-10">∂Ψ∕∂𝜃</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">r</span></sub> = 0). The above
parametric equations specify a series of concentric-circular magnetic surfaces.
</p><!--l. 4583--><p class="indent" >   Assume the toroidal ﬁeld function <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">r</span>) = <span 
class="cmmi-10">RB</span><sub><span 
class="cmmi-7">ϕ</span></sub> is given. Then the toroidal magnetic ﬁeld is
determined by <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmmi-10">g∕R</span>. Further assume the safety factor proﬁle <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">r</span>) is given, then the magnetic ﬁeld
is fully determined. Next, let us derive the explicit form of the poloidal magnetic ﬁeld <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub>, which is
given by
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-94003r369"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium476x.png" alt="                1--
Bp = ∇ Ψ × ∇ ϕ = 2π∇ Ψp × ∇ ϕ,
" class="math-display"  /></center></td><td class="equation-label">(369)</td></tr></table>
<!--l. 4591--><p class="nopar" >
which involves the poloidal magnetic ﬂux <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub>. Therefore our task is to express <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub> in terms of <span 
class="cmmi-10">q </span>and <span 
class="cmmi-10">g</span>.
Using <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">r</span>) = <span 
class="cmmi-10">dΨ</span><sub><span 
class="cmmi-7">t</span></sub><span 
class="cmmi-10">∕dΨ</span><sub><span 
class="cmmi-7">p</span></sub>, we obtain
</p>
   <table 
class="equation-star"><tr><td>
                                  <span 
class="cmmi-10">dΨ</span><sub><span 
class="cmmi-7">p</span></sub> = <img 
src="tokamak_equilibrium477x.png" alt="1
q"  class="frac" align="middle" /><span 
class="cmmi-10">dΨ</span><sub><span 
class="cmmi-7">t</span></sub><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 4595--><p class="nopar" >
Integrate the above equation over <span 
class="cmmi-10">r</span>, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94004r370"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium478x.png" alt="∫ r      ∫ r1
   dΨp =    -dΨt,
 0        0 q
" class="math-display"  /></center></td><td class="equation-label">(370)</td></tr></table>
<!--l. 4599--><p class="nopar" >
which an be written as
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94005r371"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium479x.png" alt="              ∫ r 1   (∫ r∫ π        )
Ψp(r)− Ψp(0) =    ----d        Bϕrdrd𝜃  ,
               0 q(r)   0  − π
" class="math-display"  /></center></td><td class="equation-label">(371)</td></tr></table>
<!--l. 4604--><p class="nopar" >
where use has been made of <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">t</span></sub> = <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">r</span></sup> <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmsy-7">−</span><span 
class="cmmi-7">π</span></sub><sup><span 
class="cmmi-7">π</span></sup><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmmi-10">rdrd𝜃</span>. Using <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmmi-10">g∕R </span>and <span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> + <span 
class="cmmi-10">r</span> cos<span 
class="cmmi-10">𝜃</span>, the above
equation is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94006r372"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium480x.png" alt="              ∫       ( ∫  ∫                 )
                r -1--    r  π ----g-----
Ψp (r)− Ψp(0) = 0  q(r)d   0  −π R0 + r cos𝜃 rdrd𝜃
" class="math-display"  /></center></td><td class="equation-label">(372)</td></tr></table>
<!--l. 4612--><p class="nopar" >
Using <span 
class="cmtt-10">maxima </span>(an open-source computer algebra system), the above integration over <span 
class="cmmi-10">𝜃 </span>can be
performed analytically, giving
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94007r373"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium481x.png" alt="∫ π     1            2π
    ----------d𝜃 = ∘--2---2.
 −π R0 + r cos𝜃      R 0 − r
" class="math-display"  /></center></td><td class="equation-label">(373)</td></tr></table>
                                                                                

                                                                                
<!--l. 4618--><p class="nopar" >
Using this, equation (<a 
href="#x1-94006r372">372<!--tex4ht:ref: 17-11-21-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94008r374"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium482x.png" alt="                      (              )
              ∫ r 1    ∫ r   2πgr
Ψp(r)− Ψp(0) =    q(r)d      ∘--2---2dr  ,
               0        0   R 0 − r
" class="math-display"  /></center></td><td class="equation-label">(374)</td></tr></table>
<!--l. 4623--><p class="nopar" >
which can be simpliﬁed as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94009r375"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium483x.png" alt="              ∫ r 1    2πgr
Ψp(r) − Ψp(0) =    q(r)-∘--2---2dr.
               0       R0 − r
" class="math-display"  /></center></td><td class="equation-label">(375)</td></tr></table>
<!--l. 4628--><p class="nopar" >
This is what we want—the expression of the poloidal magnetic ﬂux in terms of <span 
class="cmmi-10">q </span>and <span 
class="cmmi-10">g</span>. [Another way
of obtaining Eq. (<a 
href="#x1-94009r375">375<!--tex4ht:ref: 17-11-21-e3 --></a>) is to use Eq. (<a 
href="#x1-48001r182">182<!--tex4ht:ref: 7-11-p1 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94010r376"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium484x.png" alt="dΨ     g ∫ 2π 𝒥
--p= − -     -2d𝜃,
dr     q  0  R
" class="math-display"  /></center></td><td class="equation-label">(376)</td></tr></table>
                                                                                

                                                                                
<!--l. 4635--><p class="nopar" >
where <span 
class="cmsy-10">𝒥 </span>is the Jacobian of the (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates and is given by <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">R</span>(<span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">𝜃</span></sub><span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">r</span></sub> <span 
class="cmsy-10">−</span><span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">r</span></sub><span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">𝜃</span></sub>) = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">Rr</span>. Then
Eq. (<a 
href="#x1-94010r376">376<!--tex4ht:ref: 19-5-9-p1 --></a>) is simpliﬁed as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94011r377"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium485x.png" alt="       ∫ 2π        ∫ 2π
dΨp-= g     rd𝜃 = g     ----r-----d𝜃 = g r∘-2π---,
dr    q 0   R     q  0  R0 + r cos𝜃    q    R20 − r2
" class="math-display"  /></center></td><td class="equation-label">(377)</td></tr></table>
<!--l. 4643--><p class="nopar" >
which, after being integrated over <span 
class="cmmi-10">r</span>, gives Eq. (<a 
href="#x1-94009r375">375<!--tex4ht:ref: 17-11-21-e3 --></a>).]
</p><!--l. 4646--><p class="indent" >   Using Eq. (<a 
href="#x1-94009r375">375<!--tex4ht:ref: 17-11-21-e3 --></a>), the poloidal magnetic ﬁeld in Eq. (<a 
href="#x1-94003r369">369<!--tex4ht:ref: 17-11-21-6 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium486x.png" alt="                (                  )
      ∇r×-∇-ϕ-∂-- ∫ r-1----2πgr---
Bp =    2π    ∂r   0 q(r) ∘R2-−-r2dr
                            0
   = ∇r × ∇ ϕ-1--∘--gr---.                            (378)
             q(r)  R20 − r2
" class="math-display"  /><a 
 id="x1-94012r378"></a></center>
</div>[Using the formulas <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">r </span>= <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium487x.png" alt="R𝒥-"  class="frac" align="middle" />(<span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">𝜃</span></sub><img 
src="tokamak_equilibrium488x.png" alt="Rˆ"  class="circ"  /><span 
class="cmsy-10">−</span><span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">𝜃</span></sub><img 
src="tokamak_equilibrium489x.png" alt="ˆZ"  class="circ"  />) and <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmmi-10">R</span>(<span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">𝜃</span></sub><span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">r</span></sub> <span 
class="cmsy-10">−</span><span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">r</span></sub><span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">𝜃</span></sub>), where <span 
class="cmsy-10">𝒥 </span>is the Jacobian of the
(<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates, we obtain <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">Rr </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">r </span>= cos<span 
class="cmmi-10">𝜃</span><img 
src="tokamak_equilibrium490x.png" alt="Rˆ"  class="circ"  /> + sin<span 
class="cmmi-10">𝜃</span><img 
src="tokamak_equilibrium491x.png" alt="ˆZ"  class="circ"  />, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>= <img 
src="tokamak_equilibrium492x.png" alt="ˆϕ"  class="circ"  /><span 
class="cmmi-10">∕R</span>. Then Eq. (<a 
href="#x1-94012r378">378<!--tex4ht:ref: 17-11-21-e1 --></a>) is
written as
   <table 
class="equation"><tr><td><a 
 id="x1-94013r379"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium493x.png" alt="     cos𝜃ˆZ-−-sin-𝜃ˆR -1-----gr---
Bp =       R       q(r)∘R2--−-r2
                          0
" class="math-display"  /></center></td><td class="equation-label">(379)</td></tr></table>
<!--l. 4664--><p class="nopar" >
This is the explicit form of the poloidal magnetic ﬁeld in terms of <span 
class="cmmi-10">g </span>and <span 
class="cmmi-10">q</span>. The magnitude of <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> is
written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-94014r380"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium494x.png" alt="          1       1     gr
Bp = ----------------∘--2---2-
     (R0 + rcos𝜃)q(r)  R 0 − r
" class="math-display"  /></center></td><td class="equation-label">(380)</td></tr></table>
<!--l. 4670--><p class="nopar" >
Note that both <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub> and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> depend on the poloidal angle <span 
class="cmmi-10">𝜃</span>.]
</p><!--l. 4673--><p class="indent" >   I use Eq. (<a 
href="#x1-94009r375">375<!--tex4ht:ref: 17-11-21-e3 --></a>) to compute the 2D data of <span 
class="cmmi-10">Ψ </span>(<span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕</span>2<span 
class="cmmi-10">π</span>) on the poloidal plane when
creating a numerical G-eqdsk ﬁle for the above magnetic conﬁguration (Fortran code is at
<span 
class="cmtt-10">/home/yj/project</span><span 
class="cmtt-10">_new/circular</span><span 
class="cmtt-10">_configuration</span><span 
class="cmtt-10">_with</span><span 
class="cmtt-10">_q</span><span 
class="cmtt-10">_given</span>).
</p><!--l. 4678--><p class="indent" >   Assume that the poloidal plasma current is zero, then <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">r</span>) = <span 
class="cmmi-10">RB</span><sub><span 
class="cmmi-7">ϕ</span></sub> is a constant independent of <span 
class="cmmi-10">r</span>.
This is always assumed by the authors who use concentric-circular conﬁguration but is seldom explicitly
mentioned.
</p><!--l. 4682--><p class="indent" >   In analytical work, 1<span 
class="cmmi-10">∕R </span>dependence on (<span 
class="cmmi-10">r,𝜃</span>) is often approximated as
</p>
   <table 
class="equation-star"><tr><td>
                  <img 
src="tokamak_equilibrium495x.png" alt="1
--
R"  class="frac" align="middle" /> = <img 
src="tokamak_equilibrium496x.png" alt="    1
----------
R0 + r cos𝜃"  class="frac" align="middle" /> = <img 
src="tokamak_equilibrium497x.png" alt=" 1
---
R0"  class="frac" align="middle" /><img 
src="tokamak_equilibrium498x.png" alt="    1
---------
1+ 𝜀 cos𝜃"  class="frac" align="middle" /> <span 
class="cmsy-10">≈</span><img 
src="tokamak_equilibrium499x.png" alt=" 1
---
R0"  class="frac" align="middle" />(1 <span 
class="cmsy-10">− </span><span 
class="cmmi-10">𝜀</span>cos<span 
class="cmmi-10">𝜃</span>)<span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 4686--><p class="nopar" >
where <span 
class="cmmi-10">𝜀 </span>= <span 
class="cmmi-10">r∕R</span><sub><span 
class="cmr-7">0</span></sub> is the local inverse aspect ratio.
                                                                                

                                                                                
</p><!--l. 4689--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">16.1   </span> <a 
 id="x1-9500016.1"></a>Is the above <span 
class="cmbx-10">B </span>divergence-free?</h4>
<!--l. 4691--><p class="noindent" >Since the above ﬁeld is derived from the general form given by Eq. (<a 
href="#x1-5001r10">10<!--tex4ht:ref: 7-28-6 --></a>), it is guaranteed
that the ﬁeld is divergence-free. In case of any doubt, let us directly verify this. Write <span 
class="cmbx-10">B</span>
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-95001r381"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium500x.png" alt="B = B (1)𝒥∇ 𝜃× ∇ ϕ+ B (2)𝒥∇ ϕ× ∇r + B (3)𝒥∇r × ∇ 𝜃,
" class="math-display"  /></center></td><td class="equation-label">(381)</td></tr></table>
<!--l. 4698--><p class="nopar" >
where <span 
class="cmsy-10">𝒥 </span>is the Jacobian of (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates; <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(1)</span></sup>, <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(2)</span></sup>, and <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(3)</span></sup> are given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-95002r382"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium501x.png" alt="B(1) = B ⋅∇r
" class="math-display"  /></center></td><td class="equation-label">(382)</td></tr></table>
<!--l. 4703--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-95003r383"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium502x.png" alt="B(2) = B ⋅∇𝜃
" class="math-display"  /></center></td><td class="equation-label">(383)</td></tr></table>
<!--l. 4706--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-95004r384"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium503x.png" alt=" (3)
B   = B ⋅∇ϕ
" class="math-display"  /></center></td><td class="equation-label">(384)</td></tr></table>
<!--l. 4709--><p class="nopar" >
Use <span 
class="cmbx-10">B</span><sub><span 
class="cmmi-7">p</span></sub> given by (<a 
href="#x1-94012r378">378<!--tex4ht:ref: 17-11-21-e1 --></a>), then <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(1)</span></sup>, <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(2)</span></sup>, and <span 
class="cmmi-10">B</span><sup><span 
class="cmr-7">(3)</span></sup> are written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-95005r385"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium504x.png" alt="B(1) = 0,
" class="math-display"  /></center></td><td class="equation-label">(385)</td></tr></table>
<!--l. 4714--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-95006r386"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium505x.png" alt="B (2) = − 1-1--∘--g0r--,
        𝒥 q(r)  R20 − r2
" class="math-display"  /></center></td><td class="equation-label">(386)</td></tr></table>
<!--l. 4718--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-95007r387"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium506x.png" alt="      B
B(3) =--ϕ,
       R
" class="math-display"  /></center></td><td class="equation-label">(387)</td></tr></table>
<!--l. 4722--><p class="nopar" >
respectively. Then, by using the divergence formula in (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates, <span 
class="cmsy-10">∇⋅ </span><span 
class="cmbx-10">B </span>is written as
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium507x.png" alt="         (                          )
∇ ⋅B = 1-  ∂B-(1)𝒥-+ ∂B-(2)𝒥-+ ∂B-(3)𝒥-
       𝒥     ∂r       ∂𝜃       ∂ϕ
       1 (    ∂B (2)𝒥    )
     = 𝒥-  0+ --∂𝜃---+ 0
            (              )
     = 1--∂- − -1--∘--g0r----
       𝒥 ∂𝜃    q(r)  R20 − r2
     = 0                                              (388)
" class="math-display"  /></center>
</div>i.e., <span 
class="cmbx-10">B </span>in this case is indeed divergence-free.
                                                                                

                                                                                
<!--l. 4738--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">16.2   </span> <a 
 id="x1-9600016.2"></a>Is the above <span 
class="cmbx-10">B </span>a solution to the GS equation?</h4>
<!--l. 4740--><p class="noindent" >The answer is no. It is ready to verify that the poloidal magnetic ﬂux function <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕</span>2<span 
class="cmmi-10">π </span>given by Eq.
(<a 
href="#x1-94009r375">375<!--tex4ht:ref: 17-11-21-e3 --></a>) is not a solution to the GS equation (<a 
href="#x1-139013r612">612<!--tex4ht:ref: 9-17-e5 --></a>) even if the plasma pressure in the GS equation is set to
zero. The above expression is a solution to the GS equation in the limit of inﬁnite aspect
ratio and zero plasma pressure. The ﬁnite aspect ratio and plasma pressure requires the
magnetic surfaces to have the Shafranov shift in order to satisfy the GS equation (see Sec.
<a 
href="#x1-137000A.14">A.14<!--tex4ht:ref: 17-11-22-p1 --></a>).
</p><!--l. 4749--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">16.3   </span> <a 
 id="x1-9700016.3"></a>Explicit expression for the generalized toroidal angle</h4>
<!--l. 4751--><p class="noindent" >For the above magnetic ﬁeld, the toroidal shift involved in the deﬁnition of the generalized toroidal
angle can be expressed in simple analytical form. The toroidal shift is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97001r389"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium508x.png" alt="-  ∫ 𝜃
δ = 0 ˆqd𝜃,
" class="math-display"  /></center></td><td class="equation-label">(389)</td></tr></table>
<!--l. 4756--><p class="nopar" >
where the local safety factor <img 
src="tokamak_equilibrium509x.png" alt="qˆ"  class="circ"  /> can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97002r390"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium510x.png" alt="      g 𝒥
ˆq = −--02--′.
     R  Ψ
" class="math-display"  /></center></td><td class="equation-label">(390)</td></tr></table>
<!--l. 4760--><p class="nopar" >
Using <span 
class="cmsy-10">𝒥 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">Rr </span>and
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97003r391"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium511x.png" alt=" ′   -1----g0r----
Ψ  = q(r) ∘R2-−-r2
            0
" class="math-display"  /></center></td><td class="equation-label">(391)</td></tr></table>
<!--l. 4764--><p class="nopar" >
The local safety factor <img 
src="tokamak_equilibrium512x.png" alt="ˆq"  class="circ"  /> in Eq. (<a 
href="#x1-97002r390">390<!--tex4ht:ref: 18-1-5-p1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97004r392"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium513x.png" alt="    ∘ --2---2 1
ˆq = q R 0 − r R .
" class="math-display"  /></center></td><td class="equation-label">(392)</td></tr></table>
<!--l. 4768--><p class="nopar" >
Using this, expression (<a 
href="#x1-97001r389">389<!--tex4ht:ref: 17-12-5-1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97005r393"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium514x.png" alt="-   ∘ -------∫ 𝜃1
δ = q R20 − r2    --d𝜃
              0 R
" class="math-display"  /></center></td><td class="equation-label">(393)</td></tr></table>
<!--l. 4773--><p class="nopar" >
Assume <span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">∈ </span>(<span 
class="cmsy-10">−</span><span 
class="cmmi-10">π,π</span>), then the integration <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup>1<span 
class="cmmi-10">∕Rd𝜃 </span>can be analytically performed (using maxima),
yielding
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97006r394"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium515x.png" alt="                 (             )
                  ---sin𝜃(R0−r)--
∫ 𝜃 1     2arctan  (cos𝜃+1)√R20−r2
   R-d𝜃 = -------∘R2--− r2-------.
 0                  0
" class="math-display"  /></center></td><td class="equation-label">(394)</td></tr></table>
<!--l. 4780--><p class="nopar" >
Then expression (<a 
href="#x1-97005r393">393<!--tex4ht:ref: 17-12-5-2 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97007r395"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium516x.png" alt="-          (             (  ))
δ = 2q arctan ∘(R02−-r)-tan  𝜃    ,
               R0 − r2    2
" class="math-display"  /></center></td><td class="equation-label">(395)</td></tr></table>
<!--l. 4785--><p class="nopar" >
where use has been made of sin<span 
class="cmmi-10">𝜃∕</span>(cos<span 
class="cmmi-10">𝜃 </span>+ 1) = tan(<span 
class="cmmi-10">𝜃∕</span>2). Using this, the generalized toroidal angle can
be written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium517x.png" alt="       -
α = ϕ− δ       (                 )
                 (R0 − r)    (𝜃)
  = ϕ− 2qarctan  ∘R2-−-r2-tan  2    .                 (396)
                    0
" class="math-display"  /><a 
 id="x1-97008r396"></a></center>
                                                                                

                                                                                
</div>The results given by the formula (<a 
href="#x1-97007r395">395<!--tex4ht:ref: 17-12-5-5 --></a>) are compared with the results from my code that assumes a
general numerical conﬁguration. The results from the two methods agree with each other, as is shown
in Fig. <a 
href="#x1-9700928">28<!--tex4ht:ref: 17-12-5-8 --></a>, which provides conﬁdence in both the analytical formula and the numerical
code.
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-9700928"></a>
                                                                                

                                                                                
<!--l. 4800--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig19/p.png" alt="pict"  
 width="218.8175pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 28: </span><span  
class="content">The results of <span class="overline"><span 
class="cmmi-10">δ</span></span> = <span 
class="cmex-10">∫</span>
  <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><img 
src="tokamak_equilibrium518x.png" alt="qˆ"  class="circ"  /> <span 
class="cmmi-10">d𝜃 </span>computed by using formula (<a 
href="#x1-97007r395">395<!--tex4ht:ref: 17-12-5-5 --></a>) and the numerical code
agree with each other. The diﬀerent lines correspond to values of <span class="overline"><span 
class="cmmi-10">δ</span></span> on diﬀerent magnetic surfaces.
In the numerical code, two kinds of poloidal angles can be selected: one is the equal-volume
poloidal angle, and another is the equal-arch-length angle. Make sure that the latter is selected
when doing the comparison because the the poloidal angle <span 
class="cmmi-10">𝜃 </span>appearing in the analytical formula
is the equal-arc-length poloidal angle.</span></div><!--tex4ht:label?: x1-9700928 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 4812--><p class="indent" >   In passing, we note that the straight-ﬁeld-line poloidal angle <span 
class="cmmi-10">𝜃</span><sub><span 
class="cmmi-7">f</span></sub> can also be considered to be deﬁned
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97010r397"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium519x.png" alt="α = ϕ − q𝜃f,
" class="math-display"  /></center></td><td class="equation-label">(397)</td></tr></table>
<!--l. 4816--><p class="nopar" >
i.,e,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97011r398"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium520x.png" alt="               -
     1         δ
𝜃f = q(ϕ − α ) = q.
" class="math-display"  /></center></td><td class="equation-label">(398)</td></tr></table>
<!--l. 4820--><p class="nopar" >
Then using Eq. (<a 
href="#x1-97008r396">396<!--tex4ht:ref: 18-9-11-a1 --></a>), <span 
class="cmmi-10">𝜃</span><sub><span 
class="cmmi-7">f</span></sub> is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-97012r399"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium521x.png" alt="           (                 )
              (R0 − r)    (𝜃 )
𝜃f = 2 arctan ∘--2---2-tan  2    ,
               R0 − r
" class="math-display"  /></center></td><td class="equation-label">(399)</td></tr></table>
                                                                                

                                                                                
<!--l. 4825--><p class="nopar" >
which agrees with Eq. (A2) in Gorler’s paper<span class="cite">[<a 
href="#Xgorler2016">13</a>]</span>.
</p>
   <h4 class="subsectionHead"><span class="titlemark">16.4   </span> <a 
 id="x1-9800016.4"></a>Metric elements</h4>
<!--l. 4830--><p class="noindent" >Let <span 
class="cmmi-10">ψ </span>= <span 
class="cmmi-10">r </span>and deﬁne <span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">ψR</span></sup> = <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">⋅</span><img 
src="tokamak_equilibrium522x.png" alt="Rˆ"  class="circ"  />, <span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">αR</span></sup> = <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">α</span><span 
class="cmsy-10">⋅</span><img 
src="tokamak_equilibrium523x.png" alt="ˆR"  class="circ"  />, etc. Explicit expressions for these elements can be
written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium524x.png" alt="hψR = ∇ψ ⋅ ˆR
    = ∇r ⋅ ˆR
       R-   ˆ      ˆ  ˆ
    = −𝒥 (Z𝜃R − R 𝜃Z )⋅R
       R
    = −𝒥-Z 𝜃
    = cos 𝜃                                     (400)
" class="math-display"  /></center>
</div><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium525x.png" alt="hψZ = ∇ψ ⋅ ˆZ
          ˆ
    = ∇r ⋅Z
    = − R(Z𝜃Rˆ− R 𝜃ˆZ)⋅ ˆZ
        𝒥
    = R-R𝜃
      𝒥
    = sin𝜃
" class="math-display"  /></center>
</div><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium526x.png" alt=" ψϕ       ˆ
h   = ∇ψ ⋅ϕ
    = 0
" class="math-display"  /></center>
</div>
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium527x.png" alt="h𝜃R = ∇ 𝜃⋅ ˆR
    = R-(ZψRˆ− R ψˆZ)⋅Rˆ
      𝒥
    = R-Z
      𝒥  ψ
        1
    = − r sin 𝜃
" class="math-display"  /></center>
</div><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium528x.png" alt="h 𝜃Z = ∇ 𝜃⋅ ˆZ
      R-    ˆ     ˆ   ˆ
    = 𝒥 (ZψR − R ψZ)⋅Z
        R-
    = − 𝒥 Rψ
      1
    = r cos𝜃
                                                                                

                                                                                
" class="math-display"  /></center>
</div><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium529x.png" alt="h𝜃ϕ = ∇𝜃 ⋅ ˆϕ

    = 0
" class="math-display"  /></center>
</div><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium530x.png" alt="h αR = ∇ α ⋅ ˆR
      [ ˆ   (  -        -     )    (  -         -     )  ]
    =   ϕ-+  -∂δR-Z𝜃 − ∂δR-Zψ  Rˆ+   ∂δ-RR ψ − ∂δR-R 𝜃 ˆZ  ⋅ ˆR
        R    ∂ψ 𝒥      ∂𝜃𝒥           ∂𝜃𝒥       ∂ψ𝒥
       ∂δ R     ∂δ R
    =  ∂ψ𝒥-Z 𝜃 − ∂𝜃-𝒥 Z ψ
        -           -
    =  ∂δ-Rr cos𝜃 − ∂δ-R sin𝜃
       ∂ψ𝒥         ∂𝜃𝒥
        ∂δ-      ∂-δ1
    = − ∂ψ cos𝜃+ ∂ 𝜃r sin𝜃
        ∂δ        1
    = − ---cos 𝜃+ ˆq-sin𝜃
        ∂r        r
" class="math-display"  /></center>
</div><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium531x.png" alt="hαZ = ∇[ α ⋅ ˆZ                                           ]
       ˆϕ   ( ∂δR      ∂δ R   )    ( ∂δ R      ∂δ R   )
   =   R-+  ∂-ψ𝒥-Z 𝜃 − ∂𝜃𝒥-Z ψ ˆR +  ∂𝜃-𝒥-Rψ − ∂ψ-𝒥 R 𝜃 Zˆ ⋅ ˆZ
       -         -
      ∂δR-     ∂-δR-
   =  ∂𝜃𝒥 R ψ − ∂ψ 𝒥 R𝜃
        1       ∂δ
   = − ˆq- cos𝜃 − ---sin𝜃
        r       ∂r
" class="math-display"  /></center>
</div>
   <table 
class="equation"><tr><td><a 
 id="x1-98009r401"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium532x.png" alt="      1
hαϕ = R-.
" class="math-display"  /></center></td><td class="equation-label">(401)</td></tr></table>
<!--l. 4909--><p class="nopar" >
Using expression (<a 
href="#x1-97007r395">395<!--tex4ht:ref: 17-12-5-5 --></a>), <span 
class="cmmi-10">d</span><span class="overline"><span 
class="cmmi-10">δ</span></span><span 
class="cmmi-10">∕dr </span>can be evaluated analytically, yielding </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium533x.png" alt=" -            (             ( ) )                            (  )    [        ]
dδ = 2dqarctan  (∘R0-−-r)-tan  𝜃    + 2q---(-----1-------)--tan  𝜃  -d  (∘R0-−-r)-
dr    dr          R20 − r2    2             (√R0−r)-  ( 𝜃) 2     2  dr    R20 − r2
                                      1+    R20−r2 tan 2
              (             ( ) )
   = 2dqarctan  (∘R0-−-r)-tan  𝜃
      dr          R20 − r2    2
                1             ( 𝜃)       − R0
   + 2q---(----------(--))2-tan  2  (R--+r)∘R2--−-r2
       1+   (√RR02−−rr)2 tan 𝜃2             0       0
              0
" class="math-display"  /></center>
</div>where use has been made of
                                                                                

                                                                                
   <table 
class="equation-star"><tr><td>
                              <img 
src="tokamak_equilibrium534x.png" alt="d
---
dx"  class="frac" align="middle" />arctan(<span 
class="cmmi-10">x</span>) = <img 
src="tokamak_equilibrium535x.png" alt="  1
----2-
1+ x"  class="frac" align="middle" />
</td></tr></table>
<!--l. 4925--><p class="nopar" >
(I did not remember this formula and I use SymPy to obtain this.) These expressions are used to
benchmark the numerical code that assume general ﬂux surface shapes. The results show that the code
gives correct result when concentric circular ﬂux surfaces are used.
</p><!--l. 4931--><p class="indent" >    
</p><!--l. 4933--><p class="indent" >   Taking the <span 
class="cmmi-10">𝜃 </span>derivative of <span class="overline"><span 
class="cmmi-10">δ</span></span>, equation (<a 
href="#x1-97007r395">395<!--tex4ht:ref: 17-12-5-5 --></a>) is written as (using Sympy)
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-98011r402"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium536x.png" alt="∂δ      ( tan2(𝜃)   1)       1
--=  2qA   -----2-+  -  -2---2(𝜃)----
∂𝜃           2      2  A tan  2  + 1
" class="math-display"  /></center></td><td class="equation-label">(402)</td></tr></table>
<!--l. 4939--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-98012r403"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium537x.png" alt="A = ∘(R0-− r)
      R20 − r2
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(403)</td></tr></table>
<!--l. 4943--><p class="nopar" >
Equation (<a 
href="#x1-97004r392">392<!--tex4ht:ref: 18-4-30-e1 --></a>) should be equal to <img 
src="tokamak_equilibrium538x.png" alt="qˆ"  class="circ"  /> given by Eq. (<a 
href="#x1-97004r392">392<!--tex4ht:ref: 18-4-30-e1 --></a>). This was veriﬁed numerically.
</p><!--l. 4947--><p class="indent" >    
</p><!--l. 4949--><p class="indent" >   Taking the <span 
class="cmmi-10">r </span>derivative of Eq. (<a 
href="#x1-94009r375">375<!--tex4ht:ref: 17-11-21-e3 --></a>), we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-98013r404"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium539x.png" alt="dΨp=  -1-∘-2πg0r--
dr    q(r)  R20 − r2
" class="math-display"  /></center></td><td class="equation-label">(404)</td></tr></table>
<!--l. 4953--><p class="nopar" >
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-98014r405"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium540x.png" alt="dΨ-= -1--∘--g0r---.
dr   q(r)  R20 − r2
" class="math-display"  /></center></td><td class="equation-label">(405)</td></tr></table>
<!--l. 4957--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-98015r406"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium541x.png" alt="dψ-=  ----1------1--∘--g0r--.
 dr   Ψ(a)− Ψ(0)q(r)  R20 − r2
" class="math-display"  /></center></td><td class="equation-label">(406)</td></tr></table>
<!--l. 4962--><p class="nopar" >
</p><!--l. 4965--><p class="indent" >    
</p><!--l. 4967--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-9801629"></a>
                                                                                

                                                                                
<!--l. 4970--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig31/p.png" alt="pict"  
 width="259.97125pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig31b/p.png" alt="pict"  
 width="255.95625pt" />
</p><!--l. 4972--><p class="noindent" > 
<br /> </p><div class="caption" 
><span class="id">Fig. 29: </span><span  
class="content"><span 
class="cmmi-10">∂</span><span class="overline"><span 
class="cmmi-10">δ</span></span><span 
class="cmmi-10">∕∂𝜃 </span>and <span 
class="cmmi-10">∂</span><span class="overline"><span 
class="cmmi-10">δ</span></span><span 
class="cmmi-10">∕∂ψ</span>. Numerical and analytical results are plotted, which are so close to
each other that they can not be distinguished by eyes. <span 
class="cmmi-10">∂</span><span class="overline"><span 
class="cmmi-10">δ</span></span><span 
class="cmmi-10">∕∂𝜃 </span>is equal to the local safety factor
<img 
src="tokamak_equilibrium542x.png" alt="ˆq"  class="circ"  />. Note that <span 
class="cmmi-10">∂</span><span class="overline"><span 
class="cmmi-10">δ</span></span><span 
class="cmmi-10">∕∂ψ </span>is discontinuous at the <span 
class="cmmi-10">𝜃 </span>cut, which in this case is on the high-ﬁeld-side.</span></div><!--tex4ht:label?: x1-9801629 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">16.5   </span> <a 
 id="x1-9900016.5"></a>Safety factor proﬁle</h4>
<!--l. 4984--><p class="noindent" >The magnetic shear for a concentric-circular conﬁguration is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-99001r407"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium543x.png" alt="ˆs = dq r,
   dr q
" class="math-display"  /></center></td><td class="equation-label">(407)</td></tr></table>
<!--l. 4987--><p class="nopar" >
where <span 
class="cmmi-10">r </span>is the minor radius of a magnetic surface. The above expression can be re-arranged
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-99002r408"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium544x.png" alt=" dr   dq
ˆsr =  q
" class="math-display"  /></center></td><td class="equation-label">(408)</td></tr></table>
<!--l. 4992--><p class="nopar" >
Integrating the above equation over <span 
class="cmmi-10">r </span>and assuming <span 
class="cmmi-10">ŝ</span> is a constant, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-99003r409"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium545x.png" alt=" ∫       ∫
   r dr    r dq
ˆs r0 r =  r0 q ,
" class="math-display"  /></center></td><td class="equation-label">(409)</td></tr></table>
<!--l. 4997--><p class="nopar" >
Performing the integration, the above equation is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-99004r410"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium546x.png" alt="ˆs(ln r− ln r ) = ln q− ln q ,
          0           0
" class="math-display"  /></center></td><td class="equation-label">(410)</td></tr></table>
<!--l. 5001--><p class="nopar" >
where <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> = <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub>). Equation (<a 
href="#x1-99004r410">410<!--tex4ht:ref: 17-11-21-4 --></a>) can be ﬁnally written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-99005r411"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium547x.png" alt="     ( r )ˆs
q = q0 r-  .
        0
" class="math-display"  /></center></td><td class="equation-label">(411)</td></tr></table>
<!--l. 5005--><p class="nopar" >
This is a proﬁle with a constant magnetic shear <span 
class="cmmi-10">s</span>. In Ben’s toroidal ITG simulation, the following <span 
class="cmmi-10">q</span>
proﬁle is used:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-99006r412"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium548x.png" alt="q = q0 + (r − r0)q′(r0),
" class="math-display"  /></center></td><td class="equation-label">(412)</td></tr></table>
<!--l. 5010--><p class="nopar" >
with <span 
class="cmmi-10">q</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub>) = <span 
class="cmmi-10">ŝ</span><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕r</span><sub><span 
class="cmr-7">0</span></sub>. This is a linear proﬁle over <span 
class="cmmi-10">r</span>, with the values of <span 
class="cmmi-10">q </span>and the shear at <span 
class="cmmi-10">r </span>= <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub> being
<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> and <span 
class="cmmi-10">ŝ</span>, respectively.
</p><!--l. 5015--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">17   </span> <a 
 id="x1-10000017"></a>Fixed boundary tokamak equilibrium problem</h3>
<!--l. 5017--><p class="noindent" >The ﬁxed boundary equilibrium problem (also called the “inverse equilibrium problem” by some
authors) refers to the case where the shape of a boundary magnetic surface is given and one is asked to
solve the equilibrium within this magnetic surface. To make it convenient to deal with the shape of the
boundary, one usually uses a general coordinates system which has one coordinate surface coinciding
with the given magnetic surface. This makes it trivial to deal with the irregular boundary.
To obtain the equilibrium, one needs to solve the GS equation in the general coordinate
system.
</p><!--l. 5026--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.1   </span> <a 
 id="x1-10100017.1"></a>Toroidal elliptic operator in general coordinates</h4>
<!--l. 5028--><p class="noindent" >Next we derive the form of the GS equation in a general coordinate system. The main task is to derive
the form of the toroidal elliptic operator in the general coordinate system. The toroidal elliptic operator
takes the form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-101001r413"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium549x.png" alt="            (  1   )
△ ∗Ψ ≡ R2∇ ⋅  -2∇ Ψ
              R
" class="math-display"  /></center></td><td class="equation-label">(413)</td></tr></table>
<!--l. 5034--><p class="nopar" >
For an arbitrary general coordinate system (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) (the (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinate system here is an arbitrary
general coordinate system except that <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>is perpendicular to both <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>), the toroidal elliptic
operator is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-101002r414"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium550x.png" alt="        2 {[          ]    [         ]   [              ]   [           ]  }
△ ⋆Ψ = R--  Ψ ψ 𝒥2|∇ ψ|2  +  Ψ𝜃 𝒥2-|∇ 𝜃|2 +  Ψψ 𝒥2(∇ ψ⋅∇ 𝜃)  +  Ψ𝜃 𝒥-2∇𝜃 ⋅∇ψ   ,
       𝒥       R       ψ      R       𝜃      R           𝜃     R         ψ
" class="math-display"  /></center></td><td class="equation-label">(414)</td></tr></table>
<!--l. 5047--><p class="nopar" >
where the subscripts denotes partial derivatives, <span 
class="cmsy-10">𝒥 </span>is the Jacobian of the coordinate system (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>).
[Next, we provide the proof of Eq. (<a 
href="#x1-101002r414">414<!--tex4ht:ref: 4-23-4 --></a>). The gradient of <span 
class="cmmi-10">Ψ </span>is written as (note that <span 
class="cmmi-10">Ψ </span>is independent of
<span 
class="cmmi-10">ϕ</span>)
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-101003r415"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium551x.png" alt="∇ Ψ = ∂Ψ∇ ψ + ∂Ψ-∇𝜃
      ∂ψ      ∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(415)</td></tr></table>
<!--l. 5055--><p class="nopar" >
Using this expression and the divergence formula (<a 
href="#x1-40003r132">132<!--tex4ht:ref: 6-8-e5 --></a>), the elliptic operator in Eq. (<a 
href="#x1-101001r413">413<!--tex4ht:ref: 4-23-5 --></a>) is written
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium552x.png" alt="            (                   )
△ ∗Ψ = R2 ∇ ⋅ -1-∂Ψ-∇ψ + -1-∂Ψ-∇𝜃
             R2 ∂ψ      R2 ∂𝜃
        2 1-∂-(  -1-∂Ψ-           -1-∂Ψ-      )
    = R  𝒥 ∂ψ  𝒥 R2 ∂ψ ∇ψ ⋅∇ ψ+ 𝒥 R2 ∂𝜃 ∇𝜃 ⋅∇ ψ
         1 ∂  (   1 ∂Ψ            1 ∂Ψ       )
    + R2 ----- 𝒥 -2---∇ ψ ⋅∇𝜃 +𝒥 --2---∇𝜃 ⋅∇𝜃
         𝒥[ ∂(𝜃    R  ∂ψ)    (     R  ∂𝜃  )    (            )    (         ) ]
       R2-    -𝒥-    2        -𝒥-                𝒥--              -𝒥-   2
    =  𝒥    ΨψR2 |∇ψ|  ψ +  Ψ𝜃R2 ∇ ψ⋅∇ 𝜃 ψ +  Ψψ R2∇ ψ⋅∇ 𝜃 𝜃 +  Ψ𝜃R2 |∇ 𝜃| (𝜃41,6)
" class="math-display"  /></center>
</div>which is Eq. (<a 
href="#x1-101002r414">414<!--tex4ht:ref: 4-23-4 --></a>).]
<!--l. 5079--><p class="indent" >   Using Eq. (<a 
href="#x1-101002r414">414<!--tex4ht:ref: 4-23-4 --></a>), the GS equation (<a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-101005r417"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium553x.png" alt="   [(          )    (          )   (            )    (             ) ]
R2-     𝒥--   2         𝒥--   2        𝒥--               -𝒥-                 2 dP- dg-
𝒥    Ψ ψR2|∇ ψ|  ψ +  Ψ𝜃R2|∇𝜃|  𝜃 +  Ψ𝜃R2 ∇ψ ⋅∇𝜃  ψ +  ΨψR2 ∇ψ ⋅∇ 𝜃 𝜃 =  − μ0R dΨ− dΨ g,
" class="math-display"  /></center></td><td class="equation-label">(417)</td></tr></table>
<!--l. 5088--><p class="nopar" >
which is the form of the GS equation in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinate system.
</p><!--l. 5093--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.2   </span> <a 
 id="x1-10200017.2"></a>Finite diﬀerence form of toroidal elliptic operator in general coordinate system</h4>
<!--l. 5095--><p class="noindent" >The toroidal elliptic operator in Eq. (<a 
href="#x1-101002r414">414<!--tex4ht:ref: 4-23-4 --></a>) can be written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102001r418"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium554x.png" alt="  ∗    R2-  ψψ         𝜃𝜃        ψ𝜃        ψ𝜃
△  Ψ = 𝒥  [(h  Ψψ)ψ + (h  Ψ𝜃)𝜃 + (h Ψ𝜃)ψ + (h Ψψ)𝜃],
" class="math-display"  /></center></td><td class="equation-label">(418)</td></tr></table>
<!--l. 5100--><p class="nopar" >
where <span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">aβ</span></sup> is deﬁned by Eq. (<a 
href="#x1-45005r173">173<!--tex4ht:ref: 4-25-e20 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102002r419"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium555x.png" alt="hαβ = 𝒥-∇ α⋅∇ β.
      R2
" class="math-display"  /></center></td><td class="equation-label">(419)</td></tr></table>
<!--l. 5105--><p class="nopar" >
Next, we derive the ﬁnite diﬀerence form of the toroidal elliptic operator. The ﬁnite diﬀerence form of
the term (<span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">ψψ</span></sup><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">ψ</span></sub>)<sub><span 
class="cmmi-7">ψ</span></sub> is written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium556x.png" alt="  ψψ          1 [ ψψ    ( Ψi,j+1 − Ψi,j)    ψψ   ( Ψi,j − Ψi,j−1) ]
(h  Ψψ)ψ|i,j = δψ hi,j+1∕2  ----δψ------ − hi,j− 1∕2  ----δψ-----
               ψψ                   ψψ
           = H i,j+1∕2(Ψi,j+1 − Ψi,j)− H i,j− 1∕2(Ψi,j − Ψi,j−1),          (420)
" class="math-display"  /></center>
</div>where
   <table 
class="equation"><tr><td><a 
 id="x1-102004r421"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium557x.png" alt=" ψψ   -hψψ-
H   = (δψ)2.
" class="math-display"  /></center></td><td class="equation-label">(421)</td></tr></table>
<!--l. 5121--><p class="nopar" >
The ﬁnite diﬀerence form of (<span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">𝜃𝜃</span></sup><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">𝜃</span></sub>)<sub><span 
class="cmmi-7">𝜃</span></sub> is written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium558x.png" alt="              [       (           )          (           )]
(h𝜃𝜃Ψ ) |  = 1- h 𝜃𝜃      Ψi+1,j −-Ψi,j − h𝜃𝜃     Ψi,j-−-Ψi−1,j
    𝜃 𝜃i,j   δ𝜃   i+1∕2,j      δ𝜃         i−1∕2,j      δ𝜃
          = H 𝜃𝜃    (Ψi+1,j − Ψi,j)− H𝜃𝜃    (Ψi,j − Ψi−1,j),             (422)
             i+1∕2,j               i−1∕2,j
" class="math-display"  /></center>
</div>where
   <table 
class="equation"><tr><td><a 
 id="x1-102006r423"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium559x.png" alt="       h𝜃𝜃
H 𝜃𝜃 =----2.
      (δ𝜃)
" class="math-display"  /></center></td><td class="equation-label">(423)</td></tr></table>
<!--l. 5136--><p class="nopar" >
The ﬁnite diﬀerence form of (<span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">ψ𝜃</span></sup><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">𝜃</span></sub>)<sub><span 
class="cmmi-7">ψ</span></sub> is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102007r424"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium560x.png" alt="                [       (                    )         (                    )]
(Ψ hψ𝜃) ||  = -1- hψ𝜃     Ψi+1,j+1∕2 −-Ψi−1,j+1∕2 − hψ𝜃      Ψi+1,j−-1∕2 −-Ψi−1,j−1∕2  .
  𝜃    ψ i,j  δψ   i,j+1∕2          2δ𝜃             i,j−1∕2          2δ𝜃
" class="math-display"  /></center></td><td class="equation-label">(424)</td></tr></table>
<!--l. 5145--><p class="nopar" >
Approximating the value of <span 
class="cmmi-10">Ψ </span>at the grid centers by the average of the value of <span 
class="cmmi-10">Ψ </span>at the neighbor grid
points, Eq. (<a 
href="#x1-102007r424">424<!--tex4ht:ref: 4-27-e1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102008r425"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium561x.png" alt="(Ψ𝜃hψ𝜃)ψ|i,j = H ψ𝜃  (Ψi+1,j+Ψi+1,j+1− Ψi−1,j− Ψi−1,j+1)− H ψ𝜃  (Ψi+1,j− 1+ Ψi+1,j− Ψi−1,j−1− Ψi− 1,j).
              i,j+1∕2                                 i,j−1∕2
" class="math-display"  /></center></td><td class="equation-label">(425)</td></tr></table>
<!--l. 5153--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102009r426"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium562x.png" alt="  ψ𝜃   -hψ𝜃--
H    = 4δψd𝜃.
" class="math-display"  /></center></td><td class="equation-label">(426)</td></tr></table>
<!--l. 5158--><p class="nopar" >
Similarly, the ﬁnite diﬀerence form of (<span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">ψ𝜃</span></sup><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">ψ</span></sub>)<sub><span 
class="cmmi-7">𝜃</span></sub> is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium563x.png" alt="               [       (                    )         (                    )]
(Ψ hψ𝜃)|  =  1- hψ𝜃     Ψi+1∕2,j+1 −-Ψi+1∕2,j−1 − hψ𝜃      Ψi−-1∕2,j+1 −-Ψi−1∕2,j−1
  ψ    𝜃i,j   δ𝜃   i+1∕2,j         2δψ             i−1∕2,j          2δψ
          = H ψ𝜃   (Ψi+1,j+1 + Ψi,j+1 − Ψi+1,j−1 − Ψi,j−1) − H ψ𝜃 (Ψi,j+1 + Ψi−1,j+1 − Ψi,j−1 − Ψi− 1,(j−4217).)
              i+1∕2,j                                    i−1∕2,j
" class="math-display"  /></center>
</div>Using the above results, the ﬁnite diﬀerence form of the operator <span 
class="cmsy-10">𝒥△</span><sup><span 
class="cmmi-7">⋆</span></sup><span 
class="cmmi-10">Ψ∕R</span><sup><span 
class="cmr-7">2</span></sup> is written as
<div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium564x.png" alt=" 𝒥     ||
R2-△∗Ψ ||  = (h ψ𝜃Ψ 𝜃)ψ + (h ψψΨψ)ψ + (h𝜃𝜃Ψ𝜃)𝜃 + (h ψ𝜃Ψ ψ)𝜃
       i,j
          = Hψiψ,j+1∕2(Ψi,j+1 − Ψi,j) − Hψiψ,j−1∕2(Ψi,j − Ψi,j−1)
          + H𝜃𝜃    (Ψ     − Ψ ) − H𝜃𝜃   (Ψ   − Ψ   )
             i+1∕2,j i+1,j    i,j    i−1∕2,j i,j    i−1,j
          + Hψi𝜃,j+1∕2(Ψi+1,j + Ψi+1,j+1 − Ψi− 1,j − Ψi−1,j+1)− Hiψ,j𝜃−1∕2(Ψi+1,j−1 + Ψi+1,j − Ψi− 1,j−1 − Ψi−1,j)
             ψ𝜃                                        ψ𝜃
          + Hi+1∕2,j(Ψi+1,j+1 +Ψi,j+1 − Ψi+1,j− 1 − Ψi,j−1)− Hi−1∕2,j(Ψi,j+1 + Ψi− 1,j+1 − Ψi− 1,j−1 − Ψi,j−1)
          = Ψi,j(− Hiψ,jψ+1∕2 − H ψi,ψj− 1∕2 − H 𝜃i+𝜃1∕2,j − H 𝜃i𝜃−1∕2,j)
                     ψ𝜃       ψ𝜃              ψψ       ψ𝜃       ψ𝜃
          + Ψi− 1,j−1(H i,j−1∕2 +H i−1∕2,j) +Ψi,j−1(H i,j− 1∕2 − H i+1∕2,j +H i−1∕2,j)
          + Ψi+1,j− 1(− H ψ𝜃   − H ψ𝜃   )+ Ψi−1,j(H𝜃i𝜃−1∕2,j − Hψ 𝜃  + H ψ𝜃   )
                   𝜃𝜃 i,j−1∕2ψ𝜃  i+1∕2,jψ𝜃                 iψ,j𝜃+1∕2   i,jψ−𝜃1∕2
          + Ψi+1,j(H i+1∕2,j + Hi,j+1∕2 − Hi,j−1∕2)+ Ψi− 1,j+1(− Hi,j+1∕2 − Hi−1∕2,j)
          + Ψ    (H ψψ    + Hψ𝜃    − Hψ𝜃    )+ Ψ     (H ψ𝜃   + H ψ𝜃   )
             i,j+1  i,j+1∕2    i+1∕2,j   i−1∕2,j    i+1,j+1   i,j+1∕2    i+1∕2,j
" class="math-display"  /></center>
</div>The coeﬃcients are given by
   <table 
class="equation"><tr><td><a 
 id="x1-102012r428"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium565x.png" alt="       𝒥         1
hψψ = --2|∇ ψ|2 =--(R2𝜃 + Z2𝜃),
      R         𝒥
" class="math-display"  /></center></td><td class="equation-label">(428)</td></tr></table>
                                                                                

                                                                                
<!--l. 5211--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102013r429"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium566x.png" alt="h𝜃𝜃 = 𝒥2|∇ 𝜃|2 = 1(R2ψ + Z2ψ ),
      R         𝒥
" class="math-display"  /></center></td><td class="equation-label">(429)</td></tr></table>
<!--l. 5215--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102014r430"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium567x.png" alt=" ψ𝜃   𝒥--          -1
h   = R2∇ ψ ⋅∇𝜃 = −𝒥 (R𝜃R ψ + Z 𝜃Z ψ),
" class="math-display"  /></center></td><td class="equation-label">(430)</td></tr></table>
<!--l. 5220--><p class="nopar" >
where the Jacobian
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-102015r431"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium568x.png" alt="𝒥 = R (R 𝜃Zψ − R ψZ𝜃).
" class="math-display"  /></center></td><td class="equation-label">(431)</td></tr></table>
                                                                                

                                                                                
<!--l. 5224--><p class="nopar" >
The partial derivatives, <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">𝜃</span></sub>, <span 
class="cmmi-10">R</span><sub><span 
class="cmmi-7">ψ</span></sub>, <span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">𝜃</span></sub>, and <span 
class="cmmi-10">Z</span><sub><span 
class="cmmi-7">ψ</span></sub>, appearing in Eqs. (<a 
href="#x1-102012r428">428<!--tex4ht:ref: 7-5-1 --></a>)-(<a 
href="#x1-102015r431">431<!--tex4ht:ref: 7-5-2 --></a>) are calculated by using the
central diﬀerence scheme. The values of <span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">ψψ</span></sup>, <span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">𝜃𝜃</span></sup>, <span 
class="cmmi-10">h</span><sup><span 
class="cmmi-7">ψ𝜃</span></sup> and <span 
class="cmsy-10">𝒥 </span>at the middle points are approximated by
the linear average of their values at the neighbor grid points.
</p><!--l. 5232--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.3   </span> <a 
 id="x1-10300017.3"></a>Special treatment at coordinate origin, wrong! to be deleted</h4>
   <table 
class="equation"><tr><td><a 
 id="x1-103001r432"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium569x.png" alt="Ψ ≈ a00 + a10R + a01Z + a11RZ + a20R2 + a02Z2.
" class="math-display"  /></center></td><td class="equation-label">(432)</td></tr></table>
<!--l. 5237--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-103002r433"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium570x.png" alt="           ∘ --
R = R0 + b11 ψ cos𝜃
" class="math-display"  /></center></td><td class="equation-label">(433)</td></tr></table>
<!--l. 5240--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-103003r434"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium571x.png" alt="            --
Z = Z0 + c11∘ ψ sin 𝜃
" class="math-display"  /></center></td><td class="equation-label">(434)</td></tr></table>
<!--l. 5243--><p class="nopar" >
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium572x.png" alt="            (       ∘ --   )        ∘ --        (       ∘ --    )  ∘ --         (       ∘ --   )2      (  ∘ --   )2
Ψ ≈ a00 + a10  R0 + b11 ψcos𝜃  + a01c11  ψsin 𝜃+ a11 R0 + b11  ψ cos𝜃 c11 ψ sin 𝜃+ a20 R0 + b11  ψ cos𝜃   + a02 c11  ψ sin𝜃
                     ∘ --           ∘ --             ∘--            ∘ --  ∘ --                                       ∘ --
  = a00 + a10R0 + a10b11  ψcos𝜃 + a01c11  ψsin 𝜃+ a11R0c11 ψ sin 𝜃+ 1a11b11 ψc11  ψ sin2𝜃 +2a20R20 + a20(b11)2ψ cos2𝜃 + 2a20R0b11 ψ cos𝜃 + a02(c11)2ψ sin2𝜃
          ∘ --       ∘ --                                     2
  = d0 + d1 ψcos𝜃+ d2  ψ sin𝜃 + d3ψsin 2𝜃+ d4ψ cos2𝜃 + d5ψ sin2 𝜃
" class="math-display"  /></center>
</div>
   <table 
class="equation-star"><tr><td>
                          <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">d</span><sub><span 
class="cmr-7">0</span></sub> + <span 
class="cmmi-10">d</span><sub><span 
class="cmr-7">1</span></sub><img 
src="tokamak_equilibrium573x.png" alt="∘ --
  ψ"  class="sqrt"  />cos<span 
class="cmmi-10">𝜃 </span>+ <span 
class="cmmi-10">d</span><sub><span 
class="cmr-7">2</span></sub><img 
src="tokamak_equilibrium574x.png" alt="∘ --
  ψ"  class="sqrt"  />sin<span 
class="cmmi-10">𝜃</span>
</td></tr></table>
<!--l. 5261--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-103005r435"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium575x.png" alt="R = R  +b11∘ ψcos𝜃 + b12∘ ψ-cos2𝜃 + b21( ∘ψ-)2cos𝜃+ b22(∘ ψ)2 cos2𝜃
     0
" class="math-display"  /></center></td><td class="equation-label">(435)</td></tr></table>
<!--l. 5267--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-103006r436"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium576x.png" alt="          11∘ --       12∘ --       21(∘ --)2       22 (∘ -)2
Z = Z0 + c   ψ sin𝜃 + c   ψ sin2𝜃 + c    ψ   sin 𝜃+ c     ψ  sin2𝜃
" class="math-display"  /></center></td><td class="equation-label">(436)</td></tr></table>
<!--l. 5272--><p class="nopar" >
</p><!--l. 5274--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.4   </span> <a 
 id="x1-10400017.4"></a>Pressure and toroidal ﬁeld function proﬁle</h4>
<!--l. 5276--><p class="noindent" >The function <span 
class="cmmi-10">p</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>) in the GS equation are free functions which must be speciﬁed by users
before solving the GS equation. Next, we discuss one way to specify the free functions. Following Ref.
<span class="cite">[<a 
href="#Xjardin2010">16</a>]</span>,  we take <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>) to be of the forms
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104001r437"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium577x.png" alt="                     --
P(Ψ) = P0 − (P0 − Pb)ˆp(Ψ),
" class="math-display"  /></center></td><td class="equation-label">(437)</td></tr></table>
<!--l. 5282--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104002r438"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium578x.png" alt="1 2     1  2      --
2g (Ψ) = 2 g0(1 − γ ˆg(Ψ )),
" class="math-display"  /></center></td><td class="equation-label">(438)</td></tr></table>
<!--l. 5286--><p class="nopar" >
with <img 
src="tokamak_equilibrium579x.png" alt="ˆp"  class="circ"  /> and <span 
class="cmmi-10">ĝ</span> chosen to be of polynomial form:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104003r439"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium580x.png" alt="ˆp(Ψ) = Ψ-α,
" class="math-display"  /></center></td><td class="equation-label">(439)</td></tr></table>
<!--l. 5290--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104004r440"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium581x.png" alt="  --  --β
ˆg(Ψ) = Ψ ,
" class="math-display"  /></center></td><td class="equation-label">(440)</td></tr></table>
<!--l. 5293--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104005r441"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium582x.png" alt="Ψ-≡ Ψ-−-Ψa-,
    Ψb − Ψa
" class="math-display"  /></center></td><td class="equation-label">(441)</td></tr></table>
<!--l. 5297--><p class="nopar" >
with <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub> the value of <span 
class="cmmi-10">Ψ </span>on the boundary, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">a</span></sub> the value of <span 
class="cmmi-10">Ψ </span>on the magnetic axis, <span 
class="cmmi-10">α</span>, <span 
class="cmmi-10">β</span>, <span 
class="cmmi-10">γ</span>, <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub>, <span 
class="cmmi-10">P</span><sub><span 
class="cmmi-7">b</span></sub>, and
<span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">0</span></sub> are free parameters. Using the proﬁles of <span 
class="cmmi-10">P </span>and <span 
class="cmmi-10">g </span>given by Eqs. (<a 
href="#x1-104001r437">437<!--tex4ht:ref: 4-28-p1 --></a>) and (<a 
href="#x1-104002r438">438<!--tex4ht:ref: 4-28-p2 --></a>), we
obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104006r442"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium583x.png" alt="                     --
dP-(Ψ-)= − 1-(P0 − Pb)αΨα−1
  dΨ      Δ
" class="math-display"  /></center></td><td class="equation-label">(442)</td></tr></table>
<!--l. 5305--><p class="nopar" >
where <span 
class="cmmi-10">Δ </span>= <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">a</span></sub>, and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104007r443"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium584x.png" alt="  dg     1   1  -β−1
g ---= − -g20γ--βΨ   .
  dΨ     2   Δ
" class="math-display"  /></center></td><td class="equation-label">(443)</td></tr></table>
<!--l. 5310--><p class="nopar" >
Then the term on the r.h.s (nonlinear source term) of the GS equation is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104008r444"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium585x.png" alt="                      [            --  ]          --
− μ0R2dP- − dgg = μ0R2  1-(P0 − Pb)α Ψα−1 +  1g20γ 1-βΨβ−1.
       dΨ   dΨ          Δ                  2   Δ
" class="math-display"  /></center></td><td class="equation-label">(444)</td></tr></table>
<!--l. 5318--><p class="nopar" >
The value of parameters <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub>, <span 
class="cmmi-10">P</span><sub><span 
class="cmmi-7">b</span></sub>, and <span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">0</span></sub> in Eqs. (<a 
href="#x1-104001r437">437<!--tex4ht:ref: 4-28-p1 --></a>) and (<a 
href="#x1-104002r438">438<!--tex4ht:ref: 4-28-p2 --></a>), and the value of <span 
class="cmmi-10">α </span>and <span 
class="cmmi-10">β </span>in Eqs. (<a 
href="#x1-104003r439">439<!--tex4ht:ref: 1-2-1 --></a>)
and (<a 
href="#x1-104004r440">440<!--tex4ht:ref: 1-2-2 --></a>) can be chosen arbitrarily. The parameter <span 
class="cmmi-10">γ </span>is used to set the value of the total toroidal
current. The toroidal current density is given by Eq. (<a 
href="#x1-131001r570">570<!--tex4ht:ref: 4-10-1 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104009r445"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium586x.png" alt="J  = RdP- + 1-dg-g-,
 ϕ    dΨ    μ0dΨ R
" class="math-display"  /></center></td><td class="equation-label">(445)</td></tr></table>
<!--l. 5327--><p class="nopar" >
which can be integrated over the poloidal cross section within the boundary magnetic surface to give
the total toroidal current, </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium587x.png" alt="    ∫
I =    J dS
 ϕ      ϕ
    ∫  (  dP-  1--dgg-)
  =     R dΨ + μ0dΨ R   dRdZ
    ∫  [ (   1)           --    1  1   1   --]
  =     R  −--  (P0 − Pb)ˆp′(Ψ) −-----g20γ--ˆg′(Ψ)  dRdZ          (446)
            Δ                  μ0R 2   Δ
" class="math-display"  /><a 
 id="x1-104010r446"></a></center>
</div>Using
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-104011r447"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium588x.png" alt="       -1
dRdZ = R 𝒥 dψd𝜃,
" class="math-display"  /></center></td><td class="equation-label">(447)</td></tr></table>
<!--l. 5341--><p class="nopar" >
Eq. (<a 
href="#x1-104010r446">446<!--tex4ht:ref: 9-28-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104012r448"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium589x.png" alt="      [(    )                               ]
    ∫     -1           ′--   -1--1  2 1- ′--
Iϕ =      −Δ   (P0 − Pb)ˆp(Ψ)− μ0R22 g0γ Δ ˆg(Ψ) 𝒥 dψd𝜃,
" class="math-display"  /></center></td><td class="equation-label">(448)</td></tr></table>
<!--l. 5348--><p class="nopar" >
from which we solve for <span 
class="cmmi-10">γ</span>, giving
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-104013r449"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium590x.png" alt="    − ΔIϕ − (P0 − Pb)∫[pˆ′(Ψ)]𝒥 dψd𝜃
γ = -----1-2-∫ [-1-′--]---------.
        2μ0g0   R2ˆg (Ψ) 𝒥dψd 𝜃
" class="math-display"  /></center></td><td class="equation-label">(449)</td></tr></table>
<!--l. 5355--><p class="nopar" >
If the total toroidal current <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">ϕ</span></sub> is given, Eq. (<a 
href="#x1-104013r449">449<!--tex4ht:ref: 9-28-2 --></a>) can be used to determine the value of
<span 
class="cmmi-10">γ</span>.
                                                                                

                                                                                
</p><!--l. 5359--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.5   </span> <a 
 id="x1-10500017.5"></a>Boundary magnetic surface and initial coordinates</h4>
<!--l. 5361--><p class="noindent" >In the ﬁxed boundary equilibrium problem, the shape of the boundary magnetic surface (it is also the
boundary of the computational region) is given while the shape of the inner ﬂux surface is
to be solved. A simple analytical expression for a D-shaped magnetic surface takes the
form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105001r450"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium591x.png" alt="R = R0 + acos(𝜃 +Δ sin𝜃),
" class="math-display"  /></center></td><td class="equation-label">(450)</td></tr></table>
<!--l. 5367--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105002r451"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium592x.png" alt="Z = κa sin𝜃,
" class="math-display"  /></center></td><td class="equation-label">(451)</td></tr></table>
<!--l. 5370--><p class="nopar" >
with <span 
class="cmmi-10">𝜃 </span>changing from 0 to 2<span 
class="cmmi-10">π</span>. According to the deﬁnition in Eqs. (<a 
href="#x1-12002r28">28<!--tex4ht:ref: 4-25-p1 --></a>), (<a 
href="#x1-12003r29">29<!--tex4ht:ref: 4-25-p2 --></a>), and (<a 
href="#x1-12005r31">31<!--tex4ht:ref: 4-25-p4 --></a>) we can readily
verify that the parameters <span 
class="cmmi-10">a</span>, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>, <span 
class="cmmi-10">κ </span>appearing in Eqs. (<a 
href="#x1-105001r450">450<!--tex4ht:ref: 4-20-1 --></a>) and (<a 
href="#x1-105002r451">451<!--tex4ht:ref: 4-20-2 --></a>) are indeed the minor radius,
major radius, and ellipticity, respectively. According to the deﬁnition of triangularity Eq.
(<a 
href="#x1-12004r30">30<!--tex4ht:ref: 4-25-p3 --></a>), the triangularity <span 
class="cmmi-10">δ </span>for the magnetic surface deﬁned by Eqs. (<a 
href="#x1-105001r450">450<!--tex4ht:ref: 4-20-1 --></a>) and (<a 
href="#x1-105002r451">451<!--tex4ht:ref: 4-20-2 --></a>) is written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105003r452"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium593x.png" alt="δ = sin Δ.
" class="math-display"  /></center></td><td class="equation-label">(452)</td></tr></table>
<!--l. 5380--><p class="nopar" >
Another common expression for the shape of a magnetic surface was given by Miller<span class="cite">[<a 
href="#Xchen2010">8</a>, <a 
href="#Xmiller1998">21</a>]</span>, which is
written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105004r453"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium594x.png" alt="R = R0 + acos[𝜃+ arcsin(Δ sin𝜃)],
" class="math-display"  /></center></td><td class="equation-label">(453)</td></tr></table>
<!--l. 5385--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105005r454"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium595x.png" alt="Z = κa sin𝜃.
" class="math-display"  /></center></td><td class="equation-label">(454)</td></tr></table>
<!--l. 5388--><p class="nopar" >
Note that Miller’s formula is only slightly diﬀerent from the formula (<a 
href="#x1-105001r450">450<!--tex4ht:ref: 4-20-1 --></a>). For Miller’s formula, it is
easy to prove that the triangularity <span 
class="cmmi-10">δ </span>is equal to <span 
class="cmmi-10">Δ </span>(instead of <span 
class="cmmi-10">δ </span>= sin<span 
class="cmmi-10">Δ </span>as given in Eq.
(<a 
href="#x1-105003r452">452<!--tex4ht:ref: 8-10-1 --></a>)).
</p><!--l. 5394--><p class="indent" >   In the iterative metric method<span class="cite">[<a 
href="#Xdelucia1980">11</a>]</span> for solving the ﬁxed boundary equilibrium problem, we need to
provide an initial guess of the shape of the inner ﬂux surface (this initial guess is used to construct a
initial generalized coordinates system). A common guess of the inner ﬂux surfaces is given
                                                                                

                                                                                
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105006r455"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium596x.png" alt="R = ψα(RLCFS − R0)+ R0,
" class="math-display"  /></center></td><td class="equation-label">(455)</td></tr></table>
<!--l. 5401--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105007r456"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium597x.png" alt="Z = ψαZLCFS,
" class="math-display"  /></center></td><td class="equation-label">(456)</td></tr></table>
<!--l. 5404--><p class="nopar" >
where <span 
class="cmmi-10">α </span>is a parameter, <span 
class="cmmi-10">ψ </span>is a label parameter of ﬂux surface. If the shape of the LCFS is given by Eqs.
(<a 
href="#x1-105001r450">450<!--tex4ht:ref: 4-20-1 --></a>) and (<a 
href="#x1-105002r451">451<!--tex4ht:ref: 4-20-2 --></a>), then Eqs. (<a 
href="#x1-105006r455">455<!--tex4ht:ref: 4-25-p5 --></a>) and (<a 
href="#x1-105007r456">456<!--tex4ht:ref: 4-25-p6 --></a>) are written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105008r457"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium598x.png" alt="R = R0 + ψ αacos(𝜃 + Δ sin𝜃),
" class="math-display"  /></center></td><td class="equation-label">(457)</td></tr></table>
<!--l. 5411--><p class="nopar" >
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-105009r458"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium599x.png" alt="Z = ψaκa sin 𝜃.
" class="math-display"  /></center></td><td class="equation-label">(458)</td></tr></table>
<!--l. 5414--><p class="nopar" >
Fig. <a 
href="#x1-10501030">30<!--tex4ht:ref: 4-25-p10 --></a> plots the shape given by Eqs. (<a 
href="#x1-105008r457">457<!--tex4ht:ref: 4-25-p8 --></a>) and (<a 
href="#x1-105009r458">458<!--tex4ht:ref: 4-25-p9 --></a>) for <span 
class="cmmi-10">a </span>=0.4, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>7, <span 
class="cmmi-10">κ </span>= 1<span 
class="cmmi-10">.</span>7, <span 
class="cmmi-10">Δ </span>= arcsin(0<span 
class="cmmi-10">.</span>6),
and <span 
class="cmmi-10">α </span>= 1 with <span 
class="cmmi-10">ψ </span>varying from zero to one.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-10501030"></a>
                                                                                

                                                                                
<!--l. 5420--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig1/plt.png" alt="pict"  
 width="180.67499pt" /> <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig2/plt.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 30: </span><span  
class="content">Shape of ﬂux surface given by Eqs. (<a 
href="#x1-105008r457">457<!--tex4ht:ref: 4-25-p8 --></a>) and (<a 
href="#x1-105009r458">458<!--tex4ht:ref: 4-25-p9 --></a>). Left ﬁgure: points with the same
value of <span 
class="cmmi-10">ψ </span>are connected to show <span 
class="cmmi-10">ψ </span>coordinate surface; Right ﬁgure: dot plot. Parameters are
<span 
class="cmmi-10">a </span>=0.4m, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>7<span 
class="cmmi-10">m</span>, <span 
class="cmmi-10">κ </span>= 1<span 
class="cmmi-10">.</span>7, <span 
class="cmmi-10">Δ </span>= arcsin(0<span 
class="cmmi-10">.</span>6), <span 
class="cmmi-10">α </span>= 1 with <span 
class="cmmi-10">ψ </span>varying from zero (center) to one
(boundary). The shape parameters of LCFS are chosen according to the parameters of EAST
tokamak.</span></div><!--tex4ht:label?: x1-10501030 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">17.6   </span> <a 
 id="x1-10600017.6"></a>Fixed boundary equilibrium numerical code</h4>
<!--l. 5432--><p class="noindent" >The tokamak equilibrium problem where the shape of the LCFS is given is called ﬁxed boundary
equilibrium problem. I wrote a numerical code that uses the iterative metric method<span class="cite">[<a 
href="#Xdelucia1980">11</a>]</span> to solve this
kind of equilibrium problem. Figure <a 
href="#x1-10600131">31<!--tex4ht:ref: 12-26-1 --></a> describes the steps involved in the iterative metric
method.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-10600131"></a>
                                                                                

                                                                                
<!--l. 5439--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig3/plt.png" alt="pict"  
 width="180.67499pt" /> <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig4/plt.png" alt="pict"  
 width="180.67499pt" />
</p><!--l. 5441--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig3/reshape.png" alt="pict"  
 width="180.67499pt" /> <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig6/plt.png" alt="pict"  
 width="180.67499pt" />
</p><!--l. 5443--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig5/plt.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 31: </span><span  
class="content">Upper left ﬁgure plots the initial coordinate surfaces. After solving the GS equation to
obtain the location of the magnetic axis, I shift the origin point of the initial coordinate system
to the location of the magnetic axis (upper right ﬁgure). Then, reshape the coordinate surface so
that the coordinate surfaces <span 
class="cmmi-10">ψ </span>= const lies on magnetic surfaces (middle left ﬁgure). Recalculate
the radial coordinate <span 
class="cmmi-10">ψ </span>that is consistent with the Jacobian constraint and interpolate ﬂux
surface to uniform <span 
class="cmmi-10">ψ </span>coordinates (middle right ﬁgure). Recalculate the poloidal coordinate <span 
class="cmmi-10">𝜃 </span>that
is consistent with the Jacobian constraint and interpolate poloidal points on every ﬂux surface
to uniform <span 
class="cmmi-10">𝜃 </span>coordinates (bottom left ﬁgure).</span></div><!--tex4ht:label?: x1-10600131 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">17.7   </span> <a 
 id="x1-10700017.7"></a>Benchmark of the code</h4>
<!--l. 5459--><p class="noindent" >To benchmark the numerical code, I set the proﬁle of <span 
class="cmmi-10">P </span>and <span 
class="cmmi-10">g </span>according to Eqs. (<a 
href="#x1-124001r533">533<!--tex4ht:ref: 11-1-2 --></a>) and (<a 
href="#x1-124002r534">534<!--tex4ht:ref: 3-15-a1 --></a>) with
the parameters <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">2</span></sub> = 0, <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">1</span></sub> = <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup> + 1)<span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub>), <span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>5, and <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>5. The comparison of the
analytic and numerical results are shown in Fig. <a 
href="#x1-10700132">32<!--tex4ht:ref: 3-15-a2 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-10700132"></a>
                                                                                

                                                                                
<!--l. 5466--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig13/tmp.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 32: </span><span  
class="content">Agreement between the magnetic surfaces (contours of <span 
class="cmmi-10">Ψ</span>) given by the Solovev analytic
formula and those calculated by the numerical code. The two sets of magnetic surfaces are
indistinguishable at this scale. The boundary magnetic surface is selected by the requirement
that <span class="overline"><span 
class="cmmi-10">Ψ</span></span> = 0<span 
class="cmmi-10">.</span>11022 in the Solovev formula (<a 
href="#x1-124010r542">542<!--tex4ht:ref: 3-12-p1 --></a>). Parameters: <span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>5, <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>5.</span></div><!--tex4ht:label?: x1-10700132 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 5475--><p class="indent" >   Note that the parameter <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub> in the Solovev equilibrium seems to be not needed in the numerical
calculation. In fact this impression is wrong: the <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub> parameter is actually needed in determining the
boundary magnetic surface of the numerical equilibrium (in the case considered here <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub> is chosen as
<span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub> = <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub>)).
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.8   </span> <a 
 id="x1-10800017.8"></a>Low-beta equilibrium vs. high-beta equilibrium</h4>
<!--l. 5483--><p class="noindent" >With the pressure increasing, the magnetic axis usually shifts to the low-ﬁeld-side of the device, as is
shown in Fig. <a 
href="#x1-10800133">33<!--tex4ht:ref: 10-31-e8 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-10800133"></a>
                                                                                

                                                                                
<!--l. 5487--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig14/tmp1.png" alt="pict"  
 width="180.67499pt" /> <img 
src="my_figure/home/yj/project_new/inverse_metric_method/fig14/tmp2.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 33: </span><span  
class="content">Comparison of two equilibria obtained with <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> = 10<sup><span 
class="cmr-7">4</span></sup> Pasca (left) and <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> = 10<sup><span 
class="cmr-7">5</span></sup> Pasca
(right), respectively, where <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> is the pressure at the magnetic axis. All the other parameters are
the same for the two equilibria, <span 
class="cmmi-10">α </span>= 1<span 
class="cmmi-10">.</span>0, <span 
class="cmmi-10">β </span>= 1<span 
class="cmmi-10">.</span>0, <span 
class="cmmi-10">P</span><sub><span 
class="cmmi-7">b</span></sub> = 10<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup> Pasca, <span 
class="cmmi-10">g</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>0<span 
class="cmmi-10">Tm</span>, <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">ϕ</span></sub> = 500kA,
and the LCFS is given by miller’s formulas (<a 
href="#x1-105004r453">453<!--tex4ht:ref: 10-31-e1 --></a>) and (<a 
href="#x1-105005r454">454<!--tex4ht:ref: 10-31-e2 --></a>) with <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>7, <span 
class="cmmi-10">a </span>= 0<span 
class="cmmi-10">.</span>45, <span 
class="cmmi-10">κ </span>= 1<span 
class="cmmi-10">.</span>7,
and <span 
class="cmmi-10">δ </span>= 0<span 
class="cmmi-10">.</span>6.</span></div><!--tex4ht:label?: x1-10800133 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 5498--><p class="indent" >    
</p><!--l. 5500--><p class="indent" >    
</p><!--l. 5502--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.9   </span> <a 
 id="x1-10900017.9"></a>Analytical form of Jacobian (need cleaning up)</h4>
<!--l. 5506--><p class="noindent" >Consider the Jacobian of the form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-109001r459"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium600x.png" alt="     ( R )m
𝒥 = μ  ---   ψn,
       R0
" class="math-display"  /></center></td><td class="equation-label">(459)</td></tr></table>
<!--l. 5509--><p class="nopar" >
where <span 
class="cmmi-10">m </span>and <span 
class="cmmi-10">n </span>are arbitrary integers which can be appropriately chosen by users, <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub> and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> are
constants included for normalization. In the iterative metric method of solving ﬁxed boundary
equilibrium problem, we ﬁrst construct a coordinates transformation (<span 
class="cmmi-10">𝜃,ψ</span>) <span 
class="cmsy-10">→ </span>(<span 
class="cmmi-10">R</span>(<span 
class="cmmi-10">𝜃,ψ</span>)<span 
class="cmmi-10">,Z</span>(<span 
class="cmmi-10">𝜃,ψ</span>)) (this
transformation is arbitrary except for that surface <span 
class="cmmi-10">ψ </span>= 1 coincides with the last closed ﬂux surface),
then solve the GS equation in (<span 
class="cmmi-10">𝜃,ψ</span>) coordinate system to get the value of <span 
class="cmmi-10">Ψ </span>at grid points, and ﬁnally
adjust the value of (<span 
class="cmmi-10">R</span>(<span 
class="cmmi-10">𝜃,ψ</span>)<span 
class="cmmi-10">,Z</span>(<span 
class="cmmi-10">𝜃,ψ</span>)) to make surface <span 
class="cmmi-10">ψ </span>= const lies on a magnetic surface. It is obvious
the Jacobian of the ﬁnal transformation we obtained usually does not satisfy the constraint given by
Eq. (<a 
href="#x1-109001r459">459<!--tex4ht:ref: 1-4-1 --></a>) since we do not use any information of Eq. (<a 
href="#x1-109001r459">459<!--tex4ht:ref: 1-4-1 --></a>) in the above steps. Now comes the question:
how to make the transformation obtained above satisfy the constraint Eq. (<a 
href="#x1-109001r459">459<!--tex4ht:ref: 1-4-1 --></a>) through
adjusting the values of <span 
class="cmmi-10">𝜃</span>? To make the constraint Eq. (<a 
href="#x1-109001r459">459<!--tex4ht:ref: 1-4-1 --></a>) satisﬁed, <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ψ </span>should satisfy the
relation
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-109002r460"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium601x.png" alt="          [R (𝜃,ψ )]m
𝒥 (𝜃,ψ) = μ -------  ψn,
             R0
" class="math-display"  /></center></td><td class="equation-label">(460)</td></tr></table>
                                                                                

                                                                                
<!--l. 5529--><p class="nopar" >
which
</p><!--l. 5532--><p class="indent" >    
</p><!--l. 5534--><p class="indent" >    
</p><!--l. 5536--><p class="indent" >   Using Eq. (), we obtain
</p>
   <table 
class="equation-star"><tr><td>
                           <span 
class="cmex-10">∫</span>
                             <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><span 
class="cmmi-10">d𝜃 </span>= <span 
class="cmex-10">∫</span>
  <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><span 
class="cmmi-10">d𝜃</span><img 
src="tokamak_equilibrium602x.png" alt="-𝒥-
ψn"  class="frac" align="middle" /><img 
src="tokamak_equilibrium603x.png" alt="1-
μ"  class="frac" align="middle" /><img 
src="tokamak_equilibrium604x.png" alt="(   )
  R0-
  R"  class="left" align="middle" /><sup><span 
class="cmmi-7">m</span></sup>
</td></tr></table>
<!--l. 5538--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-109003r461"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium605x.png" alt="    ∫ 𝜃   𝒥 1 (R0 )m
𝜃 =    d𝜃ψn-μ- -R-
     0
" class="math-display"  /></center></td><td class="equation-label">(461)</td></tr></table>
<!--l. 5542--><p class="nopar" >
normalized to 2<span 
class="cmmi-10">π</span>, the normalized <span 
class="cmmi-10">𝜃 </span>is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-109004r462"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium606x.png" alt="       ∫𝜃d𝜃-𝒥n 1(R0 )m       ∫𝜃d𝜃𝒥 (1-)m
𝜃 = 2π∫-02π--ψ𝒥-μ1-(RR0)m-= 2π∫-02π-----R(1)m-
       0  d𝜃ψnμ  R         0  d𝜃𝒥  R
" class="math-display"  /></center></td><td class="equation-label">(462)</td></tr></table>
<!--l. 5550--><p class="nopar" >
</p><!--l. 5553--><p class="indent" >    
</p><!--l. 5556--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">17.10   </span> <a 
 id="x1-11000017.10"></a>Grad-Shafranov equation with prescribed safety factor proﬁle (to be ﬁnished)</h4>
<!--l. 5558--><p class="noindent" >In the GS equation, <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>) is one of the two free functions which can be prescribed by users. In some
cases, we want to specify the safety factor proﬁle <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ψ</span>), instead of <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), in solving the GS equation.
Next, we derive the form of the GS equation that contains <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ψ</span>), rather than <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), as a free function.
The safety factor deﬁned in Eq. (<a 
href="#x1-48001r182">182<!--tex4ht:ref: 7-11-p1 --></a>) can be written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium607x.png" alt="             ∫ 2π
q(ψ) = − 1-g′    𝒥-2d𝜃                             (463)
        2πΨ  ∫0  R
        1--g -20πR-−2𝒥d𝜃-∫ 2π
    = − 2πΨ ′  ∫2π𝒥 d𝜃   0  𝒥d𝜃
               0  ∫ 2π
    = − 1--g ⟨R −2⟩    𝒥d𝜃                          (464)
        2πΨ ′      0
              -V-′-⟨R−2⟩
    = − sgn(𝒥 )(2π)2 Ψ ′ g.                         (465)
" class="math-display"  /><a 
 id="x1-110001r465"></a></center>
</div>Equation (<a 
href="#x1-110001r465">465<!--tex4ht:ref: 12-21-p2 --></a>) gives the relation between the safety factor <span 
class="cmmi-10">q </span>and the toroidal ﬁeld function <span 
class="cmmi-10">g</span>. This
relation can be used in the GS equation to eliminate <span 
class="cmmi-10">g </span>in favor of <span 
class="cmmi-10">q</span>, which gives
   <table 
class="equation"><tr><td><a 
 id="x1-110002r466"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium608x.png" alt="           -(2π)2-- ′
g = − sgn(𝒥 )V ′⟨R−2⟩Ψ q.
" class="math-display"  /></center></td><td class="equation-label">(466)</td></tr></table>
<!--l. 5581--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110003r467"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium609x.png" alt="                 [           ]
  -dg    -(2π)2-- --(2π-)2--  ′
⇒ dΨ g = V′⟨R −2⟩q V ′⟨R −2⟩qΨ  ψ.
" class="math-display"  /></center></td><td class="equation-label">(467)</td></tr></table>
<!--l. 5586--><p class="nopar" >
Note that this expression involves the ﬂux surface average, which depends on the ﬂux surface shape and
the shape is unknown before <span 
class="cmmi-10">Ψ </span>is determined.
</p><!--l. 5590--><p class="indent" >   Multiplying Eq. (<a 
href="#x1-136002r595">595<!--tex4ht:ref: 9-28-e1 --></a>) by <span 
class="cmmi-10">R</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">2</span></sup> gives
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110004r468"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium610x.png" alt="  [                                 ]
1  (   𝒥      )    (   𝒥         )        dp       dg
𝒥-   Ψ′R2|∇ψ |2   +  Ψ ′R2(∇ψ ⋅∇ 𝜃)   + μ0dΨ-+ R −2dΨ-g = 0.
                ψ                  𝜃
" class="math-display"  /></center></td><td class="equation-label">(468)</td></tr></table>
<!--l. 5596--><p class="nopar" >
Surface-averaging the above equation, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110005r469"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium611x.png" alt="       [                                ]
2π∫     (  ′ 𝒥    2)    ( ′ 𝒥         )       dp     −2 dg
V′-  d𝜃  Ψ R2-|∇ψ|    +  Ψ R2-(∇ψ ⋅∇𝜃)    + μ0dΨ-+ ⟨R  ⟩dΨ-g = 0,
                    ψ                  𝜃
" class="math-display"  /></center></td><td class="equation-label">(469)</td></tr></table>
<!--l. 5603--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110006r470"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium612x.png" alt="   2π ∫    (   𝒥      )      dp        dg
⇒  -′- d𝜃  Ψ′--2|∇ ψ|2   +μ0 ---+ ⟨R −2⟩--g = 0,
   V         R        ψ     dΨ        dΨ
" class="math-display"  /></center></td><td class="equation-label">(470)</td></tr></table>
<!--l. 5608--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110007r471"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium613x.png" alt="   2π[   ∫   (  |∇ψ |2) ]      dp        dg
⇒  -′-Ψ ′  d𝜃 𝒥 ---2-    + μ0---+ ⟨R −2⟩--g = 0,
   V              R     ψ    dΨ         dΨ
" class="math-display"  /></center></td><td class="equation-label">(471)</td></tr></table>
<!--l. 5614--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110008r472"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium614x.png" alt="     [     ⟨     ⟩ ]
   1--  ′ ′ |∇ψ-|2        -dp     −2 dg-
⇒  V′ V Ψ     R2    ψ + μ0dΨ + ⟨R  ⟩dΨg = 0.
" class="math-display"  /></center></td><td class="equation-label">(472)</td></tr></table>
<!--l. 5619--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110009r473"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium615x.png" alt="   [    ⟨     2⟩]
⇒   V′Ψ′  |∇-ψ2|-    + μ0V′ dp-+ ⟨R−2⟩V′ dg-g = 0,
           R     ψ       dΨ          dΨ
" class="math-display"  /></center></td><td class="equation-label">(473)</td></tr></table>
<!--l. 5625--><p class="nopar" >
Substitute Eq. (<a 
href="#x1-110003r467">467<!--tex4ht:ref: 4-18-p3 --></a>) into the above equation to eliminate <span 
class="cmmi-10">gdg∕dΨ</span>, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110010r474"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium616x.png" alt="  [    ⟨      ⟩ ]                  [       ]
     ′ ′ |∇ψ|2          ′dp-       4 --qΨ-′--
⇒  V Ψ    R2     ψ + μ0V dΨ + q(2π) V ′⟨R− 2⟩ ψ = 0,
" class="math-display"  /></center></td><td class="equation-label">(474)</td></tr></table>
<!--l. 5632--><p class="nopar" >
Eq. (<a 
href="#x1-110010r474">474<!--tex4ht:ref: 4-19-5 --></a>) agrees with Eq. (5.55) in Ref. <span class="cite">[<a 
href="#Xjardin2010">16</a>]</span>.
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110011r475"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium617x.png" alt="     ⟨     ⟩     [  ⟨      ⟩]                   [        ]          [       ]
⇒ V ′ |∇ψ-|2  Ψ′′+  V′  |∇-ψ|2    Ψ′+μ V ′ dp+q (2π)4 ---q----Ψ ′′+q (2π)4  ---q----  Ψ′ = 0
        R2             R2    ψ     0   dΨ         V′⟨R −2⟩            V′⟨R−2⟩ ψ
" class="math-display"  /></center></td><td class="equation-label">(475)</td></tr></table>
<!--l. 5640--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110012r476"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium618x.png" alt="              {                                              }
    ′′     1   [  ′⟨|∇ψ |2⟩ ]   ′      4[   q    ]   ′     ′ dp
⇒  Ψ  = −V-′D   V   --R2-    Ψ  +q(2π)  V-′⟨R-−2⟩  Ψ + μ0V  dΨ-
                            ψ                    ψ
" class="math-display"  /></center></td><td class="equation-label">(476)</td></tr></table>
<!--l. 5646--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110013r477"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium619x.png" alt="    ⟨|∇ ψ|2⟩    (2π )4 ( q )2
D =  ---2-  + ---−2  --′
       R      ⟨R   ⟩ V
" class="math-display"  /></center></td><td class="equation-label">(477)</td></tr></table>
<!--l. 5651--><p class="nopar" >
The GS equation is
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110014r478"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium620x.png" alt="△ ⋆Ψ = − μ R2 dp-− g dg
         0   dΨ     dΨ
" class="math-display"  /></center></td><td class="equation-label">(478)</td></tr></table>
<!--l. 5656--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110015r479"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium621x.png" alt="                          4 [     ′  ]
⇒  △ ⋆Ψ = − μ0R2-dp−  q(2π)-----qΨ----
               dΨ    V′⟨R −2⟩ V ′⟨R −2⟩ ψ
" class="math-display"  /></center></td><td class="equation-label">(479)</td></tr></table>
<!--l. 5661--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110016r480"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium622x.png" alt="                         4 { [       ]      [        ]  }
⇒ △ ⋆Ψ = − μ0R2-dp− q(2π)---  ---q----  Ψ′ + ---q---- Ψ′′
              dΨ    V′⟨R −2⟩   V ′⟨R−2⟩ ψ      V ′⟨R− 2⟩
" class="math-display"  /></center></td><td class="equation-label">(480)</td></tr></table>
<!--l. 5667--><p class="nopar" >
Using Eq. (<a 
href="#x1-110012r476">476<!--tex4ht:ref: 1-2-4 --></a>) to eliminate <span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">′′</span> in the above equation, the coeﬃcients before (<span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">dp∕dΨ</span>) is written as
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium623x.png" alt="                { [       ]       }
B = R2 − -q(2π)4--  ---q---- -1--V′
         V′⟨R −2⟩   V′⟨R−2⟩  V′D
    1 {  2    ( q )2 (2π)4 }
  = D-  R D −  V-′  ⟨R−-2⟩2  .                        (481)
" class="math-display"  /></center>
</div>Substituting the expression of <span 
class="cmmi-10">D </span>into the above equation, we obtain <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium624x.png" alt="       {   ⟨     ⟩           (   )   (   )       }
B = -1  R2  |∇ψ-|2  + R2 (2π)4-  q--2 −  q--2-(2π)4
    D         R2        ⟨R −2⟩  V′      V′  ⟨R −2⟩2
     1 { 2 ⟨|∇ψ |2⟩   ( q )2 (2π)4 (  2    1  ) }
  = D-  R   --R2-  +  V-′  ⟨R−-2⟩ R  − ⟨R−2⟩   ,             (482)
" class="math-display"  /><a 
 id="x1-110018r482"></a></center>
</div>which is equal to the expression (5.58) in Ref. <span class="cite">[<a 
href="#Xjardin2010">16</a>]</span>. The coeﬃcient before <span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">′ </span>is written
as
   <table 
class="equation-star"><tr><td>
<span 
class="cmmi-10">A </span>= <span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium625x.png" alt="      4
-q(′2π)−2-
V ⟨R   ⟩"  class="frac" align="middle" /><img 
src="tokamak_equilibrium626x.png" alt="{[        ]   [        ]     [(   ⟨    2⟩ )         [        ] ]}
   -′-q−2-- −   -′-q−2----1′-   V ′ |∇ψ2|     + q(2π)4  -′-q−2--
   V ⟨R   ⟩ ψ    V ⟨R   ⟩ V  D         R     ψ          V ⟨R   ⟩ ψ"  class="left" align="middle" />
</td></tr></table>
<!--l. 5695--><p class="nopar" >
Deﬁne
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                                 <span 
class="cmmi-10">α </span>= <img 
src="tokamak_equilibrium627x.png" alt="⟨     ⟩
 |∇ψ-|2
   R2"  class="left" align="middle" /><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 5697--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                                  <span 
class="cmmi-10">β </span>= <img 
src="tokamak_equilibrium628x.png" alt="   q
V-′⟨R−-2⟩-"  class="frac" align="middle" /><span 
class="cmmi-10">.</span>
</td></tr></table>
<!--l. 5698--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                   <span 
class="cmmi-10">A </span>= <span 
class="cmsy-10">−</span>(2<span 
class="cmmi-10">π</span>)<sup><span 
class="cmr-7">4</span></sup><span 
class="cmmi-10">β</span><img 
src="tokamak_equilibrium629x.png" alt="{                           }
 βψ − β--1-[(V′α)ψ + q(2π)4βψ ]
       V ′D"  class="left" align="middle" />
</td></tr></table>
<!--l. 5700--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110019r483"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium630x.png" alt="      D                1   ′          4
=⇒ −-(2π)4β-A = Dβψ − βV-′[(V α)ψ +q(2π) βψ]
" class="math-display"  /></center></td><td class="equation-label">(483)</td></tr></table>
<!--l. 5704--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110020r484"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium631x.png" alt="= ⇒ ---D----A = D β − β-1[V′′α + V ′α  + q(2π )4β ]
    − β(2π)4       ψ    V ′         ψ         ψ
" class="math-display"  /></center></td><td class="equation-label">(484)</td></tr></table>
<!--l. 5708--><p class="nopar" >
Using
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110021r485"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium632x.png" alt="D = α + (2π )4⟨R− 2⟩β2
" class="math-display"  /></center></td><td class="equation-label">(485)</td></tr></table>
<!--l. 5712--><p class="nopar" >
Eq. () is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110022r486"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium633x.png" alt="                                                                    ]
=⇒  ---D---A = αβ  + (2π)4⟨R −2⟩β2β  − β-1-V′′α − β-1V ′α  − β 1-q(2π )4β
    − β(2π)4     ψ               ψ    V ′       V ′   ψ    V′      ψ
" class="math-display"  /></center></td><td class="equation-label">(486)</td></tr></table>
<!--l. 5719--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110023r487"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium634x.png" alt="       D                 4  −2  2      1  ′′           1     4  ]
=⇒  −-β(2π-)4A = α βψ + (2π) ⟨R  ⟩β βψ − β V′V α − βαψ − βV-′q(2π) βψ
" class="math-display"  /></center></td><td class="equation-label">(487)</td></tr></table>
<!--l. 5725--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110024r488"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium635x.png" alt="   A                                1
−-β(2π)4D = αβψ + (2π )4⟨R− 2⟩β2βψ − βV-′V ′′α − β αψ − β2⟨R −2⟩(2π)4βψ
" class="math-display"  /></center></td><td class="equation-label">(488)</td></tr></table>
<!--l. 5730--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110025r489"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium636x.png" alt="       A               1   ′′
= ⇒ −-β(2π)4-D = αβψ − βV′V  α− βα ψ
" class="math-display"  /></center></td><td class="equation-label">(489)</td></tr></table>
<!--l. 5734--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110026r490"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium637x.png" alt="                   (   )
=⇒  ---A---D  = − β2 α-   − β 1-V ′′α
    − β(2π)4          β  ψ    V′
" class="math-display"  /></center></td><td class="equation-label">(490)</td></tr></table>
<!--l. 5739--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110027r491"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium638x.png" alt="      A            (α )       1   α
=⇒  − β(2π)4D = − β2 β   − β2V-′V ′′β-
                       ψ
" class="math-display"  /></center></td><td class="equation-label">(491)</td></tr></table>
<!--l. 5745--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110028r492"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium639x.png" alt="                   [               ]
      A             (α )     1   α
=⇒ −-β(2π)4D = − β2  -β   + V-′V ′′β-
                        ψ
" class="math-display"  /></center></td><td class="equation-label">(492)</td></tr></table>
<!--l. 5750--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110029r493"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium640x.png" alt="                      [(  )           ]
    ---A----      2-1-   α-    ′   ′′α-
= ⇒ − β(2π)4 D = − β V ′  β  ψV  + V β
" class="math-display"  /></center></td><td class="equation-label">(493)</td></tr></table>
<!--l. 5756--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110030r494"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium641x.png" alt="       A            1 (α   )
=⇒  − β(2π)4D = − β2V-′ β-V′
                            ψ
" class="math-display"  /></center></td><td class="equation-label">(494)</td></tr></table>
<!--l. 5760--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110031r495"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium642x.png" alt="           4 (        )3   [⟨     2⟩   −2    ]
=⇒  A = (2π)- ----q---   1--  |∇-ψ|-  ⟨R--⟩V ′2
         D    V ′⟨R −2⟩   V′    R2      q      ψ
" class="math-display"  /></center></td><td class="equation-label">(495)</td></tr></table>
<!--l. 5766--><p class="nopar" >
But the expression of <span 
class="cmmi-10">A </span>is slightly diﬀerent from that given in Ref. <span class="cite">[<a 
href="#Xjardin2010">16</a>]</span> [Eq. (5.57)]. Using the above
coeﬃcients, the GS equation with the <span 
class="cmmi-10">q</span>-proﬁle held ﬁxed is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-110032r496"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium643x.png" alt="(          )
  Δ⋆ − A-∂-  Ψ = − B μ0 dp.
        ∂ψ            dΨ
" class="math-display"  /></center></td><td class="equation-label">(496)</td></tr></table>
<!--l. 5773--><p class="nopar" >
</p><!--l. 5776--><p class="indent" >    
</p><!--l. 5778--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">18   </span> <a 
 id="x1-11100018"></a>Misc contents</h3>
<!--l. 5780--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">18.1   </span> <a 
 id="x1-11200018.1"></a>Expression of current density</h4>
<!--l. 5782--><p class="noindent" >Let us derive the contravariant expression for the current density. Using
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                                  <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmbx-10">J </span>= <span 
class="cmsy-10">∇× </span><span 
class="cmbx-10">B</span><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 5783--><p class="nopar" >
along with magnetic ﬁeld expression (<a 
href="#x1-46002r176">176<!--tex4ht:ref: 5-6-2 --></a>) and the curl formula (<a 
href="#x1-42001r138">138<!--tex4ht:ref: 4-16-2 --></a>), we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium644x.png" alt="       [                               ]
         ( ′ 𝒥     2)    (  ′ 𝒥       )              ′
μ0J = −   Ψ R2-|∇ ψ|   +   Ψ R2∇ ψ ⋅∇𝜃    ∇ψ × ∇ 𝜃− g∇ ϕ × ∇ψ,     (497)
                     ψ                 𝜃
" class="math-display"  /><a 
 id="x1-112001r497"></a></center>
</div>which is the contravariant form of the current density vector. Next, for later use, calculate the
parallel current. By using Eqs. (<a 
href="#x1-46002r176">176<!--tex4ht:ref: 5-6-2 --></a>) and (<a 
href="#x1-112001r497">497<!--tex4ht:ref: 4-16-p2 --></a>), the parallel current density is written as
<div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium645x.png" alt="          [(          )    (            ) ]                  (           )
μ0J⋅B = −    Ψ′ 𝒥-|∇ ψ|2  +  Ψ ′ 𝒥-∇ ψ⋅∇ 𝜃   g∇ψ × ∇𝜃 ⋅∇ϕ − g′ − Ψ′ 𝒥-|∇ψ |2 ∇ϕ × ∇ψ ⋅∇ 𝜃
               R2       ψ      R2        𝜃                        R2
          [(   𝒥      )    (   𝒥        ) ]               𝒥
      = −    Ψ′-2|∇ ψ|2   +  Ψ ′-2∇ ψ⋅∇ 𝜃    g𝒥−1 + g′𝒥 −1Ψ′-2-|∇ ψ|2
               R{       ψ      R         𝜃                R       }
                 1 (   𝒥      )    1 (  𝒥        )    g′   𝒥
      = − g2𝒥− 1 g  Ψ ′R2|∇ψ |2   + g  Ψ′R2-∇ψ ⋅∇𝜃   − g2Ψ ′R2-|∇ψ|2
                [              ψ                 ] 𝜃
           2 − 1 (Ψ-′𝒥--   2)    ( Ψ′𝒥--      )
      = − g 𝒥      g R2|∇ψ |   +   g R2 ∇ψ ⋅∇𝜃    .                               (498)
                              ψ                 𝜃
" class="math-display"  /></center>
</div>
                                                                                

                                                                                
<!--l. 5818--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">18.2   </span> <a 
 id="x1-11300018.2"></a>Normalized internal inductance</h4>
<!--l. 5820--><p class="noindent" >The self-inductance of a current loop is deﬁned as the ratio of the magnetic ﬂux <span 
class="cmmi-10">Φ </span>traversing the loop
and its current <span 
class="cmmi-10">I</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113001r499"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium646x.png" alt="    Φ-
L = I ,
" class="math-display"  /></center></td><td class="equation-label">(499)</td></tr></table>
<!--l. 5824--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113002r500"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium647x.png" alt="   ∫
Φ =   B ⋅dS.
     S
" class="math-display"  /></center></td><td class="equation-label">(500)</td></tr></table>
<!--l. 5828--><p class="nopar" >
It can be proved that <span 
class="cmmi-10">L </span>is independent of the current <span 
class="cmmi-10">I </span>in the loop, i.e., <span 
class="cmmi-10">L </span>is fully determined by the
shape of the loop.
</p><!--l. 5832--><p class="indent" >   On the other hand, the energy contained in the magnetic ﬁeld produced by the loop current is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113003r501"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium648x.png" alt="     ∫
        -B2
W  =  V02μ0 dV,
" class="math-display"  /></center></td><td class="equation-label">(501)</td></tr></table>
<!--l. 5836--><p class="nopar" >
where the volume includes all space where <span 
class="cmmi-10">B </span>is not negligible. It can be proved that (to be proved) <span 
class="cmmi-10">W</span>,
<span 
class="cmmi-10">L</span>, and <span 
class="cmmi-10">I </span>are related to each other by:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113004r502"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium649x.png" alt="W =  1LI2,
     2
" class="math-display"  /></center></td><td class="equation-label">(502)</td></tr></table>
<!--l. 5841--><p class="nopar" >
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113005r503"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium650x.png" alt="    2W--
L = I2 ,
" class="math-display"  /></center></td><td class="equation-label">(503)</td></tr></table>
<!--l. 5845--><p class="nopar" >
which can be considered an equivalent deﬁnition of the self-inductance.
</p><!--l. 5848--><p class="indent" >   The internal inductance <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">i</span></sub> of tokamak plasma is deﬁned in such a way that <span 
class="cmmi-10">W </span>only includes the
magnetic energy within the plasma. Speciﬁcally, <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">i</span></sub> is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113006r504"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium651x.png" alt="              ∫    2
Li ≡ 2Wi-=  2-   B-𝜃dV
      I2    I2 P 2μ0
" class="math-display"  /></center></td><td class="equation-label">(504)</td></tr></table>
<!--l. 5854--><p class="nopar" >
where the integration over the plasma volume <span 
class="cmmi-10">P </span>and only the poloidal ﬁeld <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">𝜃</span></sub> appears in the
integration since plasma current produces only the poloidal magnetic ﬁeld.
</p><!--l. 5859--><p class="indent" >   The normalized internal inductance <span 
class="cmmi-10">l</span><sub><span 
class="cmmi-7">i</span></sub> is deﬁned as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113007r505"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium652x.png" alt="    --Li---
li ≡ μ0R0∕2 ,
" class="math-display"  /></center></td><td class="equation-label">(505)</td></tr></table>
<!--l. 5862--><p class="nopar" >
where <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> is the major radius of the device (equal to <span 
class="cmmi-10">R </span>of the magnetic axis). Using Eq. (<a 
href="#x1-113006r504">504<!--tex4ht:ref: 22-9-30-1 --></a>),
expression (<a 
href="#x1-113007r505">505<!--tex4ht:ref: 22-9-30-2 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113008r506"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium653x.png" alt="      1    2 ∫  B2        2V   ∫  B2dV
li = -------2    -𝜃-dV = -2-2----P--𝜃---,
    μ0R0∕2I   P 2μ0     I μ0R0    V
" class="math-display"  /></center></td><td class="equation-label">(506)</td></tr></table>
<!--l. 5869--><p class="nopar" >
which is the deﬁnition of <span 
class="cmmi-10">l</span><sub><span 
class="cmmi-7">i</span></sub> used in the ITER design.
</p><!--l. 5872--><p class="indent" >   Another way of deﬁning the normalized internal inductance is
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-113009r507"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium654x.png" alt="    ⟨B2𝜃⟩P-
li = ⟨B2 ⟩S,
      𝜃
" class="math-display"  /></center></td><td class="equation-label">(507)</td></tr></table>
<!--l. 5876--><p class="nopar" >
where <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">…</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">S</span></sub> is the surface average over the plasma boundary. For circular cross section with minor
radius <span 
class="cmmi-10">a </span>and assuming <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">𝜃</span></sub> is independent of the poloidal angle, then, Ampere’s law gives
<span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">𝜃</span></sub>(<span 
class="cmmi-10">a</span>) = <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">I∕</span>(2<span 
class="cmmi-10">πa</span>). Then <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">𝜃</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">S</span></sub> is approximated as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113010r508"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium655x.png" alt="               μ20I2
⟨B2𝜃⟩S ≈ B20(a) = 4π2a2
" class="math-display"  /></center></td><td class="equation-label">(508)</td></tr></table>
<!--l. 5885--><p class="nopar" >
Using this and <span 
class="cmmi-10">V </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">πa</span><sup><span 
class="cmr-7">2</span></sup>2<span 
class="cmmi-10">πR</span><sub><span 
class="cmr-7">0</span></sub>,  Eq. (<a 
href="#x1-113009r507">507<!--tex4ht:ref: 22-9-30-5 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-113011r509"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium656x.png" alt="    4π2a2        4π2a2R            2V
li =--2-2 ⟨B2𝜃⟩P = --2-2--0⟨B2𝜃⟩P = -2-2--⟨B2𝜃⟩P,
     μ0I          μ0I R0         μ0I R0
" class="math-display"  /></center></td><td class="equation-label">(509)</td></tr></table>
<!--l. 5894--><p class="nopar" >
which agrees with the deﬁnition in Eq. (<a 
href="#x1-113008r506">506<!--tex4ht:ref: 22-9-30-4 --></a>).
                                                                                

                                                                                
</p><!--l. 5897--><p class="indent" >   The normalized internal inductance reﬂects the peakness of the current density proﬁle in the
toroidal plasma: a small value of <span 
class="cmmi-10">l</span><sub><span 
class="cmmi-7">i</span></sub> corresponds to a broad current proﬁle.
</p><!--l. 5901--><p class="indent" >    
</p><!--l. 5903--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">18.3   </span> <a 
 id="x1-11400018.3"></a>Cylindrical tokamak</h4>
<!--l. 5905--><p class="noindent" >For a large aspect-ratio, circular cross section tokamak, the <span 
class="cmmi-10">R </span>on a magnetic surface is nearly constant,
<span 
class="cmmi-10">R </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>. The poloidal angle dependence of the magnetic ﬁeld can be neglected, i.e., <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub>(<span 
class="cmmi-10">r,𝜃</span>) <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub>(<span 
class="cmmi-10">r</span>),
and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub>(<span 
class="cmmi-10">r,𝜃</span>) <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub>(<span 
class="cmmi-10">r</span>), where <span 
class="cmmi-10">r </span>is the minor radius of the relavent magnetic surface. Using these, the
safety factor in Eq.  (<a 
href="#x1-14004r36">36<!--tex4ht:ref: 9-5-e1 --></a>) is approximated to
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-114001r510"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium657x.png" alt="    1 ∮  1B        1 B  (r) 1 ∮        1 B (r)1        r B (r)
q =---   ---ϕdℓp ≈ ----ϕ-----   dℓp = ----ϕ-----2πr = ----ϕ---,
   2π    R Bp      2πBp (r)R0         2π Bp(r)R0      R0 Bp(r)
" class="math-display"  /></center></td><td class="equation-label">(510)</td></tr></table>
<!--l. 5916--><p class="nopar" >
</p><!--l. 5919--><p class="indent" >    
</p><!--l. 5921--><p class="indent" >    
</p><!--l. 5923--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">18.4   </span> <a 
 id="x1-11500018.4"></a>Coils system of EAST tokamak</h4>
   <h5 class="subsubsectionHead"><a 
 id="x1-11600018.4"></a>Poloidal ﬁeld (PF) coils</h5>
<!--l. 5927--><p class="noindent" >EAST has 14 superconducting poloidal ﬁeld (PF) coils (only 12 of them are independently powered).
The layout is shown in Fig. <a 
href="#x1-11600134">34<!--tex4ht:ref: 19-5-4-p1 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-11600134"></a>
                                                                                

                                                                                
<!--l. 5931--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/nbi_fig/fig10b/p.png" alt="pict"  
 width="175.65625pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 34: </span><span  
class="content">Coils system of EAST tokamak. Coils PF1 to PF6 are Central Solenoide (CS) coils
with 140 turns/coil. Both PF11 and PF12 have 64 turns, Both PF13 and PF14 have 32 turns.
PF7 and PF9 are adjacent to each other and connected in series and thus are considered as
one independent coil, with total turns being 248. The same situation applies for PF8 and PF10.
 Maximum current per turn in PF coils is 14.5kA. Locations of PF coils are from Refs. <span class="cite">[<a 
href="#Xysun2012">25</a>]</span><span class="cite">[<a 
href="#Xyychen2019">9</a>]</span>.
The inner green D-shaped structure corresponds to the vaccum vessel wall and the outer red
dashed D-shape corresponds to the TF-coils. Note that PF1-14 coils are all located outside of
the TF-coils. The small blue circles are “ﬂux loops” measuring the poloidal magnetic ﬂux. Red
coils are RMP copper coils, which generate 3D magnetic perturbations.</span></div><!--tex4ht:label?: x1-11600134 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 5946--><p class="indent" >   All the PF coils can be considered as shaping coils since they all have eﬀects in shaping the plasmas.
In practice, they are further classiﬁed according to their main roles. PF1 to PF6 form a solenoid in the
center of the torus and thus called Central Solenoide (CS) coils. Their main role is to induce electric
ﬁeld to drive current in the plasma and heat the plasma. As a result, they are often called
“Ohm heating coils”. PF13 and PF14 are mainly used to control (slow) vertical plasma
displacement and thus are often called “vertical ﬁeld coils” or “position control coils”. PF11 and
PF12 are used to triangularize the plasma and thus is called “shaping coils”. In order to
squeeze the plasma to form desied triangularity, their currents need to be in the opposite
direction of plamsa current (since two opposite currents repel each other). PF7+PF9 and
PF8+PF10 are often called (by EAST operators) as “big coils” or “divertor coils” since they have
the largest number of turns and current and are used to elongate the plasma to diverter
conﬁgurations.
</p><!--l. 5962--><p class="indent" >   Besides the 16 superconducting PF coils outside vaccum vessel, EAST has two small copper coils
within the vaccum vessel (2turn/coil), which are connected in anti-series and thus have opposite
currents. They are closer to the plasma (than other PF coils) and are used to control fast plasma
displacements, speciﬁcally VDEs (vertical displacement events). They are often called “fast control
coils”.
</p><!--l. 5969--><p class="indent" >    
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-11700018.4"></a>Toroidal magnetic Field (TF) coils and toroidal magnetic ﬁeld of EAST tokamak</h5>
<!--l. 5974--><p class="noindent" >Using Ampere’s circuital law
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-117001r511"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium658x.png" alt="∮
  B ⋅dl = μ0I,
" class="math-display"  /></center></td><td class="equation-label">(511)</td></tr></table>
<!--l. 5977--><p class="nopar" >
along the toroidal direction and assuming perfect toroidal symmetry, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-117002r512"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium659x.png" alt="2πRB ϕ = μ0I,
" class="math-display"  /></center></td><td class="equation-label">(512)</td></tr></table>
<!--l. 5981--><p class="nopar" >
which gives
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-117003r513"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium660x.png" alt="     -μ0I        −7 I
Bϕ = 2πR  = 2× 10  R .
" class="math-display"  /></center></td><td class="equation-label">(513)</td></tr></table>
<!--l. 5986--><p class="nopar" >
Neglecting the poloidal current contributed by the plasma, the poloidal current is determined solely by
the current in the TF coils. The EAST tokamak has 16 groups of TF coils with 132turns/coil (I got to
know the number of turns from ZhaoLiang Wang: <span 
class="cmmi-10">φ </span><span 
class="cmsy-10">× </span><span 
class="cmmi-10">R </span>= 12 <span 
class="cmsy-10">× </span>11 = 132). Denote the current in a
single turn by <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">s</span></sub>, then Eq. (<a 
href="#x1-117003r513">513<!--tex4ht:ref: 8-22-d1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-117004r514"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium661x.png" alt="     μ × 16× 132 × I              I
Bϕ = -0------------s-= 4.224 × 10−4-s
           2πR                    R
" class="math-display"  /></center></td><td class="equation-label">(514)</td></tr></table>
<!--l. 5995--><p class="nopar" >
Using this formula, the strength of the toroidal magnetic ﬁeld at <span 
class="cmmi-10">R </span>= 1<span 
class="cmmi-10">.</span>8<span 
class="cmmi-10">m </span>for <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">s</span></sub> = 10<sup><span 
class="cmr-7">4</span></sup><span 
class="cmmi-10">A </span>is calculated
to be <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = 2<span 
class="cmmi-10">.</span>34<span 
class="cmmi-10">T</span>. This was one of the two scenarios often used in EAST experiments (another scenario
is <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">s</span></sub> = 8 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmr-7">3</span></sup><span 
class="cmmi-10">A</span>). (The limit of the current in a single turn of the TF coils is 14<span 
class="cmmi-10">.</span>5kA (from B. J. Xiao’s
paper <span class="cite">[<a 
href="#Xxiao2008">30</a>]</span>).
</p><!--l. 6002--><p class="indent" >   Note that the exact equilibrium toroidal magnetic ﬁeld <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> is given by <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>)<span 
class="cmmi-10">∕R</span>. Compare this
with Eq. (<a 
href="#x1-117003r513">513<!--tex4ht:ref: 8-22-d1 --></a>), we know that the approximation made to obtain Eq. (<a 
href="#x1-117004r514">514<!--tex4ht:ref: 12-3-1 --></a>) is equivalent to
<span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>) <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">I</span><sub><span 
class="cmr-7">TF</span></sub><span 
class="cmmi-10">∕</span>2<span 
class="cmmi-10">π</span>, i.e. assuming <span 
class="cmmi-10">g </span>is a constant. The poloidal plasma current density <span 
class="cmmi-10">j</span><sub><span 
class="cmr-7">pol</span></sub> is related to <span 
class="cmmi-10">g</span>
by <span 
class="cmmi-10">j</span><sub><span 
class="cmr-7">pol</span></sub> = <span 
class="cmmi-10">g</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">Ψ</span>)<span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕μ</span><sub><span 
class="cmr-7">0</span></sub>. The constant <span 
class="cmmi-10">g </span>corresponds to zero plasma poloidal current, which is consistent
to the assumption used to obtain Eq. (<a 
href="#x1-117004r514">514<!--tex4ht:ref: 12-3-1 --></a>).
                                                                                

                                                                                
</p><!--l. 6011--><p class="indent" >   Let us estimate the safety factor value near the plasma edge using the total plasma current and the
current in a single turn of TF coils <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">s</span></sub>. For divertor magnetic conﬁguration, the plasma edge is at the
saperatrix, where <span 
class="cmmi-10">q </span><span 
class="cmsy-10">→∞</span>. To get a characteristic safety factor value that is ﬁnite, one often
chooses the edge to be the magnetic surface that encloses 95% of the poloidal magnetic
ﬂux. Denote this surface by <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">95</span></sub> and the value of <span 
class="cmmi-10">q </span>at this surface by <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">95</span></sub>, which is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-117005r515"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium662x.png" alt="     Bϕ,axis-a---
q95 ≈  Bp   Raxis,
" class="math-display"  /></center></td><td class="equation-label">(515)</td></tr></table>
<!--l. 6021--><p class="nopar" >
where <span 
class="cmmi-10">a </span>is the minor radius of the surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">95</span></sub>, and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">axis</span></sub> the major radius of the magnetic axis, <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ,</span><span 
class="cmr-7">axis</span></sub>
is the the magnitude of toroidal magnetic ﬁeld at the magnetic axis, and <span class="overline"><span 
class="cmmi-10">B</span></span><sub><span 
class="cmmi-7">p</span></sub> is the average
poloidal magnetic ﬁeld on the surface, <span class="overline"><span 
class="cmmi-10">B</span></span><sub><span 
class="cmmi-7">p</span></sub> <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕</span>(2<span 
class="cmmi-10">πa</span>). Using Eq. (<a 
href="#x1-117004r514">514<!--tex4ht:ref: 12-3-1 --></a>), Eq. (<a 
href="#x1-117005r515">515<!--tex4ht:ref: 23-1-16-3 --></a>) is written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-117006r516"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium663x.png" alt="     4.224× 10−4Is2πa2
q95 ≈-----μ0Ip----R2---,
                    axis
" class="math-display"  /></center></td><td class="equation-label">(516)</td></tr></table>
<!--l. 6031--><p class="nopar" >
For EAST, tipically <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">axis</span></sub> = 1<span 
class="cmmi-10">.</span>85<span 
class="cmmi-10">m </span>and <span 
class="cmmi-10">a </span>= 0<span 
class="cmmi-10">.</span>45<span 
class="cmmi-10">m</span>. Using this, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-117007r517"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium664x.png" alt="        I
q95 ≈ 125-s.
        Ip
" class="math-display"  /></center></td><td class="equation-label">(517)</td></tr></table>
<!--l. 6036--><p class="nopar" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x1-11800018.4"></a>RMP coils of EAST</h5>
<!--l. 6041--><p class="noindent" >The so-called resonant magnetic perturbation (RMP) coils are 3D coils that are used to suppress or
mitigate edge localized modes. The shape and location of RMP coils of EAST tokamak are plotted in
Fig. <a 
href="#x1-11800135">35<!--tex4ht:ref: 19-5-4-p2 --></a>.
</p><!--l. 6045--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-11800135"></a>
                                                                                

                                                                                
<!--l. 6048--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/nbi_fig/fig13d/p.png" alt="pict"  
 width="262.9825pt" /> <img 
src="my_figure/home/yj/project_new/nbi_fig/fig10/p.png" alt="pict"  
 width="103.38625pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 35: </span><span  
class="content">Location of the RMP coils on EAST tokamak in 3D view (left) and poloidal view (right).</span></div><!--tex4ht:label?: x1-11800135 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 6053--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">18.5   </span> <a 
 id="x1-11900018.5"></a>Comparison of major tokamaks in the world</h4>
<!--l. 6057--><p class="noindent" >The size of EAST is similar to that of DIII-D tokamak. The main parameters are summarized in Table.
<a 
href="#x1-1190011">1<!--tex4ht:ref: 12-3-2 --></a>. A signiﬁcant diﬀerence between EAST and DIII-D is that DIII-D has a larger minor radius, which
makes DIII-D able to operate with a larger toroidal current than that EAST can do for the same
current density. Another signiﬁcant diﬀerence between EAST and DIII-D is that the coils of EAST are
supper-conducting while the coils of DIII-D are not. The supper-conducting coils enable EAST to
operate at longer pulse.
</p>
   <div class="table">
                                                                                

                                                                                
<!--l. 6065--><p class="indent" >   <a 
 id="x1-1190011"></a></p><hr class="float" /><div class="float" 
>
                                                                                

                                                                                
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /></colgroup><colgroup id="TBL-2-2g"><col 
id="TBL-2-2" /></colgroup><colgroup id="TBL-2-3g"><col 
id="TBL-2-3" /></colgroup><colgroup id="TBL-2-4g"><col 
id="TBL-2-4" /></colgroup><colgroup id="TBL-2-5g"><col 
id="TBL-2-5" /></colgroup><colgroup id="TBL-2-6g"><col 
id="TBL-2-6" /></colgroup><colgroup id="TBL-2-7g"><col 
id="TBL-2-7" /></colgroup><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-1"  
class="td11">                          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-2"  
class="td11">    EAST      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-3"  
class="td11"> DIII-D<span class="cite">[<a 
href="#XLuxon2002">20</a>]</span> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-4"  
class="td11"> KSTAR<span class="cite">[<a 
href="#XLee2001">18</a>]</span>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-5"  
class="td11">SPARC</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-6"  
class="td11">WEST</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-7"  
class="td11"> JET </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-1"  
class="td11">       Major radius <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-2"  
class="td11">    1<span 
class="cmmi-10">.</span>85<span 
class="cmmi-10">m     </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-3"  
class="td11">   1<span 
class="cmmi-10">.</span>67<span 
class="cmmi-10">m    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-4"  
class="td11">    1<span 
class="cmmi-10">.</span>8<span 
class="cmmi-10">m     </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-5"  
class="td11"> 1<span 
class="cmmi-10">.</span>85<span 
class="cmmi-10">m </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-6"  
class="td11"> 2<span 
class="cmmi-10">.</span>5<span 
class="cmmi-10">m </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-7"  
class="td11">2.96m</td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-1"  
class="td11">       minor radius <span 
class="cmmi-10">a          </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-2"  
class="td11">    0<span 
class="cmmi-10">.</span>45<span 
class="cmmi-10">m     </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-3"  
class="td11">   0<span 
class="cmmi-10">.</span>67<span 
class="cmmi-10">m    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-4"  
class="td11">    0<span 
class="cmmi-10">.</span>5<span 
class="cmmi-10">m     </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-5"  
class="td11"> 0<span 
class="cmmi-10">.</span>57<span 
class="cmmi-10">m </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-6"  
class="td11"> 0<span 
class="cmmi-10">.</span>5<span 
class="cmmi-10">m </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-7"  
class="td11"> 0.9m </td></tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-1"  
class="td11"> elongation </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-2"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-3"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-4"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-5"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-6"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-4-7"  
class="td11"></td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-1"  
class="td11">       Plasma volume           </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-2"  
class="td11">             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-3"  
class="td11">          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-4"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-5"  
class="td11"> 20<span 
class="cmmi-10">m</span><sup><span 
class="cmr-7">3</span></sup>  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-6"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-5-7"  
class="td11">     </td></tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-1"  
class="td11"> No. of TF coils, turns, current </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-2"  
class="td11">16, 130, 14.5kA</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-3"  
class="td11">24, 6, 126kA</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-4"  
class="td11">16, 56, 35.2kA</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-5"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-6"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-6-7"  
class="td11"></td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-1"  
class="td11">          <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span></sub> at <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>                   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-2"  
class="td11">    3<span 
class="cmmi-10">.</span>26<span 
class="cmmi-10">T      </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-3"  
class="td11">   2<span 
class="cmmi-10">.</span>17<span 
class="cmmi-10">T    </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-4"  
class="td11">    3.5T      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-5"  
class="td11"> 12.2T </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-6"  
class="td11"> 3.7T </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-7-7"  
class="td11">3.45T</td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-1"  
class="td11"> CS coil module<span 
class="cmsy-10">×</span>turn<span 
class="cmsy-10">×</span>current </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-2"  
class="td11">6<span 
class="cmsy-10">×</span>120<span 
class="cmsy-10">×</span>14.5kA</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-3"  
class="td11">          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-4"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-5"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-6"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-8-7"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-1"  
class="td11">  No. of independent PF coils   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-2"  
class="td11">     6+6        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-3"  
class="td11">   ?+18     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-4"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-5"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-6"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-9-7"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-1"  
class="td11">Available solenoid magnetic ﬂux</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-2"  
class="td11">    12Vs       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-3"  
class="td11">  10<span 
class="cmmi-10">.</span>5Vs    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-4"  
class="td11">    17Vs      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-5"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-6"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-10-7"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-11-1"  
class="td11">   Maximum plasma current    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-11-2"  
class="td11">    1.0MA      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-11-3"  
class="td11">  3<span 
class="cmmi-10">.</span>0MA    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-11-4"  
class="td11">    2MA      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-11-5"  
class="td11">8<span 
class="cmmi-10">.</span>7MA</td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-11-6"  
class="td11"> 1MA </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-11-7"  
class="td11"> 5MA </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-12-1"  
class="td11">        Pulse length             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-12-2"  
class="td11">     400s       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-12-3"  
class="td11">    10s      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-12-4"  
class="td11">    300s       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-12-5"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-12-6"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-12-7"  
class="td11">     </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-13-1"  
class="td11">      superconducting?          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-13-2"  
class="td11">     Yes        </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-13-3"  
class="td11">    No      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-13-4"  
class="td11">     Yes       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-13-5"  
class="td11">      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-13-6"  
class="td11"> Yes  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-2-13-7"  
class="td11"> No  </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-14-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-14-1"  
class="td11">                           </td></tr></table></div>
<!--l. 6103--><p class="noindent" > 
<br /> </p><div class="caption" 
><span class="id">Table 1: </span><span  
class="content">Comparison of main parameters of EAST, DIII-D, JET, and ITER tokamaks. The <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span></sub>
of EAST is calculated at <span 
class="cmmi-10">R </span>= 1<span 
class="cmmi-10">.</span>85<span 
class="cmmi-10">m </span>by using Eq. (<a 
href="#x1-117004r514">514<!--tex4ht:ref: 12-3-1 --></a>) with <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">s</span></sub> = 14<span 
class="cmmi-10">.</span>5kA (the maximal current
allowed). The currents listed in the table are maximum plasma current whereas typical plasma
currents for EAST are 0<span 
class="cmmi-10">.</span>5MA and for DIII-D are 2MA or less.</span></div><!--tex4ht:label?: x1-1190011 -->
                                                                                

                                                                                
   </div><hr class="endfloat" />
   </div>
   <div class="table">
                                                                                

                                                                                
<!--l. 6112--><p class="indent" >   <a 
 id="x1-1190022"></a></p><hr class="float" /><div class="float" 
>
                                                                                

                                                                                
<div class="tabular"> <table id="TBL-3" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1" /></colgroup><colgroup id="TBL-3-2g"><col 
id="TBL-3-2" /></colgroup><colgroup id="TBL-3-3g"><col 
id="TBL-3-3" /></colgroup><colgroup id="TBL-3-4g"><col 
id="TBL-3-4" /></colgroup><colgroup id="TBL-3-5g"><col 
id="TBL-3-5" /></colgroup><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-1"  
class="td11">                          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-2"  
class="td11">  ITER<span class="cite">[<a 
href="#XAymar2002">1</a>]</span>    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-3"  
class="td11">CFETR(old version)</td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-4"  
class="td11">CFETR (new)</td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-1-5"  
class="td11">    BEST      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-1"  
class="td11">       Major radius <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-2"  
class="td11">    6.2m      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-3"  
class="td11">       5.7m          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-4"  
class="td11">    7.2m      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-2-5"  
class="td11">    3.6m       </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-1"  
class="td11">       minor radius <span 
class="cmmi-10">a          </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-2"  
class="td11">    2.0m      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-3"  
class="td11">       1.6m          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-4"  
class="td11">    2.2m      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-3-5"  
class="td11">             </td></tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-1"  
class="td11"> elongation </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-2"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-3"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-4"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-4-5"  
class="td11"></td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-5-1"  
class="td11"> No. of TF coils, turns, current </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-5-2"  
class="td11">18, 134, 68kA</td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-5-3"  
class="td11">  16, 132, 67.5kA   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-5-4"  
class="td11">   16, ?, ?     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-5-5"  
class="td11">16, 152, 45.6kA</td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-6-1"  
class="td11">          <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span></sub> at <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>                   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-6-2"  
class="td11">   5.29T     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-6-3"  
class="td11">      5.00T          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-6-4"  
class="td11">    6.5T       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-6-5"  
class="td11">             </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-7-1"  
class="td11"> CS coil module<span 
class="cmsy-10">×</span>turn<span 
class="cmsy-10">×</span>current </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-7-2"  
class="td11">           </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-7-3"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-7-4"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-7-5"  
class="td11">             </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-8-1"  
class="td11">  No. of independent PF coils   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-8-2"  
class="td11">           </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-8-3"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-8-4"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-8-5"  
class="td11">             </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-9-1"  
class="td11">Available solenoid magnetic ﬂux</td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-9-2"  
class="td11">           </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-9-3"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-9-4"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-9-5"  
class="td11">             </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-10-1"  
class="td11">   Maximum plasma current    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-10-2"  
class="td11">   15MA     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-10-3"  
class="td11">      10MA          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-10-4"  
class="td11">    14MA      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-10-5"  
class="td11">             </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-11-1"  
class="td11">        Pulse length             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-11-2"  
class="td11">    400s      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-11-3"  
class="td11">                 </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-11-4"  
class="td11">            </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-11-5"  
class="td11">             </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-12-1"  
class="td11">      superconducting?          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-12-2"  
class="td11">    Yes       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-12-3"  
class="td11">       Yes           </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-12-4"  
class="td11">     Yes       </td><td  style="white-space:nowrap; text-align:center;" id="TBL-3-12-5"  
class="td11">     Yes        </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-3-13-1"  
class="td11">                           </td></tr></table></div>
<!--l. 6142--><p class="noindent" > 
<br /> </p><div class="caption" 
><span class="id">Table 2: </span><span  
class="content">Continued from Table <a 
href="#x1-1190011">1<!--tex4ht:ref: 12-3-2 --></a>.</span></div><!--tex4ht:label?: x1-1190022 -->
                                                                                

                                                                                
   </div><hr class="endfloat" />
   </div>
<!--l. 6146--><p class="indent" >    
</p><!--l. 6148--><p class="indent" >    
</p>
   <div class="table">
                                                                                

                                                                                
<!--l. 6150--><p class="indent" >   <a 
 id="x1-1190033"></a></p><hr class="float" /><div class="float" 
>
                                                                                

                                                                                
<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0"  
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1" /></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2" /></colgroup><colgroup id="TBL-4-3g"><col 
id="TBL-4-3" /></colgroup><colgroup id="TBL-4-4g"><col 
id="TBL-4-4" /></colgroup><colgroup id="TBL-4-5g"><col 
id="TBL-4-5" /></colgroup><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-1"  
class="td11">                          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-2"  
class="td11">ASDEX-U</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-3"  
class="td11">  HL-2M   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-4"  
class="td11">NSTX</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-1-5"  
class="td11">MAST</td></tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-1"  
class="td11"> Major radius <span 
class="cmmi-10">R</span><sub>
<span 
class="cmr-7">0</span></sub>             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-2"  
class="td11">  1.65m   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-3"  
class="td11">  1.78m   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-4"  
class="td11">0.85m</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-2-5"  
class="td11"> 0.9m </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-1"  
class="td11">       minor radius <span 
class="cmmi-10">a          </span></td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-2"  
class="td11">  0.7m    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-3"  
class="td11">  0.65m   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-4"  
class="td11">0.68m</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-3-5"  
class="td11"> 0.6m </td></tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-1"  
class="td11"> elongation </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-2"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-3"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-4"  
class="td11"> </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-4-5"  
class="td11"></td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-5-1"  
class="td11"> No. of TF coils, turns, current </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-5-2"  
class="td11">  16,?,?   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-5-3"  
class="td11">20,7,190kA</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-5-4"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-5-5"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-6-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-6-1"  
class="td11">          <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span></sub> at <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>                   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-6-2"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-6-3"  
class="td11">  2.99T    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-6-4"  
class="td11"> 0.3T </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-6-5"  
class="td11"> 0.55T </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-7-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-7-1"  
class="td11"> CS coil module<span 
class="cmsy-10">×</span>turn<span 
class="cmsy-10">×</span>current </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-7-2"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-7-3"  
class="td11">   1,?,?    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-7-4"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-7-5"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-8-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-8-1"  
class="td11">  No. of independent PF coils   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-8-2"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-8-3"  
class="td11">  1+16    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-8-4"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-8-5"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-9-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-9-1"  
class="td11">Available solenoid magnetic ﬂux</td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-9-2"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-9-3"  
class="td11">   14Vs    </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-9-4"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-9-5"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-10-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-10-1"  
class="td11">    typical plasma current      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-10-2"  
class="td11">  1.6MA  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-10-3"  
class="td11">  2.5MA   </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-10-4"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-10-5"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-11-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-11-1"  
class="td11">        Pulse length             </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-11-2"  
class="td11">         </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-11-3"  
class="td11">    5s      </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-11-4"  
class="td11">     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-11-5"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-12-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-12-1"  
class="td11">      superconducting?          </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-12-2"  
class="td11">   No     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-12-3"  
class="td11">   No     </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-12-4"  
class="td11"> No  </td><td  style="white-space:nowrap; text-align:center;" id="TBL-4-12-5"  
class="td11">      </td>
</tr><tr 
class="hline"><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td><td><hr /></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-13-"><td  style="white-space:nowrap; text-align:center;" id="TBL-4-13-1"  
class="td11">                           </td></tr></table></div>
<!--l. 6179--><p class="noindent" > 
<br /> </p><div class="caption" 
><span class="id">Table 3: </span><span  
class="content">Continued from Table <a 
href="#x1-1190022">2<!--tex4ht:ref: 22-1-27-1 --></a>.</span></div><!--tex4ht:label?: x1-1190033 -->
                                                                                

                                                                                
   </div><hr class="endfloat" />
   </div>
<!--l. 6183--><p class="indent" >   DIII-D has 24 groups of TF coils with 6turns/coil, i.e., total turns are 24 <span 
class="cmsy-10">× </span>6 = 144, with a
maximum current of <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">s</span></sub> = 126kA in a single turn<span class="cite">[<a 
href="#XLuxon2002">20</a>]</span>. Using formula (<a 
href="#x1-117003r513">513<!--tex4ht:ref: 8-22-d1 --></a>), the toroidal ﬁled at
<span 
class="cmmi-10">R </span>= 1<span 
class="cmmi-10">.</span>67<span 
class="cmmi-10">m </span>can be calculated, giving 2<span 
class="cmmi-10">.</span>17<span 
class="cmmi-10">T</span>.
</p><!--l. 6188--><p class="indent" >   DIII-D is special in that its poloidal ﬁeld (PF) coils are located inside of the TF-coils, which makes
the PF-coils more close to the plasma and thus more eﬃcient in shaping the plasma. However, this
nested structure is diﬃcult to assemble. In superconducting tokamaks (e.g., EAST, KSTAR, ITER), PF
coils are all placed outside of the TF-coils.
</p><!--l. 6194--><p class="indent" >   I noticed that HL-2M also has the PF coils located within the TF-coils, similar to DIII-D. This
remind me that this layout may apply to all non-superconducting tokamaks (to be conﬁrmed, No,
non-superconducting tokamak ASDEX-U has PF coils outside of TF coils).
</p><!--l. 6199--><p class="indent" >   KSTAR has 16 TF coils and 14 PF coils. Both of the TF and PF coil system use internally cooled
superconductors. The nominal current in TF coils is 35<span 
class="cmmi-10">.</span>2kA<span 
class="cmmi-10">∕</span>turn with 56turns<span 
class="cmmi-10">∕</span>coil and all coils
connected in series<span class="cite">[<a 
href="#Xsong2007">24</a>]</span>. Using these information and formula (<a 
href="#x1-117003r513">513<!--tex4ht:ref: 8-22-d1 --></a>), the toroidal ﬁled at <span 
class="cmmi-10">R </span>= 1<span 
class="cmmi-10">.</span>8<span 
class="cmmi-10">m </span>can
be calculated, giving 3<span 
class="cmmi-10">.</span>5<span 
class="cmmi-10">T</span>. The PF coil system consists of 8 Central Solenoide (CS) coils and 6 outer
PF coils and can provide 17 V-sec.
</p><!--l. 6207--><p class="indent" >   ITER has 18 TF coils with number of turns in one coil being 134 and current per turn 68kA<span class="cite">[<a 
href="#Xsborchia2008">5</a>]</span>.
Using these information and formula (<a 
href="#x1-117003r513">513<!--tex4ht:ref: 8-22-d1 --></a>), the toroidal ﬁled at <span 
class="cmmi-10">R </span>= 6<span 
class="cmmi-10">.</span>2<span 
class="cmmi-10">m </span>can be calculated, giving
5<span 
class="cmmi-10">.</span>29<span 
class="cmmi-10">T</span>
</p><!--l. 6212--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">18.6   </span> <a 
 id="x1-12000018.6"></a>Miller’s formula for shaped ﬂux surfaces</h4>
<!--l. 6216--><p class="noindent" >According to Refs. <span class="cite">[<a 
href="#Xchen2010">8</a>, <a 
href="#Xmiller1998">21</a>]</span>, Miller’s formula for a series of shaped ﬂux surfaces is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-120001r518"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium665x.png" alt="R = R0(r)+ rcos{𝜃+ arcsin[δ(r)sin𝜃]},
" class="math-display"  /></center></td><td class="equation-label">(518)</td></tr></table>
<!--l. 6221--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-120002r519"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium666x.png" alt="Z = κ(r)rsin 𝜃,
" class="math-display"  /></center></td><td class="equation-label">(519)</td></tr></table>
<!--l. 6224--><p class="nopar" >
where <span 
class="cmmi-10">κ</span>(<span 
class="cmmi-10">r</span>) and <span 
class="cmmi-10">δ</span>(<span 
class="cmmi-10">r</span>) are elongation and triangularity proﬁle, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">r</span>) is the Shafranov shift proﬁle, which
is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-120003r520"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium667x.png" alt="                 ′[    ( )2]
R0(r) = R0 (a)− aR0-1 −  r-   ,
                2       a
" class="math-display"  /></center></td><td class="equation-label">(520)</td></tr></table>
<!--l. 6230--><p class="nopar" >
where <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmsy-10">′ </span>is a constant, <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">a</span>) is the major radius of the center of the boundary ﬂux surface. The
triangularity proﬁle is
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-120004r521"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium668x.png" alt="        (r)2
δ(r) = δ0--  ,
         a
" class="math-display"  /></center></td><td class="equation-label">(521)</td></tr></table>
<!--l. 6235--><p class="nopar" >
and the elongation proﬁle is
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-120005r522"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium669x.png" alt="                  (r)4
κ(r) = κ0 − 0.3+ 0.3-  .
                   a
" class="math-display"  /></center></td><td class="equation-label">(522)</td></tr></table>
<!--l. 6239--><p class="nopar" >
The nominal ITER parameters are <span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>8, <span 
class="cmmi-10">δ</span><sub><span 
class="cmr-7">0</span></sub> = 0<span 
class="cmmi-10">.</span>5 and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmsy-10">′ </span>= <span 
class="cmsy-10">−</span>0<span 
class="cmmi-10">.</span>16. I wrote a code to plot the
shapes of the ﬂux surface (/home/yj/project/miller_ﬂux_surface). An example of the results is given in
Fig. <a 
href="#x1-12000636">36<!--tex4ht:ref: 8-15-4 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-12000636"></a>
                                                                                

                                                                                
<br /> <div class="caption" 
><span class="id">Fig. 36:  </span><span  
class="content">Flux-surfaces  given  by  Eqs.  (<a 
href="#x1-120001r518">518<!--tex4ht:ref: 8-15-1 --></a>)  and  (<a 
href="#x1-120002r519">519<!--tex4ht:ref: 8-15-2 --></a>)  with  <span 
class="cmmi-10">r∕a  </span>varying  from  0.1  to  1.0
(corresponding boundary surface). Other parameters are <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">a</span>)<span 
class="cmmi-10">∕a </span>=  3, <span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub>  =  1<span 
class="cmmi-10">.</span>8, <span 
class="cmmi-10">δ</span><sub><span 
class="cmr-7">0</span></sub>  =  0<span 
class="cmmi-10">.</span>5,
<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmsy-10">′ </span>= <span 
class="cmsy-10">−</span>0<span 
class="cmmi-10">.</span>16.</span></div><!--tex4ht:label?: x1-12000636 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 6253--><p class="indent" >    
</p><!--l. 6255--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">18.7   </span> <a 
 id="x1-12100018.7"></a>Double transport barriers pressure proﬁle</h4>
<!--l. 6259--><p class="noindent" >An analytic expression for the pressure proﬁle of double (inner and external) transport barriers is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-121001r523"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium670x.png" alt="         (        ( − (ψ − ψ )) )   (       ( − (ψ − ψ )))
P (ψ) = ai 1+ tanh  -------i-   +ae  1+ tanh  -------e-   − c
                       wi                        we
" class="math-display"  /></center></td><td class="equation-label">(523)</td></tr></table>
<!--l. 6265--><p class="nopar" >
where <span 
class="cmmi-10">ψ </span>is the normalized poloidal ﬂux, <span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">i</span></sub> and <span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">e</span></sub> are the width of the inner and external barriers,  <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">i</span></sub>
and <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">e</span></sub> are the locations of the barriers, <span 
class="cmmi-10">a</span><sub><span 
class="cmmi-7">i</span></sub> and <span 
class="cmmi-10">a</span><sub><span 
class="cmmi-7">e</span></sub> is the height of the barriers, <span 
class="cmmi-10">c </span>is a constant to ensure
<span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">ψ</span>) = 0 at <span 
class="cmmi-10">ψ </span>= 1.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-12100237"></a>
                                                                                

                                                                                
<!--l. 6272--><p class="noindent" > <img 
src="my_figure/home/yj/theory/figures/transp_barrier.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 37: </span><span  
class="content">Pressure proﬁle of double (inner and external) transport barriers given by Eq. (<a 
href="#x1-121001r523">523<!--tex4ht:ref: 5-26-5 --></a>)
with <span 
class="cmmi-10">a</span><sub><span 
class="cmmi-7">i</span></sub> = 1, <span 
class="cmmi-10">b</span><sub><span 
class="cmmi-7">i</span></sub> = 0<span 
class="cmmi-10">.</span>2, <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">i</span></sub> = 0<span 
class="cmmi-10">.</span>36, <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">e</span></sub> = 0<span 
class="cmmi-10">.</span>96, <span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">i</span></sub> = 0<span 
class="cmmi-10">.</span>2, <span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">e</span></sub> = 0<span 
class="cmmi-10">.</span>04, <span 
class="cmmi-10">c </span>= 0.</span></div><!--tex4ht:label?: x1-12100237 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 6278--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-12100338"></a>
                                                                                

                                                                                
<!--l. 6281--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig37/pressure.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 38: </span><span  
class="content">Equilibrium pressure proﬁle for EAST discharge #38300 at 3.9s (reconstructed by EFIT
code, gﬁle name: g038300.03900), which shows a boundary transport barrier.</span></div><!--tex4ht:label?: x1-12100338 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">18.8   </span> <a 
 id="x1-12200018.8"></a>Ballooning transformation</h4>
<!--l. 6289--><p class="noindent" >To construct a periodic function about <span 
class="cmmi-10">𝜃</span>, we introduces a function <span class="overline"><span 
class="cmmi-10">z</span></span>(<span 
class="cmmi-10">𝜃</span>) which is deﬁned over
<span 
class="cmsy-10">−∞ </span><span 
class="cmmi-10">&#x003C; 𝜃 &#x003C; </span><span 
class="cmsy-10">∞ </span>and vanishes suﬃciently fast as <span 
class="cmsy-10">|</span><span 
class="cmmi-10">𝜃</span><span 
class="cmsy-10">|→∞ </span>so that the following inﬁnite summation
converge:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-122001r524"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium671x.png" alt=" ∞∑
    z(𝜃 +2πl).
l=− ∞
" class="math-display"  /></center></td><td class="equation-label">(524)</td></tr></table>
<!--l. 6295--><p class="nopar" >
If we use the above sum to deﬁne a function
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-122002r525"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium672x.png" alt="       ∞∑  -
z(𝜃) =     z(𝜃 +2πl),
      l=− ∞
" class="math-display"  /></center></td><td class="equation-label">(525)</td></tr></table>
<!--l. 6300--><p class="nopar" >
then it is obvious that
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-122003r526"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="tokamak_equilibrium673x.png" alt="z(𝜃 +2π ) = z(𝜃),
" class="math-display"  /></center></td><td class="equation-label">(526)</td></tr></table>
<!--l. 6304--><p class="nopar" >
i.e., <span 
class="cmmi-10">z</span>(<span 
class="cmmi-10">𝜃</span>) is a periodic function about <span 
class="cmmi-10">𝜃 </span>with period of 2<span 
class="cmmi-10">π</span>.
</p><!--l. 6308--><p class="indent" >   If we use the right-hand-side of Eq. (<a 
href="#x1-122002r525">525<!--tex4ht:ref: 12-13-e1 --></a>) to represent <span 
class="cmmi-10">z</span>(<span 
class="cmmi-10">𝜃</span>), then we do not need to worry about the
periodic property of <span 
class="cmmi-10">z</span>(<span 
class="cmmi-10">𝜃</span>) (the periodic property is guaranteed by the representation)
</p><!--l. 6312--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">A   </span> <a 
 id="x1-123000A"></a></h3>
<!--l. 6314--><p class="noindent" >[In passing, we note that <span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmmi-10">R </span>is the covariant toroidal component of <span 
class="cmbx-10">A </span>in cylindrical coordinates
(<span 
class="cmmi-10">R,ϕ,Z</span>). The proof is as follows. Note that the covariant form of <span 
class="cmbx-10">A </span>should be expressed in terms of the
contravariant basis vector (<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">R</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Z</span>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-123001r527"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium674x.png" alt="A = A  ∇R + A ∇ ϕ+ A  ∇Z.
      1      2       3
" class="math-display"  /></center></td><td class="equation-label">(527)</td></tr></table>
<!--l. 6321--><p class="nopar" >
where <span 
class="cmmi-10">A</span><sub><span 
class="cmr-7">2</span></sub> is the covariant toroidal component of <span 
class="cmbx-10">A</span>. To obtain <span 
class="cmmi-10">A</span><sub><span 
class="cmr-7">2</span></sub>, we take scalar product of Eq. (<a 
href="#x1-123001r527">527<!--tex4ht:ref: 12-29-1 --></a>)
with <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ϕ </span>and use the orthogonality relation (<a 
href="#x1-37001r102">102<!--tex4ht:ref: 4-6-e1 --></a>), which gives
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-123002r528"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium675x.png" alt="   ∂r
A ⋅---= A2.
   ∂ϕ
" class="math-display"  /></center></td><td class="equation-label">(528)</td></tr></table>
                                                                                

                                                                                
<!--l. 6329--><p class="nopar" >
In cylindrical coordinates (<span 
class="cmmi-10">R,ϕ,Z</span>), the location vector is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-123003r529"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium676x.png" alt="r(R, Z,ϕ) = R ˆR(ϕ)+ Z ˆZ+ 0ˆϕ
" class="math-display"  /></center></td><td class="equation-label">(529)</td></tr></table>
<!--l. 6334--><p class="nopar" >
where <img 
src="tokamak_equilibrium677x.png" alt="ˆ
R"  class="circ"  />, <img 
src="tokamak_equilibrium678x.png" alt="ˆ
Z"  class="circ"  />, and <img 
src="tokamak_equilibrium679x.png" alt="ˆ
ϕ"  class="circ"  /> are unit vectors along <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂R</span>, <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂Z</span>, and <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂ϕ</span>, respectively, i.e.
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-123004r530"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium680x.png" alt="        |  |           |  |          |  |
 ˆ   ∂r-||∂r||−1  ˆ  -∂r ||∂r||−1 ˆ   ∂r-||∂r||−1
R =  ∂R |∂R|  ,Z = ∂Z  |∂Z |  ,ϕ = ∂ϕ |∂ϕ|
" class="math-display"  /></center></td><td class="equation-label">(530)</td></tr></table>
<!--l. 6345--><p class="nopar" >
Using this, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-123005r531"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium681x.png" alt="∂r
---= Rˆϕ,
∂ϕ
" class="math-display"  /></center></td><td class="equation-label">(531)</td></tr></table>
                                                                                

                                                                                
<!--l. 6350--><p class="nopar" >
Use Eq. (<a 
href="#x1-123005r531">531<!--tex4ht:ref: 12-29-3 --></a>) in Eq. (<a 
href="#x1-123002r528">528<!--tex4ht:ref: 10-16-p1 --></a>) giving
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-123006r532"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium682x.png" alt="A  = A R,
 2    ϕ
" class="math-display"  /></center></td><td class="equation-label">(532)</td></tr></table>
<!--l. 6354--><p class="nopar" >
with <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> deﬁned by <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅</span><img 
src="tokamak_equilibrium683x.png" alt="ˆϕ"  class="circ"  />. Equation (<a 
href="#x1-123006r532">532<!--tex4ht:ref: 20-10-15-a3 --></a>) indicates that <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmmi-10">R </span>is the covariant toroidal
component of the vector potential.]
</p><!--l. 6359--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.1   </span> <a 
 id="x1-124000A.1"></a>Solovév equilibrium</h4>
<!--l. 6361--><p class="noindent" >For most choices of <span 
class="cmmi-10">P</span>(<span 
class="cmmi-10">Ψ</span>) and <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), the GS equation (<a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>) has to be solved numerically. For the
particular choice of <span 
class="cmmi-10">P </span>and <span 
class="cmmi-10">g </span>proﬁles given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124001r533"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium684x.png" alt="dP     c1
dΨ-= − μ-,
        0
" class="math-display"  /></center></td><td class="equation-label">(533)</td></tr></table>
<!--l. 6366--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124002r534"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium685x.png" alt="  dg
g ---= − c2R20,
  dΨ
" class="math-display"  /></center></td><td class="equation-label">(534)</td></tr></table>
<!--l. 6369--><p class="nopar" >
analytical solution to the GS equation can be found, which is given by<span class="cite">[<a 
href="#Xjardin2010">16</a>]</span>
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124003r535"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium686x.png" alt="    1                 1
Ψ = -(c2R20 + c0R2)Z2 +-(c1 − c0)(R2 − R20)2,
    2                 8
" class="math-display"  /></center></td><td class="equation-label">(535)</td></tr></table>
<!--l. 6375--><p class="nopar" >
where <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub>, <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">1</span></sub>, <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">2</span></sub>, and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> are arbitrary constants. [Proof: By direct substitution, we can verify <span 
class="cmmi-10">Ψ </span>of this
form is indeed a solution to the GS equation (<a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>).] A useful choice for tokamak application is
to set <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">0</span></sub> = <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub>), <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">1</span></sub> = <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup> + 1)<span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub>), and <span 
class="cmmi-10">c</span><sub><span 
class="cmr-7">2</span></sub> = 0. Then Eq. (<a 
href="#x1-124003r535">535<!--tex4ht:ref: 4-12-p1 --></a>) is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124004r536"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium687x.png" alt="       B    [       κ2         ]
Ψ = ---20--  R2Z2 + -0(R2 − R20)2 ,
    2R 0κ0q0         4
" class="math-display"  /></center></td><td class="equation-label">(536)</td></tr></table>
<!--l. 6384--><p class="nopar" >
which can be solved analytically to give the explicit form of the contour of <span 
class="cmmi-10">Ψ </span>on (<span 
class="cmmi-10">R,Z</span>)
plane:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124005r537"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium688x.png" alt="        ∘ -----------------------
      1-  2R20κ0q0    κ20  2    2 2
Z = ± R     B0   Ψ − 4 (R  − R 0),
" class="math-display"  /></center></td><td class="equation-label">(537)</td></tr></table>
<!--l. 6390--><p class="nopar" >
which indicates the magnetic surfaces are up-down symmetrical. Using Eq. (<a 
href="#x1-124001r533">533<!--tex4ht:ref: 11-1-2 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124006r538"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium689x.png" alt="dP     c1     B0(κ20 + 1)
dΨ-= − μ0-= − μ0R2κ0q0-,
                  0
" class="math-display"  /></center></td><td class="equation-label">(538)</td></tr></table>
<!--l. 6396--><p class="nopar" >
the pressure is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124007r539"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium690x.png" alt="        B  (κ2 + 1)
P = P0 −--0-20----Ψ,
         μ0R0κ0q0
" class="math-display"  /></center></td><td class="equation-label">(539)</td></tr></table>
<!--l. 6401--><p class="nopar" >
where <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> is a constant of integration. Note Eq. (<a 
href="#x1-124004r536">536<!--tex4ht:ref: 6-5-p1 --></a>) indicates that that <span 
class="cmmi-10">Ψ </span>= 0 at the magnetic axis
(<span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">,Z </span>= 0). Therefore, Eq. (<a 
href="#x1-124007r539">539<!--tex4ht:ref: 6-5-1 --></a>) indicates that <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> is the pressure at the magnetic axis. The
toroidal ﬁeld function <span 
class="cmmi-10">g </span>is a constant in this case, which implies there is no poloidal current in this
equilibrium. (For the Solovev equilibrium (<a 
href="#x1-124004r536">536<!--tex4ht:ref: 6-5-p1 --></a>), I found numerically that the value of the safety factor
at the magnetic axis (<span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">,Z </span>= 0) is equal to <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">g∕</span>(<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>). This result should be able to be proved
analytically. I will do this later. In calculating the safety factor, we also need the expression of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span>,
                                                                                

                                                                                
which is given analytically by </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium691x.png" alt="       ∘ ----------------
         (∂-Ψ)2   (∂-Ψ)2
|∇Ψ | =   ∂R    +  ∂Z
         B    ∘ -------------------------------
     = ---20--  [2RZ2 + κ20(R2 − R20)R ]2 + (2R2Z )2.           (540)
       2R 0κ0q0
" class="math-display"  /></center>
</div>)
<!--l. 6420--><p class="indent" >    
</p><!--l. 6422--><p class="indent" >   Deﬁne <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> = <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup>, and <span class="overline"><span 
class="cmmi-10">Ψ</span></span> = <span 
class="cmmi-10">Ψ∕Ψ</span><sub><span 
class="cmr-7">0</span></sub>, then Eq. (<a 
href="#x1-124004r536">536<!--tex4ht:ref: 6-5-p1 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium692x.png" alt="--    1  [--2-2  κ2 --2    ]
Ψ = 2κ-q- R Z  + -04 (R − 1)2  ,                    (541)
      0 0
" class="math-display"  /><a 
 id="x1-124009r541"></a></center>
</div>where <span class="overline"><span 
class="cmmi-10">R</span></span> = <span 
class="cmmi-10">R∕R</span><sub><span 
class="cmr-7">0</span></sub>, <span class="overline"><span 
class="cmmi-10">Z</span></span> = <span 
class="cmmi-10">Z∕R</span><sub><span 
class="cmr-7">0</span></sub>. From Eq. (<a 
href="#x1-124009r541">541<!--tex4ht:ref: 4-24-p1 --></a>), we obtain
   <table 
class="equation"><tr><td><a 
 id="x1-124010r542"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium693x.png" alt="--    1 ∘ --------κ2---2-----
Z = ± --  2κ0q0Ψ − -0(R  − 1)2.
      R            4
" class="math-display"  /></center></td><td class="equation-label">(542)</td></tr></table>
                                                                                

                                                                                
<!--l. 6434--><p class="nopar" >
Given the value of <span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub>, <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub>, for each value of <span class="overline"><span 
class="cmmi-10">Ψ</span></span>, we can plot a magnetic surface on (<span class="overline"><span 
class="cmmi-10">R</span></span><span 
class="cmmi-10">,</span><span class="overline"><span 
class="cmmi-10">Z</span></span>) plane. An
example of the nested magnetic surfaces is shown in Fig. <a 
href="#x1-12401139">39<!--tex4ht:ref: 4-24-p6 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-12401139"></a>
                                                                                

                                                                                
<!--l. 6440--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/solovev_equilibrium/fig1/plt.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 39: </span><span  
class="content">Flux surfaces of Solovév equilibrium for <span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>5 and <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>5, with <span class="overline"><span 
class="cmmi-10">Ψ</span></span> varying from
zero (center) to 0.123 (edge). The value of <span class="overline"><span 
class="cmmi-10">Ψ</span></span> on the edge is determined by the requirement that
the minimum of <span class="overline"><span 
class="cmmi-10">R</span></span> is equal to zero. (To prevent “divided by zero” that appears in Eq. (<a 
href="#x1-124010r542">542<!--tex4ht:ref: 3-12-p1 --></a>)
when <span 
class="cmmi-10">R </span>= 0, the value of <span class="overline"><span 
class="cmmi-10">Ψ</span></span> on the edge is shifted to 0<span 
class="cmmi-10">.</span>123 <span 
class="cmsy-10">− </span><span 
class="cmmi-10">𝜀 </span>when plotting the above ﬁgure,
where <span 
class="cmmi-10">𝜀 </span>is a small number, <span 
class="cmmi-10">𝜀 </span>= 10<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">3</span></sup> in this case.)</span></div><!--tex4ht:label?: x1-12401139 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 6451--><p class="indent" >   The minor radius of a magnetic surface of the Solovev equilibrium can be calculated by using Eq.
(<a 
href="#x1-124005r537">537<!--tex4ht:ref: 9-9-1 --></a>), which gives
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124012r543"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium694x.png" alt="      ∘-----√----
Rin =  R20 −  AΨ,
" class="math-display"  /></center></td><td class="equation-label">(543)</td></tr></table>
<!--l. 6455--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124013r544"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium695x.png" alt="      ∘ -----√----
Rout =  R20 +  A Ψ,
" class="math-display"  /></center></td><td class="equation-label">(544)</td></tr></table>
<!--l. 6458--><p class="nopar" >
and thus
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124014r545"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium696x.png" alt="                ∘ ---------- ∘ ----------
                  R2 + √A-Ψ −  R2 − √A-Ψ
a = Rout −-Rin =---0-------------0------.
        2                   2
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(545)</td></tr></table>
<!--l. 6463--><p class="nopar" >
where <span 
class="cmmi-10">A </span>= 8<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub>). In my code of constructing Solovev magnetic surface, the value of <span 
class="cmmi-10">a </span>is
speciﬁed by users, and then Eq. (<a 
href="#x1-124014r545">545<!--tex4ht:ref: 9-9-p2 --></a>) is solved numerically to obtain the value of <span 
class="cmmi-10">Ψ </span>of the ﬂux surface.
Note that the case <span 
class="cmmi-10">Ψ </span>= 0 corresponds to <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">in</span></sub> = <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">out</span></sub> = <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>, i.e., the magnetic axis, while the case
<span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕</span>(8<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub>) corresponds to <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">in</span></sub> = 0. Therefore, the reasonable value of <span 
class="cmmi-10">Ψ </span>of a magnetic surface
should be in the range 0 <span 
class="msam-10">≤ </span><span 
class="cmmi-10">Ψ &#x003C; R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">κ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕</span>(8<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub>). This range is used as the interval bracketing a root in
the bisection root ﬁnder.
</p><!--l. 6474--><p class="indent" >   Using Eq. (<a 
href="#x1-124014r545">545<!--tex4ht:ref: 9-9-p2 --></a>), the inverse aspect ratio of a magnetic surface labeled by <span 
class="cmmi-10">Ψ </span>can be approximated
as<span class="cite">[<a 
href="#Xjardin2010">16</a>]</span>
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124015r546"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium697x.png" alt="    ∘ -2q-Ψ---
𝜀 ≈   ---02---.
      κ0R0B0
" class="math-display"  /></center></td><td class="equation-label">(546)</td></tr></table>
<!--l. 6478--><p class="nopar" >
Therefore, the value of <span 
class="cmmi-10">Ψ </span>of a magnetic surface with the inverse aspect ratio <span 
class="cmmi-10">𝜀 </span>is approximately given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-124016r547"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium698x.png" alt="     2   2
Ψ = 𝜀-κ0R0B0-.
       2q0
" class="math-display"  /></center></td><td class="equation-label">(547)</td></tr></table>
<!--l. 6483--><p class="nopar" >
</p>
                                                                                

                                                                                
   <h4 class="subsectionHead"><span class="titlemark">A.2   </span> <a 
 id="x1-125000A.2"></a>Plasma rotation</h4>
<!--l. 6486--><p class="noindent" >In deriving the Grad-Shafranov equation, we have assumed that there is no plasma ﬂow. Next, let us
examine whether this assumption is justiﬁed for plasmas in EAST tokamak.
</p><!--l. 6490--><p class="indent" >   The complete momentum equation is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-125001r548"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium699x.png" alt="   [            ]
ρ   ∂U- + U ⋅∇U  = ρ E + J ×B − ∇ ⋅ℙ,
 m   ∂t             q
" class="math-display"  /></center></td><td class="equation-label">(548)</td></tr></table>
<!--l. 6495--><p class="nopar" >
where <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">q</span></sub><span 
class="cmbx-10">E </span>term can be usually neglected due to either <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">q</span></sub> <span 
class="cmsy-10">≈ </span>0 or <span 
class="cmbx-10">E </span><span 
class="cmsy-10">≈ </span>0, <span 
class="msbm-10">ℙ </span>is a pressure tensor, which is
diﬀerent from the scalar pressure considered in this note. The equilibrium with pressure tensor can be
important for neutral beam heating plasma, where pressure contributed by NBI fast ions can be a
tensor. With plasma ﬂow and scalar pressure and neglecting electric force term, the steady state
momentum equation is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-125002r549"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium700x.png" alt="ρmU ⋅∇U  = J× B − ∇P,
" class="math-display"  /></center></td><td class="equation-label">(549)</td></tr></table>
<!--l. 6506--><p class="nopar" >
where the term on the left-hand side is the contribution of plasma ﬂow to the force balance. Let us
estimate the magnitude of this term. Macroscopic ﬂows in tokamak are usually along the
toroidal direction (the poloidal ﬂow is usually heavily damped). The toroidal ﬂow usually has
the same toroidal angular frequency on a magnetic surface, i.e., the ﬂow can be written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-125003r550"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium701x.png" alt="U = R ωT(ψ)eϕ,
" class="math-display"  /></center></td><td class="equation-label">(550)</td></tr></table>
<!--l. 6514--><p class="nopar" >
where <span 
class="cmmi-10">ω</span><sub><span 
class="cmmi-7">T</span></sub> = <span 
class="cmmi-10">ω</span><sub><span 
class="cmmi-7">T</span></sub>(<span 
class="cmmi-10">ψ</span>) is the toroidal angular frequency of the ﬂow, which can have radial variation. Using
this expression, the left-hand side of Eq. (<a 
href="#x1-125002r549">549<!--tex4ht:ref: 19-4-11-1 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium702x.png" alt="ρmU ⋅∇U  = ρmR ωTeϕ ⋅∇(RωT eϕ)
                  1 ∂
         = ρmR ωTR-∂-ϕ(RωTeϕ)
                  2
         = − ρmR ω TeR,                           (551)
" class="math-display"  /></center>
</div>which is just the centripetal force. For typical EAST plasma, the rotation frequency <span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">T</span></sub> = <span 
class="cmmi-10">ω</span><sub><span 
class="cmmi-7">T</span></sub><span 
class="cmmi-10">∕</span>2<span 
class="cmmi-10">π </span>is less
than 10kHz. For <span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">T</span></sub> = 10kHz, <span 
class="cmmi-10">R </span>= 1<span 
class="cmmi-10">.</span>8<span 
class="cmmi-10">m </span>and <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">m</span></sub> = 1<span 
class="cmmi-10">.</span>3 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">7</span></sup> kg <span 
class="cmmi-10">∕m</span><sup><span 
class="cmr-7">3</span></sup> [Mass density of
EAST#38300@3.9s, <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">m</span></sub> = <span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">D</span></sub><span 
class="cmmi-10">m</span><sub><span 
class="cmmi-7">D</span></sub> = 4 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmr-7">19</span></sup><span 
class="cmmi-10">m</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">3</span></sup> <span 
class="cmsy-10">× </span>2 <span 
class="cmsy-10">× </span>1<span 
class="cmmi-10">.</span>6726 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">27</span></sup> kg = 1<span 
class="cmmi-10">.</span>3 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">7</span></sup> kg <span 
class="cmmi-10">∕m</span><sup><span 
class="cmr-7">3</span></sup>], the
above fore is about 9<span 
class="cmmi-10">.</span>23 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmr-7">2</span></sup> newton. On the other hand, the pressure gradient force in Eq. (<a 
href="#x1-125002r549">549<!--tex4ht:ref: 19-4-11-1 --></a>) is
about 4 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmr-7">4</span></sup> newton, which is one order larger than the force contributed by the rotation. [Pressure
gradient force is estimated by using <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">P </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕a</span>, where <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> is the thermal pressure at the magnetic axis
and <span 
class="cmmi-10">a </span>is the minor radius of plasma. For typical EAST plasmas (EAST#38300@3.9s), <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">≈ </span>2 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmr-7">4</span></sup> Pa,
<span 
class="cmmi-10">a </span>= 0<span 
class="cmmi-10">.</span>45<span 
class="cmmi-10">m</span>. Then <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">P </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕a </span>= 4 <span 
class="cmsy-10">× </span>10<sup><span 
class="cmr-7">4</span></sup><span 
class="cmmi-10">N∕m</span><sup><span 
class="cmr-7">3</span></sup>.]  This indicates the rotation has little inﬂuence on the
force balance. In other words, the EAST tokamak equilibrium can be well described by the static
equilibrium without rotation.
<!--l. 6541--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.3   </span> <a 
 id="x1-126000A.3"></a>Poloidal plasma current</h4>
<!--l. 6543--><p class="noindent" >As is discussed in Sec. (), to satisfy the force balance, <span 
class="cmmi-10">g </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">RB</span><sub><span 
class="cmmi-7">ϕ</span></sub> must be a magnetic surface function,
i.e., <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>). Using this, expression (<a 
href="#x1-19001r49">49<!--tex4ht:ref: 5-2-a2 --></a>) and (<a 
href="#x1-19002r50">50<!--tex4ht:ref: 5-2-a1 --></a>) are written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-126001r552"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium703x.png" alt="         1 dg ∂Ψ   dg
μ0JR = − --------= ---BR,
         R dΨ ∂Z   dΨ
" class="math-display"  /></center></td><td class="equation-label">(552)</td></tr></table>
<!--l. 6549--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-126002r553"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium704x.png" alt="        1dg ∂Ψ    dg
μ0JZ = --------=  --Bz,
       R dΨ ∂R    dΨ
" class="math-display"  /></center></td><td class="equation-label">(553)</td></tr></table>
<!--l. 6554--><p class="nopar" >
respectively. The above two equations imply that
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-126003r554"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium705x.png" alt="J     B
-R-=  -R-,
JZ    BZ
" class="math-display"  /></center></td><td class="equation-label">(554)</td></tr></table>
<!--l. 6558--><p class="nopar" >
which implies that the projections of <span 
class="cmbx-10">B </span>lines and <span 
class="cmbx-10">J </span>lines in the poloidal plane are identical to each
other. This indicates that the <span 
class="cmbx-10">J </span>surfaces coincide with the magnetic surfaces.
</p><!--l. 6563--><p class="indent" >   The poloidal plasma current density is usually small (compared with the toroidal plasma current
density) but is important for some cases of interest and thus could not be safely neglected. Many model
equilibria (e.g., Solovev equilibria, DIII-D cyclone base cases) frequently used in simulations assume
that <span 
class="cmmi-10">g </span>is a spatial constant, i.e., neglecting the poloidal plasmas current. The conclusions drawn from
these simulations could be misleading.
                                                                                

                                                                                
</p><!--l. 6570--><p class="indent" >   Using this and <span 
class="cmsy-10">∇⋅ </span><span 
class="cmbx-10">J </span>= 0, and following the same steps in Sec. <a 
href="#x1-90002.7">2.7<!--tex4ht:ref: 9-5-5 --></a>, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-126004r555"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium706x.png" alt="      1
Ipol = μ02π[g(Ψ2) − g(Ψ1)],
" class="math-display"  /></center></td><td class="equation-label">(555)</td></tr></table>
<!--l. 6575--><p class="nopar" >
where <span 
class="cmmi-10">I</span><sub><span 
class="cmr-7">pol</span></sub> is the poloidal current enclosed by the two magnetic surfaces, the positive direction of <span 
class="cmmi-10">I</span><sub><span 
class="cmr-7">pol</span></sub> is
chosen to be in the clockwise direction when observers look along <img 
src="tokamak_equilibrium707x.png" alt="ˆ
ϕ"  class="circ"  />. Equation (<a 
href="#x1-126004r555">555<!--tex4ht:ref: 2-14-e10 --></a>) indicates that the
diﬀerence of <span 
class="cmmi-10">g </span>between two magnetic surface is proportional to the poloidal current. For this reason, <span 
class="cmmi-10">g</span>
is usually call the “poloidal current function”.
</p><!--l. 6583--><p class="indent" >   In the above, we see that the relation of <span 
class="cmmi-10">g </span>with the poloidal electric current is similar to that
of <span 
class="cmmi-10">Ψ </span>with the poloidal magnetic ﬂux. This similarity is due to the following diﬀerential
relations:
</p>
   <table 
class="equation-star"><tr><td>
                                  <img 
src="tokamak_equilibrium708x.png" alt="{ B = ∇ × A
  Ψ = RA ϕ"  class="left" align="middle" />
</td></tr></table>
<!--l. 6589--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                                 <img 
src="tokamak_equilibrium709x.png" alt="{
 μ0J = ∇ × B
 g = RB ϕ"  class="left" align="middle" />
</td></tr></table>
<!--l. 6593--><p class="nopar" >
The poloidal plasma current density <span 
class="cmbx-10">J</span><sub><span 
class="cmmi-7">p</span></sub> can be further written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium710x.png" alt="Jp ≡ JR ˆR( + JZˆZ          )
     1--  1-∂g-ˆ   1-∂g-ˆ
  =  μ0  −R ∂Z R + R ∂R Z  .
     1
  =  μ-∇g × ∇ϕ                                   (556)
      0
" class="math-display"  /><a 
 id="x1-126005r556"></a></center>
</div>Using <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>), Eq. (<a 
href="#x1-126005r556">556<!--tex4ht:ref: 15-11-26-1 --></a>) can also be written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium711x.png" alt="Jp =-1-dg-∇Ψ × ∇ϕ
    μ0 dΨ
  = -1-dg-Bp.                               (557)
    μ0 dΨ
" class="math-display"  /></center>
</div>
   <h4 class="subsectionHead"><span class="titlemark">A.4   </span> <a 
 id="x1-127000A.4"></a>Eﬃciency of tokamak magnetic ﬁeld in conﬁning plasma: Plasma beta</h4>
<!--l. 6612--><p class="noindent" >To characterize the eﬃciency of the magnetic ﬁeld of tokamaks in conﬁning plasmas, deﬁne the plasma
<span 
class="cmmi-10">β</span>, which is the ratio of the thermal pressure to the magnetic pressure, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-127001r558"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium712x.png" alt="       p
β = B2∕2μ--.
          0
" class="math-display"  /></center></td><td class="equation-label">(558)</td></tr></table>
<!--l. 6617--><p class="nopar" >
Since the pressure in tokamak plasmas is not uniform, the volume averaged pressure is usually used to
deﬁne the beta. In tokamak plasmas, the toroidal beta <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">t</span></sub> and the poloidal beta <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub> are deﬁned,
respectively, by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-127002r559"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium713x.png" alt="      ⟨p⟩
βt = B2-∕2μ-,
      t0   0
" class="math-display"  /></center></td><td class="equation-label">(559)</td></tr></table>
<!--l. 6623--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-127003r560"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium714x.png" alt="       ⟨p⟩
βp =---2-----,
    ⟨B𝜃⟩s∕2μ0
" class="math-display"  /></center></td><td class="equation-label">(560)</td></tr></table>
<!--l. 6627--><p class="nopar" >
where <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">…</span><span 
class="cmsy-10">⟩ </span>is the volume averaging, <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">…</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">s</span></sub> is the surface averaging over the plasma boundary, <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span><span 
class="cmr-7">0</span></sub>
is the vacuum toroidal magnetic ﬁeld at the magnetic axis (or geometrical center of the
plasma). In tokamaks, the toroidal magnetic ﬁeld is dominant and thus the the toroidal
beta <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">t</span></sub> (not <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub>) is the usual way to characterize the the eﬃciency of the magnetic ﬁeld
in conﬁning plasmas. Why do we need <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub>? The short answer is that <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub> is proportional
                                                                                

                                                                                
to an important current, the so-called bootstrap current, which is important for tokamak
steady state operation. Alternatively, <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub> can be understood as characterizing the eﬃciency of
the plasma current in conﬁning the plasma. This can be seen by using Ampere’s law to
approximately write the average poloidal magnetic ﬁeld <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">pa</span></sub> <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕</span>(2<span 
class="cmmi-10">πa</span>). Then <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub> is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-127004r561"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium715x.png" alt="     ----⟨p⟩-----
βp ≈ μ0I2p∕(8π2a2),
" class="math-display"  /></center></td><td class="equation-label">(561)</td></tr></table>
<!--l. 6644--><p class="nopar" >
which is the ratio of the pressure to the plasma current, and thus characterizes the eﬃciency of the
plasma current in conﬁning the plasma.
</p><!--l. 6648--><p class="indent" >   Tokamak experiments have found that it is easier to achieve higher <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">t</span></sub> in low <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span></sub> plasmas than in
higher <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span></sub> plasmas, which indicates that the eﬃciency of the magnetic ﬁeld in conﬁning plasma is a
decreasing function of the magnitude of the magnetic ﬁeld.
</p><!--l. 6653--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.5   </span> <a 
 id="x1-128000A.5"></a>Beta limit</h4>
<!--l. 6655--><p class="noindent" >Beta limit means there is a limit for the value of beta beyond which the plasma will encounter a serious
disruption. Early calculation of the beta limit on JET shows that the maximal <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">t</span></sub> obtained is
proportional to <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕</span>(10<sup><span 
class="cmr-7">6</span></sup><span 
class="cmmi-10">aB</span><sub><span 
class="cmmi-7">t</span><span 
class="cmr-7">0</span></sub>), where all quantities are in SI units.  This scaling relation
<span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">t</span> <span 
class="cmr-7">max</span></sub> = <span 
class="cmmi-10">C</span><sub><span 
class="cmmi-7">T</span></sub><span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕</span>(10<sup><span 
class="cmr-7">6</span></sup><span 
class="cmmi-10">aB</span><sub><span 
class="cmmi-7">t</span><span 
class="cmr-7">0</span></sub>) is often called Troyon scaling, where the coeﬃcient <span 
class="cmmi-10">C</span><sub><span 
class="cmmi-7">T</span></sub> was determined
numerically by Troyon to 0.028. Often <span 
class="cmmi-10">C</span><sub><span 
class="cmmi-7">T</span></sub> is expressed in percent, in which case <span 
class="cmmi-10">C</span><sub><span 
class="cmmi-7">T</span></sub> = 2<span 
class="cmmi-10">.</span>8. This
motivates us to deﬁne
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-128001r562"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium716x.png" alt="βN = 108aBt0 βt.
          Ip
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(562)</td></tr></table>
<!--l. 6665--><p class="nopar" >
which is called “normalized beta”. The normalized beta <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> is an operational parameter indicating how
close the plasma is to reach destabilizing major MHD activities. Its typical value is of order
unit.
</p><!--l. 6670--><p class="indent" >   As mentioned above, <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> calculated by Troyon is 2<span 
class="cmmi-10">.</span>8. Empirical evaluation from the data of diﬀerent
tokamaks raises this value slightly to 3.5, although signiﬁcantly higher values, e.g., <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> = 7<span 
class="cmmi-10">.</span>2, have been
achieved in the low aspect ratio tokamak NSTX<span class="cite">[<a 
href="#Xsabbagh2006">23</a>]</span>.
</p><!--l. 6675--><p class="indent" >   The value of <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> indicates how close one is to the onset of deleterious instability . The ability to
increase the value of <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> can be considered to be the ability of controlling the major MHD
instabilities, and thus can be used to characterize how well a tokamak device is operated. One goal
of EAST tokamak during 2015-2016 is to sustain a plasma with <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> <span 
class="msam-10">≥ </span>2 for at least 10
seconds.
</p><!--l. 6682--><p class="indent" >   (check** The tearing mode, speciﬁcally the neoclassical tearing mode (NTM) is expected to set the
beta limit in a reactor.)
</p><!--l. 6685--><p class="indent" >   (**check: Tokamak experiments have found that it is easier to achieve high <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> in large <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub> plasmas
than in small <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub> plasmas. However, experiments found it is easier to achieve high <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub> in small <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub>
plasmas than in large <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub> plasmas. Examining the expression of <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">N</span></sub> and <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">p</span></sub> given by Eqs. (<a 
href="#x1-127004r561">561<!--tex4ht:ref: 7-25-1m --></a>) and Eq.
(), respectively, we recognize that pressure limit should have a scaling of <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">p</span><span 
class="cmsy-10">⟩∝ </span><span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub><sup><span 
class="cmmi-7">α</span></sup> with 1 <span 
class="cmmi-10">&#x003C; α &#x003C; </span>2.
)
</p><!--l. 6694--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.6   </span> <a 
 id="x1-129000A.6"></a>Why bigger tokamaks with larger plasma current are better at fusion?</h4>
<!--l. 6696--><p class="noindent" >As is mentioned in Sec. <a 
href="#x1-127000A.4">A.4<!--tex4ht:ref: 2015-5-31-p1 --></a>, the beta limit study on JET tokamak shows that the maximal <span 
class="cmmi-10">β</span><sub><span 
class="cmmi-7">t</span></sub> obtained
is proportional to <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕aB</span><sub><span 
class="cmmi-7">t</span><span 
class="cmr-7">0</span></sub>. This means the maximal plasmas pressure obtained is proportional to <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕a</span>,
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-129001r563"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium717x.png" alt="     Ip
⟨p⟩ ∝-a
" class="math-display"  /></center></td><td class="equation-label">(563)</td></tr></table>
<!--l. 6702--><p class="nopar" >
The total plasma energy is given by <span 
class="cmmi-10">E </span><span 
class="cmsy-10">≈⟨</span><span 
class="cmmi-10">p</span><span 
class="cmsy-10">⟩</span>2<span 
class="cmmi-10">πRπa</span><sup><span 
class="cmr-7">2</span></sup>, where <span 
class="cmmi-10">R </span>is the major radius of the device. Using
Eq. (<a 
href="#x1-129001r563">563<!--tex4ht:ref: 2015-5-31-p2 --></a>), we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-129002r564"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium718x.png" alt="E ∝ IpaR.
" class="math-display"  /></center></td><td class="equation-label">(564)</td></tr></table>
<!--l. 6708--><p class="nopar" >
Since fusion power is proportional to the plasma energy, the above relation indicates, to obtain larger
fusion power, we need bigger tokamaks with larger plasma current.
</p><!--l. 6713--><p class="indent" >   The reason why larger plasma current is desired can also be appreciated by examining an empirical
scaling of the the energy conﬁnement time <span 
class="cmmi-10">τ</span><sub><span 
class="cmmi-7">E</span></sub> given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-129003r565"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium719x.png" alt="τE ∝ I2,
     T
" class="math-display"  /></center></td><td class="equation-label">(565)</td></tr></table>
<!--l. 6718--><p class="nopar" >
which is proportional to <span 
class="cmmi-10">I</span><sup><span 
class="cmr-7">2</span></sup>.
</p><!--l. 6721--><p class="indent" >   Another fundamental reason for building larger tokamaks is that the energy conﬁnement time
<span 
class="cmmi-10">τ</span><sub><span 
class="cmmi-7">E</span></sub> <span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">a</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">∕χ </span>increases with the machine size, where <span 
class="cmmi-10">χ </span>is the heat diﬀusitivity. In addition, the heat
diﬀusitivity <span 
class="cmmi-10">χ </span>decreases with increasing machine size if the diﬀusitivity satisﬁes the gyro-Bohm scaling,
which is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-129004r566"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium720x.png" alt="       √m--T3∕2
χGB =  ---i2-i2--,
        aB qi
" class="math-display"  /></center></td><td class="equation-label">(566)</td></tr></table>
                                                                                

                                                                                
<!--l. 6728--><p class="nopar" >
which is inverse proportional to the machine size <span 
class="cmmi-10">a</span>. However, if the diﬀusitivity satisﬁes the Bohm
scaling, which is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-129005r567"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium721x.png" alt="χ  = -T--,
 B   |q|B
" class="math-display"  /></center></td><td class="equation-label">(567)</td></tr></table>
<!--l. 6733--><p class="nopar" >
then, the diﬀusitivity is independent of the machine size. The Bohm diﬀusitivity <span 
class="cmmi-10">χ</span><sub><span 
class="cmmi-7">B</span></sub> is <span 
class="cmmi-10">a∕ρ</span><sub><span 
class="cmmi-7">s</span></sub> times larger
than the gyro-Bohm diﬀusitivity <span 
class="cmmi-10">χ</span><sub><span 
class="cmmi-7">GB</span></sub>, where <span 
class="cmmi-10">ρ</span><sub><span 
class="cmmi-7">s</span></sub> is the gyro-radius. Heat diﬀusitivity scaling in the low
conﬁnement operation (<span 
class="cmmi-10">L </span>mode) in present-day tokamaks is observed to be Bohm or worse than
Bohm.
</p><!--l. 6740--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.7   </span> <a 
 id="x1-130000A.7"></a>Density limit</h4>
<!--l. 6742--><p class="noindent" >The maximum density that can be obtained in stable plasma operations (without disruption) is
empirically given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-130001r568"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium722x.png" alt="ne ≈ 1.5nG,
" class="math-display"  /></center></td><td class="equation-label">(568)</td></tr></table>
<!--l. 6746--><p class="nopar" >
where <span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">G</span></sub> is the Greenwalt density, which is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-130002r569"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium723x.png" alt="       14-Ip-
nG = 10 πa2
" class="math-display"  /></center></td><td class="equation-label">(569)</td></tr></table>
<!--l. 6750--><p class="nopar" >
where <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub> is the plasma current, <span 
class="cmmi-10">a </span>is the minor radius, all physical quantities are in SI units. The 1<span 
class="cmmi-10">.</span>5<span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">G</span></sub>
gives the density limit that can be achieved for a tokamak operation scenario with plasma
current <span 
class="cmmi-10">I</span><sub><span 
class="cmmi-7">p</span></sub> and plasma minor radius <span 
class="cmmi-10">a</span>. The Greenwalt density limit is an empirical one,
which, like other empirical limits, can be exceeded in practice. Equation (<a 
href="#x1-130002r569">569<!--tex4ht:ref: 2-25-e1 --></a>) indicates
that the Greenwalt density is proportional to the current density. Therefore the ability
to operate in large plasma current density means the ability to operate with high plasma
density.
</p><!--l. 6760--><p class="indent" >   Note that neither the pressure limit nor the density limit is determined by the force-balance
constraints. They are determined by the stability of the equilibrium. On the other hand, since the
stability of the equilibrium is determined by the equilibrium itself, the pressure and density limit is
determined by the equilibrium.
</p><!--l. 6767--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.8   </span> <a 
 id="x1-131000A.8"></a>Relation of plasma current density to pressure gradient</h4>
<!--l. 6769--><p class="noindent" >Due to the force balance condition, the plasma current is related to the plasma pressure. Using the
equilibrium constraint in the <span 
class="cmbx-10">R </span>direction, the toroidal current density <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> given by Eq. (<a 
href="#x1-20003r53">53<!--tex4ht:ref: 6-9-a1 --></a>) can be
written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium724x.png" alt="Jϕ = R dP-+--1--dg-g.                         (570)
      dΨ   μ0R dΨ
" class="math-display"  /><a 
 id="x1-131001r570"></a></center>
</div>The parallel (to the magnetic ﬁeld) current density is written as <div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium725x.png" alt="     J ⋅B
J∥ ≡ -B---
     J B  + J ⋅B
   = -ϕ--ϕ---p---p
     (  dP B  1 dg ) g   1 dg(∇ Ψ)2
     -R-dΨ +-μ0R-dΨg--R-+-μ0dΨ--R---
   =               B
      dP   1-dg [(g-)2  (∇Ψ-)2]
   = gdΨ-+-μ0dΨ---R--+---R----
                B
     gddPΨ + 1μ0 ddgΨB2
   = ------B------.
      dP 1    1 dg
   = gdΨ-B-+ μ--dΨB.                                 (571)
              0
" class="math-display"  /></center>
</div>For later use, deﬁne <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium726x.png" alt="    J∥
σ ≡ B-
     dP  1    1 dg
  = gdΨ-B2-+ μ--dΨ.                          (572)
              0
" class="math-display"  /><a 
 id="x1-131003r572"></a></center>
</div>Equation (<a 
href="#x1-131003r572">572<!--tex4ht:ref: 7-25-p5 --></a>) is used in GTAW code to calculate <span 
class="cmmi-10">J</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">∕B </span>(actually calculated is <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">J</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">∕B</span>)<span class="cite">[<a 
href="#Xhu2014">15</a>]</span>. Note
that the expression for <span 
class="cmmi-10">J</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">∕B </span>in Eq. (<a 
href="#x1-131003r572">572<!--tex4ht:ref: 7-25-p5 --></a>) is not a magnetic surface function. Deﬁne <span 
class="cmmi-10">σ</span><sub><span 
class="cmr-7">ps</span></sub> as
<div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium727x.png" alt="σps ≡ σ − ⟨σ⟩
       dP [ 1   ⟨ 1 ⟩ ]
   = g dΨ- B2-−   B2-                          (573)
       ps
   ≡  J∥-,                                     (574)
      B
" class="math-display"  /></center>
</div>where <span 
class="cmmi-10">J</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">ps</span></sup> is called Pﬁrsch-Schluter (PS) current. In cylindrical geometry, due to the poloidal
symmetry, the Pﬁersch-Schluter current is zero. In toroidal geometry, due to the poloidal
asymmetry, the PS current is generally nonzero. Thus, this quantity characterizes a toroidal
eﬀect.
<!--l. 6815--><p class="indent" >   Another useful quantity is <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmsy-10">⟨</span><span 
class="cmbx-10">J </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">B</span><span 
class="cmsy-10">⟩</span>, which is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium728x.png" alt="μ ⟨J⋅B ⟩ = μ gdP-+-dg⟨B2⟩,                      (575)
 0         0 dΨ   dΨ
" class="math-display"  /></center>
</div>where <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">…</span><span 
class="cmsy-10">⟩ </span>is ﬂux surface averaging operator.
<!--l. 6823--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.9   </span> <a 
 id="x1-132000A.9"></a>Vacuum magnetic ﬁeld (not ﬁnished)</h4>
<!--l. 6825--><p class="noindent" >In the vacuum region that is between the plasma and the ﬁrst wall, there is no current,
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-132001r576"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium729x.png" alt="∇ × B = 0.
" class="math-display"  /></center></td><td class="equation-label">(576)</td></tr></table>
                                                                                

                                                                                
<!--l. 6829--><p class="nopar" >
Next, let us examine what constraint this condition imposes on the magnetic ﬁeld. Using expression
 (<a 
href="#x1-5001r10">10<!--tex4ht:ref: 7-28-6 --></a>), the above equation is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-132002r577"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium730x.png" alt="∇ × (∇Ψ × ∇ϕ )+ ∇g × ∇ϕ = 0,
" class="math-display"  /></center></td><td class="equation-label">(577)</td></tr></table>
<!--l. 6835--><p class="nopar" >
It is not obvious how to draw useful information from the above equation.
</p><!--l. 6838--><p class="indent" >   In the above, we use the vector potential approach. Next, let us try the scalar potential
approach:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-132003r578"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium731x.png" alt="B = ∇ Φ,
" class="math-display"  /></center></td><td class="equation-label">(578)</td></tr></table>
<!--l. 6842--><p class="nopar" >
then the constraint <span 
class="cmsy-10">∇⋅ </span><span 
class="cmbx-10">B </span>= 0 is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-132004r579"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium732x.png" alt="∇2Φ = 0.
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(579)</td></tr></table>
<!--l. 6846--><p class="nopar" >
</p><!--l. 6849--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.10   </span> <a 
 id="x1-133000A.10"></a>Discussion about the poloidal current function, check!</h4>
<!--l. 6851--><p class="noindent" > 
</p><!--l. 6853--><p class="indent" >   [check***As discussed in Sec. (), the force balance equation of axisymmetric plasma requires that
<span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">g </span>= 0. From this and the fact <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">Ψ </span>= 0, we conclude that <span 
class="cmmi-10">g </span>is a function of <span 
class="cmmi-10">Ψ</span>, i.e., <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>).
However, this reasoning is not rigorous. Note the concept of a function requires that a function can not
be a one-to-more map. This means that <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>) indicates that the values of <span 
class="cmmi-10">g </span>must be equal on two
diﬀerent magnetic ﬁeld lines that have the same value of <span 
class="cmmi-10">Ψ</span>. However, the two equations <span 
class="cmbx-10">B</span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">g </span>= 0 and
<span 
class="cmbx-10">B</span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">Ψ </span>= 0 do not require this constraint. To examine whether this constraint removes some equilibria
from all the possible ones, we consider a system with an <span 
class="cmmi-10">X </span>point. Inside one of the magnetic islands, we
use
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-133001r580"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium733x.png" alt="g = Ψ 2∕(B0R30),
" class="math-display"  /></center></td><td class="equation-label">(580)</td></tr></table>
<!--l. 6867--><p class="nopar" >
and inside the another, we use
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-133002r581"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium734x.png" alt="g = Ψ 3∕(B20R50),
" class="math-display"  /></center></td><td class="equation-label">(581)</td></tr></table>
                                                                                

                                                                                
<!--l. 6871--><p class="nopar" >
Then solve the two GS equations respectively within the boundary of the two islands. It is easy to
obtain two magnetic surfaces that have the same value of <span 
class="cmmi-10">Ψ </span>respectively inside the two
islands. Equations (<a 
href="#x1-133001r580">580<!--tex4ht:ref: 11-2-p1 --></a>) and (<a 
href="#x1-133002r581">581<!--tex4ht:ref: 11-2-p2 --></a>) indicate that the values of <span 
class="cmmi-10">g </span>on the two magnetic surfaces
are diﬀerent from each other. It is obvious the resulting equilibrium that contain the two
islands can not be recovered by directly solving a single GS equation with a given function
<span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>).**check]
</p><!--l. 6880--><p class="indent" >   Note that, on both an irrational surface and a rational surface, there are inﬁnite number of
magnetic ﬁeld lines that are not connected with each other (it is wrong to say there is only one
magnetic ﬁeld line on a irrational surface). Consider a ﬁeld <span 
class="cmmi-10">f </span>that satisﬁes <span 
class="cmbx-10">B</span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">f </span>= 0, the value <span 
class="cmmi-10">f </span>is a
constant along any one of the magnetic ﬁeld lines. Now comes the question: whether the
values of <span 
class="cmmi-10">f </span>on diﬀerent ﬁeld lines are equal to each other? To answer this question, we
can choose a direction diﬀerent from <span 
class="cmbx-10">B </span>on the magnetic surface and examine whether <span 
class="cmmi-10">Ψ</span>
is constant or not along this direction, i.e, whether <span 
class="cmbx-10">k </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">f </span>equals zero or not, where <span 
class="cmbx-10">k </span>is
the chosen direction. For axsiymmetric magnetic surfaces, it is ready to see that <span 
class="cmbx-10">k </span>= <img 
src="tokamak_equilibrium735x.png" alt="ˆϕ"  class="circ"  />
is a direction in the magnetic surface and it is usually not identical with <span 
class="cmbx-10">B</span><span 
class="cmmi-10">∕B</span>. Then we
obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-133003r582"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium736x.png" alt="                1 ∂f
k ⋅∇f = ˆϕ ⋅∇f = R-∂ϕ-.
" class="math-display"  /></center></td><td class="equation-label">(582)</td></tr></table>
<!--l. 6896--><p class="nopar" >
If <span 
class="cmmi-10">f </span>is independent of <span 
class="cmmi-10">ϕ</span>, then <span 
class="cmbx-10">k </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">Ψ </span>= 0. Then the fact that <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">f </span>= 0 and the fact that <span 
class="cmbx-10">B</span>
and <span 
class="cmbx-10">k </span>are two diﬀerent directions on the magnetic surface, indicates that <span 
class="cmmi-10">f </span>is constant
on the surface, i.e., the values of <span 
class="cmmi-10">f </span>on diﬀerent ﬁeld lines are equal to each other. If <span 
class="cmmi-10">f </span>is
non-axisymmetric, then we know the values of <span 
class="cmmi-10">f </span>on diﬀerent magnetic ﬁeld lines on the same magnetic
surface are not equal to each other. This is the case for the <span 
class="cmmi-10">α </span>coordinates discussed in Sec.
().
</p><!--l. 6906--><p class="indent" >   This reasoning is for the case of axsiymmetric magnetic surfaces. It is ready to do the same
reasoning for non-axisymmetrica magnetic surface after we ﬁnd a convenient direction <span 
class="cmbx-10">k </span>on the
magnetic surface.
</p><!--l. 6910--><p class="indent" >    
</p><!--l. 6912--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.11   </span> <a 
 id="x1-134000A.11"></a>tmp  check!</h4>
                                                                                

                                                                                
<!--l. 6914--><p class="noindent" >(In practice, I choose the positive direction of <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">ϕ </span>along the direction of toroidal and poloidal
magnetic ﬁeld (i.e., <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ϕ </span>and <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃 </span>are always positive in (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) coordinates system). Then, the
<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">local</span></sub> deﬁned by Eq. (<a 
href="#x1-47001r177">177<!--tex4ht:ref: 7-12-a4 --></a>) is always positive. It follows that <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">global</span></sub> should be also positive. Next, let us
examine whether this property is correctly preserved by Eq. (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>). Case 1: The radial coordinate <span 
class="cmmi-10">ψ </span>is
chosen as <span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">′≡ </span><span 
class="cmmi-10">dΨ∕dψ &#x003E; </span>0. Then the factor before the integration in Eq. (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>) is negative. We can
further verify that <span 
class="cmsy-10">𝒥 </span>is always negative for either the case that <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span>is pointing inward or outward.
Therefore the .r.h.s. of Eq. (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>) is always positive for this case. Case 2: The radial coordinate <span 
class="cmmi-10">ψ </span>is
chosen as <span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">′≡ </span><span 
class="cmmi-10">dΨ∕dψ &#x003C; </span>0. Then the factor before the integration in Eq. (<a 
href="#x1-48002r183">183<!--tex4ht:ref: 7-12-a1 --></a>) is positive. We can
further verify that <span 
class="cmsy-10">𝒥 </span>is always positive for either the case that <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span>is pointing inward or outward.
The above two cases include all possibilities. Therefore, the positivity of <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">global</span></sub> is always
guaranteed)
</p><!--l. 6933--><p class="indent" >    
</p><!--l. 6935--><p class="indent" >   a magnetic surface forms a central hole around <span 
class="cmmi-10">Z </span>axis. Using Gauss’s theorem in the volume within
the central hole, and noting that no magnetic ﬁeld line point-intersects a magnetic surface, we know
that the magnetic ﬂux through any cross section of the hole is equal to each other. Next we calculate
this magnetic ﬂux. To make the calculation easy, we select a plane cross section perpendicular to the <span 
class="cmmi-10">Z</span>
axis, as is shown by the dash line in Fig. <a 
href="#x1-80011">1<!--tex4ht:ref: 7-28-5 --></a>. In this case, only <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">Z</span></sub> contribute to the magnetic ﬂux,
which is written (the positive direction of the cross section is chosen in the direction of <img 
src="tokamak_equilibrium737x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">Z</span></sub>)
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium738x.png" alt="     ∫
       Rc
Ψp1 = 0  Bz(R,Zc )2πRdR
     ∫ Rc 1∂Ψ
   =     -----2πRdR
      0∫ RR ∂R
   = 2π   c ∂Ψ-dR
        0   ∂R
   = 2π[Ψ(Rc,Zc)− Ψ(0,Zc)].
" class="math-display"  /></center>
</div>Note that the axisymmetry requires that the axis of symmetry, <span 
class="cmmi-10">Z </span>axis, must be a magnetic ﬁeld line.
Since <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">Ψ </span>= 0, it follows that the value of <span 
class="cmmi-10">Ψ </span>on the <span 
class="cmmi-10">Z </span>axis is a constant (denoted by <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">a</span></sub> below).
Further note that the value of <span 
class="cmmi-10">Ψ </span>is constant on a magnetic surface. Thus, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span><span 
class="cmr-7">1</span></sub> in Eq. (<a 
href="#x1-9002r20">20<!--tex4ht:ref: 7-24-2 --></a>) is
written
   <table 
class="equation"><tr><td><a 
 id="x1-134002r583"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium739x.png" alt="Ψp1 = 2π(Ψ − Ψa).
" class="math-display"  /></center></td><td class="equation-label">(583)</td></tr></table>
<!--l. 6958--><p class="nopar" >
</p><!--l. 6961--><p class="indent" >   be generalized to any revolution surface that is generated by rotating a curve segment on the
poloidal plane around <span 
class="cmmi-10">Z </span>axis. For instance, a curve on the poloidal plane that connects the magnetic
axis and a point on a ﬂux surface can form a toroidal surface (e.g., surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> in Fig. <a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>). The magnetic
ﬂux through the toroidal surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> is given by
</p><!--l. 6967--><p class="indent" >   i.e.
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-134003r584"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium740x.png" alt="Ψ − Ψ = Ψp1,
    a   2π
" class="math-display"  /></center></td><td class="equation-label">(584)</td></tr></table>
<!--l. 6970--><p class="nopar" >
which indicates that the diﬀerence of <span 
class="cmmi-10">Ψ </span>between the <span 
class="cmmi-10">Z </span>axis and a magnetic surface is the poloidal
magnetic ﬂux per radian through the central hole, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span><span 
class="cmr-7">1</span></sub><span 
class="cmmi-10">∕</span>2<span 
class="cmmi-10">π</span>.
</p><!--l. 6975--><p class="indent" >    
</p><!--l. 6977--><p class="indent" >   The magnetic surface forms a central hole around <span 
class="cmmi-10">Z </span>axis. The magnetic ﬂux through any cross
section of the central hole is equal to each other and is given by <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub> = 2<span 
class="cmmi-10">π</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">a</span></sub>), where <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">a</span></sub> and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>
are the value of <span 
class="cmmi-10">Ψ </span>at the <span 
class="cmmi-10">Z </span>axis and the magnetic surface, respectively.
</p><!--l. 6982--><p class="indent" >   The conclusion in Eq. (<a 
href="#x1-134002r583">583<!--tex4ht:ref: 12-30-1 --></a>) can be generalized to any revolution surface that is generated by
rotating a curve on the poloidal plane about <span 
class="cmmi-10">Z </span>axis. For instance, a curve on the poloidal plane that
connects the magnetic axis and a point on a ﬂux surface can form a toroidal surface (e.g., surface <span 
class="cmmi-10">S</span><sub><span 
class="cmr-7">2</span></sub> in
Fig. <a 
href="#x1-24006r66">66<!--tex4ht:ref: 7-1-p1 --></a>).
</p><!--l. 6988--><p class="indent" >   Also note the diﬀerence between <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub> and <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span><span 
class="cmr-7">1</span></sub> deﬁned in Sec. <a 
href="#x1-90002.7">2.7<!--tex4ht:ref: 9-5-5 --></a>: <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span><span 
class="cmr-7">1</span></sub> is the magnetic ﬂux
through the central hole of a torus and thus includes the ﬂux in the center transformer, and
<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">p</span></sub> is the magnetic ﬂux through the ribbon between the magnetic axis and the magnetic
surface.
</p><!--l. 6994--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.12   </span> <a 
 id="x1-135000A.12"></a>Radial coordinate to be deleted</h4>
<!--l. 6996--><p class="noindent" >We know that the toroidal ﬂux <span 
class="cmmi-10">ψ</span><sub><span 
class="cmmi-7">t</span></sub>, safety factor <span 
class="cmmi-10">q</span>, and the <span 
class="cmmi-10">Ψ </span>in the GS equation are related by the
following equations:
                                                                                

                                                                                
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135001r585"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium741x.png" alt="dψ  = 2πqdΨ
  t
" class="math-display"  /></center></td><td class="equation-label">(585)</td></tr></table>
<!--l. 7000--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135002r586"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium742x.png" alt="          ∫ Ψ
=⇒  ψt = 2π 0 qdΨ
" class="math-display"  /></center></td><td class="equation-label">(586)</td></tr></table>
<!--l. 7003--><p class="nopar" >
Deﬁne:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135003r587"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium743x.png" alt="   ∘ ψ--
ρ ≡  --t
      π
" class="math-display"  /></center></td><td class="equation-label">(587)</td></tr></table>
<!--l. 7007--><p class="nopar" >
(In the Toray_ga code, the radial coordinate <span 
class="cmmi-10">ρ </span>is deﬁned as
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-135004r588"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium744x.png" alt="    ∘ -----
ρ ≡   -ψt-,
      πBt0
" class="math-display"  /></center></td><td class="equation-label">(588)</td></tr></table>
<!--l. 7011--><p class="nopar" >
where <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">t</span><span 
class="cmr-7">0</span></sub> is a constant factor.<span 
class="cmmi-10">ρ </span>deﬁned this way is of length dimension, which is an eﬀective geometry
radius obtained by approximating the ﬂux surface as circular.)
</p><!--l. 7016--><p class="indent" >    
</p><!--l. 7018--><p class="indent" >   I use Eq. (<a 
href="#x1-135003r587">587<!--tex4ht:ref: 5-26-1 --></a>) to deﬁne <span 
class="cmmi-10">ρ</span>. Then we have
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135005r589"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium745x.png" alt="      2
ψt = πρ
" class="math-display"  /></center></td><td class="equation-label">(589)</td></tr></table>
<!--l. 7021--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135006r590"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium746x.png" alt="    dψ
=⇒  --t = 2πρ
     dρ
" class="math-display"  /></center></td><td class="equation-label">(590)</td></tr></table>
                                                                                

                                                                                
<!--l. 7024--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135007r591"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium747x.png" alt="    dψ dψ
=⇒  --t---= 2πρ
    dψ dρ
" class="math-display"  /></center></td><td class="equation-label">(591)</td></tr></table>
<!--l. 7027--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135008r592"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium748x.png" alt="       dψ-
=⇒  2πqdρ = 2πρ
" class="math-display"  /></center></td><td class="equation-label">(592)</td></tr></table>
<!--l. 7030--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-135009r593"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium749x.png" alt="    dψ    ρ
= ⇒ ---=  -
    dρ    q
" class="math-display"  /></center></td><td class="equation-label">(593)</td></tr></table>
                                                                                

                                                                                
<!--l. 7033--><p class="nopar" >
Eq. (<a 
href="#x1-135009r593">593<!--tex4ht:ref: 5-26-2 --></a>) is used to transform between <span 
class="cmmi-10">ψ </span>and <span 
class="cmmi-10">ρ</span>.
</p>
   <table 
class="equation-star"><tr><td>
             <span 
class="cmmi-10">dρ </span>= <img 
src="tokamak_equilibrium750x.png" alt="    1
∘------2--
  Φ∕πR 0B0"  class="frac" align="middle" /><img 
src="tokamak_equilibrium751x.png" alt="1
-
2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium752x.png" alt="  1
-----2
πB0R 0"  class="frac" align="middle" /><span 
class="cmmi-10">dΦ </span>= <img 
src="tokamak_equilibrium753x.png" alt="1
-
ρ"  class="frac" align="middle" /><img 
src="tokamak_equilibrium754x.png" alt="1
-
2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium755x.png" alt="   1
-----2
πB0R 0"  class="frac" align="middle" />2<span 
class="cmmi-10">πqdψ </span>= <img 
src="tokamak_equilibrium756x.png" alt="1
-
ρ"  class="frac" align="middle" /><img 
src="tokamak_equilibrium757x.png" alt="  1
----2
B0R 0"  class="frac" align="middle" /><span 
class="cmmi-10">qdψ</span>
</td></tr></table>
<!--l. 7037--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                              <span 
class="cmsy-10">⇒ </span><span 
class="cmmi-10">dψ </span>= <img 
src="tokamak_equilibrium758x.png" alt="    2
ρB0R0-
  q"  class="frac" align="middle" /><span 
class="cmmi-10">dρ</span>(<span 
class="cmmi-10">πa</span><sup><span 
class="cmr-7">2</span></sup>)
</td></tr></table>
<!--l. 7038--><p class="nopar" >
</p><!--l. 7041--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-13501040"></a>
                                                                                

                                                                                
<!--l. 7044--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3/p.png" alt="pict"  
 width="262.9825pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 40: </span><span  
class="content">to be delted, Isosurface of <span 
class="cmmi-10">α </span>= 2<span 
class="cmmi-10">π∕</span>8. The surface is made of a family of contours of
<span 
class="cmmi-10">α </span>= 2<span 
class="cmmi-10">π∕</span>8, which are all magnetic ﬁeld lines. These ﬁeld lines are traced by starting from a series
of points on the low-ﬁeld-side midplane (<span 
class="cmmi-10">𝜃 </span>= 0) at diﬀerent radial locations and the ﬁeld lines
are followed by a complete poloidal loop. Magnetic ﬁeld from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x1-13501040 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 7053--><p class="indent" >    
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.13   </span> <a 
 id="x1-136000A.13"></a>Toroidal elliptic operator in magnetic surface coordinate system</h4>
<!--l. 7058--><p class="noindent" >If (<span 
class="cmmi-10">ψ,𝜃,ϕ</span>) are magnetic surface coordinates, i.e., <span 
class="cmmi-10">∂Ψ∕∂𝜃 </span>= 0, then the toroidal elliptic operator in Eq.
(<a 
href="#x1-101002r414">414<!--tex4ht:ref: 4-23-4 --></a>) is reduced to
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-136001r594"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium759x.png" alt="          [(          )    (             ) ]
  ⋆    R2-     𝒥--    2        -𝒥-
△  Ψ = 𝒥     ΨψR2 |∇ ψ|  ψ +  ΨψR2 ∇ψ ⋅∇ 𝜃 𝜃 ,
" class="math-display"  /></center></td><td class="equation-label">(594)</td></tr></table>
<!--l. 7066--><p class="nopar" >
and the GS equation, Eq. (<a 
href="#x1-101005r417">417<!--tex4ht:ref: 4-25-7 --></a>), is reduced to
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-136002r595"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium760x.png" alt="R2 [(   𝒥      )    (   𝒥        )  ]        dP    dg
---  Ψψ -2|∇ψ |2   +  Ψ ψ-2-∇ψ ⋅∇𝜃    = − μ0R2---−  --g(Ψ).
𝒥       R        ψ      R          𝜃         dΨ    dΨ
" class="math-display"  /></center></td><td class="equation-label">(595)</td></tr></table>
<!--l. 7074--><p class="nopar" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.14   </span> <a 
 id="x1-137000A.14"></a>Grad-Shafranov equation in (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates</h4>
                                                                                

                                                                                
   <h5 class="subsubsectionHead"><a 
 id="x1-138000A.14"></a>Deﬁnition of (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates</h5>
<!--l. 7080--><p class="noindent" >Deﬁne (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-138001r596"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium761x.png" alt="R = R0 + rcos𝜃,
" class="math-display"  /></center></td><td class="equation-label">(596)</td></tr></table>
<!--l. 7083--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-138002r597"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium762x.png" alt="Z = rsin 𝜃,
" class="math-display"  /></center></td><td class="equation-label">(597)</td></tr></table>
<!--l. 7086--><p class="nopar" >
where (<span 
class="cmmi-10">R,ϕ,Z</span>) are the cylindrical coordinates and <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> is a constant. The above transformation is shown
graphically in Fig. <a 
href="#x1-13800341">41<!--tex4ht:ref: 7-9-1 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x1-13800341"></a>
                                                                                

                                                                                
<!--l. 7091--><p class="noindent" > <img 
src="my_figure/home/yj/theory/tokamak_equilibrium/figures/r_theta_coordinates-1.png" alt="pict"  
 width="256.95999pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 41: </span><span  
class="content">The relation between coordinates (<span 
class="cmmi-10">r,𝜃</span>) and (<span 
class="cmmi-10">R,Z</span>).</span></div><!--tex4ht:label?: x1-13800341 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 7096--><p class="indent" >   The Jacobian of (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinates can be calculated using the deﬁnition. Using <span 
class="cmmi-10">x </span>= <span 
class="cmmi-10">R</span> cos<span 
class="cmmi-10">ϕ</span>,
<span 
class="cmmi-10">y </span>= <span 
class="cmmi-10">R</span> sin<span 
class="cmmi-10">ϕ</span>, and <span 
class="cmmi-10">z </span>= <span 
class="cmmi-10">Z</span>, the Jacobian (with respect to the Cartesian coordinates (<span 
class="cmmi-10">x,y,z</span>)) is written as
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium763x.png" alt="    |        |  |                   |
    ||∂∂xr ∂∂x𝜃 ∂∂xϕ||  ||∂R∂corsϕ ∂Rc∂o𝜃sϕ-∂R∂coϕsϕ||
𝒥 = ||∂y ∂y ∂y||= ||∂R-sinϕ ∂Rsinϕ-∂R-sinϕ||
    ||∂∂rz ∂∂𝜃z ∂∂ϕz||  ||  ∂∂rZ-    ∂∂Z𝜃-   ∂∂ϕZ- ||
    |∂r ∂𝜃 ∂ϕ      ∂r     ∂𝜃    ∂|ϕ
    ||cos𝜃cosϕ − rsin𝜃cosϕ − R sin ϕ||
  = ||cos𝜃sinϕ − rsin𝜃sinϕ R cosϕ ||
    |  sin𝜃     r cos 𝜃      0   |
  = sin 𝜃(− Rr sin𝜃 cos2ϕ − Rrsin𝜃sin2ϕ)
  + rcos𝜃(− R sin2 ϕcos𝜃− R cos2ϕcos𝜃)
           2        2
  = − Rrsin 𝜃− Rr cos𝜃
  = − Rr.                                             (598)
" class="math-display"  /></center>
</div>
   <h5 class="subsubsectionHead"><a 
 id="x1-139000A.14"></a>Toroidal elliptic operator <span 
class="cmmi-10">Δ</span><sup><span 
class="cmmi-7">⋆</span></sup><span 
class="cmmi-10">Ψ </span>in (<span 
class="cmmi-10">r,𝜃,ϕ</span>) coordinate system</h5>
<!--l. 7130--><p class="noindent" >Next, we transform the GS equation from (<span 
class="cmmi-10">R,Z</span>) coordinates to (<span 
class="cmmi-10">r,𝜃</span>) coordinates. Using the relations
<span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub> + <span 
class="cmmi-10">r</span> cos<span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">r</span> sin<span 
class="cmmi-10">𝜃</span>, we have
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-139001r599"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium764x.png" alt="    ∘--------------   ∂r   Z
r =  (R − R0)2 + Z2 ⇒ ---= --= sin𝜃
                      ∂Z    r
" class="math-display"  /></center></td><td class="equation-label">(599)</td></tr></table>
<!--l. 7136--><p class="nopar" >
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x1-139002r600"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium765x.png" alt="      -------Z-------        ∂𝜃-  r−-Z-Zr-
sin 𝜃 = ∘ (R-−-R-)2 +-Z2-⇒ cos𝜃 ∂Z =  r2   .
              0
" class="math-display"  /></center></td><td class="equation-label">(600)</td></tr></table>
<!--l. 7140--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-139003r601"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium766x.png" alt="   ∂𝜃     r− ZZ-    1− sin2 𝜃   cos2𝜃
⇒  ∂Z-= r(R-−-Rr) = -R-−-R--=  R-− R--
               0          0         0
" class="math-display"  /></center></td><td class="equation-label">(601)</td></tr></table>
<!--l. 7146--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-139004r602"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium767x.png" alt="∂ sin𝜃   r − ZZ-   1− sin2𝜃   cos2𝜃
------= ---2-r-=  --------= -----
  ∂Z       r         r        r
" class="math-display"  /></center></td><td class="equation-label">(602)</td></tr></table>
<!--l. 7150--><p class="nopar" >
The GS equation in (<span 
class="cmmi-10">R,Z</span>) coordinates is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-139005r603"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium768x.png" alt=" 2         (     )
∂-Ψ2 + R ∂- -1∂-Ψ  = − μ0R2dP-− -dgg(Ψ).
∂Z      ∂R  R ∂R           dΨ   dΨ
" class="math-display"  /></center></td><td class="equation-label">(603)</td></tr></table>
<!--l. 7156--><p class="nopar" >
The term <span 
class="cmmi-10">∂Ψ∕∂Z </span>is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium769x.png" alt="∂ Ψ   ∂Ψ ∂r   ∂Ψ ∂ 𝜃
--- = ------+ ------
∂Z    ∂r ∂Z    ∂𝜃∂Z  2
    = ∂Ψ-sin 𝜃+ ∂Ψ--cos-𝜃.                       (604)
      ∂r       ∂ 𝜃R − R0
" class="math-display"  /><a 
 id="x1-139006r604"></a></center>
</div>Using Eq. (<a 
href="#x1-139006r604">604<!--tex4ht:ref: 8-6-p1 --></a>), <span 
class="cmmi-10">∂</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">Ψ∕∂Z</span><sup><span 
class="cmr-7">2</span></sup> is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium770x.png" alt="∂2Ψ    ∂ ( ∂Ψ     )   ∂  (∂Ψ  cos2 𝜃 )
--2-= ---  ---sin 𝜃 +  --- ----------
∂Z    ∂Z   ∂r(   )    ∂Z  ∂ 𝜃R − R0         (    )         (       )
    = sin 𝜃 ∂-  ∂Ψ- + ∂Ψ--∂-(sin𝜃)+  cos2𝜃--∂-  ∂Ψ- +  ∂Ψ-∂-  -cos2-𝜃-
          ∂Z   ∂r    ∂r ∂Z         R− R0 ∂Z   ∂𝜃     ∂𝜃∂Z   R − R0
          (∂2Ψ        ∂2Ψ  cos2 𝜃)   ∂Ψ cos2𝜃   cos2𝜃 ( ∂2Ψ        ∂2Ψ cos2𝜃 )
    = sin 𝜃 -∂r2 sin𝜃+ ∂r∂𝜃R-−-R0- + -∂r--r-- + R-−-R0- ∂𝜃∂r-sin𝜃 + ∂𝜃2-R-− R0-
                            2
    − ∂Ψ----1--2 cos𝜃sin 𝜃 cos-𝜃-                                          (605)
      ∂ 𝜃R − R0          R − R0
" class="math-display"  /><a 
 id="x1-139007r605"></a></center>
</div>
   <table 
class="equation"><tr><td><a 
 id="x1-139008r606"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium771x.png" alt="         ∘ --------------
-∂r = -∂-  (R − R0)2 + Z2 = R-−-R0-= cos𝜃
∂R    ∂R                     r
" class="math-display"  /></center></td><td class="equation-label">(606)</td></tr></table>
<!--l. 7192--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                             sin<span 
class="cmmi-10">𝜃 </span>= <img 
src="tokamak_equilibrium772x.png" alt="∘------Z--------
  (R − R0)2 + Z2"  class="frac" align="middle" /><span 
class="cmmi-10">.</span>
</td></tr></table>
<!--l. 7193--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                              cos<span 
class="cmmi-10">𝜃</span><img 
src="tokamak_equilibrium773x.png" alt="∂𝜃
---
∂R"  class="frac" align="middle" /> = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">Z</span><img 
src="tokamak_equilibrium774x.png" alt="R − R
---3-0-
  r"  class="frac" align="middle" />
</td></tr></table>
<!--l. 7194--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-139009r607"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium775x.png" alt="∂𝜃-= − Z-.
∂R     r2
" class="math-display"  /></center></td><td class="equation-label">(607)</td></tr></table>
<!--l. 7197--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                             cos<span 
class="cmmi-10">𝜃 </span>= <img 
src="tokamak_equilibrium776x.png" alt="    R − R0
∘--------2----2-
  (R − R0 ) +Z"  class="frac" align="middle" />
</td></tr></table>
<!--l. 7198--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-139010r608"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium777x.png" alt=" ∂        r− R−R0(R − R0)   1− cos2𝜃   sin2𝜃
---cos𝜃 = -----r-2--------= -------- = -----
∂R              r               r        r
" class="math-display"  /></center></td><td class="equation-label">(608)</td></tr></table>
<!--l. 7203--><p class="nopar" >
</p>
   <div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium778x.png" alt="     (     )        [  (               )]
R-∂-  1-∂Ψ-  = R ∂-- 1-  ∂Ψ-∂r-+ ∂Ψ-∂𝜃-
 ∂R   R ∂R       ∂R [R ( ∂r ∂R   ∂𝜃 ∂R )]
             = R ∂-- 1-  ∂Ψ-cos𝜃 − ∂Ψ-Z-
                 ∂R  R   ∂r       ∂𝜃 r2
                ∂ ( ∂Ψ       ∂Ψ Z )     (∂Ψ        ∂Ψ Z )(   1 )
             = ∂R-  ∂r-cos𝜃− -∂𝜃r2  + R  -∂r cos𝜃 − ∂𝜃-r2  − R2-
               (  2        2     )                   (  2         2     )           (   )     (               )
             =   ∂-Ψ2-∂r + ∂-Ψ--∂𝜃  cos𝜃+ ∂Ψ--∂-cos𝜃−   ∂-Ψ--∂r-+ ∂-Ψ2-∂𝜃- -Z2 − ∂Ψ--∂-  Z2  − 1- ∂Ψ-cos𝜃 − ∂Ψ-Z2
               ( ∂r ∂R    ∂r∂𝜃∂R )       ∂r ∂R     (   ∂𝜃∂r ∂R   ∂𝜃  ∂R)  r    ∂𝜃 ∂R   r     R(   ∂r       ∂𝜃 r)
                 ∂2Ψ-      ∂2Ψ--Z        ∂-Ψsin2𝜃    ∂2Ψ--      ∂2Ψ-Z-  Z-  ∂Ψ-  1-       -1  ∂Ψ-      ∂-Ψ-Z
             =   ∂r2 cos𝜃 − ∂r∂𝜃r2 cos𝜃+  ∂r  r  −   ∂𝜃∂r cos 𝜃− ∂𝜃2 r2  r2 + ∂𝜃Z r32cos𝜃− R   ∂r cos𝜃−  ∂𝜃r2
               ∂2Ψ        ∂2Ψ sin2 𝜃    ∂2Ψ Z       ∂ Ψsin2𝜃   ∂Ψ  1
             = --2-cos2𝜃+ ---2--2--− 2------2 cos𝜃+-------- + --Z -32cos𝜃                                  (609)
               ∂r(        ∂ 𝜃  r    ) ∂r∂𝜃 r        ∂r  r     ∂𝜃  r
             − 1-  ∂Ψ-cos𝜃− ∂Ψ-1 sin𝜃                                                                       (610)
               R   ∂r       ∂ 𝜃r
" class="math-display"  /><a 
 id="x1-139011r609"></a></center>
</div>Summing the the right-hand-side of Eq. (<a 
href="#x1-139007r605">605<!--tex4ht:ref: 9-17-e1 --></a>) and the expression on line (<a 
href="#x1-139011r609">609<!--tex4ht:ref: 9-17-e3 --></a>) yields
   <table 
class="equation"><tr><td><a 
 id="x1-139012r611"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium779x.png" alt="∂2Ψ-  ∂Ψ-1   1-∂2Ψ-
∂r2 +  ∂rr + r2∂ 𝜃2 .
" class="math-display"  /></center></td><td class="equation-label">(611)</td></tr></table>
<!--l. 7252--><p class="nopar" >
Using these, the GS equation is written as
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
<img 
src="tokamak_equilibrium780x.png" alt="∂2Ψ-
 ∂r2"  class="frac" align="middle" />+<img 
src="tokamak_equilibrium781x.png" alt="∂Ψ-
∂r"  class="frac" align="middle" /><img 
src="tokamak_equilibrium782x.png" alt="1
r"  class="frac" align="middle" />+<img 
src="tokamak_equilibrium783x.png" alt="-1
r2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium784x.png" alt="∂2Ψ-
 ∂𝜃2"  class="frac" align="middle" /><span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium785x.png" alt="----1-----
R0 + rcos𝜃"  class="frac" align="middle" /><img 
src="tokamak_equilibrium786x.png" alt="(                  )
  ∂Ψ-      ∂Ψ-1
  ∂r cos𝜃− ∂𝜃 r sin𝜃"  class="left" align="middle" /> = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>+<span 
class="cmmi-10">r</span> cos<span 
class="cmmi-10">𝜃</span>)<sup><span 
class="cmr-7">2</span></sup><img 
src="tokamak_equilibrium787x.png" alt="dP-
dΨ"  class="frac" align="middle" /><span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium788x.png" alt="dg-
dΨ"  class="frac" align="middle" /><span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span>)<span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 7259--><p class="nopar" >
which can be arranged in the form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-139013r612"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium789x.png" alt="(               )              (                   )
 1 ∂---∂-  1--∂2     -----1----  ∂Ψ-      ∂-Ψ1                      2dP-  dg-
 r ∂rr∂r + r2∂𝜃2  Ψ− R0 + rcos𝜃  ∂r cos𝜃−  ∂𝜃r sin 𝜃 = − μ0(R0+r cos 𝜃)dΨ − dΨg(Ψ),
" class="math-display"  /></center></td><td class="equation-label">(612)</td></tr></table>
<!--l. 7268--><p class="nopar" >
which agrees with Eq. (3.6.2) in Wessson’s book<span class="cite">[<a 
href="#Xwesson2004">28</a>]</span>, where <span 
class="cmmi-10">f </span>is deﬁned by <span 
class="cmmi-10">f </span>= <span 
class="cmmi-10">RB</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmmi-10">∕μ</span><sub><span 
class="cmr-7">0</span></sub>, which is
diﬀerent from <span 
class="cmmi-10">g </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">RB</span><sub><span 
class="cmmi-7">ϕ</span></sub> by a 1<span 
class="cmmi-10">∕μ</span><sub><span 
class="cmr-7">0</span></sub> factor.
</p><!--l. 7273--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.15   </span> <a 
 id="x1-140000A.15"></a>Large aspect ratio expansion</h4>
<!--l. 7275--><p class="noindent" >Consider the case that the boundary ﬂux surface is circular with radius <span 
class="cmmi-10">r </span>= <span 
class="cmmi-10">a </span>and the center of the cirle
at (<span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">,Z </span>= 0). Consider the case <span 
class="cmmi-10">𝜀 </span>= <span 
class="cmmi-10">r∕R</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">→ </span>0. Expanding <span 
class="cmmi-10">Ψ </span>in the small parameter
<span 
class="cmmi-10">𝜀</span>,
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140001r613"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium790x.png" alt="Ψ = Ψ0 + Ψ1
" class="math-display"  /></center></td><td class="equation-label">(613)</td></tr></table>
<!--l. 7281--><p class="nopar" >
where <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">𝜀</span><sup><span 
class="cmr-7">0</span></sup>), <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub> <span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">𝜀</span><sup><span 
class="cmr-7">1</span></sup>). Substituting Eq. (<a 
href="#x1-140001r613">613<!--tex4ht:ref: 9-17-e4 --></a>) into Eq. (<a 
href="#x1-139013r612">612<!--tex4ht:ref: 9-17-e5 --></a>), we obtain
                                                                                

                                                                                
</p>
   <table 
class="equation-star"><tr><td>
<img 
src="tokamak_equilibrium791x.png" alt="1
r"  class="frac" align="middle" /><img 
src="tokamak_equilibrium792x.png" alt="∂--
∂r"  class="frac" align="middle" /><span 
class="cmmi-10">r</span><img 
src="tokamak_equilibrium793x.png" alt="∂Ψ0-
 ∂r"  class="frac" align="middle" />+<img 
src="tokamak_equilibrium794x.png" alt="1
r"  class="frac" align="middle" /><img 
src="tokamak_equilibrium795x.png" alt="∂--
∂r"  class="frac" align="middle" /><span 
class="cmmi-10">r</span><img 
src="tokamak_equilibrium796x.png" alt="∂Ψ1-
 ∂r"  class="frac" align="middle" />+<img 
src="tokamak_equilibrium797x.png" alt="-1
r2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium798x.png" alt="∂2Ψ0
 ∂𝜃2"  class="frac" align="middle" />+<img 
src="tokamak_equilibrium799x.png" alt="-1
r2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium800x.png" alt="∂2Ψ1
∂𝜃2"  class="frac" align="middle" /><span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium801x.png" alt="----1-----
R0 + rcos𝜃"  class="frac" align="middle" /><img 
src="tokamak_equilibrium802x.png" alt="(                   )
 ∂-Ψ0      ∂-Ψ01
  ∂r cos𝜃−  ∂𝜃 r sin𝜃"  class="left" align="middle" /><span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium803x.png" alt="-----1----
R0 + rcos𝜃"  class="frac" align="middle" /><img 
src="tokamak_equilibrium804x.png" alt="(                    )
  ∂Ψ1-      ∂Ψ1-1
   ∂r cos𝜃−  ∂𝜃 r sin𝜃"  class="left" align="middle" /> = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub>+<span 
class="cmmi-10">r</span> cos<span 
class="cmmi-10">𝜃</span>)<sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">P</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">Ψ</span><sub>
<span 
class="cmr-7">0</span></sub>+<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub>)<span 
class="cmsy-10">−</span><span 
class="cmmi-10">g</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>+<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub>)<span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>+<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub>)
</td></tr></table>
<!--l. 7293--><p class="nopar" >
Multiplying the above equation by <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup>, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140002r614"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium805x.png" alt=" 21 ∂  ∂Ψ0   2 1∂  ∂Ψ1    21 ∂2Ψ0   2 1∂2Ψ1      R20     (∂Ψ0       ∂Ψ0 1    )      R20    ( ∂Ψ1       ∂Ψ1 1    )        2          2 ′          2′
R0r ∂rr-∂r +R 0 r∂rr-∂r-+R 0r2∂-𝜃2 +R 0r2-∂𝜃2 −R0-+-rcos𝜃-∂r-cos𝜃− -∂𝜃-r sin𝜃 − R0-+-rcos𝜃 ∂r--cos𝜃 − -∂𝜃-r sin 𝜃 = − μ0R 0(R0+r cos𝜃) P (Ψ0+ Ψ1)− 
" class="math-display"  /></center></td><td class="equation-label">(614)</td></tr></table>
<!--l. 7307--><p class="nopar" >
Further assume the following orderings (why?)
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140003r615"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium806x.png" alt="  ∂ Ψ
R0--- ∼ O(𝜀−1)Ψ,
   ∂r
" class="math-display"  /></center></td><td class="equation-label">(615)</td></tr></table>
                                                                                

                                                                                
<!--l. 7311--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140004r616"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium807x.png" alt="∂Ψ
---∼ O (𝜀0)Ψ.
∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(616)</td></tr></table>
<!--l. 7315--><p class="nopar" >
Using these orderings, the order of the terms in Eq. (<a 
href="#x1-140002r614">614<!--tex4ht:ref: 10-11-1 --></a>) can be estimated as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140005r617"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium808x.png" alt=" 21-∂- ∂Ψ0-  Ψ0-     −2
R0r∂r r∂r  ∼ 𝜀2 ∼ O(𝜀  )
" class="math-display"  /></center></td><td class="equation-label">(617)</td></tr></table>
<!--l. 7322--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140006r618"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium809x.png" alt="  1 ∂  ∂Ψ    Ψ
R20----r--1-∼ -12-∼ O(𝜀−1)
  r∂r  ∂r    𝜀
" class="math-display"  /></center></td><td class="equation-label">(618)</td></tr></table>
                                                                                

                                                                                
<!--l. 7327--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140007r619"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium810x.png" alt="  1 ∂2Ψ     1
R20-2---02 ∼ -2Ψ0 ∼ O(𝜀−2)
  r  ∂𝜃    𝜀
" class="math-display"  /></center></td><td class="equation-label">(619)</td></tr></table>
<!--l. 7331--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140008r620"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium811x.png" alt="  21-∂2Ψ1   Ψ1-     −1
R 0r2 ∂𝜃2 ∼ 𝜀2 ∼ O(𝜀  )
" class="math-display"  /></center></td><td class="equation-label">(620)</td></tr></table>
<!--l. 7336--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140009r621"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium812x.png" alt="    R            r
------0--- ≈ 1− ---cos𝜃
R0 + rcos𝜃      R0
" class="math-display"  /></center></td><td class="equation-label">(621)</td></tr></table>
                                                                                

                                                                                
<!--l. 7339--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140010r622"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium813x.png" alt="  ∂ Ψ        Ψ
R0---0cos𝜃 ∼ -0∼ O (𝜀−1)
   ∂r        𝜀
" class="math-display"  /></center></td><td class="equation-label">(622)</td></tr></table>
<!--l. 7343--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140011r623"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium814x.png" alt="   ∂Ψ01       Ψ0-     −1
R0 ∂𝜃 r sin 𝜃 ∼ 𝜀 ∼ O (𝜀  )
" class="math-display"  /></center></td><td class="equation-label">(623)</td></tr></table>
<!--l. 7347--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140012r624"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium815x.png" alt="   ∂Ψ        Ψ
R0 --1-cos 𝜃 ∼-1-= O (𝜀0)
    ∂r        𝜀
" class="math-display"  /></center></td><td class="equation-label">(624)</td></tr></table>
                                                                                

                                                                                
<!--l. 7352--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140013r625"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium816x.png" alt="  ∂ Ψ 1       Ψ
R0---1-sin𝜃 ∼ -1-= O(𝜀0)
   ∂𝜃 r       𝜀
" class="math-display"  /></center></td><td class="equation-label">(625)</td></tr></table>
<!--l. 7356--><p class="nopar" >
The leading order (<span 
class="cmmi-10">𝜀</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">2</span></sup> order) balance is given by the following equation:
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140014r626"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium817x.png" alt="  21-∂- ∂Ψ0-   21-∂2Ψ0        4 ′       2 ′
R 0r∂r r∂r + R 0r2 ∂𝜃2 = − μ0R 0P (Ψ0) − R0g(Ψ0)g(Ψ0),
" class="math-display"  /></center></td><td class="equation-label">(626)</td></tr></table>
<!--l. 7364--><p class="nopar" >
It is reasonable to assume that <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> is independent of <span 
class="cmmi-10">𝜃 </span>since <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> corresponds to the limit <span 
class="cmmi-10">a∕R </span><span 
class="cmsy-10">→ </span>0. (The
limit <span 
class="cmmi-10">a∕R </span><span 
class="cmsy-10">→ </span>0 can have two cases, one is <span 
class="cmmi-10">r </span><span 
class="cmsy-10">→ </span>0, another is <span 
class="cmmi-10">R </span><span 
class="cmsy-10">→∞</span>. In the former case, <span 
class="cmmi-10">Ψ </span>must be
independent of <span 
class="cmmi-10">𝜃 </span>since <span 
class="cmmi-10">Ψ </span>should be single-valued. The latter case corresponds to a cylinder, for
which it is reasonable (really?) to assume that <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> is independent of <span 
class="cmmi-10">𝜃</span>.) Then Eq. (<a 
href="#x1-140014r626">626<!--tex4ht:ref: 11-21-1 --></a>) is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140015r627"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium818x.png" alt="1∂-r∂Ψ0-= − μ R2P ′(Ψ )− g′(Ψ )g(Ψ ).
r∂r  ∂r      0 0    0      0    0
" class="math-display"  /></center></td><td class="equation-label">(627)</td></tr></table>
<!--l. 7375--><p class="nopar" >
(My remarks: The leading order equation (<a 
href="#x1-140015r627">627<!--tex4ht:ref: 11-21-2 --></a>) does not corresponds strictly to a cylinder equilibrium
because the magnetic ﬁeld <span 
class="cmbx-10">B </span>= <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">ϕ </span>+ <span 
class="cmmi-10">g</span><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ </span>depends on <span 
class="cmmi-10">𝜃</span>.) The next order (<span 
class="cmmi-10">𝜀</span><sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup> order) equation
is
</p>
   <table 
class="equation-star"><tr><td>
<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><img 
src="tokamak_equilibrium819x.png" alt="1
r"  class="frac" align="middle" /><img 
src="tokamak_equilibrium820x.png" alt="-∂-
∂r"  class="frac" align="middle" /><span 
class="cmmi-10">r</span><img 
src="tokamak_equilibrium821x.png" alt="∂-Ψ1
 ∂r"  class="frac" align="middle" />+<span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><img 
src="tokamak_equilibrium822x.png" alt="1-
r2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium823x.png" alt="∂2Ψ1
∂ 𝜃2"  class="frac" align="middle" /><span 
class="cmsy-10">−</span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><img 
src="tokamak_equilibrium824x.png" alt="∂Ψ0-
 ∂r"  class="frac" align="middle" />cos<span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup>2<span 
class="cmmi-10">R</span><sub>
<span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">r</span> cos<span 
class="cmmi-10">𝜃P</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>)<span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">4</span></sup><span 
class="cmmi-10">P</span><span 
class="cmsy-10">′′</span>(<span 
class="cmmi-10">Ψ</span><sub>
<span 
class="cmr-7">0</span></sub>)<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub><span 
class="cmsy-10">−</span><span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup>[<span 
class="cmmi-10">g</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">Ψ</span><sub>
<span 
class="cmr-7">0</span></sub>)<span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>)]<span 
class="cmsy-10">′</span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub>
</td></tr></table>
<!--l. 7384--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140016r628"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium825x.png" alt="  1 ∂  ∂Ψ1     1 ∂2Ψ1                                                         ∂Ψ0
R20r ∂rr-∂r +R20 r2-∂𝜃2-+{μ0R40P′′(Ψ0)+R20[g′(Ψ0)g(Ψ0)]′}Ψ1 = − μ0R202R0rcos𝜃P ′(Ψ0)+R0 ∂r-cos𝜃
" class="math-display"  /></center></td><td class="equation-label">(628)</td></tr></table>
<!--l. 7392--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140017r629"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium826x.png" alt="  1 ∂  ∂Ψ      1 ∂2Ψ   d                           dr                             ∂Ψ
R20- --r--1+R20 2---21+ --{μ0R40P ′(Ψ0)+R20g′(Ψ0)g(Ψ0)}---Ψ1 = − μ0R202R0rcos𝜃P′(Ψ0)+R0 --0cos𝜃
  r ∂r  ∂r     r ∂𝜃    dr                         dΨ0                             ∂r
" class="math-display"  /></center></td><td class="equation-label">(629)</td></tr></table>
<!--l. 7399--><p class="nopar" >
It is obvious that the simple poloidal dependence of cos<span 
class="cmmi-10">𝜃 </span>will satisfy the above equation. Therefore, we
consider <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">1</span></sub> of the form
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140018r630"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium827x.png" alt="         dΨ (r)
Ψ1 = Δ(r)--0---cos𝜃,
           dr
" class="math-display"  /></center></td><td class="equation-label">(630)</td></tr></table>
<!--l. 7404--><p class="nopar" >
where <span 
class="cmmi-10">Δ</span>(<span 
class="cmmi-10">r</span>) is a new function to be determined. Substitute this into the Eq. (), we obtain an equation
for <span 
class="cmmi-10">Δ</span>(<span 
class="cmmi-10">r</span>),
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140019r631"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium828x.png" alt="  1 d (  dΨ dΔ      d2Ψ )     1  dΨ (r)  d                           dr  dΨ (r)                      dΨ
R20- --  r--0---+ rΔ ---02  − R20 2-Δ--0--+ --{μ0R40P ′(Ψ0)+R20g′(Ψ0)g(Ψ0)}---Δ --0---= − μ0R202R0rP ′(Ψ0)+R0 --0-
  r dr   dr  dr      dr       r    dr    dr                         dΨ0    dr                        dr
" class="math-display"  /></center></td><td class="equation-label">(631)</td></tr></table>
<!--l. 7416--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140020r632"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium829x.png" alt="      (        )        (    2   )
R201 d-  rdΨ0dΔ- +R201 d-  rΔd-Ψ0  − R20 1-Δ dΨ0(r)+-d{μ0R40P′(Ψ0)+R20g′(Ψ0)g(Ψ0)}Δ = − μ0R202R0rP ′(Ψ0)+R0 dΨ0
  r dr   dr  dr     r dr     dr2      r2    dr    dr                                                 dr
" class="math-display"  /></center></td><td class="equation-label">(632)</td></tr></table>
<!--l. 7425--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140021r633"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium830x.png" alt="      (        )          (      )
 21 d-   dΨ0dΔ-      21-d   d2Ψ0     2d2Ψ0dΔ-   2-1  dΨ0(r) -d     4 ′      2 ′                 2      ′       dΨ0-
R0r dr  rdr  dr + ΔR 0rdr  r dr2  +R 0dr2  dr − R0r2Δ  dr  +dr{μ0R 0P (Ψ0)+R 0g(Ψ0)g(Ψ0)}Δ  = − μ0R02R0rP (Ψ0)+R0  dr
" class="math-display"  /></center></td><td class="equation-label">(633)</td></tr></table>
<!--l. 7433--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140022r634"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium831x.png" alt="  1 d (  dΨ dΔ )      [1 d (  d2Ψ )   1 dΨ (r)]    d2Ψ dΔ   d                                                 dΨ
R20- --  r--0--- + ΔR20 - --  r--20  − -2--0--- +R20--20---+ --{μ0R40P′(Ψ0)+R20g′(Ψ0)g(Ψ0)}Δ = − μ0R202R0rP′(Ψ0)+R0--0-
  r dr   dr  dr        r dr   dr      r   dr       dr  dr   dr                                                 dr
" class="math-display"  /></center></td><td class="equation-label">(634)</td></tr></table>
<!--l. 7441--><p class="nopar" >
Using the identity
</p>
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                   <img 
src="tokamak_equilibrium832x.png" alt="d
dr"  class="frac" align="middle" /><img 
src="tokamak_equilibrium833x.png" alt="[1 d (  dΨ0)]
 r dr r dr--"  class="left" align="middle" /> = <img 
src="tokamak_equilibrium834x.png" alt="1
r"  class="frac" align="middle" /><img 
src="tokamak_equilibrium835x.png" alt=" d
dr"  class="frac" align="middle" /><img 
src="tokamak_equilibrium836x.png" alt="( d2Ψ0 )
 r-dr2"  class="left" align="middle" /><span 
class="cmsy-10">−</span><img 
src="tokamak_equilibrium837x.png" alt=" 1
r2"  class="frac" align="middle" /><img 
src="tokamak_equilibrium838x.png" alt="dΨ0(r)
-dr---"  class="frac" align="middle" /><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 7445--><p class="nopar" >
equation () is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140023r635"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium839x.png" alt=" 21 d (  dΨ0dΔ )     2d [ 1 d ( dΨ0) ]   2d2Ψ0dΔ   d     4  ′     2 ′                  2     ′       dΨ0
R0r dr  rdr--dr + ΔR 0dr  rdr  r-dr-  +R 0dr2-dr-+ dr{μ0R0P (Ψ0)+R0g (Ψ0)g(Ψ0)}Δ = − μ0R 02R0rP (Ψ0)+R0-dr-
" class="math-display"  /></center></td><td class="equation-label">(635)</td></tr></table>
<!--l. 7454--><p class="nopar" >
Using the leading order equation (), we know that the second and fourth term on the l.h.s of the above
equation cancel each other, giving
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140024r636"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium840x.png" alt="   1 d ( dΨ  dΔ)      d2Ψ dΔ                        dΨ
R20---  r--0---- + R20--20---= − μ0R202R0rP ′(Ψ0)+ R0 --0-
   rdr    dr dr       dr  dr                        dr
" class="math-display"  /></center></td><td class="equation-label">(636)</td></tr></table>
<!--l. 7461--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140025r637"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium841x.png" alt="       (        )
⇒  1-d  rdΨ0-dΔ- +  d2Ψ0-dΔ-= − μ 2R rP′(Ψ )+ -1-dΨ0-
   rdr    dr dr     dr2 dr      0  0     0   R0 dr
" class="math-display"  /></center></td><td class="equation-label">(637)</td></tr></table>
<!--l. 7467--><p class="nopar" >
</p><!--l. 7470--><p class="indent" >   Using the identity
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140026r638"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium842x.png" alt="       [ (    )     ]      (        )
1-dr-d     dΨ0- 2 dΔ    1d-   dΨ0dΔ-    d2Ψ0 dΔ-
rdΨ0dr  r  dr    dr  =  rdr  r dr dr  +  dr2 dr ,
" class="math-display"  /></center></td><td class="equation-label">(638)</td></tr></table>
<!--l. 7476--><p class="nopar" >
equation (<a 
href="#x1-140025r637">637<!--tex4ht:ref: 9-17-e8 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140027r639"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium843x.png" alt="       [            ]
1 dr d   ( dΨ0)2 dΔ              ′      1 dΨ0
rdΨ--dr r  -dr-  dr- = − μ02R0rP (Ψ0)+ R---dr ,
   0                                     0
" class="math-display"  /></center></td><td class="equation-label">(639)</td></tr></table>
<!--l. 7482--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140028r640"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium844x.png" alt="   1 d [ ( dΨ )2 dΔ]           dP    1 ( dΨ )2
⇒  ---  r  --0-  --- = − μ02R0r---+ ---  --0-  ,
   rdr     dr    dr            dr   R0   dr
" class="math-display"  /></center></td><td class="equation-label">(640)</td></tr></table>
<!--l. 7487--><p class="nopar" >
Using
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140029r641"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium845x.png" alt="B  =  1-dΨ0-
 𝜃0   R0 dr
" class="math-display"  /></center></td><td class="equation-label">(641)</td></tr></table>
<!--l. 7491--><p class="nopar" >
equation (<a 
href="#x1-140028r640">640<!--tex4ht:ref: 9-17-e10 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140030r642"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium846x.png" alt="1 d [    dΔ ]        1  dP   B2
r dr rB2𝜃0-dr  = − μ02R-rdr-+ -R𝜃0.
                      0        0
" class="math-display"  /></center></td><td class="equation-label">(642)</td></tr></table>
<!--l. 7497--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-140031r643"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium847x.png" alt="     [       ]      (                  )
⇒  d- rB2𝜃0dΔ- = -r- − 2μ0rdP-(Ψ0) + B2𝜃0 ,
   dr      dr    R0          dr
" class="math-display"  /></center></td><td class="equation-label">(643)</td></tr></table>
<!--l. 7502--><p class="nopar" >
which agrees with equation (3.6.7) in Wessson’s book<span class="cite">[<a 
href="#Xwesson2004">28</a>]</span>.
</p><!--l. 7505--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">A.16   </span> <a 
 id="x1-141000A.16"></a>(<span 
class="cmmi-10">s,α</span>) parameters</h4>
<!--l. 7507--><p class="noindent" >The normalized pressure gradient, <span 
class="cmmi-10">α</span>, which appears frequently in tokamak literature, is deﬁned
by<span class="cite">[<a 
href="#Xberk1995">3</a>]</span>
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141001r644"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium848x.png" alt="            1   dp
α = − R0q2 B2∕2μ-dr ,
           0   0
" class="math-display"  /></center></td><td class="equation-label">(644)</td></tr></table>
<!--l. 7511--><p class="nopar" >
which can be further written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141002r645"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium849x.png" alt="          dp
α = − R0q2--,
          dr
" class="math-display"  /></center></td><td class="equation-label">(645)</td></tr></table>
                                                                                

                                                                                
<!--l. 7515--><p class="nopar" >
where <span class="overline"><span 
class="cmmi-10">p</span></span> = <span 
class="cmmi-10">p∕</span>(<span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">∕</span>2<span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub>). Equation (<a 
href="#x1-141002r645">645<!--tex4ht:ref: 1-24-p1 --></a>) can be further written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141003r646"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium850x.png" alt="     1  2dp
α = − 𝜀aq dr,
" class="math-display"  /></center></td><td class="equation-label">(646)</td></tr></table>
<!--l. 7521--><p class="nopar" >
where <span 
class="cmmi-10">𝜀</span><sub><span 
class="cmmi-7">a</span></sub> = <span 
class="cmmi-10">a∕R</span><sub><span 
class="cmr-7">0</span></sub>, <span class="overline"><span 
class="cmmi-10">r</span></span> = <span 
class="cmmi-10">r∕a</span>, and <span 
class="cmmi-10">a </span>is the minor radius of the boundary ﬂux surface. (Why is there a <span 
class="cmmi-10">q</span><sup><span 
class="cmr-7">2</span></sup>
factor in the deﬁnition of <span 
class="cmmi-10">α</span>?)
</p><!--l. 7526--><p class="indent" >   The global magnetic shear <span 
class="cmmi-10">s </span>is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141004r647"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium851x.png" alt="   r dq
s =- --,
   q dr
" class="math-display"  /></center></td><td class="equation-label">(647)</td></tr></table>
<!--l. 7529--><p class="nopar" >
which can be written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141005r648"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium852x.png" alt="   -
s = r dq.
   q dr
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(648)</td></tr></table>
<!--l. 7533--><p class="nopar" >
In the case of large aspect ratio and circular ﬂux surface, the leading order equation of the
Grad-Shafranov equation in (<span 
class="cmmi-10">r,𝜃</span>) coordinates is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141006r649"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium853x.png" alt="1 d-rdΨ-= − μ0R0Jϕ(r),
r dr dr
" class="math-display"  /></center></td><td class="equation-label">(649)</td></tr></table>
<!--l. 7542--><p class="nopar" >
which gives concentric circular ﬂux surfaces centered at (<span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">,Z </span>= 0). Assume that <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> is uniform
distributed, i.e., <span 
class="cmsy-10">|</span><span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmsy-10">| </span>= <span 
class="cmmi-10">I∕</span>(<span 
class="cmmi-10">πa</span><sup><span 
class="cmr-7">2</span></sup>), where <span 
class="cmmi-10">I </span>is the total current within the ﬂux surface <span 
class="cmmi-10">r </span>= <span 
class="cmmi-10">a</span>. Further
assume the current is in the opposite direction of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ</span>, then <span 
class="cmmi-10">J</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">I∕</span>(<span 
class="cmmi-10">πa</span><sup><span 
class="cmr-7">2</span></sup>). Using this, Eq. (<a 
href="#x1-141006r649">649<!--tex4ht:ref: 11-20-e3 --></a>) can
be solved to give
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141007r650"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium854x.png" alt="     μ0I    2
Ψ = 4πa2R0r  .
" class="math-display"  /></center></td><td class="equation-label">(650)</td></tr></table>
<!--l. 7551--><p class="nopar" >
Then it follows that the normalized radial coordinate <span 
class="cmmi-10">ρ </span><span 
class="cmsy-10">≡ </span>(<span 
class="cmmi-10">Ψ </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>)<span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>) relates to <span class="overline"><span 
class="cmmi-10">r</span></span> by <span class="overline"><span 
class="cmmi-10">r</span></span> = <img 
src="tokamak_equilibrium855x.png" alt="√-
 ρ"  class="sqrt"  />
 (I check this numerically for the case of EAST discharge #38300). Sine in my code, the radial
coordinate is <span 
class="cmmi-10">Ψ</span>, I need to transform the derivative with respect to <span class="overline"><span 
class="cmmi-10">r</span></span> to one with respect to <span 
class="cmmi-10">Ψ</span>, which
gives
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141008r651"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium856x.png" alt="     1 2dp     1 2-dp-    1 2dp -1--    1 2 dp-1--
α = − 𝜀q dr = − 𝜀q d√ρ = − 𝜀q dρ 2√ρ = − 𝜀q dΨ 2√ρ(Ψb − Ψ0).
" class="math-display"  /></center></td><td class="equation-label">(651)</td></tr></table>
<!--l. 7564--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141009r652"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium857x.png" alt="    rdq   √ρ dq  1             1 dq
s = qdr = -q-dΨ-2√ρ-(Ψb − Ψ0) = 2qdΨ-(Ψb − Ψ0).
" class="math-display"  /></center></td><td class="equation-label">(652)</td></tr></table>
<!--l. 7569--><p class="nopar" >
The necessary condition for the existence of TAEs with frequency near the upper tip of the gap is given
by<span class="cite">[<a 
href="#Xberk1995">3</a>]</span>
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-141010r653"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium858x.png" alt="α &#x003C; − s2 + 𝜀,
" class="math-display"  /></center></td><td class="equation-label">(653)</td></tr></table>
<!--l. 7574--><p class="nopar" >
which is used in my paper on Alfvén eigenmodes on EAST tokamak<span class="cite">[<a 
href="#Xhu2014">15</a>]</span>. Equations (<a 
href="#x1-141008r651">651<!--tex4ht:ref: 7-9-3 --></a>) and (<a 
href="#x1-141009r652">652<!--tex4ht:ref: 7-9-4 --></a>) are
used in the GTAW code to calculate <span 
class="cmmi-10">s </span>and <span 
class="cmmi-10">α</span>.
                                                                                

                                                                                
</p><!--l. 7579--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">B   </span> <a 
 id="x1-142000B"></a>Computing magnetic ﬁeld generated by coils</h3>
<!--l. 7581--><p class="noindent" >Magnetic ﬁeld (e.g., equilibrium poloidal ﬁeld, RMP ﬁeld, ripple ﬁeld) and vector potential generated
by coils can be calculated in the following way.
</p><!--l. 7584--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">B.1   </span> <a 
 id="x1-143000B.1"></a>Magnetic ﬁeld</h4>
<!--l. 7586--><p class="noindent" >The Biot-Savart law for a zero-thinkness wire is given by </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium859x.png" alt="       μ0-∫  dl(r′)×-(r−-r′)
B (r) = 4π  I   |r− r′|3   ,                      (654)
" class="math-display"  /></center>
</div>where <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l</span>(<span 
class="cmbx-10">r</span><span 
class="cmsy-10">′</span>) is a line element along the wire (the freedom of choosing which one of the two possible
directions along the wire is up to users), <span 
class="cmmi-10">I </span>is the current in the wire (<span 
class="cmmi-10">I </span>is positive if the current in the
same direction of <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l</span>, otherwise, negative).
<!--l. 7597--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">B.2   </span> <a 
 id="x1-144000B.2"></a>Magnetic vector potential</h4>
<!--l. 7599--><p class="noindent" >Given a current source <span 
class="cmbx-10">J</span>(<span 
class="cmbx-10">r</span><span 
class="cmmi-10">,t</span>), the vector potential can be calculated using
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-144001r655"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium860x.png" alt="        μ  ∫ J (r′,t′)
A(r,t) = -0-  -----′-d3r′,
        4π  Ω |r − r |
" class="math-display"  /></center></td><td class="equation-label">(655)</td></tr></table>
                                                                                

                                                                                
<!--l. 7605--><p class="nopar" >
where
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-144002r656"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium861x.png" alt=" ′     |r-−-r′|
t = t−   c   ,
" class="math-display"  /></center></td><td class="equation-label">(656)</td></tr></table>
<!--l. 7609--><p class="nopar" >
is called the retarded time. For a steady-state source, <span 
class="cmbx-10">J</span>(<span 
class="cmbx-10">r</span><span 
class="cmsy-10">′</span><span 
class="cmmi-10">,t</span><span 
class="cmsy-10">′</span>) = <span 
class="cmbx-10">J</span>(<span 
class="cmbx-10">r</span>). Then Eq. (<a 
href="#x1-144001r655">655<!--tex4ht:ref: 21-12-11-a1 --></a>) is simpliﬁed
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-144003r657"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium862x.png" alt="      μ0 ∫   J(r′)
A(r) = 4π   |r-−-r′|d3r′.
          Ω
" class="math-display"  /></center></td><td class="equation-label">(657)</td></tr></table>
<!--l. 7616--><p class="nopar" >
For a current ﬂowing in a thin wire, the above equation is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-144004r658"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium863x.png" alt="       μ  ∫  J(r′)
A (r) =-0-  -----′dS (r′)dl(r′),
       4π   |r− r |
" class="math-display"  /></center></td><td class="equation-label">(658)</td></tr></table>
                                                                                

                                                                                
<!--l. 7622--><p class="nopar" >
where <span 
class="cmmi-10">dS </span>is a surface element perpendicular to the wire and <span 
class="cmmi-10">dl </span>is a line element along the wire. Using
<span 
class="cmbx-10">J</span>(<span 
class="cmbx-10">r</span><span 
class="cmsy-10">′</span>)<span 
class="cmmi-10">dS</span>(<span 
class="cmbx-10">r</span><span 
class="cmsy-10">′</span>) = <span 
class="cmbx-10">I</span>(<span 
class="cmbx-10">r</span><span 
class="cmsy-10">′</span>), the above eqaution is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium864x.png" alt="          ∫
       μ0-  -I(r′)-    ′
A (r) = 4π   |r− r′| dl(r)
       μ0 ∫  I(r′)    ′
     = 4π-  |r−-r′|dl(r ).                       (659)
" class="math-display"  /></center>
</div>In cylindrical coordinates, the toroidal component of <span 
class="cmbx-10">A</span>, <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> <span 
class="cmsy-10">≡ </span><span 
class="cmbx-10">A </span><span 
class="cmsy-10">⋅ </span><span 
class="cmbx-10">e</span><sub><span 
class="cmmi-7">ϕ</span></sub>(<span 
class="cmbx-10">r</span>), is written as
   <table 
class="equation"><tr><td><a 
 id="x1-144006r660"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium865x.png" alt="        μ ∫  I(r′)
Aϕ(r) =--0   ----′-dl(r′)⋅eϕ(r).
       4π    |r− r |
" class="math-display"  /></center></td><td class="equation-label">(660)</td></tr></table>
<!--l. 7639--><p class="nopar" >
(<span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> is needed in several applications. In solving the free-boundy equilibrium problem, we need to
calculate <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> generated by the PF coils. In studying the eﬀects of RMP on particles, we need to
calculate <span 
class="cmmi-10">P</span><sub><span 
class="cmmi-7">ϕ</span></sub>, the canonical toroidal angular momentum, whose deﬁntion involves <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub>. Then we need to
calculate <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> generated by the RMP coils.)
</p><!--l. 7646--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">B.3   </span> <a 
 id="x1-145000B.3"></a>For wires along toroidal direction</h4>
<!--l. 7648--><p class="noindent" >For a curve along the toroidal direction, the line element <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l </span>in terms of the cylindrical basis is written
as <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l</span><span 
class="cmsy-10">′ </span>= <span 
class="cmmi-10">R</span><span 
class="cmsy-10">′</span><span 
class="cmmi-10">dϕ</span><span 
class="cmsy-10">′</span><img 
src="tokamak_equilibrium866x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">ϕ</span></sub><span 
class="cmsy-10">′</span>. Using Cartesian coordinate basis vectors, <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l</span><span 
class="cmsy-10">′ </span>is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-145001r661"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium867x.png" alt="dl′ = R ′dϕ′(− sinϕ′ˆex + cosϕ′ˆey),
" class="math-display"  /></center></td><td class="equation-label">(661)</td></tr></table>
<!--l. 7655--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-145002r662"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium868x.png" alt=" ′   ′    ′ˆ    ′    ′ˆ     ′ˆ
r = R cosϕ ex + R sin ϕey + Z ez
" class="math-display"  /></center></td><td class="equation-label">(662)</td></tr></table>
<!--l. 7660--><p class="nopar" >
where a global Cartesian coordinates with <span 
class="cmmi-10">x </span>axis in <span 
class="cmmi-10">ϕ </span>= 0 plane is assumed.
</p><!--l. 7664--><p class="indent" >   Let us consider a full toroidal coil at (<span 
class="cmmi-10">R</span><span 
class="cmsy-10">′</span><span 
class="cmmi-10">,Z</span><span 
class="cmsy-10">′</span>)with current <span 
class="cmmi-10">I </span>(a ﬁlamentary current loop). Since the
problem is symmetric, the magnetic ﬁeld/potential is independent of <span 
class="cmmi-10">ϕ</span>. For calculation ease, we select
<span 
class="cmmi-10">ϕ </span>= 0 plane and calculate <span 
class="cmbx-10">A </span>and <span 
class="cmbx-10">B </span>values in this plane. Then
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-145003r663"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium869x.png" alt="eϕ(r) = ˆey,
" class="math-display"  /></center></td><td class="equation-label">(663)</td></tr></table>
<!--l. 7671--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-145004r664"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium870x.png" alt="r = Rˆex + 0ˆey + Zˆez,
" class="math-display"  /></center></td><td class="equation-label">(664)</td></tr></table>
<!--l. 7675--><p class="nopar" >
Using these, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-145005r665"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium871x.png" alt="  ′         ′  ′    ′
dl ⋅eϕ(r) = R dϕ cosϕ.
" class="math-display"  /></center></td><td class="equation-label">(665)</td></tr></table>
<!--l. 7679--><p class="nopar" >
and Eq. (<a 
href="#x1-144006r660">660<!--tex4ht:ref: 24-6-14-p1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-145006r666"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium872x.png" alt="                μ0I∫ 2π              R ′cosϕ ′dϕ′
A ϕ(R, Z,ϕ = 0) = 4π     ∘-------′2--------′----′2-----′---′2-.
                     0    (Z − Z ) + (R − R cosϕ) + (R sinϕ )
" class="math-display"  /></center></td><td class="equation-label">(666)</td></tr></table>
<!--l. 7685--><p class="nopar" >
Sine <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> is axsymmetric, the above formula applies to all values of <span 
class="cmmi-10">ϕ</span>. Multiply <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ϕ</span></sub> by <span 
class="cmmi-10">R </span>and set <span 
class="cmmi-10">I </span>= 1,
we get Green’s function of <span 
class="cmmi-10">Ψ</span>: </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium873x.png" alt="  G(R ′,Z′,R,Z )

= RA ϕ∫
  μ0-  2π -------------RR-′cosϕ-′dϕ′-------------
= 4π  0  ∘ (Z-− Z-′)2 +-(R-−-R′cosϕ′)2-+-(R-′sinϕ′)2
     ∫ 2π              ′    ′ ′
= μ0-    ∘---------RR--cosϕ-dϕ-----------.                 (667)
  4π  0    (Z − Z ′)2 + R2+R ′2 − 2RR ′cosϕ′
" class="math-display"  /><a 
 id="x1-145007r667"></a></center>
</div>This expression can be directly used in numerical codes to compute the Green function
table. One can also write the above integration to the elipitic integrals and use library to
compute these inegreals. Let write the above expresion in this form. Deﬁne <span 
class="cmmi-10">𝜃 </span>= (<span 
class="cmmi-10">π </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">ϕ</span>)<span 
class="cmmi-10">∕</span>2, then
cos<span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">′ </span>= cos(<span 
class="cmmi-10">π </span><span 
class="cmsy-10">− </span>2<span 
class="cmmi-10">𝜃</span>) = <span 
class="cmsy-10">−</span>cos(2<span 
class="cmmi-10">𝜃</span>) = 2sin<sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">− </span>1. Using this Eq. (<a 
href="#x1-145007r667">667<!--tex4ht:ref: 24-5-29-p1 --></a>) is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium874x.png" alt="  G (R ′,Z ′,R,Z )
  μ0 ∫ −π∕2         − 2RR ′(2sin2 𝜃− 1)d𝜃
= 4π-      ∘------------------------------------
      π∕2    (Z − Z′)2 + R2+R ′2 − 2RR ′(2sin2𝜃 − 1)
  μ  ∫ π∕2          4RR ′(2sin2 𝜃− 1)d𝜃
= --0     ∘------------------------------------
  4π  0     (Z − Z ′)2 + R2+R ′2 − 2RR ′(2 sin2𝜃 − 1)
     ∫ π∕2           ′    2
= μ0-     ∘-------4RR-(2sin--𝜃−-1)d𝜃---------                (668)
  4π  0     (Z − Z ′)2 + (R + R′)2 − 4RR ′sin2𝜃
" class="math-display"  /></center>
</div>Deﬁne
   <table 
class="equation"><tr><td><a 
 id="x1-145009r669"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium875x.png" alt="            4RR ′
k2 = ------′2--------′2-
     (Z − Z ) + (R + R )
" class="math-display"  /></center></td><td class="equation-label">(669)</td></tr></table>
<!--l. 7719--><p class="nopar" >
Then </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium876x.png" alt="  G (R ′,Z ′,R,Z )
     ∫ π∕2            ′   2
= μ0-     ∘-------4RR-(2sin--𝜃−∘1)d𝜃--------
  4π  0     (Z − Z ′)2 + (R + R′)2 1 − k2sin2𝜃
     √----∫ π∕2     2
= μ0- RR ′     k(∘2sin--𝜃−-1)d𝜃
  2π      [0      1− k2sin2𝜃                       ]
  μ0 √RR-  ∫ π∕2   2 − k2       ∫ π∕2 2− 2k2sin2𝜃
= 2π---k--      ∘-----2---2-d𝜃 −     ∘------2--2- d𝜃
     √--- [ 0     1− k sin 𝜃     0     1 − k sin 𝜃   ]
  μ0--RR-- ∫ π∕2---2-−-k2---      ∫ π∕2∘ -----2--2-
= 2π   k    0   ∘1-−-k2sin2𝜃d𝜃 − 2 0    1 − k sin 𝜃d𝜃
     √----
= μ0--RR-′[(2 − k2)K (k)− 2E(k)]
  2π   k
" class="math-display"  /></center>
</div>where
   <table 
class="equation-star"><tr><td>
                                                                                

                                                                                
                           <span 
class="cmmi-10">E</span>(<span 
class="cmmi-10">k</span>) = <span 
class="cmex-10">∫</span>
  <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">π∕</span><span 
class="cmr-7">2</span></sup><img 
src="tokamak_equilibrium877x.png" alt="∘ -----2--2-
  1 − k sin 𝜃"  class="sqrt"  /><span 
class="cmmi-10">d𝜃</span>
</td></tr></table>
<!--l. 7737--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                          <span 
class="cmmi-10">K</span>(<span 
class="cmmi-10">k</span>) = <span 
class="cmex-10">∫</span>
  <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">π∕</span><span 
class="cmr-7">2</span></sup><img 
src="tokamak_equilibrium878x.png" alt="      1
∘-----------
  1− k2 sin2𝜃"  class="frac" align="middle" /><span 
class="cmmi-10">d𝜃,</span>
</td></tr></table>
<!--l. 7739--><p class="nopar" >
are the eliptic integrals of the ﬁrst and second kind.
</p><!--l. 7742--><p class="indent" >    
</p><!--l. 7744--><p class="indent" >    
</p><!--l. 7746--><p class="indent" >   Similarly, we can calculate the magnetic ﬁeld: </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium879x.png" alt="       μ0I ∮ dl′ × (r − r′)
B (r) =-4π   --|r−-r′|3--,                       (670)
" class="math-display"  /><a 
 id="x1-145011r670"></a></center>
</div>where the cross product is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium880x.png" alt="             |                            |
             ||     ˆex        eˆy       ˆez  ||
dl′ × (r− r′) = ||− R′dϕ′sinϕ ′ R′dϕ′cos ϕ′ 0 ||
             |R − R ′cosϕ ′ − R′sin ϕ′ Z − Z ′|
           = ˆexR ′dϕ ′cosϕ′(Z − Z ′) +eˆyR ′dϕ ′sinϕ′(Z − Z ′)
                ( ′2     ′    ′)   ′
           + ˆez  R  − RR  cosϕ  dϕ
" class="math-display"  /></center>
</div>The <img 
src="tokamak_equilibrium881x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">R</span></sub>(<span 
class="cmbx-10">r</span>) and <img 
src="tokamak_equilibrium882x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">Z</span></sub>(<span 
class="cmbx-10">r</span>) components of the above result are written as
   <table 
class="equation-star"><tr><td>
                       <img 
src="tokamak_equilibrium883x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">R</span></sub> <span 
class="cmsy-10">⋅ </span><span 
class="cmmi-10">d</span><span 
class="cmbx-10">l</span><span 
class="cmsy-10">′× </span>(<span 
class="cmbx-10">r </span><span 
class="cmsy-10">− </span><span 
class="cmbx-10">r</span><span 
class="cmsy-10">′</span>) = <span 
class="cmmi-10">R</span><span 
class="cmsy-10">′</span>(<span 
class="cmmi-10">Z </span><span 
class="cmsy-10">− </span><span 
class="cmmi-10">Z</span><span 
class="cmsy-10">′</span>)sin<span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">′</span><span 
class="cmmi-10">dϕ</span><span 
class="cmsy-10">′</span>
</td></tr></table>
<!--l. 7766--><p class="nopar" >
</p>
   <table 
class="equation-star"><tr><td>
                      <img 
src="tokamak_equilibrium884x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">Z</span></sub> <span 
class="cmsy-10">⋅ </span><span 
class="cmmi-10">d</span><span 
class="cmbx-10">l</span><span 
class="cmsy-10">′× </span>(<span 
class="cmbx-10">r </span><span 
class="cmsy-10">− </span><span 
class="cmbx-10">r</span><span 
class="cmsy-10">′</span>) = <img 
src="tokamak_equilibrium885x.png" alt="(  ′2     ′    ′)
 R   − RR cosϕ"  class="left" align="middle" /><span 
class="cmmi-10">dϕ</span><span 
class="cmsy-10">′</span>
</td></tr></table>
<!--l. 7768--><p class="nopar" >
Using these in Eq. (<a 
href="#x1-145011r670">670<!--tex4ht:ref: 24-6-5-p6m --></a>), <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">R</span></sub>(<span 
class="cmbx-10">r</span>) and <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">Z</span></sub>(<span 
class="cmbx-10">r</span>) are written as
</p>
   <div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium886x.png" alt="         ∫ 2π               ′      ′    ′
BR  = μ0I     (------------R-(Z-−-Z-)sin-ϕ-----------)--dϕ′,
      4π  0    ∘ (Z-−-Z-′)2 +-(R-−-R′cosϕ′)2-+(R-′sinϕ′)2 3
" class="math-display"  /></center>
</div>
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium887x.png" alt="      μ0I∫ 2π              R′2 − RR ′cosϕ′
BZ  = 4π-     (∘-----------------------------------)3-dϕ′,
          0      (Z − Z ′)2 + (R − R′cosϕ′)2 +(R ′sinϕ′)2
" class="math-display"  /></center>
</div>Dropping <span 
class="cmmi-10">I </span>in the above expressions gives the corresponding Green’s function: <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium888x.png" alt="                    ∫ 2π               ′     ′     ′
GBR (R′,Z′,R, Z) = μ0-    (-----------R-(Z-−-Z-)sin-ϕ-----------)-dϕ ′ (671)
                  4π 0    ∘ (Z-−-Z′)2 +-(R-− R-′cosϕ′)2 +-(R′sinϕ′)2-3
" class="math-display"  /><a 
 id="x1-145015r671"></a></center>
</div><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium889x.png" alt="                    ∫
      ′  ′        μ0- 2π--------------R′2 −-RR-′cosϕ-′-----------   ′
GBZ (R ,Z,R, Z) = 4π 0  ( ∘ -----′-2--------′----′2----′----′2)3dϕ   (672)
                            (Z − Z ) + (R − R cosϕ) + (R sinϕ )
" class="math-display"  /><a 
 id="x1-145016r672"></a></center>
</div>
<!--l. 7798--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">B.4   </span> <a 
 id="x1-146000B.4"></a>For wires in poloial plane</h4>
<!--l. 7800--><p class="noindent" >For a curve in the poloidal plane, the line element <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l </span>in terms of the cylindrical basis is
written as <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l </span>= <span 
class="cmmi-10">dR</span><img 
src="tokamak_equilibrium890x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">R</span></sub>(<span 
class="cmmi-10">ϕ</span>) + <span 
class="cmmi-10">dZ</span><img 
src="tokamak_equilibrium891x.png" alt="ˆe"  class="circ"  /><sub><span 
class="cmmi-7">z</span></sub>. Using Cartesian coordinate basis vectors, <span 
class="cmmi-10">d</span><span 
class="cmbx-10">l </span>is written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-146001r673"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium892x.png" alt="dl = dR cosϕˆex +dR sin ϕˆey + dZ ˆez.
" class="math-display"  /></center></td><td class="equation-label">(673)</td></tr></table>
<!--l. 7807--><p class="nopar" >
Using Eq. (<a 
href="#x1-146001r673">673<!--tex4ht:ref: 16-12-16-e1 --></a>) and (), we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x1-146002r674"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium893x.png" alt="            |                     |
            ||   ˆex     ˆey     ˆez  ||
dl× (r − r′) = ||dR cosϕ dR sinϕ dZ   ||.
            |(x − x ′) (y − y′) (z − z′)|
" class="math-display"  /></center></td><td class="equation-label">(674)</td></tr></table>
<!--l. 7815--><p class="nopar" >
</p><!--l. 7817--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">C   </span> <a 
 id="x1-147000C"></a>About this document</h3>
<!--l. 7819--><p class="noindent" >This document initially contains notes I took when learning tokamak equilibrium theory. As a result of
the on-going learning, the document is evolving. I enjoy seeing the continuous improvement of this
document over a long time scale (10 years). Most of the content is elementary but I still
found I got something totally wrong in the ﬁrst version. Let me know if you spot something
specious.
</p><!--l. 7826--><p class="indent" >   This document was written by using TeXmacs<span class="cite">[<a 
href="#Xtexmacs">26</a>]</span>, a structured wysiwyw (what you see is what you
want) editor for scientists. The HTML version is generated by ﬁrst converting the TeXmacs ﬁle to TeX
format and then using <span 
class="cmtt-10">htlatex </span>to convert the TeX to HTML.
</p><!--l. 7831--><p class="noindent" >
</p>
   <h3 class="likesectionHead"><a 
 id="x1-148000C"></a>References</h3>
<!--l. 7831--><p class="noindent" >
   </p><div class="thebibliography">
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[1]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="XAymar2002"></a><span 
class="cmr-9">R     Aymar,     P     Barabaschi,     and     Y     Shimomura.             The     ITER     design.</span>
   <span 
class="cmti-9">Plasma Physics and Controlled Fusion</span><span 
class="cmr-9">, 44(5):519–565, apr 2002.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[2]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xbeer1995"></a><span 
class="cmr-9">M.</span><span 
class="cmr-9"> A.</span><span 
class="cmr-9"> Beer,  S.</span><span 
class="cmr-9"> C.</span><span 
class="cmr-9"> Cowley,  and  G.</span><span 
class="cmr-9"> W.</span><span 
class="cmr-9"> Hammett.    Field-aligned  coordinates  for  nonlinear</span>
   <span 
class="cmr-9">simulations of tokamak turbulence.</span> <span 
class="cmti-9">Phys. Plasmas (1994-present)</span><span 
class="cmr-9">, 2(7):2687–2700, 1995.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[3]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xberk1995"></a><span 
class="cmr-9">H.</span><span 
class="cmr-9"> L.</span><span 
class="cmr-9"> Berk,  J.</span><span 
class="cmr-9"> W.</span><span 
class="cmr-9"> Van  Dam,  D.</span><span 
class="cmr-9"> Borba,  J.</span><span 
class="cmr-9"> Candy,  G.</span><span 
class="cmr-9"> T.</span><span 
class="cmr-9"> A.</span><span 
class="cmr-9"> Huysmans,  and  S.</span><span 
class="cmr-9"> Sharapov.</span>
   <span 
class="cmr-9">More on core localized toroidal alfv</span><span 
class="cmr-9">én eigenmodes.</span> <span 
class="cmti-9">Phys. Plasmas</span><span 
class="cmr-9">, 2(9):3401–3406, 1995.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[4]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xboozer2005"></a><span 
class="cmr-9">Allen</span><span 
class="cmr-9"> H.</span><span 
class="cmr-9"> Boozer.  Physics of magnetically conﬁned plasmas.</span>  <span 
class="cmti-9">Rev. Mod. Phys.</span><span 
class="cmr-9">, 76:1071–1141,</span>
   <span 
class="cmr-9">Jan 2005.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[5]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xsborchia2008"></a><span 
class="cmr-9">R.</span><span 
class="cmr-9"> Gallix,</span><span 
class="cmr-9"> C.</span><span 
class="cmr-9"> Jong,</span><span 
class="cmr-9"> J.</span><span 
class="cmr-9"> Knaster,</span><span 
class="cmr-9"> N.</span><span 
class="cmr-9"> Mitchell C. Sborchia, Y. Fu.   Design and speciﬁcations</span>
   <span 
class="cmr-9">of the iter tf coils.</span>  <span 
class="cmti-9">IEEE TRANSACTIONS ON APPLIED SUPERCONDUCTIVITY,</span><span 
class="cmr-9">, 18(2):463,</span>
   <span 
class="cmr-9">2008.</span>
   </p>
                                                                                

                                                                                
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[6]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xychen2003"></a><span 
class="cmr-9">Yang  Chen  and  Scott</span><span 
class="cmr-9"> E.</span><span 
class="cmr-9"> Parker.    A  delta-f  particle  method  for  gyrokinetic  simulations</span>
   <span 
class="cmr-9">with  kinetic  electrons  and  electromagnetic  perturbations.</span>    <span 
class="cmti-9">Journal of Computational Physics</span><span 
class="cmr-9">,</span>
   <span 
class="cmr-9">189(2):463–475, 2003.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[7]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xychen2007"></a><span 
class="cmr-9">Yang  Chen  and  Scott</span><span 
class="cmr-9"> E.</span><span 
class="cmr-9"> Parker.   Electromagnetic  gyrokinetic  </span><span 
class="cmmi-9">δ</span><span 
class="cmr-9">f  particle-in-cell  turbulence</span>
   <span 
class="cmr-9">simulation  with  realistic  equilibrium  proﬁles  and  geometry.</span>   <span 
class="cmti-9">Journal of Computational Physics</span><span 
class="cmr-9">,</span>
   <span 
class="cmr-9">220(2):839–855, 2007.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[8]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xchen2010"></a><span 
class="cmr-9">Yang Chen, Scott</span><span 
class="cmr-9"> E.</span><span 
class="cmr-9"> Parker, J.</span><span 
class="cmr-9"> Lang, and G.-Y.</span><span 
class="cmr-9"> Fu.  Linear gyrokinetic simulation of high-n</span>
   <span 
class="cmr-9">toroidal alfv</span><span 
class="cmr-9">én eigenmodes in a burning plasma.</span> <span 
class="cmti-9">Phys. Plasmas</span><span 
class="cmr-9">, 17(10):102504, 2010.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[9]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xyychen2019"></a><span 
class="cmr-9">Fu</span><span 
class="cmr-9"> Peng,</span><span 
class="cmr-9"> Gao</span><span 
class="cmr-9"> Ge Chen Yuan-Yang, Bao Xiao-Hua. Plasma shape optimization for east tokamak</span>
   <span 
class="cmr-9">using orthogonal method.</span> <span 
class="cmti-9">Chinese Physics B</span><span 
class="cmr-9">, 28(1):15201, 2019.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[10]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xcheng1987"></a><span 
class="cmr-9">C.Z Cheng and M.S Chance.   Nova: a nonvariational code for solving the mhd stability of</span>
   <span 
class="cmr-9">axisymmetric toroidal plasmas.</span> <span 
class="cmti-9">J. of Comput. Phys.</span><span 
class="cmr-9">, 71(1):124–146, 1987.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[11]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xdelucia1980"></a><span 
class="cmr-9">J DeLucia, S.C Jardin, and A.M.M Todd.  An iterative metric method for solving the inverse</span>
   <span 
class="cmr-9">tokamak equilibrium problem.</span> <span 
class="cmti-9">Journal of Computational Physics</span><span 
class="cmr-9">, 37(2):183–204, 1980.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[12]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xdimits1993"></a><span 
class="cmr-9">A.</span><span 
class="cmr-9"> M.</span><span 
class="cmr-9"> Dimits.    Fluid  simulations  of  tokamak  turbulence  in  quasiballooning  coordinates.</span>
   <span 
class="cmti-9">Phys. Rev. E</span><span 
class="cmr-9">, 48:4070–4079, Nov 1993.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[13]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xgorler2016"></a><span 
class="cmr-9">T.</span><span 
class="cmr-9"> G</span><span 
class="cmr-9">örler, N.</span><span 
class="cmr-9"> Tronko, W.</span><span 
class="cmr-9"> A.</span><span 
class="cmr-9"> Hornsby, A.</span><span 
class="cmr-9"> Bottino, R.</span><span 
class="cmr-9"> Kleiber, C.</span><span 
class="cmr-9"> Norscini, V.</span><span 
class="cmr-9"> Grandgirard,</span>
   <span 
class="cmr-9">F.</span><span 
class="cmr-9"> Jenko, and E.</span><span 
class="cmr-9"> Sonnendr</span><span 
class="cmr-9">ücker. Intercode comparison of gyrokinetic global electromagnetic modes.</span>
   <span 
class="cmti-9">Physics of Plasmas</span><span 
class="cmr-9">, 23(7):72503, 2016.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[14]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="XTeXmacs:website"></a><span 
class="cmr-9">J.</span><span 
class="cmr-9"> van</span><span 
class="cmr-9"> der Hoeven et</span><span 
class="cmr-9"> al. GNU TeXmacs. </span><a 
href="https://www.texmacs.org" class="url" ><span 
class="cmtt-9">https://www.texmacs.org</span></a><span 
class="cmr-9">, 1998.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[15]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xhu2014"></a><span 
class="cmr-9">Youjun  Hu,  Guoqiang  Li,  N.</span><span 
class="cmr-9"> N.</span><span 
class="cmr-9"> Gorelenkov,  Huishan  Cai,  Wenjun  Yang,  Deng  Zhou,  and</span>
   <span 
class="cmr-9">Qilong Ren.  Numerical study of alfv</span><span 
class="cmr-9">én eigenmodes in the experimental advanced superconducting</span>
   <span 
class="cmr-9">tokamak.</span> <span 
class="cmti-9">Phys. Plasmas</span><span 
class="cmr-9">, 21(5):0, 2014.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[16]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xjardin2010"></a><span 
class="cmr-9">Stephen</span><span 
class="cmr-9"> C.</span><span 
class="cmr-9"> Jardin.</span> <span 
class="cmti-9">Computational methods in plasma physics</span><span 
class="cmr-9">. CRC Press, 2010.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[17]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xlao1985"></a><span 
class="cmr-9">L.L.</span><span 
class="cmr-9"> Lao, H.</span><span 
class="cmr-9"> St.</span><span 
class="cmr-9"> John, R.D.</span><span 
class="cmr-9"> Stambaugh, A.G.</span><span 
class="cmr-9"> Kellman, and W.</span><span 
class="cmr-9"> Pfeiﬀer.  Reconstruction of</span>
   <span 
class="cmr-9">current proﬁle parameters and plasma shapes in tokamaks.</span> <span 
class="cmti-9">Nucl. Fusion</span><span 
class="cmr-9">, 25(11):1611, 1985.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[18]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="XLee2001"></a><span 
class="cmr-9">G.S.</span><span 
class="cmr-9"> Lee, M.</span><span 
class="cmr-9"> Kwon, C.J.</span><span 
class="cmr-9"> Doh, B.G.</span><span 
class="cmr-9"> Hong, K.</span><span 
class="cmr-9"> Kim, M.H.</span><span 
class="cmr-9"> Cho, W.</span><span 
class="cmr-9"> Namkung, C.S.</span><span 
class="cmr-9"> Chang,</span>
   <span 
class="cmr-9">Y.C.</span><span 
class="cmr-9"> Kim,  J.Y.</span><span 
class="cmr-9"> Kim,  H.G.</span><span 
class="cmr-9"> Jhang,  D.K.</span><span 
class="cmr-9"> Lee,  K.I.</span><span 
class="cmr-9"> You,  J.H.</span><span 
class="cmr-9"> Han,  M.C.</span><span 
class="cmr-9"> Kyum,  J.W.</span><span 
class="cmr-9"> Choi,</span>
   <span 
class="cmr-9">J.</span><span 
class="cmr-9"> Hong,  W.C.</span><span 
class="cmr-9"> Kim,  B.C.</span><span 
class="cmr-9"> Kim,  J.H.</span><span 
class="cmr-9"> Choi,  S.H.</span><span 
class="cmr-9"> Seo,  H.K.</span><span 
class="cmr-9"> Na,  H.G.</span><span 
class="cmr-9"> Lee,  S.G.</span><span 
class="cmr-9"> Lee,  S.J.</span><span 
class="cmr-9"> Yoo,</span>
                                                                                

                                                                                
   <span 
class="cmr-9">B.J.</span><span 
class="cmr-9"> Lee,  Y.S.</span><span 
class="cmr-9"> Jung,  J.G.</span><span 
class="cmr-9"> Bak,  H.L.</span><span 
class="cmr-9"> Yang,  S.Y.</span><span 
class="cmr-9"> Cho,  K.H.</span><span 
class="cmr-9"> Im,  N.I.</span><span 
class="cmr-9"> Hur,  I.K.</span><span 
class="cmr-9"> Yoo,  J.W.</span><span 
class="cmr-9"> Sa,</span>
   <span 
class="cmr-9">K.H.</span><span 
class="cmr-9"> Hong, G.H.</span><span 
class="cmr-9"> Kim, B.J.</span><span 
class="cmr-9"> Yoo, H.C.</span><span 
class="cmr-9"> Ri, Y.K.</span><span 
class="cmr-9"> Oh, Y.S.</span><span 
class="cmr-9"> Kim, C.H.</span><span 
class="cmr-9"> Choi, D.L.</span><span 
class="cmr-9"> Kim, Y.M.</span><span 
class="cmr-9"> Park,</span>
   <span 
class="cmr-9">K.W.</span><span 
class="cmr-9"> Cho,  T.H.</span><span 
class="cmr-9"> Ha,  S.M.</span><span 
class="cmr-9"> Hwang,  Y.J.</span><span 
class="cmr-9"> Kim,  S.</span><span 
class="cmr-9"> Baang,  S.I.</span><span 
class="cmr-9"> Lee,  H.Y.</span><span 
class="cmr-9"> Chang,  W.</span><span 
class="cmr-9"> Choe,</span>
   <span 
class="cmr-9">S.G.</span><span 
class="cmr-9"> Jeong,   S.S.</span><span 
class="cmr-9"> Oh,   H.J.</span><span 
class="cmr-9"> Lee,   B.H.</span><span 
class="cmr-9"> Oh,   B.H.</span><span 
class="cmr-9"> Choi,   C.K.</span><span 
class="cmr-9"> Hwang,   S.R.</span><span 
class="cmr-9"> In,   S.H.</span><span 
class="cmr-9"> Jeong,</span>
   <span 
class="cmr-9">I.S.</span><span 
class="cmr-9"> Ko, Y.S.</span><span 
class="cmr-9"> Bae, H.S.</span><span 
class="cmr-9"> Kang, J.B.</span><span 
class="cmr-9"> Kim, H.J.</span><span 
class="cmr-9"> Ahn, D.S.</span><span 
class="cmr-9"> Kim, C.H.</span><span 
class="cmr-9"> Choi, J.H.</span><span 
class="cmr-9"> Lee, Y.W.</span><span 
class="cmr-9"> Lee,</span>
   <span 
class="cmr-9">Y.S.</span><span 
class="cmr-9"> Hwang, S.H.</span><span 
class="cmr-9"> Hong, K.-H.</span><span 
class="cmr-9"> Chung, D.-I.</span><span 
class="cmr-9"> Choi, and KSTAR Team. Design and construction of</span>
   <span 
class="cmr-9">the KSTAR tokamak.</span> <span 
class="cmti-9">Nuclear Fusion</span><span 
class="cmr-9">, 41(10):1515–1523, oct 2001.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[19]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xli2013"></a><span 
class="cmr-9">G</span><span 
class="cmr-9"> Q Li, Q</span><span 
class="cmr-9"> L Ren, J</span><span 
class="cmr-9"> P Qian, L</span><span 
class="cmr-9"> L Lao, S</span><span 
class="cmr-9"> Y Ding, Y</span><span 
class="cmr-9"> J Chen, Z</span><span 
class="cmr-9"> X Liu, B Lu, and Q Zang.</span>
   <span 
class="cmr-9">Kinetic equilibrium reconstruction on east tokamak.</span> <span 
class="cmti-9">Plasma Phys. Controlled Fusion</span><span 
class="cmr-9">, 55(12):125008,</span>
   <span 
class="cmr-9">2013.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[20]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="XLuxon2002"></a><span 
class="cmr-9">J.L.</span><span 
class="cmr-9"> Luxon. A design retrospective of the DIII-D tokamak.</span> <span 
class="cmti-9">Nuclear Fusion</span><span 
class="cmr-9">, 42(5):614–633, may</span>
   <span 
class="cmr-9">2002.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[21]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xmiller1998"></a><span 
class="cmr-9">R.</span><span 
class="cmr-9"> L.</span><span 
class="cmr-9"> Miller, M.</span><span 
class="cmr-9"> S.</span><span 
class="cmr-9"> Chu, J.</span><span 
class="cmr-9"> M.</span><span 
class="cmr-9"> Greene, Y.</span><span 
class="cmr-9"> R.</span><span 
class="cmr-9"> Lin-Liu, and R.</span><span 
class="cmr-9"> E.</span><span 
class="cmr-9"> Waltz. Noncircular, ﬁnite</span>
   <span 
class="cmr-9">aspect ratio, local equilibrium model.</span> <span 
class="cmti-9">Phys. Plasmas</span><span 
class="cmr-9">, 5(4):973–978, 1998.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[22]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xottaviani2011"></a><span 
class="cmr-9">M.</span><span 
class="cmr-9"> Ottaviani.   An  alternative  approach  to  ﬁeld-aligned  coordinates  for  plasma  turbulence</span>
   <span 
class="cmr-9">simulations.</span> <span 
class="cmti-9">Physics Letters A</span><span 
class="cmr-9">, 375(15):1677–1685, 2011.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[23]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xsabbagh2006"></a><span 
class="cmr-9">S.A.</span><span 
class="cmr-9"> Sabbagh, A.C.</span><span 
class="cmr-9"> Sontag, J.M.</span><span 
class="cmr-9"> Bialek, D.A.</span><span 
class="cmr-9"> Gates, A.H.</span><span 
class="cmr-9"> Glasser, J.E.</span><span 
class="cmr-9"> Menard, W.</span><span 
class="cmr-9"> Zhu,</span>
   <span 
class="cmr-9">M.G.</span><span 
class="cmr-9"> Bell, R.E.</span><span 
class="cmr-9"> Bell, A.</span><span 
class="cmr-9"> Bondeson, C.E.</span><span 
class="cmr-9"> Bush, J.D.</span><span 
class="cmr-9"> Callen, M.S.</span><span 
class="cmr-9"> Chu, C.C.</span><span 
class="cmr-9"> Hegna, S.M.</span><span 
class="cmr-9"> Kaye,</span>
   <span 
class="cmr-9">L.L.</span><span 
class="cmr-9"> Lao, B.P.</span><span 
class="cmr-9"> LeBlanc, Y.Q.</span><span 
class="cmr-9"> Liu, R.</span><span 
class="cmr-9"> Maingi, D.</span><span 
class="cmr-9"> Mueller, K.C.</span><span 
class="cmr-9"> Shaing, D.</span><span 
class="cmr-9"> Stutman, K.</span><span 
class="cmr-9"> Tritz,</span>
   <span 
class="cmr-9">and C.</span><span 
class="cmr-9"> Zhang. Resistive wall stabilized operation in rotating high beta nstx plasmas.</span> <span 
class="cmti-9">Nucl. Fusion</span><span 
class="cmr-9">,</span>
   <span 
class="cmr-9">46(5):635, 2006.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[24]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xsong2007"></a><span 
class="cmr-9">I.</span><span 
class="cmr-9"> Song, C.</span><span 
class="cmr-9"> Choi, and M.</span><span 
class="cmr-9"> Cho.  Quench protection system for the superconducting coil of the</span>
   <span 
class="cmr-9">kstar tokamak.</span> <span 
class="cmti-9">IEEE Transactions on Applied Superconductivity</span><span 
class="cmr-9">, 17(1):1–6, March 2007.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[25]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xysun2012"></a><span 
class="cmr-9">Youwen Sun. Tokamak geometry and equilibrium. </span><a 
href="http://theory.ipp.ac.cn/~yj/other/TOKAMAK_geometry_and_equilibrium_Youwen_Sun_201208.pdf" class="url" ><span 
class="cmtt-9">http://theory.ipp.ac.cn/</span><span 
class="cmtt-9">~</span><span 
class="cmtt-9">yj/other/TOKAMAK_geometry_and_equilibrium_Youwen_Sun_201208.pdf</span></a><span 
class="cmr-9">,</span>
   <span 
class="cmr-9">2012. [Online; Institute of Plasma Physics, Chinese Academy of Sciences].</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[26]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xtexmacs"></a><span 
class="cmr-9">Joris van der</span><span 
class="cmr-9"> Hoeven.  Gnu texmacs, a structured wysiwyw (what you see is what you want)</span>
   <span 
class="cmr-9">editor for scientists. </span><a 
href="http://www.texmacs.org/" class="url" ><span 
class="cmtt-9">http://www.texmacs.org/</span></a><span 
class="cmr-9">, 2007. [Online].</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[27]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xwxwang2006"></a><span 
class="cmr-9">W.</span><span 
class="cmr-9"> X.</span><span 
class="cmr-9"> Wang,    Z.</span><span 
class="cmr-9"> Lin,    W.</span><span 
class="cmr-9"> M.</span><span 
class="cmr-9"> Tang,    W.</span><span 
class="cmr-9"> W.</span><span 
class="cmr-9"> Lee,    S.</span><span 
class="cmr-9"> Ethier,    J.</span><span 
class="cmr-9"> L.</span><span 
class="cmr-9"> V.</span><span 
class="cmr-9"> Lewandowski,</span>
   <span 
class="cmr-9">G.</span><span 
class="cmr-9"> Rewoldt, T.</span><span 
class="cmr-9"> S.</span><span 
class="cmr-9"> Hahm, and J.</span><span 
class="cmr-9"> Manickam. Gyro-kinetic simulation of global turbulent transport</span>
   <span 
class="cmr-9">properties in tokamak experiments.</span> <span 
class="cmti-9">Physics of Plasmas</span><span 
class="cmr-9">, 13(9):92505, 2006.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[28]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xwesson2004"></a><span 
class="cmr-9">John Wesson.</span> <span 
class="cmti-9">Tokamaks</span><span 
class="cmr-9">. Oxford University Press, 2004.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[29]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xwhite1984"></a><span 
class="cmr-9">R.</span><span 
class="cmr-9"> B.</span><span 
class="cmr-9"> White and M.</span><span 
class="cmr-9"> S.</span><span 
class="cmr-9"> Chance. Hamiltonian guiding center drift orbit calculation for plasmas</span>
   <span 
class="cmr-9">of arbitrary cross section.</span> <span 
class="cmti-9">The Physics of Fluids</span><span 
class="cmr-9">, 27(10):2455–2467, 1984.</span>
                                                                                

                                                                                
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[30]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xxiao2008"></a><span 
class="cmr-9">B</span><span 
class="cmr-9"> J   Xiao,   D</span><span 
class="cmr-9"> A   Humphreys,   and   M</span><span 
class="cmr-9"> L   Walker.        East   plasma   control   system.</span>
   <span 
class="cmti-9">Fusion Engineering and Design</span><span 
class="cmr-9">, 83:181, 2008.</span>
   </p>
   <p class="bibitem" ><span class="biblabel">
<span 
class="cmr-9">[31]</span> <span class="bibsp"><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span><span 
class="cmr-9"> </span></span></span><a 
 id="Xxiao2007"></a><span 
class="cmr-9">B.</span><span 
class="cmr-9"> J.</span><span 
class="cmr-9"> Xiao. The ﬁrst diverted plasma on east tokamak.</span> <span 
class="cmti-9">34th EPS Conference on Plasma Phys</span><span 
class="cmr-9">,</span>
   <span 
class="cmr-9">2007.</span></p></div>
    
</body></html> 

                                                                                


