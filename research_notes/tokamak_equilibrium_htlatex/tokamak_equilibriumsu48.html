<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Visualization of grids in ï¬eld aligned coordinates</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,4,charset=utf-8,html --> 
<meta name="src" content="tokamak_equilibrium.tex" /> 
<link rel="stylesheet" type="text/css" href="tokamak_equilibrium.css" /> 
</head><body 
>
   <!--l. 3485--><div class="crosslinks"><p class="noindent">[<a 
href="tokamak_equilibriumsu49.html" >next</a>] [<a 
href="tokamak_equilibriumsu47.html" >prev</a>] [<a 
href="tokamak_equilibriumsu47.html#tailtokamak_equilibriumsu47.html" >prev-tail</a>] [<a 
href="#tailtokamak_equilibriumsu48.html">tail</a>] [<a 
href="tokamak_equilibriumse10.html#tokamak_equilibriumsu48.html" >up</a>] </p></div>
   <h4 class="subsectionHead"><span class="titlemark">10.3   </span> <a 
 id="x59-7500010.3"></a>Visualization of grids in ï¬eld aligned coordinates</h4>
<!--l. 3487--><p class="noindent" >I am developing a fully kinetic ions module in electromagnetic turbulence code GEM which uses
ï¬eld-line-following coordinates. Having an accurate understanding of the ï¬eld-line-following coordinates
is important for writing the code. In this section, I try to visualize some aspects of the coordinates
relevant to the numerical implementation. The directions of the covariant basis vectors of (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>)
coordinates are as follows:
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-75001r308"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium397x.png" alt="âˆ‚r
âˆ‚Î±|Ïˆ,ğœƒ âˆ’â†’ usualtoroidaldirection(Ë†Ï•),
" class="math-display"  /></center></td><td class="equation-label">(308)</td></tr></table>
<!--l. 3497--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-75002r309"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium398x.png" alt="âˆ‚r
âˆ‚ğœƒ|Ïˆ,Î± âˆ’â†’  ï¬eldline direction,Bâˆ•B,
" class="math-display"  /></center></td><td class="equation-label">(309)</td></tr></table>
<!--l. 3501--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-75003r310"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium399x.png" alt="âˆ‚r
--|ğœƒ,Î± âˆ’â†’ combination ofthe usualradialand toroidaldirection
âˆ‚Ïˆ
" class="math-display"  /></center></td><td class="equation-label">(310)</td></tr></table>
<!--l. 3506--><p class="nopar" >
Here <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> is a combination of the usual radial and toroidal direction, which needs some
clariï¬cation. Note that, for nonzero magnetic shear (i.e., <span 
class="cmmi-10">q</span><span 
class="cmsy-10">â€²</span>(<span 
class="cmmi-10">Ïˆ</span>)<span 
class="cmmi-10">â‰ </span>0) and <span 
class="cmmi-10">ğœƒ</span><span 
class="cmmi-10">â‰ </span>0, the usual toroidal angle <span 
class="cmmi-10">Ï• </span>is
changing when changing <span 
class="cmmi-10">Ïˆ </span>while holding <span 
class="cmmi-10">ğœƒ </span>and the generalized toroidal angle <span 
class="cmmi-10">Î± </span>ï¬xed. This is given by
Eq. (<a 
href="tokamak_equilibriumsu46.html#x57-73008r299">299<!--tex4ht:ref: 17-9-15-1 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-75004r311"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium400x.png" alt="       âˆ« ğœƒ
Ï• = Î± +   B-â‹…âˆ‡-Ï•dğœƒ â‰ˆ Î±+ q(Ïˆ)ğœƒ,
        0 B â‹…âˆ‡ ğœƒ
" class="math-display"  /></center></td><td class="equation-label">(311)</td></tr></table>
<!--l. 3517--><p class="nopar" >
where the second equality becomes exact if <span 
class="cmmi-10">ğœƒ </span>is the straight-ï¬eld-line poloidal angle deï¬ned in Sec.
<a 
href="tokamak_equilibriumsu30.html#x36-490005.3.5">5.3.5<!--tex4ht:ref: 17-10-30-1 --></a>. Figure <a 
href="#x59-7500514">14<!--tex4ht:ref: 17-9-16-1 --></a>b shows how the usual toroidal angle <span 
class="cmmi-10">Ï• </span>changes when we change <span 
class="cmmi-10">Ïˆ </span>while holding <span 
class="cmmi-10">ğœƒ </span>and
<span 
class="cmmi-10">Î± </span>ï¬xed.
</p><!--l. 3523--><p class="indent" >   Â 
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-7500514"></a>
                                                                                

                                                                                
<!--l. 3526--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2b2/p.png" alt="pict"  
 width="113.42375pt" />                   <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2f/p.png" alt="pict"  
 width="256.96pt" />
</p><!--l. 3528--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2r1/p.png" alt="pict"  
 width="256.96pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2/p.png" alt="pict"  
 width="256.96pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 14: </span><span  
class="content">(a): A <span 
class="cmmi-10">ğœƒ </span>contour on <span 
class="cmmi-10">Ï• </span>= 0 plane. Here <span 
class="cmmi-10">ğœƒ </span>= 9 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€âˆ•</span>63. Â This is the direction of
<span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Ï•</span></sub>. (b): <span 
class="cmmi-10">Ïˆ </span>coordinate lines in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>) coordinates ( <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> is tangent to these lines)
on the isosurface of <span 
class="cmmi-10">ğœƒ </span>= 9 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€âˆ•</span>63. Here diï¬€erent lines correspond to diï¬€erent values of <span 
class="cmmi-10">Î±</span>. (c): <span 
class="cmmi-10">Î±</span>
coordinate lines (<span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Î±</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">Ïˆ,ğœƒ</span></sub> is tangent to these lines), which are along the usual toroidal direction
<img 
src="tokamak_equilibrium401x.png" alt="Ë†
Ï•"  class="circ"  />. (d): Grids on the isosurface of <span 
class="cmmi-10">ğœƒ </span>= 9 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€âˆ•</span>63, where the red lines are <span 
class="cmmi-10">Î± </span>coordinate lines while
the blue lines are <span 
class="cmmi-10">Ïˆ </span>coordinate lines. Magnetic ï¬eld from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x59-7500514 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3544--><p class="indent" >   The relation <span 
class="cmmi-10">Ï• </span><span 
class="cmsy-10">â‰ˆ </span><span 
class="cmmi-10">Î± </span>+ <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ïˆ</span>)<span 
class="cmmi-10">ğœƒ </span>given by Eq. (<a 
href="#x59-75004r311">311<!--tex4ht:ref: 17-10-30-2 --></a>) indicates that the toroidal shift along <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">Î±,ğœƒ</span></sub>
for a radial change form <span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmr-7">1</span></sub> to <span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmr-7">2</span></sub> is given by (<span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmr-7">2</span></sub>) <span 
class="cmsy-10">âˆ’ </span><span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmr-7">2</span></sub>))<span 
class="cmmi-10">ğœƒ</span>, which is large for large
magnetic shear or on <span 
class="cmmi-10">ğœƒ </span>isosurface with larger value of <span 
class="cmmi-10">ğœƒ</span>. An example for this is shown in Fig.
<a 
href="#x59-7500615">15<!--tex4ht:ref: 17-10-30-5 --></a> for <span 
class="cmmi-10">ğœƒ </span>= 19 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€âˆ•</span>63, where <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">Î±,ğœƒ</span></sub> has larger toroidal shift than that in Fig. <a 
href="#x59-7500514">14<!--tex4ht:ref: 17-9-16-1 --></a> for
<span 
class="cmmi-10">ğœƒ </span>= 9 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€âˆ•</span>63.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-7500615"></a>
                                                                                

                                                                                
<!--l. 3555--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2b3/p.png" alt="pict"  
 width="113.42375pt" />                   <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2d/p.png" alt="pict"  
 width="250.9375pt" />
</p><!--l. 3557--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2e/p.png" alt="pict"  
 width="250.9375pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2c/p.png" alt="pict"  
 width="250.9375pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 15: </span><span  
class="content">(a) <span 
class="cmmi-10">ğœƒ </span>= 19<span 
class="cmsy-10">Ã—</span>2<span 
class="cmmi-10">Ï€âˆ•</span>63 contour on <span 
class="cmmi-10">Ï• </span>= 0 plane, <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ </span>lines (upper left) and <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Î± </span>lines
(upper right) on isosurface of <span 
class="cmmi-10">ğœƒ </span>= 19 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€âˆ•</span>63. <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Î± </span>lines are identical with <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ï• </span>lines. Lower
left: Grids on the isosurface of <span 
class="cmmi-10">ğœƒ </span>= 19 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€âˆ•</span>63, which are the combinations of <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ </span>lines and
<span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Î± </span>lines.</span></div><!--tex4ht:label?: x59-7500615 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3568--><p class="indent" >   Â 
</p><!--l. 3570--><p class="indent" >   The <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> lines can be understood from another perspective. Examine a family of magnetic
ï¬eld lines that start from the low-ï¬eld-side midplane (<span 
class="cmmi-10">ğœƒ </span>= 0) with the same toroidal angle <span 
class="cmmi-10">Ï• </span>= <span 
class="cmmi-10">Ï•</span><sub><span 
class="cmr-7">1</span></sub> but
diï¬€erent radial coordinates. These starting points all have the same value of <span 
class="cmmi-10">Î±</span>, which is equal to <span 
class="cmmi-10">Ï•</span>.
When following these ï¬eld lines to another isosurfce of <span 
class="cmmi-10">ğœƒ</span>, the intersecting points of these ï¬eld lines with
the <span 
class="cmmi-10">ğœƒ </span>isosurface will trace out one <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> line. Examine another family of magnetic ï¬eld lines similar
to the above but with the starting toroidal angle <span 
class="cmmi-10">Ï• </span>= <span 
class="cmmi-10">Ï•</span><sub><span 
class="cmr-7">2</span></sub>. They will trace out another <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> line
on the <span 
class="cmmi-10">ğœƒ </span>isosurface. Continue the process, we ï¬nally get those lines in Fig. <a 
href="#x59-7500514">14<!--tex4ht:ref: 17-9-16-1 --></a>b and Fig.
<a 
href="#x59-7500615">15<!--tex4ht:ref: 17-10-30-5 --></a>b.
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">10.3.1   </span> <a 
 id="x59-7600010.3.1"></a>Radial wavenumber in ï¬eld-aligned coordinates (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>)</h5>
<!--l. 3587--><p class="noindent" >For a harmonic in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) coordinates given by <span 
class="cmmi-10">A</span>(<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) = exp(<span 
class="cmmi-10">ik</span><sub><span 
class="cmmi-7">Ïˆ</span></sub><span 
class="cmmi-10">Ïˆ </span>+ <span 
class="cmmi-10">imğœƒ </span>+ <span 
class="cmmi-10">inÏ•</span>), the radial wave
number is <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">Ïˆ</span></sub>. Let us calculate the corresponding radial wavenumber <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">Ïˆ</span></sub><sup><span 
class="cmmi-7">â‹†</span></sup> in the new coordinates
(<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>), which is deï¬ned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-76001r312"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium402x.png" alt=" â‹†   âˆ‚phase||
kÏˆ =   âˆ‚Ïˆ  ||   ,
            ğœƒ,Î±
" class="math-display"  /></center></td><td class="equation-label">(312)</td></tr></table>
<!--l. 3595--><p class="nopar" >
where the phase is given by phase = <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">Ïˆ</span></sub><span 
class="cmmi-10">Ïˆ </span>+ <span 
class="cmmi-10">mğœƒ </span>+ <span 
class="cmmi-10">nÏ•</span>. Then the above expression is written as
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium403x.png" alt="                        |
 â‹†      âˆ‚(kÏˆÏˆ-+-mğœƒ-+-nÏ•)||
kÏˆ  =          âˆ‚Ïˆ       |ğœƒ,Î±
              âˆ‚Ï• ||
    =   kÏˆ + n---||                               (313)
              âˆ‚Ïˆ ğœƒ,Î±
                                                                                

                                                                                
" class="math-display"  /></center>
</div>Using Â Using <span 
class="cmmi-10">Ï• </span><span 
class="cmsy-10">â‰ˆ </span><span 
class="cmmi-10">Î± </span>+ <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ïˆ</span>)<span 
class="cmmi-10">ğœƒ</span>, the above expression is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium404x.png" alt="kâ‹†Ïˆ  =  kÏˆ + nqâ€²ğœƒ,                           (314)
" class="math-display"  /></center>
</div>where <span 
class="cmmi-10">q</span><span 
class="cmsy-10">â€² </span>= <span 
class="cmmi-10">dqâˆ•dÏˆ</span>. This result indicates that, compared with the radial wavenumber in coordinate
system (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>), the radial wavenumber in the new coordinate system (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>) has an increment <span 
class="cmmi-10">nğœƒq</span><span 
class="cmsy-10">â€²</span>.
For nonzero magnetic shear (<span 
class="cmmi-10">q</span><span 
class="cmsy-10">â€²</span><span 
class="cmmi-10">â‰ </span>0) and nonzero poloidal location (<span 
class="cmmi-10">ğœƒ</span><span 
class="cmmi-10">â‰ </span>0), the increment <span 
class="cmmi-10">nğœƒq</span><span 
class="cmsy-10">â€² </span>can be large
for modes with toroidal mode number <span 
class="cmmi-10">n </span><span 
class="cmsy-10">â‰« </span>1. Then we need to use more radial grid number (compared
what is needed in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) coordinates) to resolve the radial variation. This is one of disadvantage of
using ï¬eld-aligned coordinates. If the saving associated with using less parallel grid number out-weights
the cost associated with using more radial grid number, we obtain a net saving in using the ï¬eld-aligned
coordinates.
<!--l. 3621--><p class="indent" >   Let us examine how many <span 
class="cmmi-10">Ïˆ </span>grid points are needed to resolve the <span 
class="cmmi-10">Ïˆ </span>dependence in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>)
coordinates on the high-ï¬eld side (<span 
class="cmmi-10">ğœƒ </span>= <span 
class="cmmi-10">Ï€</span>). Assume <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">Ïˆ</span></sub> <span 
class="cmsy-10">â‰ˆ </span>0, then <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">Ïˆ</span></sub><sup><span 
class="cmmi-7">â‹†</span></sup> at <span 
class="cmmi-10">ğœƒ </span>= <span 
class="cmmi-10">Ï€ </span>is given by <span 
class="cmmi-10">k</span><sub><span 
class="cmmi-7">Ïˆ</span></sub><sup><span 
class="cmmi-7">â‹†</span></sup> = <span 
class="cmmi-10">nÏ€q</span><span 
class="cmsy-10">â€²</span>.
The corresponding wave-length is given by <span 
class="cmmi-10">Î»</span><sub><span 
class="cmmi-7">Ïˆ</span></sub><sup><span 
class="cmmi-7">â‹†</span></sup> = 2<span 
class="cmmi-10">Ï€âˆ•k</span><sub><span 
class="cmmi-7">Ïˆ</span></sub><sup><span 
class="cmmi-7">â‹†</span></sup>. The grid spacing Î”<span 
class="cmmi-10">Ïˆ </span>should be less
than half of this wave-length (sampling theorem). Then the grid number should satisfy
that
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-76004r315"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium405x.png" alt=" â‹†   L-Ïˆ   -LÏˆ--    â€²
NÏˆ = Î” Ïˆ â‰¥ Î»â‹†Ïˆâˆ•2 = nq LÏˆ,
" class="math-display"  /></center></td><td class="equation-label">(315)</td></tr></table>
<!--l. 3631--><p class="nopar" >
where <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">Ïˆ</span></sub> is the radial width of the computational domain.
</p><!--l. 3634--><p class="indent" >   The number of Fourier harmonics that need to be included is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-76005r316"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium406x.png" alt="        kâ‹†       â€²
Nk â‹†Ïˆ = --Ïˆ---= nq-LÏˆ.
       2Ï€âˆ•LÏˆ     2
" class="math-display"  /></center></td><td class="equation-label">(316)</td></tr></table>
<!--l. 3638--><p class="nopar" >
For DIII-D cyclone base case, choose the radial coordinate <span 
class="cmmi-10">Ïˆ </span>as <span 
class="cmmi-10">r</span>. At the radial location
<span 
class="cmmi-10">Ïˆ </span>= <span 
class="cmmi-10">r</span><sub><span 
class="cmr-7">0</span></sub> = 0<span 
class="cmmi-10">.</span>24<span 
class="cmmi-10">m</span>, <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">.</span>4, <span 
class="cmmi-10">Å</span><sub><span 
class="cmr-7">0</span></sub> = 0<span 
class="cmmi-10">.</span>78, then <span 
class="cmmi-10">q</span><span 
class="cmsy-10">â€²</span><sub><span 
class="cmr-7">0</span></sub> = <span 
class="cmmi-10">s</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">âˆ•r</span><sub><span 
class="cmr-7">0</span></sub> = 4<span 
class="cmmi-10">.</span>5<span 
class="cmmi-10">m</span><sup><span 
class="cmsy-7">âˆ’</span><span 
class="cmr-7">1</span></sup>. Then <span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">r</span></sub><sup><span 
class="cmmi-7">â‹†</span></sup> = <span 
class="cmmi-10">n</span><span 
class="cmsy-10">Ã— </span>0<span 
class="cmmi-10">.</span>45 for the radial
width <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">r</span></sub> = 0<span 
class="cmmi-10">.</span>10<span 
class="cmmi-10">m</span>.
</p><!--l. 3644--><p class="indent" >   Â 
</p><!--l. 3646--><p class="indent" >   Figure <a 
href="#x59-7600616">16<!--tex4ht:ref: 17-11-10-1 --></a> plots <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> lines on the <span 
class="cmmi-10">ğœƒ </span>= 0<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">Ï€ </span>isosurfaces, which are chosen to be on the
low-ï¬eld-side midplane. On <span 
class="cmmi-10">ğœƒ </span>= 0 surface, <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> lines are identical to <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Ï•</span></sub> lines. On <span 
class="cmmi-10">ğœƒ </span>= 2<span 
class="cmmi-10">Ï€</span>
surface, each <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> line has large <span 
class="cmmi-10">Ï• </span>shift. In old version of my code, <span 
class="cmmi-10">ğœƒ </span>= 0<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">Ï€ </span>surfaces
are chosen as the <span 
class="cmmi-10">ğœƒ </span>cuts (in the new version <span 
class="cmmi-10">ğœƒ </span>= [<span 
class="cmsy-10">âˆ’</span><span 
class="cmmi-10">Ï€,Ï€</span>]). A connection condition for the
perturbations is needed between these two surfaces. This connection condition is discussed in Sec.
<a 
href="#x59-7700010.3.2">10.3.2<!--tex4ht:ref: 17-11-10-3 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-7600616"></a>
                                                                                

                                                                                
<!--l. 3659--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2jr1/p.png" alt="pict"  
 width="113.42375pt" />             <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2fr1/p.png" alt="pict"  
 width="240.9pt" />                                   <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2fr2/p.png" alt="pict"  
 width="241.90375pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 16: </span><span  
class="content">(a) <span 
class="cmmi-10">ğœƒ </span>=  0 contour (blue line) in <span 
class="cmmi-10">Ï• </span>=  0 plane; (b) a series of <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> curves
(with <span 
class="cmmi-10">Î±</span><sub><span 
class="cmmi-7">j</span></sub> = <span 
class="cmmi-10">j</span>2<span 
class="cmmi-10">Ï€âˆ•</span>20, <span 
class="cmmi-10">j </span>= 0<span 
class="cmmi-10">,</span>1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span><span 
class="cmmi-10">â€¦</span><span 
class="cmmi-10">,</span>20) on <span 
class="cmmi-10">ğœƒ </span>= 0 isosurface, (c) a single <span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚Ïˆ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">ğœƒ,Î±</span></sub> curve (with
<span 
class="cmmi-10">Î± </span>= 0) on <span 
class="cmmi-10">ğœƒ </span>= 2<span 
class="cmmi-10">Ï€ </span>isosurface. This curve ï¬nish about 4 torodial loops because (<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">max</span></sub> <span 
class="cmsy-10">âˆ’</span><span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">min</span></sub>)2<span 
class="cmmi-10">Ï€ </span>=
(5<span 
class="cmmi-10">.</span>56 <span 
class="cmsy-10">âˆ’ </span>1<span 
class="cmmi-10">.</span>79) <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€ </span><span 
class="cmsy-10">â‰ˆ </span>4 <span 
class="cmsy-10">Ã— </span>2<span 
class="cmmi-10">Ï€</span>. The radial range is <span 
class="cmmi-10">Ïˆ </span>= 0<span 
class="cmmi-10">.</span>2 <span 
class="cmsy-10">â†’ </span>0<span 
class="cmmi-10">.</span>9, where <span 
class="cmmi-10">Ïˆ </span>is the normalized
poloidal magnetic ï¬‚ux. Magnetic ï¬eld from EAST discharge #59954@3.03s (gï¬le g059954.003030
provided by Hao BaoLong).</span></div><!--tex4ht:label?: x59-7600616 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><span class="titlemark">10.3.2   </span> <a 
 id="x59-7700010.3.2"></a>Periodic conditions of physical quantity along <span 
class="cmmi-10">ğœƒ </span>and <span 
class="cmmi-10">Î± </span>in ï¬eld-line-following coordinates
(<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>)</h5>
<!--l. 3676--><p class="noindent" >Since (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) and (<span 
class="cmmi-10">Ïˆ,ğœƒ </span>+ 2<span 
class="cmmi-10">Ï€,Ï•</span>) correspond to the same spatial point, a real space continuous quantity
<span 
class="cmmi-10">f </span>expressed in terms of coordinates (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>), i.e., <span 
class="cmmi-10">f </span>= <span 
class="cmmi-10">f</span>(<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>), must satisfy the following periodic
conditions along <span 
class="cmmi-10">ğœƒ</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-77001r317"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium407x.png" alt="f(Ïˆ,ğœƒ +2Ï€,Ï• ) = f(Ïˆ,ğœƒ,Ï•).
" class="math-display"  /></center></td><td class="equation-label">(317)</td></tr></table>
<!--l. 3682--><p class="nopar" >
Since (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) and (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï• </span>+ 2<span 
class="cmmi-10">Ï€</span>) correspond to the same spatial point, <span 
class="cmmi-10">f </span>must satisfy the following
periodic conditions along <span 
class="cmmi-10">Ï•</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-77002r318"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium408x.png" alt="f(Ïˆ,ğœƒ,Ï• +2Ï€ ) = f(Ïˆ,ğœƒ,Ï•).
" class="math-display"  /></center></td><td class="equation-label">(318)</td></tr></table>
<!--l. 3688--><p class="nopar" >
Since (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>) and (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î± </span>+ 2<span 
class="cmmi-10">Ï€</span>) correspond to the same spatial point, a real space continuous quantity
<span 
class="cmmi-10">g </span>expressed in terms of ï¬eld-line-following coordinates (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>), i.e., <span 
class="cmmi-10">g </span>= <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>), must satisfy the
following periodic condition along <span 
class="cmmi-10">Î±</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-77003r319"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium409x.png" alt="g(Ïˆ,ğœƒ,Î± +2Ï€ ) = g(Ïˆ,ğœƒ,Î±).
" class="math-display"  /></center></td><td class="equation-label">(319)</td></tr></table>
<!--l. 3696--><p class="nopar" >
However, <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">1</span></sub> = (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>) and <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub> = (<span 
class="cmmi-10">Ïˆ,ğœƒ </span>+ 2<span 
class="cmmi-10">Ï€,Î±</span>) are not usually corresponding to the same
spatial point. In fact, equation (<a 
href="tokamak_equilibriumsu46.html#x57-73008r299">299<!--tex4ht:ref: 17-9-15-1 --></a>) implies, for point <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">1</span></sub>, its toroidal angle <span 
class="cmmi-10">Ï•</span><sub><span 
class="cmr-7">1</span></sub> is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-77004r320"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium410x.png" alt="        âˆ« ğœƒB â‹…âˆ‡ Ï•
Ï•1 = Î± +   B-â‹…âˆ‡-ğœƒdğœƒ,
         0
" class="math-display"  /></center></td><td class="equation-label">(320)</td></tr></table>
<!--l. 3704--><p class="nopar" >
while for point <span 
class="cmmi-10">P</span><sub><span 
class="cmr-7">2</span></sub>, its toroidal angle <span 
class="cmmi-10">Ï•</span><sub><span 
class="cmr-7">2</span></sub> is given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-77005r321"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium411x.png" alt="        âˆ« ğœƒ+2Ï€ B â‹…âˆ‡Ï•
Ï•2 = Î± +       ------dğœƒ = Ï•1 + 2Ï€q,
          0    B â‹…âˆ‡ğœƒ
" class="math-display"  /></center></td><td class="equation-label">(321)</td></tr></table>
<!--l. 3709--><p class="nopar" >
i.e., <span 
class="cmmi-10">Ï•</span><sub><span 
class="cmr-7">1</span></sub> and <span 
class="cmmi-10">Ï•</span><sub><span 
class="cmr-7">2</span></sub> are diï¬€erent by 2<span 
class="cmmi-10">Ï€q</span>. From this, we know that (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>) and (<span 
class="cmmi-10">Ïˆ,ğœƒ </span>+ 2<span 
class="cmmi-10">Ï€,Î± </span><span 
class="cmsy-10">âˆ’ </span>2<span 
class="cmmi-10">Ï€q</span>)
correspond to the same spatial point. Therefore we have the following periodic condition:
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-77006r322"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium412x.png" alt="g(Ïˆ,ğœƒ,Î±) = g(Ïˆ, ğœƒ+ 2Ï€,Î±âˆ’ 2Ï€q),
" class="math-display"  /></center></td><td class="equation-label">(322)</td></tr></table>
<!--l. 3717--><p class="nopar" >
or equivalently
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-77007r323"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium413x.png" alt="g(Ïˆ,ğœƒ + 2Ï€,Î±) = g(Ïˆ,ğœƒ,Î±+ 2Ï€q).
" class="math-display"  /></center></td><td class="equation-label">(323)</td></tr></table>
<!--l. 3721--><p class="nopar" >
</p><!--l. 3724--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">10.3.3   </span> <a 
 id="x59-7800010.3.3"></a>Numerical implementation of periodic condition (322)</h5>
<!--l. 3726--><p class="noindent" >For the fully kinetic ion module of GEM code that I am developing, <span 
class="cmmi-10">ğœƒ </span>is chosen in the range [0 : 2<span 
class="cmmi-10">Ï€</span>].
The condition (<a 
href="#x59-77006r322">322<!--tex4ht:ref: 17-11-2-p1 --></a>) imposes the following boundary condition:
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-78001r324"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium414x.png" alt="g(Ïˆ,2Ï€,Î±) = g(Ïˆ,0,Î± + 2Ï€q).
" class="math-display"  /></center></td><td class="equation-label">(324)</td></tr></table>
                                                                                

                                                                                
<!--l. 3731--><p class="nopar" >
If <span 
class="cmmi-10">Î± </span>is on a grid, <span 
class="cmmi-10">Î± </span>+ 2<span 
class="cmmi-10">Ï€q </span>is usually not on a grid. Therefore, to get the value of <span 
class="cmmi-10">g</span>(<span 
class="cmmi-10">Ïˆ,</span>0<span 
class="cmmi-10">,Î± </span>+ 2<span 
class="cmmi-10">Ï€q</span>), an
interpolation of the discrete date over the generalized toroidal angle <span 
class="cmmi-10">Î± </span>(or equivalently <span 
class="cmmi-10">Ï•</span>) is needed, as
is shown in Fig. <a 
href="#x59-7800217">17<!--tex4ht:ref: 17-11-2-1 --></a>.
</p><!--l. 3738--><p class="indent" >   Â 
</p><!--l. 3740--><p class="indent" >   Â 
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-7800217"></a>
                                                                                

                                                                                
<!--l. 3743--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig2fr3/p.png" alt="pict"  
 width="250.9375pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 17: </span><span  
class="content">Twenty magnetic ï¬eld lines (on <span 
class="cmmi-10">Ïˆ </span>=  0<span 
class="cmmi-10">.</span>2 magnetic surface) starting at diï¬€erent
toroidal angle (blue points) on the midplane (<span 
class="cmmi-10">ğœƒ </span>= 0) go a full poloidal loop (i.e., Î”<span 
class="cmmi-10">ğœƒ </span>= 2<span 
class="cmmi-10">Ï€</span>),
arriving at a toroidal angle (red points) which are diï¬€erent from their respective starting toroidal
angle. The ï¬eld values on the red points can be obtained by interpolating the ï¬eld values on
the blue points. The safety factor of the magnetic surface <span 
class="cmmi-10">q </span>= 1<span 
class="cmmi-10">.</span>79. Magnetic ï¬eld from EAST
discharge #59954@3.03s.</span></div><!--tex4ht:label?: x59-7800217 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3754--><p class="indent" >   Â 
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">10.3.4   </span> <a 
 id="x59-7900010.3.4"></a><span 
class="cmmi-10">Î± </span>contours on a magnetic surface</h5>
<!--l. 3758--><p class="noindent" >Figure <a 
href="#x59-7900118">18<!--tex4ht:ref: 17-10-29-1 --></a> compares a small number of <span 
class="cmmi-10">Ï• </span>contours and <span 
class="cmmi-10">Î± </span>contours on a magnetic surface.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-7900118"></a>
                                                                                

                                                                                
<!--l. 3762--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3e/p.png" alt="pict"  
 width="242.9075pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3d/p.png" alt="pict"  
 width="242.9075pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 18: </span><span  
class="content">Comparison between a series of <span 
class="cmmi-10">Ï• </span>contours (left) and a series of <span 
class="cmmi-10">Î± </span>contours (right) on
a magnetic surface. Here the values of <span 
class="cmmi-10">Ï• </span>are <span 
class="cmmi-10">Ï•</span><sub><span 
class="cmmi-7">j</span></sub> = <span 
class="cmmi-10">Î±</span><sub><span 
class="cmmi-7">j</span></sub> = (<span 
class="cmmi-10">j </span><span 
class="cmsy-10">âˆ’ </span>1)2<span 
class="cmmi-10">Ï€âˆ•</span>4<span 
class="cmmi-10">âˆ•</span>(10 <span 
class="cmsy-10">âˆ’ </span>1) with <span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span><span 
class="cmmi-10">â€¦</span><span 
class="cmmi-10">,</span>10,
i.e., only 1<span 
class="cmmi-10">âˆ•</span>4 of the full torus. The values of <span 
class="cmmi-10">Î± </span>contours are <span 
class="cmmi-10">Î±</span><sub><span 
class="cmmi-7">j</span></sub> = (<span 
class="cmmi-10">j </span><span 
class="cmsy-10">âˆ’ </span>1)2<span 
class="cmmi-10">Ï€âˆ•</span>4<span 
class="cmmi-10">âˆ•</span>(10 <span 
class="cmsy-10">âˆ’ </span>1) with
<span 
class="cmmi-10">j  </span>=  1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span><span 
class="cmmi-10">â€¦</span><span 
class="cmmi-10">,</span>10,  i.e.,  only  1<span 
class="cmmi-10">âˆ•</span>4  of  the  full  range  2<span 
class="cmmi-10">Ï€</span>.  Every  <span 
class="cmmi-10">Ï• </span>and  <span 
class="cmmi-10">Î± </span>contours  start  from  the
lower-ï¬eld-side midplane and go one full poloidal loop. Â Magnetic ï¬eld from EAST discharge
#59954@3.03s.</span></div><!--tex4ht:label?: x59-7900118 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3774--><p class="indent" >   Â 
</p><!--l. 3776--><p class="indent" >   As is shown in the left panel of Fig. <a 
href="#x59-7900118">18<!--tex4ht:ref: 17-10-29-1 --></a>, with <span 
class="cmmi-10">Ï• </span>ï¬xed, an <span 
class="cmmi-10">ğœƒ </span>curve reaches its starting
point when <span 
class="cmmi-10">ğœƒ </span>changes from zero to 2<span 
class="cmmi-10">Ï€</span>. However, as shown in the right panel of Fig. <a 
href="#x59-7900118">18<!--tex4ht:ref: 17-10-29-1 --></a>,
with <span 
class="cmmi-10">Î± </span>ï¬xed, an <span 
class="cmmi-10">ğœƒ </span>curve (i.e. a magnetic ï¬eld line) does not necessarily reach its starting
point when <span 
class="cmmi-10">ğœƒ </span>changes from zero to 2<span 
class="cmmi-10">Ï€</span>. There is a toroidal shift, 2<span 
class="cmmi-10">Ï€q</span>, between the starting
point and ending point. Therefore there is generally no periodic condition along <span 
class="cmmi-10">ğœƒ </span>since
<span 
class="cmmi-10">q </span>is not always an integer. A mixed periodic condition involves both <span 
class="cmmi-10">ğœƒ </span>and <span 
class="cmmi-10">Î± </span>is given in
(<a 
href="#x59-77006r322">322<!--tex4ht:ref: 17-11-2-p1 --></a>).
</p><!--l. 3786--><p class="indent" >   In ï¬eld-line-following coordinates (<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>), a toroidal harmonic of a physical perturbation can be
written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-79002r325"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium415x.png" alt="Î´A (Ïˆ,ğœƒ,Î±) = Î´A0(Ïˆ)cos(mâ€²ğœƒ+ nÎ± + Î±0)
" class="math-display"  /></center></td><td class="equation-label">(325)</td></tr></table>
<!--l. 3791--><p class="nopar" >
where <span 
class="cmmi-10">n </span>is the toroidal mode number, <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€²</span>, which is not necessary an integer, is introduced to
describe the variation along a ï¬eld line. The periodic condition given by Eq. (<a 
href="#x59-77006r322">322<!--tex4ht:ref: 17-11-2-p1 --></a>) requires
that
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-79003r326"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium416x.png" alt="cos(m â€²ğœƒ+ n Î±+ Î±0) = cos[mâ€²(ğœƒ + 2Ï€)+ n(Î±âˆ’ 2Ï€q) +Î±0 ],
" class="math-display"  /></center></td><td class="equation-label">(326)</td></tr></table>
<!--l. 3798--><p class="nopar" >
To satisfy the above condition, we can choose
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-79004r327"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="tokamak_equilibrium417x.png" alt=" â€²
m 2Ï€âˆ’ n2Ï€q = N 2Ï€,
" class="math-display"  /></center></td><td class="equation-label">(327)</td></tr></table>
<!--l. 3802--><p class="nopar" >
where <span 
class="cmmi-10">N </span>is an arbitrary integer, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-79005r328"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium418x.png" alt="m â€² = N + nq.
" class="math-display"  /></center></td><td class="equation-label">(328)</td></tr></table>
<!--l. 3806--><p class="nopar" >
We are interested in perturbation with a slow variation along the ï¬eld line direction (i.e., along
<span 
class="cmmi-10">âˆ‚</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">âˆ•âˆ‚ğœƒ</span><span 
class="cmsy-10">|</span><sub><span 
class="cmmi-7">Ïˆ,Î±</span></sub>) and thus we want the value of <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€² </span>to be small. One of the possible small values
given by expression (<a 
href="#x59-79005r328">328<!--tex4ht:ref: 17-12-16-5 --></a>) is to choose <span 
class="cmmi-10">N </span>= <span 
class="cmmi-10">n </span><span 
class="cmsy-10">Ã—</span> NINT((<span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">max</span></sub> + <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">min</span></sub>)<span 
class="cmmi-10">âˆ•</span>2), so that <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€² </span>is given
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-79006r329"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium419x.png" alt="                  (          )
m â€² = nqâˆ’ n Ã—NINT  qmax-+qmin  ,
                        2
" class="math-display"  /></center></td><td class="equation-label">(329)</td></tr></table>
<!--l. 3815--><p class="nopar" >
where NINT is a function that return the nearest integer of its argument, <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">max</span></sub> and <span 
class="cmmi-10">q</span><sub><span 
class="cmr-7">min</span></sub> is the maximal
and minimal value of the safety factor in the radial region in which we are interested. [In the past, I
choose <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€²</span>(<span 
class="cmmi-10">Ïˆ</span>) = <span 
class="cmmi-10">nq </span><span 
class="cmsy-10">âˆ’</span> NINT(<span 
class="cmmi-10">nq</span>). However, <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€²</span>(<span 
class="cmmi-10">Ïˆ</span>) in this case is not a continuous function of <span 
class="cmmi-10">Ïˆ </span>and thus
is not physical.] This form is used to set the initial density perturbation in the fully kinetic code I am
                                                                                

                                                                                
developing. Note that <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€² </span>in Eq. (<a 
href="#x59-79006r329">329<!--tex4ht:ref: 18-5-4-p1 --></a>) depends on the radial coordinate <span 
class="cmmi-10">Ïˆ </span>through <span 
class="cmmi-10">q</span>(<span 
class="cmmi-10">Ïˆ</span>). Also note that
<span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€² </span>here is diï¬€erent from the poloidal mode number <span 
class="cmmi-10">m </span>in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) coordinate system. It is ready to show
that the perturbation given by Eq. (<a 
href="#x59-79002r325">325<!--tex4ht:ref: 17-10-30-e1 --></a>) with <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€²âˆ¼ </span>1 and <span 
class="cmmi-10">n </span><span 
class="cmsy-10">â‰« </span>1 has large poloidal mode
number <span 
class="cmmi-10">m </span>when expressed in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) coordinates. [Proof: Expression (<a 
href="#x59-79002r325">325<!--tex4ht:ref: 17-10-30-e1 --></a>) can be written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x59-79007r330"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium420x.png" alt="Î´A = Î´A0 (Ïˆ )cos[mâ€²ğœƒ+ n(Ï• âˆ’ Î´(Ïˆ,ğœƒ))+ Î±0]
" class="math-display"  /></center></td><td class="equation-label">(330)</td></tr></table>
<!--l. 3832--><p class="nopar" >
If <span 
class="cmmi-10">ğœƒ </span>is the straight-ï¬eld-line poloidal angle in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) coordinate system, then <span class="overline"><span 
class="cmmi-10">Î´</span></span>(<span 
class="cmmi-10">Ïˆ,ğœƒ</span>) = <span 
class="cmmi-10">qğœƒ </span>and the
above equation is written as
</p>
   <table 
class="equation-star"><tr><td>
                       <span 
class="cmmi-10">Î´A </span>= <span 
class="cmmi-10">Î´A</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmmi-10">Ïˆ</span>)cos[(<span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€²âˆ’ </span><span 
class="cmmi-10">nq</span>)<span 
class="cmmi-10">ğœƒ </span>+ <span 
class="cmmi-10">nÏ• </span>+ <span 
class="cmmi-10">Î±</span><sub><span 
class="cmr-7">0</span></sub>]<span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 3837--><p class="nopar" >
which indicates the poloidal mode number <span 
class="cmmi-10">m </span>in (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) coordinates is given by <span 
class="cmmi-10">m </span>= <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€²âˆ’</span><span 
class="cmmi-10">nq</span>. For the
case with <span 
class="cmmi-10">m</span><span 
class="cmsy-10">â€²âˆ¼ </span>1 and <span 
class="cmmi-10">n </span><span 
class="cmsy-10">â‰« </span>1, <span 
class="cmmi-10">m </span>is much larger than one.]
</p><!--l. 3842--><p class="indent" >   Â 
</p><!--l. 3844--><p class="indent" >   [Since <span 
class="cmmi-10">Î± </span>contours are magnetic ï¬eld lines, they span out the 3D shape of the magnetic surface when
there are enough number of <span 
class="cmmi-10">Î± </span>contours on a magnetic surface, as is shown by the right-panel of Fig.
<a 
href="#x59-7900819">19<!--tex4ht:ref: 17-10-29-e1 --></a>.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-7900819"></a>
                                                                                

                                                                                
<!--l. 3849--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3c/p.png" alt="pict"  
 width="242.9075pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3b/p.png" alt="pict"  
 width="242.9075pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 19: </span><span  
class="content">Comparison between a series of <span 
class="cmmi-10">Ï• </span>contours(left) and a series of <span 
class="cmmi-10">Î± </span>contours (left)
on a magnetic surface. The <span 
class="cmmi-10">Î± </span>contours correspond to magnetic ï¬eld lines. Here the <span 
class="cmmi-10">Î± </span>values
of adjacent <span 
class="cmmi-10">Î± </span>contours diï¬€er by <span 
class="cmmi-10">dÎ± </span>= 2<span 
class="cmmi-10">Ï€âˆ•</span>20 and each <span 
class="cmmi-10">Î± </span>contour goes one full poloidal loop.
Magnetic ï¬eld from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x59-7900819 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3858--><p class="indent" >   Â 
</p><!--l. 3860--><p class="indent" >   Â 
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">10.3.5   </span> <a 
 id="x59-8000010.3.5"></a><span 
class="cmmi-10">Î± </span>contours in a toroidal annulus</h5>
<!--l. 3864--><p class="noindent" >Figure <a 
href="#x59-8000120">20<!--tex4ht:ref: 17-9-18-1 --></a> compares the <span 
class="cmmi-10">Ï• </span>coordinate surface of (<span 
class="cmmi-10">Ïˆ,ğœƒ,Ï•</span>) coordinates with the <span 
class="cmmi-10">Î± </span>coordinate surface of
(<span 
class="cmmi-10">Ïˆ,ğœƒ,Î±</span>) coordinates.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-8000120"></a>
                                                                                

                                                                                
<!--l. 3869--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3g/p.png" alt="pict"  
 width="242.90749pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3f/p.png" alt="pict"  
 width="238.89249pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 20: </span><span  
class="content">Comparison between isosurface of <span 
class="cmmi-10">Ï• </span>= 2<span 
class="cmmi-10">Ï€âˆ•</span>8 (projection of magnetic ï¬eld lines onto
<span 
class="cmmi-10">Ï• </span>= 2<span 
class="cmmi-10">Ï€âˆ•</span>8 plane) and isosurface of <span 
class="cmmi-10">Î± </span>= 2<span 
class="cmmi-10">Ï€âˆ•</span>8. The <span 
class="cmmi-10">Î± </span>isosurface is made of a family of contours of
<span 
class="cmmi-10">Î± </span>= 2<span 
class="cmmi-10">Ï€âˆ•</span>8, which are all magnetic ï¬eld lines. These ï¬eld lines are traced by starting from a series
of points on the low-ï¬eld-side midplane (<span 
class="cmmi-10">ğœƒ </span>= 0) at diï¬€erent radial locations and the ï¬eld lines
are followed by a complete poloidal loop. The radial range is given by <span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmmi-7">N</span></sub> <span 
class="cmsy-10">âˆˆ </span>[0<span 
class="cmmi-10">.</span>4 : 0<span 
class="cmmi-10">.</span>5], where <span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmmi-7">N</span></sub>
is the normalized poloidal magnetic ï¬‚ux. Magnetic ï¬eld from EAST discharge #59954@3.03s.</span></div><!--tex4ht:label?: x59-8000120 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3881--><p class="indent" >   Â 
</p><!--l. 3883--><p class="indent" >   Â 
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-8000221"></a>
                                                                                

                                                                                
<!--l. 3886--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3i/p.png" alt="pict"  
 width="242.90749pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig3h/p.png" alt="pict"  
 width="263.98625pt" />
<br /> </p><div class="caption" 
><span class="id">FigureÂ 21: </span><span  
class="content">The same plot as in Fig. <a 
href="#x59-8000120">20<!--tex4ht:ref: 17-9-18-1 --></a> but with a larger radial range. <span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmmi-7">N</span></sub> <span 
class="cmsy-10">âˆˆ </span>[0<span 
class="cmmi-10">.</span>4 : 0<span 
class="cmmi-10">.</span>7], where
<span 
class="cmmi-10">Ïˆ</span><sub><span 
class="cmmi-7">N</span></sub> is the normalized poloidal magnetic ï¬‚ux.</span></div><!--tex4ht:label?: x59-8000221 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x59-8000322"></a>
                                                                                

                                                                                
<!--l. 3893--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15c/p.png" alt="pict"  
 width="268.00125pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15d/p.png" alt="pict"  
 width="268.00125pt" />
</p><!--l. 3895--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15e/p.png" alt="pict"  
 width="266.9975pt" />                                         <img 
src="my_figure/home/yj/project_new/fig_lorentz/fig15f/p.png" alt="pict"  
 width="266.9975pt" />
</p><!--l. 3897--><p class="noindent" >Â 
<br /> </p><div class="caption" 
><span class="id">FigureÂ 22: </span><span  
class="content">The value of <span 
class="cmmi-10">ğœƒ </span>and <span class="overline"><span 
class="cmmi-10">Î´</span></span> on an annulus in the poloidal plane (<span 
class="cmmi-10">R,Z</span>). Upper panel:
using magnetic coordinates, Lower panel: comparison with the results computed in cylindricall
coordinates. Â <span class="overline"><span 
class="cmmi-10">Î´</span></span> = <span 
class="cmex-10">âˆ«</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">ğœƒ</span></sup><img 
src="tokamak_equilibrium421x.png" alt="Ë†q"  class="circ"  /> <span 
class="cmmi-10">dğœƒ</span>. Both <span 
class="cmmi-10">ğœƒ </span>and <span class="overline"><span 
class="cmmi-10">Î´</span></span> are discontinuous at the <span 
class="cmmi-10">ğœƒ </span>cut, which is chosen on the
high-ï¬eld-side in this case.</span></div><!--tex4ht:label?: x59-8000322 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3906--><p class="indent" >   Â 
</p><!--l. 3908--><p class="indent" >   Â 
                                                                                

                                                                                
</p>
   <!--l. 3910--><div class="crosslinks"><p class="noindent">[<a 
href="tokamak_equilibriumsu49.html" >next</a>] [<a 
href="tokamak_equilibriumsu47.html" >prev</a>] [<a 
href="tokamak_equilibriumsu47.html#tailtokamak_equilibriumsu47.html" >prev-tail</a>] [<a 
href="tokamak_equilibriumsu48.html" >front</a>] [<a 
href="tokamak_equilibriumse10.html#tokamak_equilibriumsu48.html" >up</a>] </p></div>
<!--l. 3910--><p class="indent" >   <a 
 id="tailtokamak_equilibriumsu48.html"></a>  </p> 
</body></html> 
