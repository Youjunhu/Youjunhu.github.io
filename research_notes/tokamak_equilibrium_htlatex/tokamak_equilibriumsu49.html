<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Deﬁnition of the ﬁeld-line-following coordinates (ψ,𝜃,α)</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,4,charset=utf-8,html --> 
<meta name="src" content="tokamak_equilibrium.tex" /> 
<link rel="stylesheet" type="text/css" href="tokamak_equilibrium.css" /> 
</head><body 
>
   <!--l. 3411--><div class="crosslinks"><p class="noindent">[<a 
href="tokamak_equilibriumsu50.html" >next</a>] [<a 
href="#tailtokamak_equilibriumsu49.html">tail</a>] [<a 
href="tokamak_equilibriumse11.html#tokamak_equilibriumsu49.html" >up</a>] </p></div>
   <h4 class="subsectionHead"><span class="titlemark">11.1   </span> <a 
 id="x61-7600011.1"></a>Deﬁnition of the ﬁeld-line-following coordinates (<span 
class="cmmi-10">ψ,𝜃,α</span>)</h4>
<!--l. 3413--><p class="noindent" >In (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates, a magnetic ﬁeld line is straight in (<span 
class="cmmi-10">𝜃,ζ</span>) plane with slope being <span 
class="cmmi-10">q</span>. Then the
equation for a magnetic ﬁeld line is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76001r291"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium380x.png" alt="ζ = q𝜃 + α,
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(291)</td></tr></table>
<!--l. 3418--><p class="nopar" >
where <span 
class="cmmi-10">α </span>is a constant in (<span 
class="cmmi-10">𝜃,ζ</span>) plane and can be used to label magnetic ﬁeld lines on a magnetic surface.
This motivates us to use <span 
class="cmmi-10">α</span>, i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76002r292"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium381x.png" alt="α ≡ ζ − q𝜃,
" class="math-display"  /></center></td><td class="equation-label">(292)</td></tr></table>
<!--l. 3424--><p class="nopar" >
to replace <span 
class="cmmi-10">ζ</span>. Then the magnetic ﬁeld in Eq. (<a 
href="tokamak_equilibriumsu40.html#x51-66003r261">261<!--tex4ht:ref: 3-13-p3 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76003r293"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium382x.png" alt="B = Ψ ′∇ ψ × ∇α,
" class="math-display"  /></center></td><td class="equation-label">(293)</td></tr></table>
<!--l. 3429--><p class="nopar" >
which is called the Clebsch form. The direction
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76004r294"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium383x.png" alt="∂r
--|ψ,α = 𝒥∇ α× ∇ ψ,
∂𝜃
" class="math-display"  /></center></td><td class="equation-label">(294)</td></tr></table>
                                                                                

                                                                                
<!--l. 3434--><p class="nopar" >
is parallel (or anti-parallel) to the magnetic ﬁeld direction. Due to this fact, (<span 
class="cmmi-10">ψ,𝜃,α</span>) coordinates are
usually called “ﬁeld-line-following coordinates” or “ﬁeld-aligned coordinates” <span class="cite">[<a 
href="tokamak_equilibriumli1.html#Xbeer1995">2</a>, <a 
href="tokamak_equilibriumli1.html#Xychen2003">6</a>]</span>.
</p><!--l. 3440--><p class="indent" >   Equation (<a 
href="#x61-76003r293">293<!--tex4ht:ref: 10-9-p1 --></a>) implies that
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76005r295"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium384x.png" alt="B ⋅∇α = 0,
" class="math-display"  /></center></td><td class="equation-label">(295)</td></tr></table>
<!--l. 3443--><p class="nopar" >
and
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76006r296"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium385x.png" alt="B ⋅∇ψ = 0,
" class="math-display"  /></center></td><td class="equation-label">(296)</td></tr></table>
<!--l. 3447--><p class="nopar" >
i.e., both <span 
class="cmmi-10">α </span>and <span 
class="cmmi-10">ψ </span>are constant along a magnetic ﬁeld line. Taking scalar product of Eq. (<a 
href="#x61-76003r293">293<!--tex4ht:ref: 10-9-p1 --></a>) with <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">𝜃</span>,
we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76007r297"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium386x.png" alt="            ′
B ⋅∇ 𝜃 = − Ψ-,
          𝒥
                                                                                

                                                                                
" class="math-display"  /></center></td><td class="equation-label">(297)</td></tr></table>
<!--l. 3452--><p class="nopar" >
which is nonzero, i.e., only <span 
class="cmmi-10">𝜃 </span>among (<span 
class="cmmi-10">ψ,𝜃,α</span>) is changing along a magnetic ﬁeld line. (Here
<span 
class="cmsy-10">𝒥 </span>= (<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ </span><span 
class="cmsy-10">×∇</span><span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α</span>)<sup><span 
class="cmsy-7">−</span><span 
class="cmr-7">1</span></sup> is the Jacobian of the coordinate system (<span 
class="cmmi-10">ψ,𝜃,α</span>), which happens to be equal to
the Jacobian of (<span 
class="cmmi-10">ψ,𝜃,ζ</span>) coordinates.)
</p><!--l. 3459--><p class="indent" >   Using Eq. (<a 
href="#x61-76003r293">293<!--tex4ht:ref: 10-9-p1 --></a>), the magnetic diﬀerential operator <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇ </span>in the new coordinate system (<span 
class="cmmi-10">ψ,𝜃,α</span>) is
written
</p>
   <table 
class="equation"><tr><td><a 
 id="x61-76008r298"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium387x.png" alt="         Ψ ′∂
B ⋅∇f  = −-𝒥 ∂𝜃f,
" class="math-display"  /></center></td><td class="equation-label">(298)</td></tr></table>
<!--l. 3464--><p class="nopar" >
which is just a partial derivative over <span 
class="cmmi-10">𝜃</span>, as is expected, since only <span 
class="cmmi-10">𝜃 </span>is changing along a magnetic ﬁeld
line.
</p><!--l. 3468--><p class="indent" >   By the way, note that (<span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">α</span>)<span 
class="cmmi-10">∕</span>(<span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃</span>) = 0, i.e., the magnetic ﬁeld lines are straight with zero
slope on (<span 
class="cmmi-10">𝜃,α</span>) plane.
</p><!--l. 3472--><p class="indent" >   Using Eqs. (<a 
href="#x61-76002r292">292<!--tex4ht:ref: 17-3-18-1 --></a>) and (<a 
href="tokamak_equilibriumsu39.html#x50-65007r255">255<!--tex4ht:ref: 17-4-11-1 --></a>), <span 
class="cmmi-10">α </span>can be written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="tokamak_equilibrium388x.png" alt="       ∫ 𝜃
α = ϕ −   ˆqd𝜃,                            (299)
        0
" class="math-display"  /><a 
 id="x61-76009r299"></a></center>
</div>where <img 
src="tokamak_equilibrium389x.png" alt="ˆq"  class="circ"  /> = <span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">ϕ∕</span><span 
class="cmbx-10">B </span><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">𝜃 </span>is the local safety factor. (If we choose the straight-ﬁeld-line <span 
class="cmmi-10">𝜃</span>, then <span 
class="cmmi-10">α </span>is
written as <span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">−</span><span 
class="cmmi-10">q𝜃</span>.) Deﬁne <span class="overline"><span 
class="cmmi-10">δ</span></span> = <span 
class="cmex-10">∫</span>
 <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmmi-7">𝜃</span></sup><img 
src="tokamak_equilibrium390x.png" alt="ˆq"  class="circ"  /> <span 
class="cmmi-10">d𝜃</span>, which is called <span 
class="cmtt-10">tor</span><span 
class="cmtt-10">_shift</span> in <span 
class="cmtt-10">TEK</span> code, then <span 
class="cmmi-10">α </span>= <span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">−</span><span class="overline"><span 
class="cmmi-10">δ</span></span>. In
<span 
class="cmtt-10">TEK</span>, I choose <span 
class="cmmi-10">𝜃 </span><span 
class="cmsy-10">∈ </span>[<span 
class="cmsy-10">−</span><span 
class="cmmi-10">π,π</span>) with <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>corresponding to the high-ﬁeld-side midplane, and <span 
class="cmmi-10">𝜃 </span>is increasing
along the counter-clockwise direction viewed along <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ϕ</span>.  The <span 
class="cmmi-10">𝜃 </span>cut (<span 
class="cmmi-10">i.e.,𝜃 </span>= <span 
class="cmsy-10">±</span><span 
class="cmmi-10">π</span>) is far away from the
low-ﬁeld-side where ballooning modes often have larger amplitude. The (<span 
class="cmmi-10">x,y</span>) grid near the <span 
class="cmmi-10">𝜃 </span>cut is
highly twisted in real space and interplation is needed in mapping physical quantity from the
grid at <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>plane to that at <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π</span>. Numerical errors more likely appear there. So
we prefer that the <span 
class="cmmi-10">𝜃 </span>cut is located in less important area (area where mode amplitude is
small).
                                                                                

                                                                                
<!--l. 3492--><p class="indent" >   It is widely believed that turbulence responsible for energy transport in tokamak plasmas usually
has <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">≪ </span><span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">⊥</span></sub>, where <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub> and <span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">⊥</span></sub> are the parallel and perpendicular wavenumbers, respectively. Due to
this elongated structure along the parallel direction, less grids can be used in the parallel direction than
that in the perpendicular direction in turbulence simulation. In this case, the ﬁeld-aligned coordinates
(<span 
class="cmmi-10">ψ,𝜃,α</span>) provide suitable coordinates to be used, where less gridpoints can be used for <span 
class="cmmi-10">𝜃 </span>coordinate in
simulations and even some <span 
class="cmmi-10">∂∕∂𝜃 </span>derivatives can be neglected (high-n approximation), which simpliﬁes
the equations that need to be solved. However, there is a more important reason why almost all
gyrokinetic codes use ﬁeld-aligned coordinates: the  stability of numerical algorthims is improved
when we use coarse grids in the parallel direction because the parallel Courant condition
(for explicit schemes) <span 
class="cmmi-10">Δt </span><span 
class="msam-10">≤ </span><span 
class="cmmi-10">ΔL</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">∕v</span><sub><span 
class="cmsy-7">∥</span></sub> can be more easily satisﬁed (especially for the cases
with kinetic electrons), where <span 
class="cmmi-10">ΔL</span><sub><span 
class="cmsy-7">∥</span></sub> is the parallel grid spacing, which is larger when coarse
grids are used in the parallel direction. This is also mentioned in Ref. <span class="cite">[<a 
href="tokamak_equilibriumli1.html#Xottaviani2011">21</a>]</span> and it seems
to be right from my experiences of testing several algorithm but a strict test is needed
to verify this. This can also be understood in the following way: the coarse parallel grid
automatically ﬁlters out physically irrelevant but numerically problematic high-<span 
class="cmmi-10">k</span><sub><span 
class="cmsy-7">∥</span></sub> modes,
permitting much longer time steps for explicit time stepping, in both particle and ﬂuid
codes<span class="cite">[<a 
href="tokamak_equilibriumli1.html#Xdimits1993">12</a>]</span>.
                                                                                

                                                                                
</p>
   <!--l. 3517--><div class="crosslinks"><p class="noindent">[<a 
href="tokamak_equilibriumsu50.html" >next</a>] [<a 
href="tokamak_equilibriumsu49.html" >front</a>] [<a 
href="tokamak_equilibriumse11.html#tokamak_equilibriumsu49.html" >up</a>] </p></div>
<!--l. 3517--><p class="indent" >   <a 
 id="tailtokamak_equilibriumsu49.html"></a> </p> 
</body></html> 
