<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Finding magnetic surfaces</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,4,charset=utf-8,html --> 
<meta name="src" content="tokamak_equilibrium.tex" /> 
<link rel="stylesheet" type="text/css" href="tokamak_equilibrium.css" /> 
</head><body 
>
   <!--l. 2281--><div class="crosslinks"><p class="noindent">[<a 
href="tokamak_equilibriumsu36.html" >next</a>] [<a 
href="#tailtokamak_equilibriumsu35.html">tail</a>] [<a 
href="tokamak_equilibriumse7.html#tokamak_equilibriumsu35.html" >up</a>] </p></div>
   <h4 class="subsectionHead"><span class="titlemark">7.1   </span> <a 
 id="x43-580007.1"></a>Finding magnetic surfaces</h4>
<!--l. 2283--><p class="noindent" >Two-dimensional data <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>) on a rectangular grids (<span 
class="cmmi-10">R,Z</span>) is read from the G_EQDSK ﬁle (G-ﬁle) of
EFIT code. Based on the 2D array data, I use 2D cubic spline interpolation to construct a interpolating
function <span 
class="cmmi-10">Ψ </span>= <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>). To construct a magnetic surface coordinate system, I need to ﬁnd the contours
of <span 
class="cmmi-10">Ψ</span>, i.e., magnetic surfaces. The values of <span 
class="cmmi-10">Ψ </span>on the magnetic axis, <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub>, and the value of <span 
class="cmmi-10">Ψ </span>on the last
closed ﬂux surface (LCFS), <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>, are given in G-ﬁle. Using these two values, I construct a
1D array “psival” with value of elements changing uniform from <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> to <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>. Then I try to
ﬁnd the contours of <span 
class="cmmi-10">Ψ </span>with contour level value ranging from <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmr-7">0</span></sub> to <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">b</span></sub>. This is done in the
following way: construct a series of straight line (in the poloidal plane) that starts from the
location of the magnetic axis and ends at one of the points on the LCFS. Combine the
straight line equation, <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>), with the interpolating function <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>), we obtain a
one variable function <span 
class="cmmi-10">h </span>= <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>(<span 
class="cmmi-10">R</span>)). Then ﬁnding the location where <span 
class="cmmi-10">Ψ </span>is equal to a
speciﬁed value <span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">i</span></sub>, is reduced to ﬁnding the root of the equation <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>(<span 
class="cmmi-10">R</span>)) <span 
class="cmsy-10">− </span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">i</span></sub> = 0.
Since this is a one variable equation, the root can be easily found by using simple root
ﬁnding scheme, such as bisection method (bisection method is used in GTAW code). After
ﬁnding the roots for each value in the array “psival” on each straight lines, the process of
ﬁnding the contours of <span 
class="cmmi-10">Ψ </span>is ﬁnished. The contours of <span 
class="cmmi-10">Ψ </span>found this way are plotted in Fig.
<a 
href="#x43-580017">7<!--tex4ht:ref: 4-3-p2 --></a>.
</p><!--l. 2306--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x43-580017"></a>
                                                                                

                                                                                
<!--l. 2309--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig1/contour.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 7: </span><span  
class="content">Veriﬁcation of the numerical code that calculates the contours of the poloidal ﬂux <span 
class="cmmi-10">Ψ</span>. The
bold line in the ﬁgure indicates the LCFS. The contour lines (solid lines) given by the gnuplot
program agrees well with the results I calculate by using interpolation and root-ﬁnding method
(the two sets of contours are indistinguishable in this scale). My code only calculate the contour
lines within the LCFS, while those given by gnuplot contains additional contour lines below the
X point and on the left top in the ﬁgure. Eqdisk ﬁle of the equilibrium was provided by Dr.
Guoqiang Li (ﬁlename: g013606.07104).</span></div><!--tex4ht:label?: x43-580017 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2321--><p class="indent" >    
</p><!--l. 2323--><p class="indent" >   In the above, we mentioned that the point of magnetic axis and points on the LCFS are needed to
construct the straight lines. In G-ﬁle, points on LCFS are given explicitly in an array. The location of
magnetic axis is also explicitly given in G-ﬁle. It is obvious that some of the straight lines <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>)
that pass through the location of magnetic axis and points on the LCFS will have very large or even
inﬁnite slope. On these lines, ﬁnding the accurate root of the equation <span 
class="cmmi-10">Ψ</span>(<span 
class="cmmi-10">R,Z</span>(<span 
class="cmmi-10">R</span>)) <span 
class="cmsy-10">−</span><span 
class="cmmi-10">Ψ</span><sub><span 
class="cmmi-7">i</span></sub> = 0 is diﬃcult
or even impossible. The way to avoid this situation is obvious: switch to use function <span 
class="cmmi-10">R </span>= <span 
class="cmmi-10">R</span>(<span 
class="cmmi-10">Z</span>)
instead of <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>) when the slope of <span 
class="cmmi-10">Z </span>= <span 
class="cmmi-10">Z</span>(<span 
class="cmmi-10">R</span>) is large (the switch condition I used is
<span 
class="cmsy-10">|</span><span 
class="cmmi-10">dZ∕dR</span><span 
class="cmsy-10">| </span><span 
class="cmmi-10">&#x003E; </span>1).
</p><!--l. 2334--><p class="indent" >   In constructing the ﬂux surface coordinate with desired Jacobian, we will need the absolute value of
the gradient of <span 
class="cmmi-10">Ψ</span>, <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span>, on some speciﬁed spatial points. To achieve this, we need to construct a
interpolating function for <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span>. The <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x43-58002r199"></a>
   <center class="math-display" >
<img 
src="tokamak_equilibrium272x.png" alt="       ∘ ----------------
         (∂ Ψ)2   (∂ Ψ)2
|∇Ψ | =   ---   +  ---  ,
          ∂R       ∂Z
" class="math-display"  /></center></td><td class="equation-label">(199)</td></tr></table>
<!--l. 2342--><p class="nopar" >
By using the center diﬀerence scheme to evaluate the partial derivatives with respect to <span 
class="cmmi-10">R </span>and <span 
class="cmmi-10">Z </span>in the
above equation (using one side diﬀerence scheme for the points on the rectangular boundary), we can
obtain an 2D array for the value of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on the rectangular (<span 
class="cmmi-10">R,Z</span>) grids. Using this 2D array,
we can construct an interpolating function for <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">Ψ </span>by using the cubic spline interpolation
scheme.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x43-580038"></a>
                                                                                

                                                                                
<!--l. 2351--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig2/plt.png" alt="pict"  
 width="180.67499pt" /> <img 
src="my_figure/home/yj/project_new/read_gfile/fig40/plt.png" alt="pict"  
 width="180.67499pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 8: </span><span  
class="content">Grid points (the intersecting points of two curves in the ﬁgure) corresponding to uniform
poloidal ﬂux and uniform poloidal arc length for EAST equilibrium shot 13606 at 7.1s (left)
(G-ﬁle name: g013606.07104) and shot 38300 at 3.9s (right) (G-ﬁle name: g038300.03900).</span></div><!--tex4ht:label?: x43-580038 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x43-580049"></a>
                                                                                

                                                                                
<!--l. 2359--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/p2.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 9: </span><span  
class="content"><span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>as a function of the poloidal angle. The diﬀerent lines corresponds to the values
of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on diﬀerent magnetic surfaces. The stars correspond to the values on the boundary
magnetic surface while the plus signs correspond to the value on the innermost magnetic surface
(the magnetic surface adjacent to the magnetic axis). The equilibrium is for EAST shot 38300
at 3.9s.</span></div><!--tex4ht:label?: x43-580049 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x43-5800510"></a>
                                                                                

                                                                                
<!--l. 2369--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/p3.png" alt="pict"  
 width="251.94124pt" />                             <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/p4.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 10: </span><span  
class="content">The Poloidal magnetic ﬁeld <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">p</span></sub> = <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">|</span><span 
class="cmmi-10">∕R </span>(left) and toroidal magnetic ﬁeld <span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">ϕ</span></sub> = <span 
class="cmmi-10">g∕R</span>
(right) as a function of the poloidal angle. The diﬀerent lines corresponds to the values on diﬀerent
magnetic surfaces. The stars correspond to the values on the boundary magnetic surface while
the plus signs correspond to the value on the innermost magnetic surface (the magnetic surface
adjacent to the magnetic axis). The equilibrium is for EAST shot 38300 at 3.9s.</span></div><!--tex4ht:label?: x43-5800510 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2379--><p class="indent" >    
</p><!--l. 2381--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x43-5800611"></a>
                                                                                

                                                                                
<!--l. 2384--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig41/tmp.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 11: </span><span  
class="content">Equal-arc Jacobian as a function of the poloidal angle on diﬀerent magnetic surfaces.
The dotted line corresponds to the values of Jacobian on the boundary magnetic surface. The
equilibrium is for EAST shot 38300 at 3.9s.</span></div><!--tex4ht:label?: x43-5800611 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x43-5800712"></a>
                                                                                

                                                                                
<!--l. 2392--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig32/tmp.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 12: </span><span  
class="content"><span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>as a function of the poloidal angle. The diﬀerent lines corresponds to values of
<span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on diﬀerent magnetic surfaces. The stars correspond to the values of <span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">Ψ</span><span 
class="cmsy-10">| </span>on the boundary
magnetic surface while the plus signs correspond to the value on the innermost magnetic surface
(the magnetic surface adjacent to the magnetic axis). The equilibrium is a Solovev equilibrium.</span></div><!--tex4ht:label?: x43-5800712 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2401--><p class="indent" >    
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x43-5800813"></a>
                                                                                

                                                                                
<!--l. 2404--><p class="noindent" > <img 
src="my_figure/home/yj/project_new/read_gfile/fig29/tmp.png" alt="pict"  
 width="251.94124pt" />
<br /> </p><div class="caption" 
><span class="id">Fig. 13:  </span><span  
class="content">Jacobian  on  diﬀerent  magnetic  surfaces  as  a  function  of  the  poloidal  angle.  The
equilibrium  is  a  Solovev  equilibrium  and  the  Jacobian  is  an  equal-arc  Jacobian.  The  stars
correspond to the values of Jacobian on the boundary magnetic surface while the plus signs
correspond to the value on the innermost magnetic surface (the magnetic surface adjacent to the
magnetic axis).</span></div><!--tex4ht:label?: x43-5800813 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 2413--><p class="indent" >    
                                                                                

                                                                                
</p>
   <!--l. 2415--><div class="crosslinks"><p class="noindent">[<a 
href="tokamak_equilibriumsu36.html" >next</a>] [<a 
href="tokamak_equilibriumsu35.html" >front</a>] [<a 
href="tokamak_equilibriumse7.html#tokamak_equilibriumsu35.html" >up</a>] </p></div>
<!--l. 2415--><p class="indent" >   <a 
 id="tailtokamak_equilibriumsu35.html"></a> </p> 
</body></html> 
