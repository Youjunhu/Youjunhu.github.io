<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Gyrokinetic equation in forms amenable to numerical computation</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,2,charset=utf-8,html --> 
<meta name="src" content="nonlinear_gyrokinetic_equation.tex" /> 
<link rel="stylesheet" type="text/css" href="nonlinear_gyrokinetic_equation.css" /> 
</head><body 
>
   <!--l. 1618--><div class="crosslinks"><p class="noindent">[<a 
href="nonlinear_gyrokinetic_equationse5.html" >next</a>] [<a 
href="nonlinear_gyrokinetic_equationse3.html" >prev</a>] [<a 
href="nonlinear_gyrokinetic_equationse3.html#tailnonlinear_gyrokinetic_equationse3.html" >prev-tail</a>] [<a 
href="#tailnonlinear_gyrokinetic_equationse4.html">tail</a>] [<a 
href="nonlinear_gyrokinetic_equation.html#nonlinear_gyrokinetic_equationse4.html" >up</a>] </p></div>
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x5-300004"></a>Gyrokinetic equation in forms amenable to numerical computation</h3>
<!--l. 1621--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.1   </span> <a 
 id="x5-310004.1"></a>Eliminate <span 
class="cmmi-10">∂</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δϕ</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">∕∂t </span>term on the right-hand side of Eq. (136)</h4>
<!--l. 1623--><p class="noindent" >Note that the coeﬃcient before <span 
class="cmmi-10">∂F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕∂𝜀</span> in Eq. (<a 
href="nonlinear_gyrokinetic_equationse3.html#x4-29001r136">136<!--tex4ht:ref: 16-10-16-2 --></a>) involves the time derivative of <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δϕ</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub>, which is
problematic if treated by using explicit ﬁnite diﬀerence in particle simulations (I test the algorithm that
treats this term by implicit scheme, the result roughly agrees with the standard method discussed in
Sec. <a 
href="nonlinear_gyrokinetic_equationse6.html#x7-400006">6<!--tex4ht:ref: 19-1-4-1 --></a>). It turns out that <span 
class="cmmi-10">∂</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δ</span>Φ<span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">∕∂t </span>can be eliminated by deﬁning another gyro-phase independent
function <span 
class="cmmi-10">δf </span>by
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-31001r139"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation147x.png" alt="     q-     ∂F0-
δf = m ⟨δΦ ⟩α ∂𝜀  +δG0.
" class="math-display"  /></center></td><td class="equation-label">(139)</td></tr></table>
<!--l. 1634--><p class="nopar" >
Substituting this into Eq. (<a 
href="nonlinear_gyrokinetic_equationse3.html#x4-29001r136">136<!--tex4ht:ref: 16-10-16-2 --></a>), we obtain the equation for <span 
class="cmmi-10">δf</span>: </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation148x.png" alt="[                          ]
 -∂ + (ve  + V  + δV  )⋅∇   δf
 ∂t    ∥ ∥    D      D    X
  q-∂F0-[ ∂                        ]
− m  ∂𝜀  ∂t + (v∥e∥ + VD + δVD ) ⋅∇X ⟨δΦ⟩α
  q      [ ∂                        ] ∂F
− --⟨δΦ ⟩α -- + (v∥e∥ + VD + δVD )⋅∇X  ---0
  m       ∂t                          ∂𝜀
= − δVD ⋅∇XF0  − q-∂⟨δL⟩α∂F0-.                        (140)
                 m   ∂t   ∂𝜀
" class="math-display"  /></center>
</div>Noting that <span 
class="cmmi-10">∂F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕∂t </span>= 0, <span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> = 0, <span 
class="cmmi-10">∂F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕∂𝜀 </span><span 
class="cmsy-10">≈−</span><span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">m∕T</span>, we ﬁnd that the third line of the above
equation is of order <span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">λ</span><sup><span 
class="cmr-7">3</span></sup>) (after both sides being divided by <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub>Ω). Therefore the third line can be
dropped. Moving the second line to the right-hand side and noting that <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δL</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub> = <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δϕ </span><span 
class="cmsy-10">− </span><span 
class="cmbx-10">v </span><span 
class="cmsy-10">⋅ </span><span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub>, the
above equation is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation149x.png" alt="[ ∂                       ]
 --+ (v∥e∥ + VD + δVD )⋅∇X  δf
 ∂t
= − δ[VD ⋅∇XF0                               ]
−-q − ∂⟨v-⋅δA⟩α − (v e + VD  + δVD )⋅∇X ⟨δΦ ⟩α ∂F0-,        (141)
 m        ∂t       ∥ ∥                        ∂𝜀
" class="math-display"  /><a 
 id="x5-31003r141"></a></center>
</div>where two <span 
class="cmmi-10">∂</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">ϕ</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">∕∂t </span>terms cancel each other. Note that the right-hand side of Eq. (<a 
href="#x5-31003r141">141<!--tex4ht:ref: 17-5-13-p2 --></a>) contains a
nonlinear term <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub> <span 
class="cmsy-10">⋅∇</span><sub><span 
class="cmmi-7">X</span></sub><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δ</span>Φ<span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub>. This is diﬀerent from the original Frieman-Chen equation, where all
nonlinear terms appear on the left-hand side. For the electrostatic limit, this term disappears because
<span 
class="cmmi-10">δ</span><span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub> is perpendicular to <span 
class="cmsy-10">∇</span><sub><span 
class="cmmi-7">X</span></sub><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δ</span>Φ<span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub>.
<!--l. 1681--><p class="indent" >   [Equation (<a 
href="#x5-31003r141">141<!--tex4ht:ref: 17-5-13-p2 --></a>) corresponds to Eq. (A8) in Yang Chen’s paper<span class="cite">[<a 
href="nonlinear_gyrokinetic_equationli1.html#Xychen2009">2</a>]</span> (where the ﬁrst minus on the
right-hand side is wrong and should be replaced with <span 
class="cmmi-10">q∕m</span>; one <span 
class="cmmi-10">q </span>is missing before <span 
class="cmmi-10">∂</span>(<span 
class="cmbx-10">v </span><span 
class="cmsy-10">⋅ </span><span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A</span>)<span 
class="cmmi-10">∕∂t </span>in
A9).]
</p><!--l. 1686--><p class="indent" >    
</p><!--l. 1690--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.2   </span> <a 
 id="x5-320004.2"></a>Eliminate <span 
class="cmmi-10">∂</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δ</span><span 
class="cmbx-10">v </span><span 
class="cmsy-10">⋅ </span><span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">∕∂t </span>term on the right-hand side of GK equation</h4>
<!--l. 1692--><p class="noindent" >Similar to the method of eliminating <span 
class="cmmi-10">∂</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δϕ</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">∕∂t</span>, we deﬁne another gyro-phase independent function
by
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-32001r142"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation150x.png" alt="          q        ∂F
δh = δf −--⟨v ⋅δA ⟩α--0-.
         m          ∂𝜀
" class="math-display"  /></center></td><td class="equation-label">(142)</td></tr></table>
<!--l. 1699--><p class="nopar" >
Most gyrokinetic simulations approximate the vector potential as <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">∥</span></sub>. Let us simplify Eq.
(<a 
href="#x5-32006r147">147<!--tex4ht:ref: 19-1-4-e1 --></a>) for this case. Then <span 
class="cmsy-10">⟨</span><span 
class="cmbx-10">v </span><span 
class="cmsy-10">⋅ </span><span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub> is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-32002r143"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation151x.png" alt="⟨v ⋅δA⟩α ≈ ⟨v∥δA ∥⟩α.
" class="math-display"  /></center></td><td class="equation-label">(143)</td></tr></table>
<!--l. 1708--><p class="nopar" >
Then expression (<a 
href="#x5-32001r142">142<!--tex4ht:ref: 23-11-15-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-32003r144"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation152x.png" alt="         -q        ∂F0-
δh = δf − m ⟨v∥δA∥⟩α ∂𝜀 .
" class="math-display"  /></center></td><td class="equation-label">(144)</td></tr></table>
<!--l. 1713--><p class="nopar" >
Then Eq. (<a 
href="#x5-31003r141">141<!--tex4ht:ref: 17-5-13-p2 --></a>) is written in terms of <span 
class="cmmi-10">δh </span>as </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation153x.png" alt="[ ∂                        ]
 ∂t + (v∥e∥ + VD +δVD ) ⋅∇X δh
       [(                     )    ]
+-q ∂F0-  ∂-+ v∥e∥ + VD + δVD   ⋅∇X   ⟨v∥δA ∥⟩α
 m  ∂𝜀    ∂t                (    )
 -q                          ∂F0-
+m ⟨v∥δA∥⟩α[(VD  + δVD )⋅∇X ]  ∂𝜀
= − δVD ⋅∇XF0
  q [ ∂ ⟨v∥δA∥⟩α                             ] ∂F
−--  −--------- − (v∥e∥ +VD  + δVD )⋅∇X ⟨δΦ⟩α ---0,        (145)
 m        ∂t                                  ∂𝜀
" class="math-display"  /></center>
</div>where use has been made of that <span 
class="cmmi-10">∂F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕∂t </span>= 0 and <span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⋅∇</span><span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> = 0. Further noting that <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">δ</span>Φ,
<span 
class="cmmi-10">qδ</span>Φ<span 
class="cmmi-10">∕T </span><span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">λ</span><sup><span 
class="cmr-7">1</span></sup>), <span 
class="cmmi-10">∂F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕∂𝜀 </span><span 
class="cmsy-10">∼−</span><span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">m∕T</span>,    <span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub><span 
class="cmmi-10">∕v</span><sub><span 
class="cmmi-7">t</span></sub> <span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">λ</span><sup><span 
class="cmr-7">1</span></sup>), <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub><span 
class="cmmi-10">∕v</span><sub><span 
class="cmmi-7">t</span></sub> <span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">λ</span><sup><span 
class="cmr-7">1</span></sup>), and <span 
class="cmmi-10">ρ</span><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> <span 
class="cmsy-10">∼ </span><span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">λ</span><sup><span 
class="cmr-7">1</span></sup>)<span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub>, we
ﬁnd that the red term of the above equation (after divided by Ω<span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub>) is of <span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">λ</span><sup><span 
class="cmr-7">3</span></sup>), hence can be dropped.
Move the second line to the right-hand side, giving <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation154x.png" alt="[ ∂                        ]
 ∂t +(v∥e∥ + VD + δVD )⋅∇X  δh
= − δV  ⋅∇  F
      D   X  0
+ q-[(v∥e∥ + VD + δVD )⋅∇X (⟨δΦ − v∥δA ∥⟩α)]∂F0,           (146)
  m                                    ∂ 𝜀
" class="math-display"  /><a 
 id="x5-32005r146"></a></center>
</div>where <span 
class="cmmi-10">∂</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">∕∂t </span>terms cancel each other. Further note that <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub> (given by Eq. (<a 
href="nonlinear_gyrokinetic_equationse3.html#x4-29003r138">138<!--tex4ht:ref: 19-1-3-1 --></a>)) is
perpendicular to <span 
class="cmsy-10">∇</span><sub><span 
class="cmmi-7">X</span></sub><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δ</span>Φ <span 
class="cmsy-10">− </span><span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub>. Therefore the blue term in Eq. (<a 
href="#x5-32005r146">146<!--tex4ht:ref: 19-1-3-e1 --></a>) is zero, then Eq. (<a 
href="#x5-32005r146">146<!--tex4ht:ref: 19-1-3-e1 --></a>)
simpliﬁes to <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation155x.png" alt="[                         ]
 ∂-+ (v e + V  + δV  )⋅∇    δh
 ∂t    ∥ ∥    D     D    X
= − δVD ⋅∇XF0
 -q                             ∂F0-
+m [(v∥e∥ +VD ) ⋅∇X ⟨δΦ − v∥δA∥⟩α]∂𝜀 .               (147)
" class="math-display"  /><a 
 id="x5-32006r147"></a></center>
</div>Note that in terms of (<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,𝜀,μ,α,σ</span>) coordinates, <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub> is written as
   <table 
class="equation"><tr><td><a 
 id="x5-32007r148"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation156x.png" alt="      ∘ ---------
v∥ = σ  2𝜀− 2μB0,
" class="math-display"  /></center></td><td class="equation-label">(148)</td></tr></table>
<!--l. 1772--><p class="nopar" >
where <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmbx-10">x</span>) = <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmbx-10">X </span>+ <span 
class="cmmib-10">ρ</span>) with <span 
class="cmmib-10">ρ</span> = <span 
class="cmmib-10">ρ</span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,𝜀,μ,α</span>). Since the scale length of <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub> is much larger than the
thermal Larmor radius, <span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmbx-10">x</span>) <span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmbx-10">X</span>) and hence <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub> can be approximated as a constant when
gyro-angle <span 
class="cmmi-10">α </span>changes. Then <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub> can be taken out of the gyro-averaging in expression (<a 
href="#x5-32002r143">143<!--tex4ht:ref: 19-3-26-e1 --></a>),
yielding
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-32008r149"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation157x.png" alt="⟨v∥δA∥⟩α ≈ v∥⟨δA ∥⟩α.
" class="math-display"  /></center></td><td class="equation-label">(149)</td></tr></table>
<!--l. 1783--><p class="nopar" >
Using this, the term related to <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub> in (<a 
href="#x5-32006r147">147<!--tex4ht:ref: 19-1-4-e1 --></a>) can be further written as </p><div class="eqnarray">
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="nonlinear_gyrokinetic_equation158x.png" alt="(v∥e∥ + VD )⋅∇X ⟨v∥δA ∥⟩α =   (v∥e∥ + VD )⋅∇X (v∥⟨δA∥⟩α)
                        =   ⟨δA ∥⟩α(v∥e∥ + VD ) ⋅∇X (v∥)+ v∥(v∥e∥ + VD )⋅∇X ⟨δA∥(⟩1α5.0)
" class="math-display"  /></center>
</div>Using expression (<a 
href="#x5-32007r148">148<!--tex4ht:ref: 19-3-27-1 --></a>), (<span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">∥</span></sub> + <span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub>) <span 
class="cmsy-10">⋅∇</span><sub><span 
class="cmmi-7">X</span></sub>(<span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub>) is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation159x.png" alt="⟨δA ⟩ (ve  + V  )⋅∇  (v )  ≈  ⟨δA ⟩ (v e )⋅∇  (v )
   ∥ α ∥ ∥    D    X  ∥         ∥ α  ∥ ∥   X (∥∘ ---------)
                          =  ⟨δA∥⟩α(v∥e∥)⋅∇X  σ  2𝜀− 2μB0
                                              (∘ ---------)
                          =  ⟨δA∥⟩ασ(v∥e∥)⋅∇X    2𝜀− 2μB0
                                      − 2μe∥ ⋅∇XB0
                          =  ⟨δA∥⟩ασv∥-2√2𝜀-−-2μB---
                                                 0
                          =  ⟨δA∥⟩αv∥−-2μe∥ ⋅∇XB0-
                                          2v∥
                          =  − ⟨δA ∥⟩α μe∥ ⋅∇XB0.                  (151)
" class="math-display"  /></center>
</div>(We can also obtain <span 
class="cmsy-10">∇</span><sub><span 
class="cmmi-7">X</span></sub>(<span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub>) = <span 
class="cmsy-10">−</span><span 
class="cmmi-10">μ</span>(<span 
class="cmsy-10">∇</span><span 
class="cmmi-10">B</span><sub><span 
class="cmr-7">0</span></sub>)<span 
class="cmmi-10">∕v</span><sub><span 
class="cmsy-7">∥</span></sub> by using Eq. (<a 
href="nonlinear_gyrokinetic_equationse16.html#x17-76002r370">370<!--tex4ht:ref: 19-1-2-e1 --></a>)). Using the above results, equation
(<a 
href="#x5-32006r147">147<!--tex4ht:ref: 19-1-4-e1 --></a>) is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation160x.png" alt="   [                          ]
    ∂- + (v∥e∥ + VD + δVD )⋅∇X  δh
    ∂t
                 -q                     ∂F0-
=  − δVD ⋅∇XF0 + m [(v∥e∥ + VD )⋅∇X ⟨δΦ ⟩α]∂𝜀
   -q                                          ∂F0-
−  m [v∥(v∥e∥ + VD )⋅∇X ⟨δA∥⟩α− ⟨δA ∥⟩α(μe∥ ⋅∇XB0 )]∂𝜀 ,       (152)
" class="math-display"  /><a 
 id="x5-32011r152"></a></center>
</div>which agrees with the so-called <span 
class="cmmi-10">p</span><sub><span 
class="cmsy-7">∥</span></sub> formulation given in the <span 
class="cmtt-10">GEM</span> manual (the ﬁrst line of Eq. 28). (It is
                                                                                

                                                                                
said that <span 
class="cmmi-10">p</span><sub><span 
class="cmsy-7">∥</span></sub> formulation uses <span 
class="cmmi-10">p</span><sub><span 
class="cmsy-7">∥</span></sub> = <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub> + <span 
class="cmmi-10">q</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><span 
class="cmmi-10">∕m </span>as an independent variable, but I can not relate this
explanation to my derivation given above.)
<!--l. 1841--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.3   </span> <a 
 id="x5-330004.3"></a>Mixed-variable pullback method<span class="cite">[<a 
href="nonlinear_gyrokinetic_equationli1.html#XMISHCHENKO2019194">4</a>]</span></h4>
<!--l. 1843--><p class="noindent" >Deﬁne <span 
class="cmmi-10">δf</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup> by
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-33001r153"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation161x.png" alt="  (h)       q      (h)  ∂F0
δf   = δf − m-⟨v∥δA ∥ ⟩α∂-𝜀 ,
" class="math-display"  /></center></td><td class="equation-label">(153)</td></tr></table>
<!--l. 1848--><p class="nopar" >
where <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup> is a part of <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-33002r154"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation162x.png" alt="        (s)     (h)
δA∥ = δA∥ + δA ∥ ,
" class="math-display"  /></center></td><td class="equation-label">(154)</td></tr></table>
<!--l. 1853--><p class="nopar" >
with <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup> determined by an evolution equation:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-33003r155"></a>
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="nonlinear_gyrokinetic_equation163x.png" alt="∂δA (s∥)
------ = − b ⋅∇δΦ.
  ∂t
" class="math-display"  /></center></td><td class="equation-label">(155)</td></tr></table>
<!--l. 1858--><p class="nopar" >
Following the same procedure in Sec. <a 
href="#x5-320004.2">4.2<!--tex4ht:ref: 24-3-21-p1 --></a>, we obtain the following evoluation equation for <span 
class="cmmi-10">δf</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup>:
</p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation164x.png" alt="[ ∂                        ]  (h)
 ∂t + (v∥e∥ + VD +δVD ) ⋅∇X  δf

= − δVD ⋅∇XF0 + -q[(VD  + δVD )⋅∇X ⟨δΦ⟩α]∂F0-
                m                       ∂𝜀
−-q[v∥(v∥e∥ + VD + δVD )⋅∇X ⟨δA(∥h)⟩α − ⟨δA(∥h)⟩α(μe∥ ⋅∇XB0 )]∂F0-.  (156)
 m                                                      ∂𝜀
" class="math-display"  /><a 
 id="x5-33004r156"></a></center>
</div>Next, consider the special case that <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is a local Maxwellian given by
   <table 
class="equation"><tr><td><a 
 id="x5-33005r157"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation165x.png" alt="               (        )3∕2   [       ]
F0(X,𝜀) = n0(X ) --m-----   exp − -m-𝜀-- ,
                 2πT0(X )          T0(X)
" class="math-display"  /></center></td><td class="equation-label">(157)</td></tr></table>
<!--l. 1879--><p class="nopar" >
Then <span 
class="cmmi-10">∂F</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">∕∂𝜀 </span>and <span 
class="cmsy-10">∇</span><sub><span 
class="cmmi-7">X</span></sub><span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> are written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-33006r158"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation166x.png" alt="∂F    (  m )
---0=  − --  F0,
 ∂𝜀      T
" class="math-display"  /></center></td><td class="equation-label">(158)</td></tr></table>
<!--l. 1884--><p class="nopar" >
and </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation167x.png" alt="         ∂F0       ∂F0
∇F0   =  -∂n0∇n0 + ∂T-∇T0
            ∇n      ( mv2   3) ∇T
      =  F0 --0-+ F0  ----− -  ---0
            n0[     (  2T0   2)   T]0
      =  − F  κ  +  mv2- − 3  κ  ,                   (159)
            0  n     2T0   2   T
" class="math-display"  /><a 
 id="x5-33007r159"></a></center>
</div>where <span 
class="cmmib-10">κ</span><sub><span 
class="cmmi-7">n</span></sub> = <span 
class="cmsy-10">−</span><img 
src="nonlinear_gyrokinetic_equation168x.png" alt="∇nn00"  class="frac" align="middle" />, and <span 
class="cmmib-10">κ</span><sub><span 
class="cmmi-7">T</span></sub> = <span 
class="cmsy-10">−</span><img 
src="nonlinear_gyrokinetic_equation169x.png" alt="∇TT00"  class="frac" align="middle" />. Consider the case that <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,𝜀</span>) is independent of <span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">α</span>, then
<span 
class="cmmib-10">κ</span><sub><span 
class="cmmi-7">n</span></sub> and <span 
class="cmmib-10">κ</span><sub><span 
class="cmmi-7">T</span></sub>are written as <span 
class="cmmib-10">κ</span><sub><span 
class="cmmi-7">n</span></sub> = <span 
class="cmmi-10">κ</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">r </span>and <span 
class="cmmib-10">κ</span><sub><span 
class="cmmi-7">T</span></sub> = <span 
class="cmmi-10">κ</span><sub><span 
class="cmmi-7">T</span></sub><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">r</span>, where <span 
class="cmmi-10">κ</span><sub><span 
class="cmmi-7">n</span></sub> <span 
class="cmsy-10">≡−</span><img 
src="nonlinear_gyrokinetic_equation170x.png" alt="-1
n0"  class="frac" align="middle" /><img 
src="nonlinear_gyrokinetic_equation171x.png" alt="dn0
 dr"  class="frac" align="middle" />, <span 
class="cmmi-10">κ</span><sub><span 
class="cmmi-7">T</span></sub> <span 
class="cmsy-10">≡−</span><img 
src="nonlinear_gyrokinetic_equation172x.png" alt="1-
T0"  class="frac" align="middle" /><img 
src="nonlinear_gyrokinetic_equation173x.png" alt="dT0-
dr"  class="frac" align="middle" />, and <span 
class="cmmi-10">r </span>is
chosen to be the minor radius at the low ﬁeld side.
<!--l. 1903--><p class="indent" >   Using the above results, Eq. (<a 
href="#x5-33004r156">156<!--tex4ht:ref: 17-6-21-3 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation174x.png" alt="                      [     (        )   ]
dδf(h)             -dr       mv2-   3          q-
  dt    =  δVD ⋅∇ ψdψ  κn +   2T0 − 2  κT F0 − T[(VD + δVD )⋅∇ ⟨δΦ ⟩]F0
           q-                         (h)     (h)
        +  T [v∥(v∥e∥ + VD + δVD )⋅∇ ⟨δA∥ ⟩− ⟨δA∥ ⟩(μe∥ ⋅∇B0 )]F0.      (160)
" class="math-display"  /><a 
 id="x5-33008r160"></a></center>
</div>
                                                                                

                                                                                
<!--l. 1917--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">4.3.1   </span> <a 
 id="x5-340004.3.1"></a>Weight evolution equation</h5>
<!--l. 1919--><p class="noindent" >The weight of the <span 
class="cmmi-10">j</span> th marker is deﬁned by
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-34001r161"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation175x.png" alt="w  = δf(h)(X ,v ,t)V   ,
 j         j  j   pj0
" class="math-display"  /></center></td><td class="equation-label">(161)</td></tr></table>
<!--l. 1922--><p class="nopar" >
where <span 
class="cmmi-10">V</span> <sub><span 
class="cmmi-7">pj</span><span 
class="cmr-7">0</span></sub> is the phase space volume occupied by the <span 
class="cmmi-10">j</span>th marker. Multiplying both sides of Eq. (<a 
href="#x5-33008r160">160<!--tex4ht:ref: 21-8-8-a1 --></a>)
by <span 
class="cmmi-10">V</span> <sub><span 
class="cmmi-7">pj</span><span 
class="cmr-7">0</span></sub>, and noting that <span 
class="cmmi-10">d</span>(<span 
class="cmmi-10">V</span> <sub><span 
class="cmmi-7">pj</span><span 
class="cmr-7">0</span></sub>)<span 
class="cmmi-10">∕dt </span>= 0, we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation176x.png" alt="                    [    (   2    )   ]
dwj- =  δVD  ⋅∇ψ dr- κn +  mv--− 3  κT Vpj0F0 − q[(VD  + δVD )⋅⟨∇δΦ ⟩]Vpj0F0.
dt               dψ        2T0   2              T
     +  -q[v∥(v∥e∥ + VD + δVD  )⋅⟨∇ δA(h)⟩ − ⟨δA (h)⟩(μe∥ ⋅∇B0 )]Vpj0F0,         (162)
        T                          ∥        ∥
" class="math-display"  /><a 
 id="x5-34002r162"></a></center>
</div>where use has been made of <span 
class="cmsy-10">∇⟨</span><span 
class="cmmi-10">δ</span>Φ<span 
class="cmsy-10">⟩ </span>= <span 
class="cmsy-10">⟨∇</span><span 
class="cmmi-10">δ</span>Φ<span 
class="cmsy-10">⟩ </span>and <span 
class="cmsy-10">∇⟨</span><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup><span 
class="cmsy-10">⟩ </span>= <span 
class="cmsy-10">⟨∇</span><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup><span 
class="cmsy-10">⟩</span>.
<!--l. 1980--><p class="indent" >   Note that <span 
class="cmsy-10">∇≡ </span><span 
class="cmmi-10">∂∕∂</span><span 
class="cmbx-10">X</span>. Using <span 
class="cmbx-10">x </span>= <span 
class="cmbx-10">X </span>+ <span 
class="cmmi-10">ρ</span>, we obtain </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation177x.png" alt="∂δΦg(X,α,v⊥-) =   ∂δΦp(X-+-ρ(X,α,v⊥-))-
     ∂X                   ∂X
              =   ∂δΦp(x) = ∂δΦp(x) ⋅ ∂x-
                    ∂X     (  ∂x  )  ∂X
                  ∂δΦp(x)      -∂ρ
              =     ∂x    ⋅ 1+ ∂X
                  ∂δΦp(x)
              ≈   --∂x---,                             (163)
" class="math-display"  /></center>
</div>which is accurate up to <span 
class="cmmi-10">O</span>(<span 
class="cmmi-10">λ</span>) in gyrokinetic ordering. Note that ﬁeld values on a regular <span 
class="cmbx-10">X </span>grid are not
available in our simulation because <span 
class="cmbx-10">X </span>is sampled by random markers rather than by a regular grid.
This fact makes it diﬀcult to numerical compute <span 
class="cmmi-10">∂∕∂</span><span 
class="cmbx-10">X</span>. Then the relation <span 
class="cmmi-10">∂δ</span>Φ<sub><span 
class="cmmi-7">g</span></sub><span 
class="cmmi-10">∕∂</span><span 
class="cmbx-10">X </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">∂δ</span>Φ<sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕∂</span><span 
class="cmbx-10">x</span>,
becomes useful because we can use <span 
class="cmmi-10">δ</span>Φ deﬁned on <span 
class="cmbx-10">x </span>grid (which is available in simulations) to compute
 <span 
class="cmmi-10">∂δ</span>Φ<sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕∂</span><span 
class="cmbx-10">x </span>at <span 
class="cmbx-10">x </span>grid-points (using ﬁnite-diﬀerence), and then interpolate it to particle position.
 Similarly, we have <span 
class="cmmi-10">∂δA</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">g</span></sub><span 
class="cmmi-10">∕∂</span><span 
class="cmbx-10">X </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">∂δA</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">∕∂</span><span 
class="cmbx-10">x</span>.
<!--l. 1980--><p class="indent" >   Also note that <span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δ</span>Φ<sub><span 
class="cmmi-7">g</span></sub><span 
class="cmsy-10">⟩ </span>is not known on <span 
class="cmbx-10">X </span>grid (it is known on random markers). So, to calculate
<span 
class="cmmi-10">∂</span><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">δ</span>Φ<sub><span 
class="cmmi-7">g</span></sub><span 
class="cmsy-10">⟩</span><span 
class="cmmi-10">∕∂</span><span 
class="cmbx-10">X</span>, we need to exchange the operation order:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-34004r164"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation178x.png" alt="δ⟨δΦg-⟩   ∂δΦg-    ∂δΦp-
 ∂X   = ⟨ ∂X  ⟩ ≈ ⟨ ∂x ⟩.
" class="math-display"  /></center></td><td class="equation-label">(164)</td></tr></table>
<!--l. 1980--><p class="nopar" >
For notation ease, the subscripts <span 
class="cmmi-10">g </span>and <span 
class="cmmi-10">p </span>will be dropped in the following.
</p><!--l. 1982--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><span class="titlemark">4.3.2   </span> <a 
 id="x5-350004.3.2"></a>In ﬁeld-aligned coordinates</h5>
<!--l. 1984--><p class="noindent" >In ﬁeld-aligned coordinates (<span 
class="cmmi-10">x,y,z</span>),  <img 
src="nonlinear_gyrokinetic_equation179x.png" alt="∂δΦ
 ∂x"  class="frac" align="middle" /> can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35001r165"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation180x.png" alt="∂δΦ- = ∂δΦ∇x +  ∂δΦ∇y + ∂-δΦ-∇z.
 ∂x    ∂x       ∂y       ∂z
" class="math-display"  /></center></td><td class="equation-label">(165)</td></tr></table>
<!--l. 1991--><p class="nopar" >
Note that the direction of <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂x </span>at <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>is diﬀerent from that of <span 
class="cmmi-10">∂</span><span 
class="cmbx-10">r</span><span 
class="cmmi-10">∕∂x </span>at <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π</span>. This implies that
<span 
class="cmmi-10">∂δ</span>Φ<span 
class="cmmi-10">∕∂x </span>is a non-periodic function of <span 
class="cmmi-10">𝜃</span>. Similarly, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y </span>is also a non-perioidic functon of <span 
class="cmmi-10">𝜃</span>. Then both
<span 
class="cmmi-10">∂δ</span>Φ<span 
class="cmmi-10">∕∂x </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y </span>are discontinuous across the <span 
class="cmmi-10">𝜃 </span>cut (<span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">±</span><span 
class="cmmi-10">π</span>).
</p><!--l. 2000--><p class="indent" >   The gyro-average of expression (<a 
href="#x5-35001r165">165<!--tex4ht:ref: 23-11-29-p1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35002r166"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation181x.png" alt="⟨∂δΦ-⟩ ≈ ⟨∂δΦ-⟩∇x + ⟨∂δΦ-⟩∇y + ⟨∂δΦ⟩∇z,
  ∂x      ∂x        ∂y        ∂z
" class="math-display"  /></center></td><td class="equation-label">(166)</td></tr></table>
<!--l. 2006--><p class="nopar" >
where we approximate <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">z </span>as constants when performing the gyro-averge since they
are determined by the equilibrim magnetic ﬁeld, which is nearly constant on the Larmor
radius scale. As is mentioned above, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y </span>is not continuous at the <span 
class="cmmi-10">𝜃 </span>cut. Do we need to worry
about this? We do not. This is because we must stick to the same branch when we perform
gryo-average on it, and hence <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y </span>is always continous. Then, do we need to worry about
the disconunity of <span 
class="cmmi-10">∂δ</span>Φ<span 
class="cmmi-10">∕∂x </span>across the <span 
class="cmmi-10">𝜃 </span>cut when performing the gyro-averge on it? We
do not either. The reason is the same: we must stick to a single branch. The disconunity
is just irrelevant here. The discontinuity only manifest itself when we need to infer value
on <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>from that on <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π </span>(vice versa), i.e., when across branch communication is
explicitly needed. In TEK, the ﬁeld equations are not solved at <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π </span>and hence the ﬁeld
values are not directly obtained. Instead, the ﬁeld values at <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π </span>are infered from the
ﬁeld values at <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π </span>using the coninuity of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">δ</span>Φ. At the <span 
class="cmmi-10">𝜃 </span>cut, the continuity of <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">δ</span>Φ
requires
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35003r167"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation182x.png" alt="⟨∂δΦ-⟩+∇x + ⟨∂δΦ⟩∇y+  = ⟨∂δΦ⟩− ∇x + ⟨∂δΦ-⟩∇y− ,
  ∂x         ∂y          ∂x          ∂y
" class="math-display"  /></center></td><td class="equation-label">(167)</td></tr></table>
<!--l. 2029--><p class="nopar" >
where the superscript “+” and “<span 
class="cmsy-10">−</span>” refer to the location <span 
class="cmmi-10">𝜃 </span>= +<span 
class="cmmi-10">π </span>and <span 
class="cmmi-10">𝜃 </span>= <span 
class="cmsy-10">−</span><span 
class="cmmi-10">π</span>, respectively. Dotting the
above by <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span>, we obtain
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35004r168"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation183x.png" alt=" ∂δΦ- +   ∂-δΦ- −   ∂-δΦ- ∇y-− ⋅∇x-−-∇y+-⋅∇x--
⟨ ∂x ⟩ = ⟨ ∂x ⟩  +⟨ ∂y ⟩       |∇x |2      ,
" class="math-display"  /></center></td><td class="equation-label">(168)</td></tr></table>
<!--l. 2039--><p class="nopar" >
which is used in TEK to infer the value of <span 
class="cmsy-10">⟨</span><img 
src="nonlinear_gyrokinetic_equation184x.png" alt="∂δΦ
 ∂x"  class="frac" align="middle" /><span 
class="cmsy-10">⟩</span><sup><span 
class="cmr-7">+</span></sup> from that of <span 
class="cmsy-10">⟨</span><img 
src="nonlinear_gyrokinetic_equation185x.png" alt="∂δΦ
 ∂x"  class="frac" align="middle" /><span 
class="cmsy-10">⟩</span><sup><span 
class="cmsy-7">−</span></sup>.
</p><!--l. 2044--><p class="indent" >   Similarly, for <span 
class="cmmi-10">∂δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup><span 
class="cmmi-10">∕∂</span><span 
class="cmbx-10">x</span>, we obtain:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35005r169"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation186x.png" alt="∂δA(h)   ∂δA(h)      ∂δA(h)     ∂δA(h)
---∥--=  ---∥-∇x +  ---∥-∇y +  ---∥-∇z.
  ∂x      ∂x         ∂y         ∂z
" class="math-display"  /></center></td><td class="equation-label">(169)</td></tr></table>
<!--l. 2053--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35006r170"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation187x.png" alt="    (h)       (h)          (h)          (h)
⟨∂δA∥--⟩ ≈ ⟨∂δA∥-⟩∇x + ⟨∂δA∥-⟩∇y + ⟨∂δA-∥-⟩∇z
   ∂x        ∂x          ∂y           ∂z
" class="math-display"  /></center></td><td class="equation-label">(170)</td></tr></table>
<!--l. 2061--><p class="nopar" >
Using these, Eq. (<a 
href="#x5-34002r162">162<!--tex4ht:ref: 17-7-25-1m --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation188x.png" alt="                    [     (   2    )   ]
dwj-  =  δVD  ⋅∇ ψ dr-κn +   mv--− 3  κT Vpj0F0
 dt        [      dψ        2T0   2                     ]
         -q  ∂δΦ- dX-′       ∂δΦ-dX-′       ∂δΦ- dX′-
      −  T  ⟨ ∂x ⟩ dt ⋅∇x + ⟨∂y ⟩ dt ⋅∇y + ⟨ ∂z ⟩dt ⋅∇z  Vpj0F0
             (     (h)              (h)              (h)       )
         -q  (  ∂δA∥-- dX-       ∂δA∥-- dX-       ∂δA∥-- dX-   )
      +  T v∥  ⟨ ∂x   ⟩dt ⋅∇x + ⟨  ∂y  ⟩dt ⋅∇y + ⟨  ∂z  ⟩dt ⋅∇z  Vpj0F0
          q
      −  --⟨δA(∥h)⟩(μb ⋅∇B0 )Vpj0F0,                                      (171)
         T
" class="math-display"  /></center>
</div>where <img 
src="nonlinear_gyrokinetic_equation189x.png" alt="dX-
dt"  class="frac" align="middle" /> <span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmbx-10">b </span>+ <span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub> + <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub> and <img 
src="nonlinear_gyrokinetic_equation190x.png" alt="dX′
 dt"  class="frac" align="middle" /> <span 
class="cmsy-10">≡ </span><span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub> + <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">V</span><sub><span 
class="cmmi-7">D</span></sub>. Deﬁne
   <table 
class="equation"><tr><td><a 
 id="x5-35008r172"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation191x.png" alt="                  q v δA(h)
δΦ-= quδΦ-,δA(∥h) = -u-u--∥-,
      Tu             Tu
" class="math-display"  /></center></td><td class="equation-label">(172)</td></tr></table>
<!--l. 2088--><p class="nopar" >
Then, a typical term of the above is written as </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation192x.png" alt="        (h)                            -(h)  --
qv∥⟨∂δA-∥-⟩dX-⋅∇xtn   =  q--Tu-vnv∥⟨∂δA∥--⟩dX-⋅∇x
T     ∂x    dt           T quvu       ∂x   dt
                          q∕q  v    ∂δA-(h) dX- --
                      =  ---u--nv∥⟨----∥-⟩---⋅∇x,
                         T ∕Tuvu     ∂x   dt
" class="math-display"  /></center>
</div>where <img 
src="nonlinear_gyrokinetic_equation193x.png" alt="q∕qu
T∕Tu"  class="frac" align="middle" /><img 
src="nonlinear_gyrokinetic_equation194x.png" alt="vn
vu"  class="frac" align="middle" /> is the normlizing factor needed when coding. The mirror force term: <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation195x.png" alt="q    (h)                 q  Tu Bn μn  -(h) --  ---
T-⟨δA ∥ ⟩(μb ⋅∇B0 )tn =   T-quvu-Ln--⟨δA∥ ⟩(μb ⋅∇B0 )tn          (173)
                                   2  --       ---
                    =   q∕qu-1--Bnvn⟨δA(∥h)⟩(μb ⋅∇B0 )tn
                        T∕Tu vuLnBn
                    =   q∕qu-vn⟨δA(h)⟩(μb ⋅∇B- )
                        T∕Tu vu   ∥          0
" class="math-display"  /></center>
</div>where <img 
src="nonlinear_gyrokinetic_equation196x.png" alt="qT∕∕quTu"  class="frac" align="middle" /><img 
src="nonlinear_gyrokinetic_equation197x.png" alt=" vvnu"  class="frac" align="middle" /> is the normlizing factor needed when coding.
<!--l. 2119--><p class="indent" >   The pullback: </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation198x.png" alt="                               (    )
-q⟨v∥δA(h)⟩∂F0-Vp =   q-⟨v∥δA (h)⟩ − m- F0Vp
m      ∥   ∂𝜀        m      ∥     T
                 ≈   −-qv∥⟨δA(∥h)⟩F0Vp
                      T
                 =   −-q∕quv∥⟨δA-(h∥)⟩F0Vp
                      T ∕Tuvu
" class="math-display"  /></center>
</div>The <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">E </span><span 
class="cmsy-10">× </span><span 
class="cmbx-10">B</span><sub><span 
class="cmr-7">0</span></sub> drift term is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation199x.png" alt="  ∂δΦ                (                             )
− ⟨-∂x ⟩×2-B0 =  − -12 ⟨∂δΦ-⟩∇x + ⟨∂δΦ⟩∇y + ⟨∂δΦ-⟩∇z   × B0
     B0           B0    ∂x        ∂y         ∂z
             =  − ⟨∂δΦ⟩-1-∇x × B  − ⟨∂δΦ⟩-1-∇y × B  − ⟨∂δΦ⟩-1-∇z × B .
                   ∂x  B20       0   ∂y  B20      0    ∂z  B20      0
" class="math-display"  /></center>
</div>The <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">z </span>components of the above expression are written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation200x.png" alt="− ⟨∂δ∂Φx ⟩×-B0-⋅∇x =  − ⟨∂δΦ⟩-1-∇y × B  ⋅∇x − ⟨∂δΦ⟩-1-∇z × B  ⋅∇x
     B20                ∂y  B20      0        ∂z  B20      0
                       ∂δΦ--1-               ∂δΦ--1-
                 =  − ⟨∂y ⟩B2 ∇x × ∇y ⋅B0 − ⟨∂z ⟩B2 ∇x × ∇z ⋅B0.   (174)
                             0                     0
" class="math-display"  /></center>
</div>
   <div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation201x.png" alt="  ⟨∂δΦ-⟩× B             ∂δΦ  1                ∂δΦ  1
− -∂x--2--0-⋅∇y  =  − ⟨----⟩-2∇x × B0 ⋅∇y − ⟨---⟩--2∇z × B0 ⋅∇y
     B 0                ∂x  B0                ∂z B 0
                 =  ⟨∂-δΦ-⟩-1-∇x × ∇y ⋅B0 − ⟨∂δΦ-⟩-1-∇y × ∇z ⋅B0    (175)
                      ∂x  B20               ∂z  B20
" class="math-display"  /></center>
</div>
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation202x.png" alt="   ∂δΦ-
− ⟨∂x-⟩×-B0-⋅∇z  =  − ⟨∂δΦ-⟩ 1-∇x × B0 ⋅∇z − ⟨∂δΦ⟩-1-∇y × B0 ⋅∇z
     B20                ∂x  B20               ∂y  B20
                     ∂-δΦ- -1-              ∂δΦ- -1-
                 =  ⟨ ∂x ⟩B20∇x × ∇z ⋅B0 + ⟨ ∂y ⟩B20 ∇y ×∇z ⋅B0     (176)
" class="math-display"  /></center>
</div>
<!--l. 2186--><p class="indent" >   Using
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35016r177"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation203x.png" alt="dx= V   ⋅∇x,
dt    G
" class="math-display"  /></center></td><td class="equation-label">(177)</td></tr></table>
<!--l. 2189--><p class="nopar" >
i.e.,
</p>
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x5-35017r178"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation204x.png" alt="dx-= t V  ⋅∇x
dt   n  G
" class="math-display"  /></center></td><td class="equation-label">(178)</td></tr></table>
<!--l. 2193--><p class="nopar" >
To get the normalizing factor, consider only the contribution from <span 
class="cmmi-10">E </span><span 
class="cmsy-10">×</span><span 
class="cmmi-10">B </span>drift. Then a typical term is
written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation205x.png" alt="dx- =   − tn⟨∂δΦ-⟩ 1-∇x × ∇y ⋅B0
dt           ∂y  B20 --
          Tu--tn-- ∂δΦ- 1---   --  --
    =   − quBnL2n⟨ ∂y ⟩B2∇x × ∇y ⋅B0
                      --0
    =   − Tu---1---⟨∂δΦ-⟩ 1-∇x × ∇y ⋅B0,               (179)
          quBnvnLn   ∂y  B20
" class="math-display"  /></center>
</div>where <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">q</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">v</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">n</span></sub>) is the normlizing factor we need when coding.
<!--l. 2211--><p class="indent" >   The magnetic ﬂuttering term is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation206x.png" alt="                          ⟨    (                           ) ⟩
−-v∥⟨b× ∇  (δA )⟩ =   −-v∥-  b×   ∂δA∥∇x +  ∂δA∥∇y + ∂δA-∥∇z
 B0       x   ∥        B0         ∂x        ∂y       ∂z
                       -v∥-   (  ∂δA∥-      ∂δA∥-      ∂δA-∥   )
                  ≈   −B0 b×   ⟨ ∂x ⟩∇x + ⟨ ∂y  ⟩∇y + ⟨ ∂z  ⟩∇z
" class="math-display"  /></center>
</div>The <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x</span>, <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y</span>, and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">z </span>components of the above expression are written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation207x.png" alt="                                 (                     )
 -v∥                       -v∥      ∂δA∥-      ∂δA∥-
−B0 ⟨b× ∇x (δA∥)⟩⋅∇x  =   −B0 b ×  ⟨ ∂y ⟩∇y + ⟨ ∂z  ⟩∇z   ⋅∇x
                          v∥ ( ∂δA ∥           ∂ δA ∥        )
                      =   B2- ⟨-∂y--⟩∇x × ∇y +⟨--∂z-⟩∇x × ∇z  ⋅B0   (180)
                           0
" class="math-display"  /></center>
</div><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation208x.png" alt="  v∥-                      -v∥   (  ∂δA∥-      ∂δA-∥   )
− B0⟨b× ∇x (δA∥)⟩⋅∇y  =   −B0 b ×  ⟨ ∂x ⟩∇x + ⟨ ∂z  ⟩∇z   ⋅∇y
                          v  ( ∂δA             ∂ δA          )
                      =   -∥2- ⟨----∥⟩∇y ×∇x  +⟨----∥⟩∇y × ∇z  ⋅B0   (181)
                          B0    ∂x               ∂z
" class="math-display"  /></center>
</div><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation209x.png" alt="                                 (                     )
− v∥⟨b× ∇  (δA )⟩⋅∇z  =   −-v∥b ×  ⟨∂δA∥⟩∇x + ⟨∂δA-∥⟩∇y   ⋅∇z
  B0      x   ∥            B0        ∂x         ∂y
                          v∥-( ∂δA-∥           ∂δA-∥        )
                      =   B2  ⟨ ∂x  ⟩∇z × ∇x + ⟨ ∂y ⟩∇z × ∇y  ⋅B0   (182)
                           0
" class="math-display"  /></center>
</div>
<!--l. 2264--><p class="indent" >   Also to get the normalizing factor needed in the code, consider a typical term: </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation210x.png" alt="dx-       v∥-∂δA-∥
dt  =   tn B20⟨ ∂y  ⟩∇x × ∇y ⋅B0
         T     v   v   ∂δA- --   --  --
    =   --u-tn-2n---∥2⟨---∥⟩∇x × ∇y ⋅B0
        quvu  LnBn B 0 -∂y
         Tu   1   v∥ ∂δA∥ --   --  --
    =   quvuLnBn---2⟨-∂y--⟩∇x × ∇y ⋅B0                  (183)
                 B 0
" class="math-display"  /></center>
</div>
<!--l. 2281--><p class="indent" >   where <span 
class="cmmi-10">T</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">q</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">v</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">n</span></sub>) is the normlizing factor I need when coding.
</p><!--l. 2283--><p class="indent" >   The basic terms involved in the above expressions can be written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35024r184"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation211x.png" alt="                B2
(∇x × ∇y )⋅B0 = -0′,
                Ψ
" class="math-display"  /></center></td><td class="equation-label">(184)</td></tr></table>
<!--l. 2286--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35025r185"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation212x.png" alt="               ( ∂x ∂z   ∂x ∂z )
(∇x  ×∇z )⋅B0 =   ------− ------  Bϕ ≡ W 14
                 ∂Z ∂R   ∂R ∂Z
" class="math-display"  /></center></td><td class="equation-label">(185)</td></tr></table>
<!--l. 2292--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35026r186"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation213x.png" alt="               -- ( 1 ∂α ∂𝜃)   -- ( ∂α ∂𝜃   ∂α ∂𝜃 )   -- (  1 ∂α ∂𝜃)
(∇y × ∇z)⋅B0 = BR   R-∂ϕ-∂Z- + B ϕ  ∂Z-∂R-− ∂R-∂Z-  + BZ  − R-∂ϕ-∂R- ≡ W 15
" class="math-display"  /></center></td><td class="equation-label">(186)</td></tr></table>
<!--l. 2304--><p class="nopar" >
</p><!--l. 2307--><p class="indent" >    
</p><!--l. 2309--><p class="indent" >    
</p><!--l. 2311--><p class="indent" >    
</p><!--l. 2313--><p class="indent" >    
</p><!--l. 2315--><p class="indent" >   In terms of <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup>, the Ampere’s law is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35027r187"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation214x.png" alt="(∑   ω2      )          ∑
     -p2s− ∇2⊥   δA(∥h) = μ0   δJ(||hs)+ ∇2⊥ δA(∥s),
  s  c                   s
" class="math-display"  /></center></td><td class="equation-label">(187)</td></tr></table>
                                                                                

                                                                                
<!--l. 2320--><p class="nopar" >
where <span 
class="cmmi-10">δJ</span><sub><span 
class="cmsy-7">||</span><span 
class="cmmi-7">s</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup> is the parallel current carried by the distrbution funciton <span 
class="cmmi-10">δf</span><sub><span 
class="cmmi-7">s</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup>, where the subscript <span 
class="cmmi-10">s </span>is
species index (do not confuse it with the superscript <span 
class="cmmi-10">s </span>of <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup>). Here <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup> has been moved to
the right-hand side since its value is already known when we solve the Ampere’s law for
<span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup>.
</p><!--l. 2328--><p class="indent" >   Compared with the <span 
class="cmmi-10">p</span><sub><span 
class="cmsy-7">∥</span></sub> formulation, the improvement of the above procedure is that a part of <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub> is
solved from an evolution equation (which is chosen by some physical consideration) and the remainder
is solved from the Ampere’s law. We hope that the former is the dominant part of <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub> so that the
remainder solved from the Ampere’s law is small and hence the cancellation problem (of the Ampere’s
law) become less signiﬁcant. While a wise choice of the evolution equation for <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup> may help ensure
that <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup> remain dominant over the entire simulation duration, we have another simple way to make
<span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup> remain dominant: collect both <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup> and <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup> into <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">s</span><span 
class="cmr-7">)</span></sup> at the end of each time
step:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35028r188"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation215x.png" alt="   (s)      (s)     (h)
δA ∥new = δA∥old + δA∥old.
" class="math-display"  /></center></td><td class="equation-label">(188)</td></tr></table>
<!--l. 2343--><p class="nopar" >
Then, to make <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub> untouched (so that electromagnetic ﬁeld remain unchanged), we set <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup> to
zero:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35029r189"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation216x.png" alt="δA (h)  = 0.
  ∥new
" class="math-display"  /></center></td><td class="equation-label">(189)</td></tr></table>
<!--l. 2348--><p class="nopar" >
Here “old” and “new” refers to before and after the re-spliting, respectively. Note that this re-spliting is
made at the end of each time step and does not correspond to any time evolution. This re-splitting
keeps the value of <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub> untouched and hence does not inﬂuence the electromagnetic ﬁeld.
Meanwhile, the deﬁnition of Eq. (<a 
href="#x5-33001r153">153<!--tex4ht:ref: 23-11-16-p1 --></a>) indicates that, for a given <span 
class="cmmi-10">δf</span>, the re-splitting will make the
                                                                                

                                                                                
value of <span 
class="cmmi-10">δf</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup> increase by Δ = <img 
src="nonlinear_gyrokinetic_equation217x.png" alt="q-
m"  class="frac" align="middle" /><span 
class="cmsy-10">⟨</span><span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmr-7">old</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup><span 
class="cmsy-10">⟩</span><sub>
<span 
class="cmmi-7">α</span></sub><img 
src="nonlinear_gyrokinetic_equation218x.png" alt="∂F0
 ∂𝜀"  class="frac" align="middle" /> since <span 
class="cmmi-10">δA</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup> is reduced by <span 
class="cmmi-10">δA</span><sub>
<span 
class="cmr-7">old</span></sub><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup>. In
other words, to keep <span 
class="cmmi-10">δf </span>unchanged, which is what we need to ensure, we must add Δ to
<span 
class="cmmi-10">δf</span><sup><span 
class="cmr-7">(</span><span 
class="cmmi-7">h</span><span 
class="cmr-7">)</span></sup>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35030r190"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation219x.png" alt="δf(h) = δf(h) + q-⟨v δA (h)⟩ ∂F0-.
  new     old   m  ∥   ∥old α ∂𝜀
" class="math-display"  /></center></td><td class="equation-label">(190)</td></tr></table>
<!--l. 2365--><p class="nopar" >
After the operations in (<a 
href="#x5-35028r188">188<!--tex4ht:ref: 23-11-16-p3 --></a>) (<a 
href="#x5-35029r189">189<!--tex4ht:ref: 23-11-16-p4 --></a>) and (<a 
href="#x5-35030r190">190<!--tex4ht:ref: 23-11-16-p5 --></a>), both the electromagnetic ﬁeld and the distribution
function <span 
class="cmmi-10">δf </span>remain unchanged. Therefore we do not change any physical process of the system. Hence
the above operations can only have eﬀects on numerical round-oﬀ errors. As mentioned above, we hope
the numerical eﬀects will reduce the cancellation errors.
</p><!--l. 2373--><p class="indent" >   Deﬁne
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35031r191"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation220x.png" alt=" --  quδΦ  -(h)  quvuδA(∥h)  -(s)   quvuδA (s∥)  -(h)   δJ(∥ss)
δΦ = -T--,δA∥  = ---T-----,δA∥  = ---T----,δJ||s = n-q-v--,
       u              u               u            u u ns
" class="math-display"  /></center></td><td class="equation-label">(191)</td></tr></table>
<!--l. 2380--><p class="nopar" >
where <span 
class="cmmi-10">q</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">,n</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">,T</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmmi-7">u</span></sub> are chosen units, <span 
class="cmmi-10">v</span><sub><span 
class="cmmi-7">ns</span></sub> is a velocity unit for a species, whose value is diﬀerent among
diﬀerent species [<span 
class="cmmi-10">v</span><sub><span 
class="cmmi-7">ns</span></sub> = <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmmi-10">∕</span>(2<span 
class="cmmi-10">π∕</span>(<span 
class="cmmi-10">B</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmsy-10">|</span><span 
class="cmmi-10">q</span><sub><span 
class="cmmi-7">s</span></sub><span 
class="cmsy-10">|</span><span 
class="cmmi-10">∕m</span><sub><span 
class="cmmi-7">s</span></sub>))]. In <span 
class="cmtt-10">TEK</span>, <span 
class="cmmi-10">v</span><sub><span 
class="cmmi-7">u</span></sub> is chosen as <span 
class="cmmi-10">v</span><sub><span 
class="cmmi-7">ns</span></sub> of the ﬁrst ion
species.
</p><!--l. 2386--><p class="indent" >   Then the Ampere’s law (<a 
href="#x5-35027r187">187<!--tex4ht:ref: 23-12-4-1 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35032r192"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation221x.png" alt="(     2      )           2   2
 ∑   ωps− ∇2   δA(h)= -ω-pu--vu ∑  vnsδJ(h)+ ∇2δA-(s),
  s  c2     ⊥    ∥    Tu∕mu c2  s vu   ||s    ⊥   ∥
" class="math-display"  /></center></td><td class="equation-label">(192)</td></tr></table>
<!--l. 2392--><p class="nopar" >
where <span 
class="cmmi-10">ω</span><sub><span 
class="cmmi-7">pu</span></sub><sup><span 
class="cmr-7">2</span></sup> = <span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">q</span><sub><span 
class="cmmi-7">u</span></sub><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">m</span><sub><span 
class="cmmi-7">u</span></sub><span 
class="cmmi-10">𝜀</span><sub><span 
class="cmr-7">0</span></sub>), <span 
class="cmmi-10">m</span><sub><span 
class="cmmi-7">u</span></sub> is a mass unit, and use has been made of <span 
class="cmmi-10">μ</span><sub><span 
class="cmr-7">0</span></sub> = 1<span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">c</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">𝜀</span><sub><span 
class="cmr-7">0</span></sub>).
</p><!--l. 2396--><p class="indent" >   <span 
class="cmmi-10">δf </span>pullback in Eq. (<a 
href="#x5-35030r190">190<!--tex4ht:ref: 23-11-16-p5 --></a>) is now written as (for the case of <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> being Maxwellian): </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation222x.png" alt="                 q           (  m)
δf(nhe)w  =  δf(ohld)+ --⟨v∥δA (h∥o)ld⟩α  − -- F0
           (h)  qm    (h)       T
       =  fold − T-⟨v∥δA∥old⟩αF0
           (h)  q - vn  -(h)
       =  fold − T-v∥vu⟨δA∥old⟩αF0                      (193)
" class="math-display"  /></center>
</div>In terms of units used in <span 
class="cmtt-10">TEK</span>, Eq. (<a 
href="#x5-33003r155">155<!--tex4ht:ref: 23-11-16-2 --></a>) is written as
   <table 
class="equation-star"><tr><td>
                          <img 
src="nonlinear_gyrokinetic_equation223x.png" alt="  --(s)
∂δA-∥-
  ∂t"  class="frac" align="middle" /><img 
src="nonlinear_gyrokinetic_equation224x.png" alt="-Tu-
quvu"  class="frac" align="middle" /><img 
src="nonlinear_gyrokinetic_equation225x.png" alt="-1
tu"  class="frac" align="middle" /> = <span 
class="cmsy-10">−</span><img 
src="nonlinear_gyrokinetic_equation226x.png" alt="-Tu--
quLn"  class="frac" align="middle" /><span 
class="cmbx-10">b </span><span 
class="cmsy-10">⋅</span><span class="overline"><span 
class="cmsy-10">∇</span></span><span 
class="cmmi-10">δ</span><span class="overline">Φ</span><span 
class="cmmi-10">,</span>
</td></tr></table>
<!--l. 2413--><p class="nopar" >
where <span class="overline"><span 
class="cmmi-10">t</span></span> = <span 
class="cmmi-10">t∕t</span><sub><span 
class="cmmi-7">u</span></sub>, <span 
class="cmmi-10">t</span><sub><span 
class="cmmi-7">u</span></sub> = <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">n</span></sub><span 
class="cmmi-10">∕v</span><sub><span 
class="cmmi-7">u</span></sub>. Then the above equation is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35034r194"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation227x.png" alt="  --(s)
∂δA-∥- = − b ⋅∇δΦ,
  ∂t
" class="math-display"  /></center></td><td class="equation-label">(194)</td></tr></table>
<!--l. 2419--><p class="nopar" >
i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-35035r195"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation228x.png" alt="∂δA-(s∥)       --  ∂δΦ-
------ = − (b⋅∇z )-∂z-.
  ∂t
" class="math-display"  /></center></td><td class="equation-label">(195)</td></tr></table>
<!--l. 2425--><p class="nopar" >
</p><!--l. 2428--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.4   </span> <a 
 id="x5-360004.4"></a>Discretizing Laplacian operator </h4>
<!--l. 2430--><p class="noindent" >The Laplacian operator is approximated as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-36001r196"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation229x.png" alt="          2           2            2
∇2 δA∥ ≈ ∂-δA∥|∇x|2 + ∂-δA-∥|∇y |2 + ∂-δA∥2∇x ⋅∇y.
 ⊥        ∂2x         ∂2y         ∂x∂y
" class="math-display"  /></center></td><td class="equation-label">(196)</td></tr></table>
                                                                                

                                                                                
<!--l. 2437--><p class="nopar" >
To approximate <span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub> of zero boundary condition <span 
class="cmmi-10">A</span><sub><span 
class="cmsy-7">∥</span></sub>(<span 
class="cmmi-10">x </span>= 0) = <span 
class="cmmi-10">A</span><sub><span 
class="cmsy-7">∥</span></sub>(<span 
class="cmmi-10">x </span>= <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">x</span></sub>) = 0, the sine expansion can
be adopted. In the <span 
class="cmmi-10">y </span>direction, full Fourier expansion is needed. Then, at each value of <span 
class="cmmi-10">z</span>, <span 
class="cmmi-10">A</span><sub><span 
class="cmsy-7">∥</span></sub>(<span 
class="cmmi-10">x,y,z</span>) is
approximated by the following two-dimensional expansion:
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-36002r197"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation230x.png" alt="              N∑y∕2     (  2π  )Nx∑−1          ( m π       )
δA ∥(x,y,z) ≈       exp  in--y       Am,n(z)sin  ---(x− x0) ,
            n=− Ny∕2       Ly    m=1            Lx
" class="math-display"  /></center></td><td class="equation-label">(197)</td></tr></table>
<!--l. 2447--><p class="nopar" >
Using this expression, Eq. (<a 
href="#x5-36001r196">196<!--tex4ht:ref: 23-12-16-3 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation231x.png" alt="                       (      )
   2          Ny∑∕2        -2π   N∑x−1
− ∇ ⊥δA∥ =          exp inLy y      δAm,n(z)
             n{=[−Ny∕2            m=1       ]                                                     }
               ( m-π)2    2  (  2π-)2    2    (m-π       )     2π-( mπ-)           ( mπ-       )
         ×       Lx    |∇x | +  nLy   |∇y|  sin   Lx (x − x0) − inLy   Lx  2∇x ⋅∇y cos  Lx (x − x0)
" class="math-display"  /></center>
</div>At <span 
class="cmmi-10">x </span>= <span 
class="cmmi-10">x</span><sub><span 
class="cmmi-7">j</span></sub>, with <span 
class="cmmi-10">x</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="cmsy-10">− </span><span 
class="cmmi-10">x</span><sub><span 
class="cmr-7">0</span></sub> = <span 
class="cmmi-10">j</span>Δ and <span 
class="cmmi-10">L</span><sub><span 
class="cmmi-7">x</span></sub><span 
class="cmmi-10">∕</span>Δ = <span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">x</span></sub>, the above expression is written as <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation232x.png" alt="   2          Ny∑∕2     (   2π ) N∑x−1
− ∇ ⊥δA∥ =          exp inL--y      δAm,n(z)
             n{=[−Ny∕2        y   m=1       ]                                         }
               ( m π)2       (  2π )2         (jm π)     2π ( mπ )           ( jmπ )
         ×       L--   |∇x |2 +  nL--  |∇y|2 sin  -N--  − inL--  L-- 2∇x ⋅∇y cos  N--(198,)
                   x              y               x       y    x                 x
" class="math-display"  /><a 
 id="x5-36004r198"></a></center>
</div>where <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">x </span>and <span 
class="cmsy-10">∇</span><span 
class="cmmi-10">y </span>are evaluated at <span 
class="cmmi-10">x</span><sub><span 
class="cmmi-7">j</span></sub>. Plugging the DST coeﬃcients
   <table 
class="equation"><tr><td><a 
 id="x5-36005r199"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation233x.png" alt="             N − 1           (     )
δA   (z) =-2- ∑x  A (x ′,z)sin  j′m-π- ,
  m,n     Nx  j′=1  n  j        Nx
" class="math-display"  /></center></td><td class="equation-label">(199)</td></tr></table>
<!--l. 2476--><p class="nopar" >
into expression (<a 
href="#x5-36004r198">198<!--tex4ht:ref: 23-12-16-1 --></a>) gives </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation234x.png" alt="              Ny∑∕2     (   2π ) N∑x−1 2 Nx∑−1            (j′mπ )
− ∇2⊥δA∥ =          exp in---y      ---     An(xj′,z)sin  -----
             n=−Ny∕2      Ly    m=1 Nx  j′=1              Nx
             {[(    )2       (     )2     ]   (    )        (    )           (     )}
         ×       m-π   |∇x |2 +  n2π-  |∇y|2 sin  jm-π  − in2π-  mπ- 2∇x ⋅∇y cos  jmπ-
                 Lx             Ly              Nx       Ly   Lx               Nx
" class="math-display"  /></center>
</div>For a single toroidal harmonic, the above expression reduces to <div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation235x.png" alt="    N∑x−1   Nx∑−1            ( ′   )
        -2-     An(xj′,z)sin  j-mπ-
    m=1 Nx  j′=1              Nx
    {[(    )2       (     )2     ]   (    )        (    )           (     )}
×       m-π   |∇x |2 +  n2π-  |∇y|2 sin  jm-π  − in2π-  mπ- 2∇x ⋅∇y cos  jmπ(200)
        Lx             Ly              Nx       Ly   Lx               Nx
" class="math-display"  /><a 
 id="x5-36007r200"></a></center>
</div>Deﬁne <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation236x.png" alt="                     (     )
          Nx∑− 1-2-    j′mπ-
Mjj′,n  ≡       Nx sin   Nx
          {m=[1(    )2       (    )2     ]    (    )        (   )            (    ) }
       ×       mπ-  |∇x|2 +  n2π-  |∇y |2 sin  jm-π  − in2π- m-π  2∇x ⋅∇y cos jm-π
               Lx             Ly              Nx       Ly   Lx               Nx
" class="math-display"  /></center>
</div>then expression (<a 
href="#x5-36007r200">200<!--tex4ht:ref: 23-12-27-e1 --></a>) is written as
   <table 
class="equation"><tr><td><a 
 id="x5-36009r201"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation237x.png" alt="Nx∑ −1
     Mjj′,nAn (xj′,z).
 j′=1
" class="math-display"  /></center></td><td class="equation-label">(201)</td></tr></table>
<!--l. 2512--><p class="nopar" >
</p><!--l. 2515--><p class="indent" >    
                                                                                

                                                                                
</p><!--l. 2517--><p class="indent" >    
</p><!--l. 2519--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.5   </span> <a 
 id="x5-370004.5"></a>Summary of distribution function split</h4>
<!--l. 2521--><p class="noindent" >In simulations, the seemingly trivial thing on how to split the distribution function is often considered
to be a big deal. Separating the perturbation from the total distribution function gets the famous name
“<span 
class="cmmi-10">δf </span>particle method”, in contrast to the conventional particle method which is now called full-f particle
method.
</p><!--l. 2527--><p class="indent" >   In the above, the perturbed part of the distribution function, <span 
class="cmmi-10">δF</span>, is split at least three times in
order to (1) simplify the gyrokinetic equation by splitting out the adiabatic response; (2) eliminate
the time derivatives, <span 
class="cmmi-10">∂δϕ∕∂t</span>, and (3) <span 
class="cmmi-10">∂δ</span><span 
class="cmbx-10">A</span><span 
class="cmmi-10">∕∂t</span>, on the right-hand. To avoid confusion, I
summarize the split of the distribution function here. The total distribution function <span 
class="cmmi-10">F </span>is split
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-37001r202"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation238x.png" alt="F = F0 +δF,
" class="math-display"  /></center></td><td class="equation-label">(202)</td></tr></table>
<!--l. 2536--><p class="nopar" >
where <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is the equilibrium distribution function and <span 
class="cmmi-10">δF </span>is the perturbed part of the total distribution
function. <span 
class="cmmi-10">δF </span>is further split as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-37002r203"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation239x.png" alt="          q-           ∂F0-  q-        ∂F0-
δF = δh + m (δΦ− ⟨δΦ⟩α) ∂𝜀 + m ⟨v⋅δA ⟩α∂ 𝜀 ,
" class="math-display"  /></center></td><td class="equation-label">(203)</td></tr></table>
<!--l. 2545--><p class="nopar" >
where <span 
class="cmmi-10">δh </span>satisﬁes the gyrokinetic equation (<a 
href="#x5-32006r147">147<!--tex4ht:ref: 19-1-4-e1 --></a>) or (<a 
href="#x5-32011r152">152<!--tex4ht:ref: 19-1-4-5 --></a>). In PIC simulations, <span 
class="cmmi-10">δh </span>is evolved by using
markers and its moment in the phase-space is evaluated via Monte-Carlo integration.
                                                                                

                                                                                
</p><!--l. 2550--><p class="indent" >    
</p><!--l. 2552--><p class="indent" >   The integration of the red and blue terms can be approximated analytically in terms of <span 
class="cmmi-10">δ</span>Φ and <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A</span>.
But this can also be evaluated using markers, i.e., using Monte-Carlo method, to avoid
the inaccurate cancellation between the integration of these parts and the integration of
<span 
class="cmmi-10">δh</span>.
</p><!--l. 2558--><p class="indent" >    
</p><!--l. 2560--><p class="indent" >   Another issue is how to accurately solve for <span 
class="cmmi-10">δ</span>Φ from the Poisson equation and <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A </span>from the
Ampere’s law. To make the solution accurate, one need to have a large term that is explictly dependent
on <span 
class="cmmi-10">δ</span>Φ and <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A </span>to appear on the left-hand side of the equations and small terms appear on the
right-hand side.
</p><!--l. 2566--><p class="indent" >   The red term in expression (<a 
href="#x5-37002r203">203<!--tex4ht:ref: 19-1-3-e2 --></a>) gives “the polarization density” when integrated in the velocity
space (discussed in Sec. <a 
href="nonlinear_gyrokinetic_equationse6.html#x7-400006">6<!--tex4ht:ref: 19-1-4-1 --></a>). The reason for the name “polarization” is that (<span 
class="cmmi-10">δ</span>Φ <span 
class="cmsy-10">−⟨</span><span 
class="cmmi-10">δ</span>Φ<span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub>) is the
diﬀerence between the local value and the averaged value on a gyro-ring, expressing a kind of
“separation”.
</p><!--l. 2573--><p class="indent" >    
</p><!--l. 2575--><p class="indent" >   are also needed to be evaluated using Monte-Carlo markers.
</p><!--l. 2577--><p class="indent" >    
</p><!--l. 2579--><p class="indent" >   This term is moved to the left-hand side of the Poisson equation and is utilized in solving the
Poisson equation. The blue term also has an explicit dependence on <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A</span>, which, however, will cause
numerical problems in particle simulations if it is moved to the left-hand side of the Ampere
equation. This is the “cancellation problem” in gyrokinetic simulations discussed in Sec.
<a 
href="#x5-370004.5">4.5<!--tex4ht:ref: 2023-10-31-p1 --></a>.
</p><!--l. 2586--><p class="indent" >    
</p><!--l. 2588--><p class="indent" >   The blue and red terms in the above expression explicitly depends on the perturbed ﬁeld. The
velocity integrations of these two terms can be performed analytically. However, in some cases, the
phase space integration of the blue terms must be evaluated using markers, i.e., using Monte-Carlo
method, to avoid the inaccurate cancellation between the integration of these parts and the
integration of <span 
class="cmmi-10">δh </span>(the latter is computed using Monte-Carlo method). When will the inaccurate
cancellation is signiﬁcant depends on the problem being investigated and thus can only be
determined by actual numerical experiments. Electromagnetic particle simulation experiments
indicate that the parallel current carried by the blue term must be evaluated via Monte-Carlo
method, otherwise inaccurate cancellation between this term and <span 
class="cmmi-10">δh </span>will give rise to numerical
instabilities.
</p><!--l. 2603--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.6   </span> <a 
 id="x5-380004.6"></a>Velocity space moment of <img 
src="nonlinear_gyrokinetic_equation240x.png" alt="-q
m"  class="frac" align="middle" /><span 
class="cmsy-10">⟨</span><span 
class="cmbx-10">v </span><span 
class="cmsy-10">⋅ </span><span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A</span><span 
class="cmsy-10">⟩</span><sub><span 
class="cmmi-7">α</span></sub><img 
src="nonlinear_gyrokinetic_equation241x.png" alt="∂F0
∂𝜀"  class="frac" align="middle" /></h4>
<!--l. 2605--><p class="noindent" >Consider the approximation <span 
class="cmmi-10">δ</span><span 
class="cmbx-10">A </span><span 
class="cmsy-10">≈ </span><span 
class="cmmi-10">δA</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">∥</span></sub>, then the blue term in Eq. (<a 
href="#x5-37002r203">203<!--tex4ht:ref: 19-1-3-e2 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38001r204"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation242x.png" alt="q-⟨vδA  ⟩ ∂F0.
m  ∥   ∥α ∂𝜀
" class="math-display"  /></center></td><td class="equation-label">(204)</td></tr></table>
<!--l. 2611--><p class="nopar" >
Notice that <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub> can be taken out of the gyro-averaging. Then the above equation is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38002r205"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation243x.png" alt="q-v ⟨δA  ⟩ ∂F0.
m  ∥   ∥α ∂𝜀
" class="math-display"  /></center></td><td class="equation-label">(205)</td></tr></table>
<!--l. 2617--><p class="nopar" >
If we neglect the FLR eﬀect, then the above expression is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38003r206"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation244x.png" alt="-qv δA ∂F0-.
m  ∥  ∥ ∂𝜀
" class="math-display"  /></center></td><td class="equation-label">(206)</td></tr></table>
<!--l. 2622--><p class="nopar" >
The zeroth order moment (number density) is then written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38004r207"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation245x.png" alt="           ∫
δn = q-δA    v ∂F0dv,
     m   ∥    ∥∂ 𝜀
" class="math-display"  /></center></td><td class="equation-label">(207)</td></tr></table>
<!--l. 2627--><p class="nopar" >
which is zero if <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is Maxwellian. Next, consider the parallel current carried by distribution (<a 
href="#x5-38003r206">206<!--tex4ht:ref: 19-2-20-5 --></a>),
which is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38005r208"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation246x.png" alt="           ∫
     q2       2∂F0-
δj∥ = m δA ∥ v∥ ∂𝜀 dv.
" class="math-display"  /></center></td><td class="equation-label">(208)</td></tr></table>
<!--l. 2633--><p class="nopar" >
If <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is a Maxwellian distribution given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38006r209"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation247x.png" alt="                   (     )
      ( -m--)3∕2       mv2-
F0 = n0 2πT    exp  − 2T   .
" class="math-display"  /></center></td><td class="equation-label">(209)</td></tr></table>
<!--l. 2638--><p class="nopar" >
then
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38007r210"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation248x.png" alt="∂F0-= − m-F .
∂𝜀     T  0
" class="math-display"  /></center></td><td class="equation-label">(210)</td></tr></table>
<!--l. 2642--><p class="nopar" >
Then expression (<a 
href="#x5-38005r208">208<!--tex4ht:ref: 19-2-20-1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38008r211"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation249x.png" alt="                        ∫       (     )
       q2   (-m--)3∕2       2       mv2-
δj∥ = − T n0 2πT    δA ∥  v∥exp  − 2T   dv.
" class="math-display"  /></center></td><td class="equation-label">(211)</td></tr></table>
<!--l. 2648--><p class="nopar" >
Working in the spherical coordinates, then <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">∥</span></sub> = <span 
class="cmmi-10">v</span> cos<span 
class="cmmi-10">𝜃 </span>and <span 
class="cmmi-10">d</span><span 
class="cmbx-10">v </span>= <span 
class="cmmi-10">v</span><sup><span 
class="cmr-7">2</span></sup> sin<span 
class="cmmi-10">𝜃dvd𝜃dϕ</span>. Then expression (<a 
href="#x5-38008r211">211<!--tex4ht:ref: 19-2-20-4 --></a>)
is written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation250x.png" alt="              (    )      ∫            (      )
δj  =   − q2-n  -m-- 3∕2δA    v2cos2𝜃 exp − mv2- v2 sin𝜃dvd𝜃dϕ
  ∥       T  0 2πT       ∥                 2T
          q2   ( m  )3∕2   4π ∫  4   (   mv2)
    =   − T-n0 2πT-    δA∥-3-  v exp  − 2T-- dv
          2   (  )3∕2         ∫
    =   − q-n0 -1    2T-δA∥4π-  x4exp(− x2)dx
          T    π      m     3
          q2   ( 1)3∕2 2T   4π 3√π-
    =   − T-n0 π-    -m-δA∥-3--8--
          2
    =   − q-n0δA ∥.                                               (212)
          m
" class="math-display"  /></center>
</div>Using <span 
class="cmmi-10">c </span>= 1<span 
class="cmmi-10">∕</span><img 
src="nonlinear_gyrokinetic_equation251x.png" alt="√----
 μ0𝜀0"  class="sqrt"  /> and <span 
class="cmmi-10">ω</span><sub><span 
class="cmmi-7">p</span></sub><sup><span 
class="cmr-7">2</span></sup> = <span 
class="cmmi-10">n</span><sub>
<span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">q</span><sup><span 
class="cmr-7">2</span></sup><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">m𝜀</span><sub>
<span 
class="cmr-7">0</span></sub>), the above expression can be written as
   <table 
class="equation"><tr><td><a 
 id="x5-38010r213"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation252x.png" alt="          2
μ0δj∥ = − ωp2 δA ∥,
         c
" class="math-display"  /></center></td><td class="equation-label">(213)</td></tr></table>
<!--l. 2671--><p class="nopar" >
where the <span 
class="cmmi-10">c∕ω</span><sub><span 
class="cmmi-7">ps</span></sub> is often called the skin depth of species “s”. The skin current can also be written
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x5-38011r214"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation253x.png" alt="μ0δj∥ = − β2δA ∥,
         ρ
" class="math-display"  /></center></td><td class="equation-label">(214)</td></tr></table>
<!--l. 2676--><p class="nopar" >
where <span 
class="cmmi-10">ρ </span>= <img 
src="nonlinear_gyrokinetic_equation254x.png" alt="∘ -----
  2T∕m"  class="sqrt"  /><span 
class="cmmi-10">∕</span>Ω is the thermal Larmor radius.
                                                                                

                                                                                
</p>
   <!--l. 2679--><div class="crosslinks"><p class="noindent">[<a 
href="nonlinear_gyrokinetic_equationse5.html" >next</a>] [<a 
href="nonlinear_gyrokinetic_equationse3.html" >prev</a>] [<a 
href="nonlinear_gyrokinetic_equationse3.html#tailnonlinear_gyrokinetic_equationse3.html" >prev-tail</a>] [<a 
href="nonlinear_gyrokinetic_equationse4.html" >front</a>] [<a 
href="nonlinear_gyrokinetic_equation.html#nonlinear_gyrokinetic_equationse4.html" >up</a>] </p></div>
<!--l. 2679--><p class="indent" >   <a 
 id="tailnonlinear_gyrokinetic_equationse4.html"></a>  </p> 
</body></html> 
