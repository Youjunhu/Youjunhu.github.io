<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Summary of split of the distribution function</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,4,charset=utf-8,html --> 
<meta name="src" content="nonlinear_gyrokinetic_equation.tex" /> 
<link rel="stylesheet" type="text/css" href="nonlinear_gyrokinetic_equation.css" /> 
</head><body 
>
   <!--l. 1837--><div class="crosslinks"><p class="noindent">[<a 
href="nonlinear_gyrokinetic_equationsu21.html" >next</a>] [<a 
href="nonlinear_gyrokinetic_equationsu19.html" >prev</a>] [<a 
href="nonlinear_gyrokinetic_equationsu19.html#tailnonlinear_gyrokinetic_equationsu19.html" >prev-tail</a>] [<a 
href="#tailnonlinear_gyrokinetic_equationsu20.html">tail</a>] [<a 
href="nonlinear_gyrokinetic_equationse5.html#nonlinear_gyrokinetic_equationsu20.html" >up</a>] </p></div>
   <h4 class="subsectionHead"><span class="titlemark">5.3   </span> <a 
 id="x26-350005.3"></a>Summary of split of the distribution function</h4>
<!--l. 1839--><p class="noindent" >In the above, the perturbed part of the distribution function, <span 
class="cmmi-10">Œ¥F</span>, is split at least three times in order
to (1) simplify the gyrokinetic equation by splitting out the adiabatic response and (2)
eliminate the time derivatives, <span 
class="cmmi-10">‚àÇŒ¥œï‚àï‚àÇt </span>and (3) <span 
class="cmmi-10">‚àÇŒ¥</span><span 
class="cmbx-10">A</span><span 
class="cmmi-10">‚àï‚àÇt</span>, on the right-hand. To avoid confusion, I
summarize the split of the distribution function here. The total distribution function <span 
class="cmmi-10">F </span>is split
as
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-35001r150"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation158x.png" alt="F = F0 +Œ¥F,
" class="math-display"  /></center></td><td class="equation-label">(150)</td></tr></table>
<!--l. 1848--><p class="nopar" >
where <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is the equilibrium distribution function and <span 
class="cmmi-10">Œ¥F </span>is the perturbed part of the total distribution
function. <span 
class="cmmi-10">Œ¥F </span>is further split as
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-35002r151"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation159x.png" alt="         q            ‚àÇF    q         ‚àÇF
Œ¥F = Œ¥h + --(Œ¥Œ¶‚àí ‚ü®Œ¥Œ¶‚ü©Œ±)--0-+ --‚ü®v‚ãÖŒ¥A ‚ü©Œ± --0,
         m             ‚àÇùúÄ   m         ‚àÇùúÄ
" class="math-display"  /></center></td><td class="equation-label">(151)</td></tr></table>
<!--l. 1857--><p class="nopar" >
where <span 
class="cmmi-10">Œ¥h </span>satisÔ¨Åes the gyrokinetic equation (<a 
href="nonlinear_gyrokinetic_equationsu19.html#x25-33004r142">142<!--tex4ht:ref: 19-1-4-e1 --></a>) or (<a 
href="nonlinear_gyrokinetic_equationsu19.html#x25-34006r149">149<!--tex4ht:ref: 19-1-4-5 --></a>). In Eq. (<a 
href="#x26-35002r151">151<!--tex4ht:ref: 19-1-3-e2 --></a>), the red term gives rise to
the so-called polarization density (discussed in Sec. <a 
href="nonlinear_gyrokinetic_equationsu23.html#x29-410005.6">5.6<!--tex4ht:ref: 19-1-4-1 --></a>). The analytic dependence of this
term on <span 
class="cmmi-10">Œ¥Œ¶ </span>is utilized in solving the Poisson equation. The blue term also has an analytic
dependence on <span 
class="cmmi-10">Œ¥</span><span 
class="cmbx-10">A</span>, which, however, will cause numerical problems in particle simulations if it is
utilized in solving the Ampere equation (the so-called ‚Äúcancellation problem‚Äù in gyrokinetic
                                                                                

                                                                                
simulations).
</p>
   <h5 class="subsubsectionHead"><a 
 id="x26-360005.3"></a>Velocity space moment of <img 
src="nonlinear_gyrokinetic_equation160x.png" alt=" q
m-"  class="frac" align="middle" /><span 
class="cmsy-10">‚ü®</span><span 
class="cmbx-10">v </span><span 
class="cmsy-10">‚ãÖ </span><span 
class="cmmi-10">Œ¥</span><span 
class="cmbx-10">A</span><span 
class="cmsy-10">‚ü©</span><sub><span 
class="cmmi-7">Œ±</span></sub><img 
src="nonlinear_gyrokinetic_equation161x.png" alt="‚àÇ‚àÇFùúÄ0"  class="frac" align="middle" /></h5>
<!--l. 1871--><p class="noindent" >Consider the approximation <span 
class="cmmi-10">Œ¥</span><span 
class="cmbx-10">A </span><span 
class="cmsy-10">‚âà </span><span 
class="cmmi-10">Œ¥A</span><sub><span 
class="cmsy-7">‚à•</span></sub><span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">‚à•</span></sub>, then the blue term in Eq. (<a 
href="#x26-35002r151">151<!--tex4ht:ref: 19-1-3-e2 --></a>) is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36001r152"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation162x.png" alt="q-‚ü®vŒ¥A  ‚ü© ‚àÇF0.
m  ‚à•   ‚à•Œ± ‚àÇùúÄ
" class="math-display"  /></center></td><td class="equation-label">(152)</td></tr></table>
<!--l. 1877--><p class="nopar" >
Notice that <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚à•</span></sub> can be taken out of the gyro-averaging. Then the above equation is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36002r153"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation163x.png" alt="q-        ‚àÇF0-
m v‚à•‚ü®Œ¥A ‚à•‚ü©Œ± ‚àÇùúÄ .
" class="math-display"  /></center></td><td class="equation-label">(153)</td></tr></table>
<!--l. 1883--><p class="nopar" >
If we neglect the FLR eÔ¨Äect, then the above expression is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36003r154"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation164x.png" alt="-qv Œ¥A ‚àÇF0-.
m  ‚à•  ‚à• ‚àÇùúÄ
" class="math-display"  /></center></td><td class="equation-label">(154)</td></tr></table>
<!--l. 1888--><p class="nopar" >
The zeroth order moment (number density) is then written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36004r155"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation165x.png" alt="           ‚à´
     q-        ‚àÇF0-
Œ¥n = m Œ¥A‚à•   v‚à•‚àÇ ùúÄ dv,
" class="math-display"  /></center></td><td class="equation-label">(155)</td></tr></table>
<!--l. 1893--><p class="nopar" >
which is zero if <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is Maxwellian.
</p><!--l. 1896--><p class="indent" >   Next, consider the parallel current carried by distribution (<a 
href="#x26-36003r154">154<!--tex4ht:ref: 19-2-20-5 --></a>), which is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36005r156"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation166x.png" alt="     q2    ‚à´  2‚àÇF0
Œ¥j‚à• = m-Œ¥A ‚à• v‚à•-‚àÇùúÄ-dv.
" class="math-display"  /></center></td><td class="equation-label">(156)</td></tr></table>
<!--l. 1901--><p class="nopar" >
If <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is a Maxwellian distribution given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36006r157"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation167x.png" alt="                   (     )
      ( -m--)3‚àï2       mv2-
F0 = n0 2œÄT    exp  ‚àí 2T   .
" class="math-display"  /></center></td><td class="equation-label">(157)</td></tr></table>
<!--l. 1906--><p class="nopar" >
then
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36007r158"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation168x.png" alt="‚àÇF0-= ‚àí m-F0.
‚àÇùúÄ     T
" class="math-display"  /></center></td><td class="equation-label">(158)</td></tr></table>
<!--l. 1910--><p class="nopar" >
Then expression (<a 
href="#x26-36005r156">156<!--tex4ht:ref: 19-2-20-1 --></a>) is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-36008r159"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation169x.png" alt="        2   (    )3‚àï2    ‚à´       (    2)
Œ¥j‚à• = ‚àí q-n0 -m--   Œ¥A ‚à•  v2‚à•exp  ‚àí mv-- dv.
       T     2œÄT                   2T
" class="math-display"  /></center></td><td class="equation-label">(159)</td></tr></table>
<!--l. 1916--><p class="nopar" >
Working in the spherical coordinates, then <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚à•</span></sub> = <span 
class="cmmi-10">v</span> cos<span 
class="cmmi-10">ùúÉ </span>and <span 
class="cmmi-10">d</span><span 
class="cmbx-10">v </span>= <span 
class="cmmi-10">v</span><sup><span 
class="cmr-7">2</span></sup> sin<span 
class="cmmi-10">ùúÉdvdùúÉdœï</span>. Then expression (<a 
href="#x26-36008r159">159<!--tex4ht:ref: 19-2-20-4 --></a>)
is written </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation170x.png" alt="           (     )      ‚à´            (     )
Œ¥j = ‚àí q2n   -m-- 3‚àï2Œ¥A    v2cos2ùúÉexp  ‚àí mv2- v2sinùúÉdvdùúÉdœï
  ‚à•    T  0  2œÄT       ‚à•                2T
       q2  (  m  )3‚àï2    4œÄ‚à´   4   (  mv2 )
   = ‚àí T-n0  2œÄT-   Œ¥A ‚à•3--  v exp  ‚àí-2T-  dv                   (160)
        2  (  )3 ‚àï2         ‚à´
   = ‚àí q-n0  1-    2TŒ¥A  4œÄ-  x4exp(‚àí x2)dx
       T     œÄ     m    ‚à•3
       q2  ( 1)3 ‚àï2 2T    4œÄ3‚àö œÄ-
   = ‚àí T-n0  œÄ-    m-Œ¥A ‚à•3---8-
        2
   = ‚àí q-n0Œ¥A‚à•.                                                 (161)
       m
" class="math-display"  /></center>
</div>
   <h5 class="subsubsectionHead"><a 
 id="x26-370005.3"></a>Ampere‚Äôs Law</h5>
   <table 
class="equation"><tr><td><a 
 id="x26-37001r162"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation171x.png" alt="‚àí ‚àá2‚ä• Œ¥A(‚à•n+1)= Œº0(Œ¥J (n||i+1)+ Œ¥J(|n|e+1)).
" class="math-display"  /></center></td><td class="equation-label">(162)</td></tr></table>
<!--l. 1941--><p class="nopar" >
The parallel currents are given by
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-37002r163"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation172x.png" alt="                         ‚à´         q2          ‚àÇF
Œ¥J(n||i+1)= Œ¥J|‚Ä≤|i(Œ¥œï(n),Œ¥A(‚à•n)) +  (v(‚à•n+1))2-i-‚ü®Œ¥A (n‚à•+1)‚ü©Œ±--i0dv,
                                   mi           ‚àÇùúÄ
" class="math-display"  /></center></td><td class="equation-label">(163)</td></tr></table>
                                                                                

                                                                                
<!--l. 1949--><p class="nopar" >
</p>
   <table 
class="equation"><tr><td><a 
 id="x26-37003r164"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation173x.png" alt="                  (n)   ‚à´   (n+1)  q2    (n+1)  ‚àÇFe0
Œ¥J||e = Œ¥J‚Ä≤||e(Œ¥œï(n),Œ¥A ‚à• )+  (v‚à•   )2-e‚ü®Œ¥A ‚à•   ‚ü©Œ± ----dv,
                                 me           ‚àÇùúÄ
" class="math-display"  /></center></td><td class="equation-label">(164)</td></tr></table>
<!--l. 1955--><p class="nopar" >
where <span 
class="cmmi-10">Œ¥J</span><sub><span 
class="cmsy-7">‚à•</span><span 
class="cmmi-7">i</span></sub><span 
class="cmsy-10">‚Ä≤ </span>and <span 
class="cmmi-10">Œ¥J</span><sub><span 
class="cmsy-7">‚à•</span><span 
class="cmmi-7">e</span></sub><span 
class="cmsy-10">‚Ä≤ </span>is the parallel current carried by the distribution function <span 
class="cmmi-10">Œ¥h </span>in Eq. (<a 
href="#x26-35002r151">151<!--tex4ht:ref: 19-1-3-e2 --></a>), which
are updated from the value at the <span 
class="cmmi-10">n</span>th time step to the (<span 
class="cmmi-10">n </span>+ 1)th time step using an explicit scheme
and therefore does not depends on the Ô¨Åeld at the (<span 
class="cmmi-10">n </span>+ 1)th step. The blue terms in Eqs. (<a 
href="#x26-37002r163">163<!--tex4ht:ref: 19-3-21-4 --></a>) and
(<a 
href="#x26-37003r164">164<!--tex4ht:ref: 19-3-21-5 --></a>) depend on the Ô¨Åeld at the (<span 
class="cmmi-10">n </span>+ 1)th step and thus need to be moved to the left-hand side of
Ampere‚Äôs law (<a 
href="#x26-37001r162">162<!--tex4ht:ref: 19-3-21-6 --></a>) if we want to solve this equation by direct methods. In this case, equation (<a 
href="#x26-37001r162">162<!--tex4ht:ref: 19-3-21-6 --></a>) is
written as
</p>
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation174x.png" alt="               ‚à´          2
‚àí ‚àá2‚ä•Œ¥A(‚à•n+1)‚àí Œº0 (v(n‚à•+1))2 qi‚ü®Œ¥A(‚à•n+1)‚ü©Œ± ‚àÇFi0-dv
   ‚à´                     mi          ‚àÇ ùúÄ
‚àí Œº  (v(n+1))2 q2e‚ü®Œ¥A (n+1)‚ü© ‚àÇFe0dv.
  0    ‚à•     me    ‚à•   Œ±  ‚àÇùúÄ
= Œº (Œ¥J ‚Ä≤(Œ¥œï (n),Œ¥A(n))+ Œ¥J‚Ä≤ (Œ¥œï(n),Œ¥A(n)))                   (165)
   0  ‚à•i        ‚à•      ||e        ‚à•
" class="math-display"  /></center>
</div>However the gyro-averaging in the blue terms can not be evaluated analytically. If evaluated
numerically using markers, the corresponding matrix will depends on markers and thus needs to be
re-constructed and inverted each time-step, which is computationally expensive. Therefore
we go back to Eq. (<a 
href="#x26-37001r162">162<!--tex4ht:ref: 19-3-21-6 --></a>) and try to solve it using iterative methods. However, it is found
numerically that directly using Eq. (<a 
href="#x26-37001r162">162<!--tex4ht:ref: 19-3-21-6 --></a>) as an iterative scheme is usually divergent. To obtain
a convergent iterative scheme, we need to have an approximate form for the blue terms,
which is independent of markers and so that it is easy to construct its matrix, and then
                                                                                

                                                                                
subtract this approximate form from both sides. After doing this, the iterative scheme has
better chance to be convergent. An approximate form is that derived by neglecting the FLR
eÔ¨Äect given in Sec. <a 
href="#x26-360005.3">5.3<!--tex4ht:ref: 19-3-21-8 --></a>. Using this, the iterative scheme for solving Eq. (<a 
href="#x26-37001r162">162<!--tex4ht:ref: 19-3-21-6 --></a>) is written as
<div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation175x.png" alt="               (                             )
‚àí ‚àá2 Œ¥A(n+1) ‚àí Œº  ‚àí q2in  Œ¥A(n+1) ‚àí q2en  Œ¥A(n+1)
   ‚ä•   ‚à•       0   mi i0  ‚à•      me  e0  ‚à•
= Œº [Œ¥J‚Ä≤(Œ¥œï(n),Œ¥A(n))+ Œ¥J‚Ä≤(Œ¥œï(n),Œ¥A (n))]
   0‚à´  ‚à•i       ‚à•       ||e        ‚à•
+ Œº   (v(n+1))2-qi2‚ü®Œ¥A(n+1)‚ü© ‚àÇFi0dv
   0   ‚à•     mi    ‚à•    Œ± ‚àÇùúÄ
    ‚à´  (n+1)2-q2e   (n+1) ‚àÇFe0
+ Œº0  (v‚à•    )me ‚ü®Œ¥A‚à•   ‚ü©Œ± ‚àÇùúÄ  dv
    (  q2            q2          )
‚àí Œº0 ‚àí -ini0Œ¥A(‚à•n+1)‚àí -e-ne0Œ¥A (n‚à•+1) .                       (166)
       mi            me
" class="math-display"  /><a 
 id="x26-37005r166"></a></center>
</div>In the drift-kinetic limit (i.e., neglecting the FLR eÔ¨Äect), the blue and red terms on the right-hand side
of the above equation cancel each other exactly. Even in this case, it is found numerically that these
terms need to be retained and the blue terms are evaluated using markers. Otherwise, numerical
inaccuracy can give numerical instabilities, which is the so-called cancellation problem. The explanation
for this is as follows. The blue terms are part of the current. The remained part of the current is
computed by using Monte-Carlo integration over markers. If the blue terms are evaluated analytically,
rather than using Monte-Carlo integration over markers, then the cancellation between this
analytical part and Monte-Carlo part can have large error (assume that there are two large
contribution that have opposite signs in the two parts) because the two parts are evaluated
using diÔ¨Äerent methods and thus have diÔ¨Äerent accuracy, which makes the cancellation less
accurate.
<!--l. 2026--><p class="noindent" >The blue terms are sometimes called ‚Äúadiabatic current‚Äù. The red terms are approximation to
the ‚Äúadiabatic current‚Äù obtained by neglecting the FLR eÔ¨Äect. Because the ion adiabatic
current is less than the electron adiabatic current by a factor of <span 
class="cmmi-10">m</span><sub><span 
class="cmmi-7">e</span></sub><span 
class="cmmi-10">‚àïm</span><sub><span 
class="cmmi-7">i</span></sub>, its accuracy is not
important, and is approximated by the drift-kinetic limit in GEM. And the cancellation error
is not a problem and hence can be neglected. In this case, equation (<a 
href="#x26-37005r166">166<!--tex4ht:ref: 19-3-21-p1 --></a>) is simpliÔ¨Åed as
</p><div class="eqnarray">
   <center class="math-display" >
                                                                                

                                                                                
<img 
src="nonlinear_gyrokinetic_equation176x.png" alt="               (                             )
‚àí ‚àá2 Œ¥A(n+1) ‚àí Œº  ‚àí q2in  Œ¥A(n+1) ‚àí q2en  Œ¥A(n+1)
   ‚ä•   ‚à•       0   mi i0  ‚à•      me  e0  ‚à•
= Œº [Œ¥J‚Ä≤(Œ¥œï(n),Œ¥A(n))+ Œ¥J‚Ä≤(Œ¥œï(n),Œ¥A (n))]
   0‚à´  ‚à•i       ‚à•       ||e        ‚à•
+ Œº   (v(n+1))2 q2e‚ü®Œ¥A(n+1)‚ü© ‚àÇFe0dv
   0    ‚à•     me   ‚à•    Œ±  ‚àÇùúÄ
    (  q2e-     (n+1))
‚àí Œº0 ‚àí me ne0Œ¥A ‚à•    .                                     (167)
" class="math-display"  /><a 
 id="x26-37006r167"></a></center>
</div>
                                                                                

                                                                                
   <!--l. 2049--><div class="crosslinks"><p class="noindent">[<a 
href="nonlinear_gyrokinetic_equationsu21.html" >next</a>] [<a 
href="nonlinear_gyrokinetic_equationsu19.html" >prev</a>] [<a 
href="nonlinear_gyrokinetic_equationsu19.html#tailnonlinear_gyrokinetic_equationsu19.html" >prev-tail</a>] [<a 
href="nonlinear_gyrokinetic_equationsu20.html" >front</a>] [<a 
href="nonlinear_gyrokinetic_equationse5.html#nonlinear_gyrokinetic_equationsu20.html" >up</a>] </p></div>
<!--l. 2049--><p class="indent" >   <a 
 id="tailnonlinear_gyrokinetic_equationsu20.html"></a>  </p> 
</body></html> 
