<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Polarization density matrix obtained by numerically integrating in phase space using
grid</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,2,charset=utf-8,html --> 
<meta name="src" content="nonlinear_gyrokinetic_equation.tex" /> 
<link rel="stylesheet" type="text/css" href="nonlinear_gyrokinetic_equation.css" /> 
</head><body 
>
   <!--l. 3294--><div class="crosslinks"><p class="noindent">[<a 
href="nonlinear_gyrokinetic_equationse9.html" >next</a>] [<a 
href="nonlinear_gyrokinetic_equationse7.html" >prev</a>] [<a 
href="nonlinear_gyrokinetic_equationse7.html#tailnonlinear_gyrokinetic_equationse7.html" >prev-tail</a>] [<a 
href="#tailnonlinear_gyrokinetic_equationse8.html">tail</a>] [<a 
href="nonlinear_gyrokinetic_equation.html#nonlinear_gyrokinetic_equationse8.html" >up</a>] </p></div>
   <h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x9-520008"></a>Polarization density matrix obtained by numerically integrating in phase space using
grid</h3>
<!--l. 3296--><p class="noindent" >In Sec. <a 
href="nonlinear_gyrokinetic_equationse7.html#x8-420007">7<!--tex4ht:ref: 21-8-22-a3 --></a>, to evaluate the polarization density, the potential <span 
class="cmmi-10">Œ¥</span>Œ¶ is Fourier expanded in space using
local Cartesian coordinates, and then the double gyro-angle integration of each harmonic is
expressed as the Bessel function. (It seems that the original motivation of using the Fourier
expansion here is to facilitate analytical treatment and is not designed for numerical use.
GEM code does make use of the local Fourier expansion in its numerical implementation,
where the local perpendicular wave number needs to be estimated numerically, which seems
awkward.)
</p><!--l. 3305--><p class="indent" >   In this section, we avoid using the local Fourier expansion, and directly express the double
gyro-angle integral as linear combination of values of <span 
class="cmmi-10">Œ¥</span>Œ¶ at spatial grid-points. The polarization density
is given by Eq. (<a 
href="nonlinear_gyrokinetic_equationse6.html#x7-40004r224">224<!--tex4ht:ref: 18-9-13-p9 --></a>), i.e.,
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-52001r265"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation318x.png" alt="          ‚à´    (               )
np(x) = q-  dv  (Œ¥Œ¶ ‚àí ‚ü®Œ¥Œ¶‚ü©Œ±)‚àÇF0 .
        m                   ‚àÇùúÄ
" class="math-display"  /></center></td><td class="equation-label">(265)</td></tr></table>
<!--l. 3313--><p class="nopar" >
Our goal is to write <span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">p</span></sub> in the following real-space discrete from:
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-52002r266"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation319x.png" alt="        ‚àë
np(xk) =    cijŒ¥Œ¶i,j.
        i,j
" class="math-display"  /></center></td><td class="equation-label">(266)</td></tr></table>
<!--l. 3317--><p class="nopar" >
</p><!--l. 3320--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.1   </span> <a 
 id="x9-530008.1"></a>Direct evaluation of the double gyrophase integration</h4>
<!--l. 3322--><p class="noindent" >DeÔ¨Åne
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-53001r267"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation320x.png" alt="         q‚à´    (      ‚àÇF0)
A(x) = ‚àím-   dv  ‚ü®Œ¥Œ¶ ‚ü©Œ± ‚àÇùúÄ-- .
" class="math-display"  /></center></td><td class="equation-label">(267)</td></tr></table>
<!--l. 3326--><p class="nopar" >
Using <span 
class="cmmi-10">d</span><span 
class="cmbx-10">v </span>= <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚ä•</span></sub><span 
class="cmmi-10">dv</span><sub><span 
class="cmsy-7">‚ä•</span></sub><span 
class="cmmi-10">dv</span><sub><span 
class="cmsy-7">‚à•</span></sub><span 
class="cmmi-10">dŒ±</span>, the above integration is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-53002r268"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation321x.png" alt="         q ‚à´ ‚àû    ‚à´ ‚àû       ‚àÇF ‚à´ 2œÄ
A (x ) = ‚àí--    dv‚à•    v‚ä•dv‚ä• --0-   dŒ± ‚ü®Œ¥Œ¶ ‚ü©Œ±,
         m  ‚àí‚àû     0        ‚àÇùúÄ  0
" class="math-display"  /></center></td><td class="equation-label">(268)</td></tr></table>
<!--l. 3333--><p class="nopar" >
where use has been made of the assumption that <span 
class="cmmi-10">‚àÇF</span><sub><span 
class="cmr-7">0</span></sub><span 
class="cmmi-10">‚àï‚àÇùúÄ </span>is uniform in <span 
class="cmmi-10">Œ± </span>in (<span 
class="cmbx-10">x</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">‚ä•</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">‚à•</span></sub><span 
class="cmmi-10">,Œ±</span>)
coordinates, and thus is moved outside of the <span 
class="cmmi-10">Œ± </span>integration. Using the deÔ¨Ånition of gyro-averaging
(2<span 
class="cmmi-10">œÄ</span>)<sup><span 
class="cmsy-7">‚àí</span><span 
class="cmr-7">1</span></sup> <span 
class="cmex-10">‚à´</span>
   <sub><span 
class="cmr-7">0</span></sub><sup><span 
class="cmr-7">2</span><span 
class="cmmi-7">œÄ</span></sup>(<span 
class="cmmi-10">‚Ä¶</span>)<span 
class="cmmi-10">dŒ±</span><span 
class="cmsy-10">‚Ä≤</span>, the above integration is written as
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-53003r269"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation322x.png" alt="           ‚à´ ‚àû    ‚à´ ‚àû          ‚à´ 2œÄ   (   ‚à´ 2œÄ     )
A(x) = ‚àí-q     dv‚à•    dv‚ä•‚àÇFi0v‚ä•    dŒ±   1--   Œ¥Œ¶dŒ± ‚Ä≤ .
        m   ‚àí‚àû     0      ‚àÇùúÄ    0       2œÄ  0
" class="math-display"  /></center></td><td class="equation-label">(269)</td></tr></table>
<!--l. 3344--><p class="nopar" >
Note that the gyro-averaging is performed in the guiding-center space, i.e., performed by varying the
gyroangle <span 
class="cmmi-10">Œ±</span><span 
class="cmsy-10">‚Ä≤ </span>while keeping guiding-center position <span 
class="cmbx-10">X</span>, <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚ä•</span></sub>, and <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚à•</span></sub> constant. Using the deÔ¨Ånition of <span 
class="cmmi-10">Œ¥</span>Œ¶<sub><span 
class="cmmi-7">g</span></sub>
(i.e., its relation with <span 
class="cmmi-10">Œ¥</span>Œ¶):
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-53004r270"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation323x.png" alt="Œ¥Œ¶g(X,Œ±‚Ä≤,v‚ä•) = Œ¥Œ¶(x),
" class="math-display"  /></center></td><td class="equation-label">(270)</td></tr></table>
<!--l. 3351--><p class="nopar" >
where the particle location <span 
class="cmbx-10">x </span>is computed from the guiding-center location by
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-53005r271"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation324x.png" alt="                        e‚à•(X )
x = X + œÅ(x,v ) ‚âà X ‚àí v√ó Œ©(X-),
" class="math-display"  /></center></td><td class="equation-label">(271)</td></tr></table>
<!--l. 3358--><p class="nopar" >
then <span 
class="cmmi-10">A</span>(<span 
class="cmbx-10">x</span>) is written as </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation325x.png" alt="A(x)  ‚à´      ‚à´             ‚à´     [   ‚à´      (                     )   ]
= ‚àí q-  ‚àû dv   ‚àû dv ‚àÇFi0v    2œÄ dŒ± -1-  2œÄŒ¥Œ¶  X ‚àí v  (v ,Œ± ‚Ä≤)√ó e‚à•(X-) dŒ± ‚Ä≤
    m  ‚àí‚àû   ‚à• 0    ‚ä• ‚àÇùúÄ  ‚ä•  0     2œÄ  0           ‚ä•  ‚ä•       Œ©(X)
      ‚à´ ‚àû    ‚à´ ‚àû           ‚à´ 2œÄ   ‚åä    N2   (                     ) ‚åã
‚âà ‚àí q-    dv‚à•    dv‚ä•‚àÇFi0v‚ä•     dŒ±‚åà 1--‚àë  Œ¥Œ¶  X ‚àí v‚ä•(v‚ä•,Œ±‚Ä≤)√ó e‚à•(X)- ‚åâ
    m  ‚àí‚àû     0      ‚àÇùúÄ     0      N2 j=1                j   Œ© (X)
" class="math-display"  /></center>
</div>where <span 
class="cmbx-10">v</span><sub><span 
class="cmsy-7">‚ä•</span></sub> = <span 
class="cmbx-10">v</span>(<span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚ä•</span></sub><span 
class="cmmi-10">,Œ±</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">‚Ä≤</span>) denotes a perpendicular velocity corresponding to a discrete gyro-angle
<span 
class="cmmi-10">Œ±</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">‚Ä≤</span>.
<!--l. 3378--><p class="indent" >   Next, in order to perform the remaining velocity space integration, transform back to the particle
coordinates (because the velocity integration is performed in the particle coordinates, i.e., it is
performed by keeping the particle coordinate <span 
class="cmbx-10">x </span>constant): </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation326x.png" alt="           ‚à´      ‚à´
        -q   ‚àû      ‚àû    ‚àÇFi0
A (x) = ‚àím   ‚àí‚àû dv‚à• 0  dv‚ä• ‚àÇùúÄ v‚ä•
  ‚à´     ‚åä    N    (                                       ) ‚åã
√ó  2œÄ dŒ±‚åà 1--‚àë2 Œ¥Œ¶  x+ v  (v  ,Œ± )√ó e‚à•(X)-‚àí v (v ,Œ±‚Ä≤)√ó e‚à•(X)- ‚åâ
   0      N2 j=1         ‚ä•  ‚ä•      Œ© (X )    ‚ä•  ‚ä•  j   Œ© (X )
      ‚à´ ‚àû    ‚à´ ‚àû
‚âà ‚àí q-    dv‚à•    dv‚ä• ‚àÇFi0-v‚ä•
    m  ‚àí‚àû‚åä     0      ‚àÇ ùúÄ                                   ‚åã
  ‚à´ 2œÄ       N‚àë2   (                                      )
√ó     dŒ±‚åà 1--   Œ¥Œ¶  x+ v‚ä• (v‚ä•,Œ± )√ó e‚à•(x)‚àí v‚ä•(v‚ä•,Œ±‚Ä≤j)√ó  e‚à•(x)- ‚åâ
   0      N2 j=1                   Œ© (x)               Œ©(x)
    q ‚à´ ‚àû    ‚à´ ‚àû     ‚àÇF
‚âà ‚àí --    dv‚à•    dv‚ä• --i0-v‚ä•
    m  ‚àí‚àû     0  (   ‚àÇ ùúÄ                                )
  2œÄ-N‚àë1 -1-N‚àë2                    e‚à•(x)         ‚Ä≤    e‚à•(x)-
√ó N1    N2    Œ¥Œ¶  x + v‚ä•(v‚ä•,Œ±i)√ó Œ© (x) ‚àí v‚ä•(v‚ä•,Œ±j)√ó  Œ©(x)  .     (272)
     i=1    j=1
" class="math-display"  /><a 
 id="x9-53007r272"></a></center>
</div>For notation ease, deÔ¨Åne
                                                                                

                                                                                
   <table 
class="equation"><tr><td><a 
 id="x9-53008r273"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation327x.png" alt="                  e‚à•(x)-         ‚Ä≤   e‚à•(x)
ŒîœÅij = v‚ä• (v‚ä•,Œ±i)√ó Œ©(x) ‚àí v‚ä•(v‚ä•,Œ±j)√ó Œ© (x),
" class="math-display"  /></center></td><td class="equation-label">(273)</td></tr></table>
<!--l. 3418--><p class="nopar" >
where Œî<span 
class="cmmi-10">œÅ</span><sub><span 
class="cmmi-7">ij</span></sub> is a function of (<span 
class="cmbx-10">x</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">‚ä•</span></sub><span 
class="cmmi-10">,Œ±</span><sub><span 
class="cmmi-7">i</span></sub><span 
class="cmmi-10">,Œ±</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">‚Ä≤</span>). Then Eq. (<a 
href="#x9-53007r272">272<!--tex4ht:ref: 21-9-16-a4 --></a>) is written as </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation328x.png" alt="           q ‚à´ ‚àû    ‚à´ ‚àû    ‚àÇFi0   2œÄ N‚àë1  1 N‚àë2
A(x) =   ‚àí m-    dv‚à•    dv‚ä•-‚àÇùúÄ-v‚ä• N1-   N2-   Œ¥Œ¶(x + ŒîœÅij).      (274)
              ‚àí‚àû     0               i=1    j=1
" class="math-display"  /><a 
 id="x9-53009r274"></a></center>
</div>The guiding-center transform and its inverse involved in the above are illustrated in Fig. <a 
href="#x9-530112">2<!--tex4ht:ref: 21-8-22-a1 --></a>.
Then the double gyro-angle integral appearing in the polarization density is approximated
as
   <table 
class="equation"><tr><td><a 
 id="x9-53010r275"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation329x.png" alt="‚à´     ( ‚à´          )         N1 N2
 2œÄ dŒ±   2œÄ Œ¥Œ¶ (x)dŒ± ‚Ä≤ ‚âà -(2œÄ)2 ‚àë  ‚àë  Œ¥Œ¶(x ),
 0       0             N1N2  i=1 j=1    ij
" class="math-display"  /></center></td><td class="equation-label">(275)</td></tr></table>
<!--l. 3437--><p class="nopar" >
where <span 
class="cmmi-10">N</span><sub><span 
class="cmr-7">1</span></sub> = 4<span 
class="cmmi-10">,N</span><sub><span 
class="cmr-7">2</span></sub> = 4 for the case shown in Fig. <a 
href="#x9-530112">2<!--tex4ht:ref: 21-8-22-a1 --></a>. This gives how to approximate the double
gyro-angle integration using the discrete values of <span 
class="cmmi-10">Œ¥</span>Œ¶<sub><span 
class="cmmi-7">ij</span></sub>. The spatial points <span 
class="cmbx-10">x</span><sub><span 
class="cmmi-7">ij</span></sub> appearing in Eq. (<a 
href="#x9-53010r275">275<!--tex4ht:ref: 21-9-2-a1 --></a>)
are not necessarily grid points. Linear interpolations are used to express <span 
class="cmmi-10">Œ¥</span>Œ¶(<span 
class="cmbx-10">x</span><sub><span 
class="cmmi-7">ij</span></sub>) as linear combination
                                                                                

                                                                                
of values of <span 
class="cmmi-10">Œ¥</span>Œ¶ at grid-points.
</p><!--l. 3445--><p class="indent" >   ¬†
</p><!--l. 3447--><p class="indent" >   ¬†
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                

                                                                                
<a 
 id="x9-530112"></a>
                                                                                

                                                                                
<!--l. 3450--><p class="noindent" > <img 
src="nonlinear_gyrokinetic_equation-1-.png" alt="PIC"  
 />
<br /> </p><div class="caption" 
><span class="id">Figure¬†2:  </span><span  
class="content">Given  a  <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚ä•</span></sub>,  then  the  double  gyro-angle  integration  in  Eq.  (<a 
href="#x9-53003r269">269<!--tex4ht:ref: 21-8-22-e1 --></a>)  at  a  particle
location  <span 
class="cmbx-10">x  </span>is  evaluated  by  the  following  steps:  Use  the  guiding  center  transform  to  get
guiding-center locations (four locations are shown in this case, namely <span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">i</span></sub> with <span 
class="cmmi-10">i </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span>3<span 
class="cmmi-10">,</span>4,
corresponding gyro-angle <span 
class="cmmi-10">Œ±</span><sub><span 
class="cmmi-7">i</span></sub> with <span 
class="cmmi-10">i </span>=  1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span>3<span 
class="cmmi-10">,</span>4; 2.) For each guiding-center location, use the
inverse guiding-center transform to calculate points on the corresponding gyro-ring (four points
are shown for each guiding-center <span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">i</span></sub> in this case, namely <span 
class="cmbx-10">x</span><sub><span 
class="cmmi-7">ij</span></sub> with <span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span>3<span 
class="cmmi-10">,</span>4, corresponding
gyro angle <span 
class="cmmi-10">Œ±</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">‚Ä≤ </span>with <span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span>2<span 
class="cmmi-10">,</span>3<span 
class="cmmi-10">,</span>4.)</span></div><!--tex4ht:label?: x9-530112 -->
                                                                                

                                                                                
   </div><hr class="endfigure" />
<!--l. 3463--><p class="indent" >   ¬†
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.2   </span> <a 
 id="x9-540008.2"></a>Performing the parallel velocity integration</h4>
<!--l. 3467--><p class="noindent" >Assume that <span 
class="cmmi-10">F</span><sub><span 
class="cmr-7">0</span></sub> is Maxwellian, then
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-54001r276"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation330x.png" alt="                                ( ‚àí mv2 )   (     2)
‚àÇF0-= ‚àí mfM  = ‚àí m----n0--3‚àï2 exp  ----‚à•- exp  ‚àí mv-‚ä• .
‚àÇ ùúÄ     T       T (2œÄT ‚àïm)         2T          2T
" class="math-display"  /></center></td><td class="equation-label">(276)</td></tr></table>
<!--l. 3473--><p class="nopar" >
Note that Œî<span 
class="cmmi-10">œÅ</span><sub><span 
class="cmmi-7">ij</span></sub> is independent of <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚à•</span></sub>. Then the integration over <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚à•</span></sub> in Eq. (<a 
href="#x9-53009r274">274<!--tex4ht:ref: 22-11-8-1 --></a>) can be analytically
performed, yielding
</p>
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation331x.png" alt="           ‚à´ ‚àû        (  -2) ‚à´ ‚àû                (  -2 )
A(x)  =  q-    dv‚à• exp  ‚àí-v‚à•      dv‚ä•v‚ä•--n0-- exp  ‚àív‚ä•-
         T  ‚àí‚àû           2    0       (2œÄ)3‚àï2      2
            ‚àëN1   ‚àëN2
      √ó  2œÄ-   -1-   Œ¥Œ¶ (x + Œî œÅij)
         N1 i=1N2 j=1
           ‚à´ ‚àû          (  -2 )    N1    N2
      =  n0    dv‚ä•v‚ä• exp  ‚àív‚ä•-  -1-‚àë  -1-‚àë  q-Œ¥Œ¶(x+ Œî œÅij).      (277)
            0              2    N1 i=1 N2 j=1T
" class="math-display"  /><a 
 id="x9-54002r277"></a></center>
</div>where <span class="overline"><span 
class="cmmi-10">v</span></span><sub><span 
class="cmsy-7">‚à•</span></sub> = <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚à•</span></sub><span 
class="cmmi-10">‚àïv</span><sub><span 
class="cmmi-7">t</span></sub>, <span class="overline"><span 
class="cmmi-10">v</span></span><sub><span 
class="cmsy-7">‚ä•</span></sub> = <span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">‚ä•</span></sub><span 
class="cmmi-10">‚àïv</span><sub><span 
class="cmmi-7">t</span></sub>, ¬†<span 
class="cmmi-10">v</span><sub><span 
class="cmmi-7">t</span></sub> = <img 
src="nonlinear_gyrokinetic_equation332x.png" alt="‚àòT-‚àïm-"  class="sqrt"  />, and use has been made of
   <table 
class="equation"><tr><td><a 
 id="x9-54003r278"></a>
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation333x.png" alt="‚à´ ‚àû    (    2)     ‚àö ---
    exp  ‚àí x- dx =   2œÄ.
 ‚àí‚àû        2
" class="math-display"  /></center></td><td class="equation-label">(278)</td></tr></table>
<!--l. 3497--><p class="nopar" >
</p><!--l. 3499--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.3   </span> <a 
 id="x9-550008.3"></a>Toroidal DFT of polarization density in Ô¨Åeld-aligned coordinates</h4>
<!--l. 3501--><p class="noindent" >In Ô¨Åeld-aligned coordinates (<span 
class="cmmi-10">x,y,z</span>), Fourier expansion of <span 
class="cmmi-10">Œ¥</span>Œ¶ along <span 
class="cmmi-10">y </span>is written
</p>
   <table 
class="equation"><tr><td><a 
 id="x9-55001r279"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation334x.png" alt="         Ny‚àë‚àï2     (   2œÄ )
Œ¥Œ¶ (x) ‚âà        exp  Œπn L-y  Œ¥Œ¶n(x,z),
        n=‚àíNy‚àï2        y
" class="math-display"  /></center></td><td class="equation-label">(279)</td></tr></table>
<!--l. 3506--><p class="nopar" >
where <span 
class="cmmi-10">Œπ </span>= <img 
src="nonlinear_gyrokinetic_equation335x.png" alt="‚àö ---
  ‚àí 1"  class="sqrt"  />. Use this in Eq. (<a 
href="#x9-54002r277">277<!--tex4ht:ref: 21-9-16-a5 --></a>), yielding </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation336x.png" alt="            ‚à´            (  -  )
A (x) =   n   ‚àû dv v  exp  ‚àív2‚ä•-
           0 0    ‚ä• ‚ä•       2
             N‚àë1    ‚àëN2‚åä    Ny‚àë‚àï2     (               )                      ‚åã
      √ó   -1-   -1-   ‚åà q-       exp  Œπn 2œÄ(y+ Œî œÅijy) Œ¥Œ¶n (x + ŒîœÅijx,z + ŒîœÅijz)‚åâ
          N1 i=1N2 j=1  T n=‚àíNy‚àï2       Ly
            Nt‚àï2     (      )   ‚à´            (  - )
            ‚àë           2œÄ-      ‚àû  - -      ‚àí-v2‚ä•
      =          exp  Œπn Lyy  n0 0  dv‚ä•v‚ä• exp    2
          n=‚àíNy‚àï2
          -1-N‚àë1 -1-‚àëN2[    (  2œÄ-    ) q-                      ]
      √ó   N1    N2     exp  ŒπnLyŒî œÅijy  T Œ¥Œ¶n(x+ Œî œÅijx,z + Œî œÅijz) .        (280)
             i=1   j=1
" class="math-display"  /><a 
 id="x9-55002r280"></a></center>
</div>From Eq. (<a 
href="#x9-55002r280">280<!--tex4ht:ref: 21-9-16-a1 --></a>), the Fourier expansion coeÔ¨Écient of <span 
class="cmmi-10">A</span>(<span 
class="cmbx-10">x</span>) can be identiÔ¨Åed: <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation337x.png" alt="               ‚à´ ‚àû  - -     (‚àí v2)
An (x,z)  =  n0     dv‚ä•v‚ä•exp  ---‚ä•
                0        [   ( 2        )                        ]
             1--N‚àë1 -1-N‚àë2         2œÄ-      q-
         √ó   N1    N2     exp Œπn LyŒî œÅijy  TŒ¥Œ¶n (x + ŒîœÅijx,z + ŒîœÅijz) .  (281)
                i=1    j=1
" class="math-display"  /><a 
 id="x9-55003r281"></a></center>
</div>Let us make the following approximation
   <table 
class="equation"><tr><td><a 
 id="x9-55004r282"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation338x.png" alt="Œ¥Œ¶n(x+ Œî œÅijx,z + Œî œÅijz) ‚âà Œ¥Œ¶n(x + ŒîœÅijx,z),
" class="math-display"  /></center></td><td class="equation-label">(282)</td></tr></table>
<!--l. 3540--><p class="nopar" >
which should be a good approximation since the variation of <span 
class="cmmi-10">Œ¥</span>Œ¶ along a Ô¨Åeld line over a distance of a
Larmor radius is small. Then expression (<a 
href="#x9-55003r281">281<!--tex4ht:ref: 22-12-21-1 --></a>) is written as </p><div class="eqnarray">
                                                                                

                                                                                
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation339x.png" alt="            ‚à´ ‚àû  - -     (‚àí v2)
An(x,z) ‚âà n0    dv‚ä•v‚ä•exp  ---‚ä•
             0[   (         2)                 ]
  1--N‚àë1 -1-N‚àë2         2œÄ-      q-
√ó N1    N2     exp  Œπn LyŒî œÅijy  TŒ¥Œ¶n (x + ŒîœÅijx,z)  .        (283)
     i=1    j=1
" class="math-display"  /></center>
</div>The approximation (<a 
href="#x9-55004r282">282<!--tex4ht:ref: 22-12-21-3 --></a>) makes the operator <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">n</span></sub> on <span 
class="cmmi-10">Œ¥</span>Œ¶<sub><span 
class="cmmi-7">n</span></sub> become local in <span 
class="cmmi-10">z </span>direction, i.e., it involves
<span 
class="cmmi-10">Œ¥</span>Œ¶<sub><span 
class="cmmi-7">n</span></sub> at locations with a Ô¨Åxed value of <span 
class="cmmi-10">z</span>. This makes <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">n</span></sub>(<span 
class="cmmi-10">x,z</span>) reduce to a 1D operator on <span 
class="cmmi-10">Œ¥</span>Œ¶<sub><span 
class="cmmi-7">n</span></sub> in the <span 
class="cmmi-10">x</span>
direction.
<!--l. 3557--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">8.4   </span> <a 
 id="x9-560008.4"></a>Using MC integration, to be continued, not necessary</h4>
<!--l. 3559--><p class="noindent" >The integration we try to express is given by </p><div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation340x.png" alt="             ‚à´
Aijk  ‚âà  -1--    dxnp (x )
         Vijk‚à´Vijk   ‚à´    (                 )
         -1--             -q           ‚àÇF0-
      =  Vijk Vijk dx  dv  m (Œ¥Œ¶ ‚àí ‚ü®Œ¥Œ¶ ‚ü©Œ±) ‚àÇùúÄ   ,            (284)
" class="math-display"  /></center>
</div>where <span 
class="cmmi-10">A</span><sub><span 
class="cmmi-7">ijk</span></sub> is the value of <span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">p</span></sub>(<span 
class="cmbx-10">x</span>) at a grid-point, which is approximated by the spatial averaging of
<span 
class="cmmi-10">n</span><sub><span 
class="cmmi-7">p</span></sub>(<span 
class="cmbx-10">x</span>) over the cell whose center is the grid-point, <span 
class="cmmi-10">V</span> <sub><span 
class="cmmi-7">ijk</span></sub> is the volume of the cell. We will use
Monte-Carlo guiding-center markers to compute the above cell average. <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation341x.png" alt="                      (           )
A(1) =   ‚àí-q--1-‚àë  ‚àë    ‚ü®Œ¥Œ¶ ‚ü© ‚àÇF0-1
 ijk       m Vijk p  Œ±       Œ± ‚àÇùúÄ g
                ‚àë       ‚àë  (      )
     =   ‚àí-q--1-   ‚ü®Œ¥Œ¶‚ü©Œ±     ‚àÇF0-1
          m Vijk p       Œ±    ‚àÇùúÄ g
" class="math-display"  /></center>
</div>Nearest neighbour interpolation
   <div class="eqnarray">
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation342x.png" alt="                 ‚àë  ‚àë  (        )
A(2)  =  ‚àí q--1--       Œ¥Œ¶ ‚àÇF01
 ijk       m Vijk  p  Œ±     ‚àÇùúÄ g
           q Œ¥Œ¶   ‚àë  ‚àë  ( ‚àÇF 1)
      =  ‚àí ----ijk-        --0-
           m Vijk  p  Œ±   ‚àÇùúÄ g
" class="math-display"  /></center>
</div>Later, I found that evaluating the polarization density using grid works well. Therefore there is no need
to evaluate it using MC markers, which is more complicated.
                                                                                

                                                                                
   <!--l. 3594--><div class="crosslinks"><p class="noindent">[<a 
href="nonlinear_gyrokinetic_equationse9.html" >next</a>] [<a 
href="nonlinear_gyrokinetic_equationse7.html" >prev</a>] [<a 
href="nonlinear_gyrokinetic_equationse7.html#tailnonlinear_gyrokinetic_equationse7.html" >prev-tail</a>] [<a 
href="nonlinear_gyrokinetic_equationse8.html" >front</a>] [<a 
href="nonlinear_gyrokinetic_equation.html#nonlinear_gyrokinetic_equationse8.html" >up</a>] </p></div>
<!--l. 3594--><p class="indent" >   <a 
 id="tailnonlinear_gyrokinetic_equationse8.html"></a>  </p> 
</body></html> 
