<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>Numerical evaluation of distribution function moments at grids</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,4,charset=utf-8,html --> 
<meta name="src" content="nonlinear_gyrokinetic_equation.tex" /> 
<link rel="stylesheet" type="text/css" href="nonlinear_gyrokinetic_equation.css" /> 
</head><body 
>
   <!--l. 3176--><div class="crosslinks"><p class="noindent"><span 
class="ecrm-1000">[</span><a 
href="nonlinear_gyrokinetic_equationsu29.html" ><span 
class="ecrm-1000">next</span></a><span 
class="ecrm-1000">] [</span><a 
href="nonlinear_gyrokinetic_equationsu27.html" ><span 
class="ecrm-1000">prev</span></a><span 
class="ecrm-1000">] [</span><a 
href="nonlinear_gyrokinetic_equationsu27.html#tailnonlinear_gyrokinetic_equationsu27.html" ><span 
class="ecrm-1000">prev-tail</span></a><span 
class="ecrm-1000">] [</span><a 
href="#tailnonlinear_gyrokinetic_equationsu28.html"><span 
class="ecrm-1000">tail</span></a><span 
class="ecrm-1000">] [</span><a 
href="nonlinear_gyrokinetic_equationse9.html#nonlinear_gyrokinetic_equationsu28.html" ><span 
class="ecrm-1000">up</span></a><span 
class="ecrm-1000">] </span></p></div>
   <h4 class="subsectionHead"><span class="titlemark"><span 
class="ecrm-1000">C.2   </span></span> <a 
 id="x38-58000C.2"></a><span 
class="ecrm-1000">Numerical evaluation of distribution function moments at grids</span></h4>
<!--l. 3178--><p class="noindent" ><span 
class="ecrm-1000">Consider the evaluation of integral (</span><a 
href="nonlinear_gyrokinetic_equationsu27.html#x37-57003r260"><span 
class="ecrm-1000">260</span><!--tex4ht:ref: 19-1-19-p1 --></a><span 
class="ecrm-1000">). Actually evaluated in PIC simulation is the average of </span><span 
class="cmmi-10">n</span>(<span 
class="cmbx-10">x</span>) <span 
class="ecrm-1000">in</span>
<span 
class="ecrm-1000">a spatial cell, i.e.,</span>
</p>
   <table 
class="equation"><tr><td><a 
 id="x38-58001r261"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation290x.png" alt="         1  ∫    ( ∫ ∫                         )
ni,j,k = -----           fg(X,v)δ3(X  − x + ρ)dvdX dx,
       Vi,j,k  Ωi,j,k
" class="math-display"  /></center></td><td class="equation-label">(261)</td></tr></table>
<!--l. 3185--><p class="nopar" >
<span 
class="ecrm-1000">where </span><span 
class="cmmi-10">Ω</span><sub><span 
class="cmmi-7">i,j,k</span></sub> <span 
class="ecrm-1000">is a spatial cell and </span><span 
class="cmmi-10">V</span> <sub><span 
class="cmmi-7">i,j,k</span></sub> <span 
class="ecrm-1000">is its volume.</span>
</p><!--l. 3188--><p class="indent" >   <span 
class="ecrm-1000">In PIC simulations, integral (</span><a 
href="#x38-58001r261"><span 
class="ecrm-1000">261</span><!--tex4ht:ref: 19-3-23-1 --></a><span 
class="ecrm-1000">) is evaluated by using Monte-Carlo markers. Thinking in terms of</span>
<span 
class="ecrm-1000">full orbit particle simulation, we load an assemble of particles in the phase space </span>(<span 
class="cmbx-10">x</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>)<span 
class="ecrm-1000">. Then we</span>
<span 
class="ecrm-1000">know the phase-space volume occupied by each marker, which is assumed to be constant in time for</span>
<span 
class="ecrm-1000">each marker. For a marker with coordinates </span>(<span 
class="cmbx-10">x</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmmi-7">j</span></sub>)<span 
class="ecrm-1000">, we can calculate the guiding-center</span>
<span 
class="ecrm-1000">position </span><span 
class="cmbx-10">X </span><span 
class="ecrm-1000">of each marker by using Eq. (</span><a 
href="nonlinear_gyrokinetic_equationsu3.html#x6-5001r19"><span 
class="ecrm-1000">19</span><!--tex4ht:ref: 16-9-21-1 --></a><span 
class="ecrm-1000">). This is done for only once at the initialization stage of the</span>
<span 
class="ecrm-1000">simulation. Most codes directly set guiding-center localtion </span><span 
class="cmbx-10">X</span><span 
class="ecrm-1000">, then the transformation is not needed,</span>
<span 
class="ecrm-1000">but I prefer the former method because particle coordinates are physical and guiding-center coodrinates</span>
<span 
class="cmbx-10">X </span><span 
class="ecrm-1000">are only imaginary and auxiliary. Update: However, directly sampling particle position, rather than</span>
<span 
class="ecrm-1000">guiding-center position, is not practical because we need to load a distribution function that is</span>
<span 
class="ecrm-1000">independent of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">in </span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>) <span 
class="ecrm-1000">coordinates and this is hard to achieve if we directly sample</span>
(<span 
class="cmbx-10">x</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>)<span 
class="ecrm-1000">.</span>
</p><!--l. 3206--><p class="indent" >   <span 
class="ecrm-1000">Then </span>(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub>) <span 
class="ecrm-1000">can be evolved by using the guiding-center motion equation. But</span>
<span 
class="ecrm-1000">how does the gyro-angle </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">evolves with time? We do not have an equation for the time</span>
<span 
class="ecrm-1000">evolution of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">. The evolution can be calculated by using the local gyro-frequency if we</span>
<span 
class="ecrm-1000">want them. Do we need the gyro angle? Yes, we do. The gyro-angle </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">is needed in the</span>
<span 
class="ecrm-1000">inverse guiding-center transform when depositing particle weight to grids. But it turns out</span>
<span 
class="ecrm-1000">tracking the evolution of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">of a marker is not necessary for PIC simulations because the</span>
<span 
class="ecrm-1000">density and current needed in gyrokinetic particle simulations are those averaged over a</span>
<span 
class="ecrm-1000">gyro-period and during this time interval the gyro-angle of a mark has taken all the possible</span>
<span 
class="ecrm-1000">values.</span>
</p><!--l. 3218--><p class="indent" >   <span 
class="ecrm-1000">Assume that we load markers in </span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>) <span 
class="ecrm-1000">with uniform random distribution in the gyro-angle.</span>
<span 
class="ecrm-1000">The gyro-angle of each marker evolves on a very fast time-scale and at later time the distribution in</span>
<span 
class="ecrm-1000">gyro-angle should be still uniform. There is no need to follow the time evolution of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">of each marker</span>
                                                                                

                                                                                
<span 
class="ecrm-1000">because any set of random samplings of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">are similar to each other in terms of evaluating Monte-Carlo</span>
<span 
class="ecrm-1000">integration. When doing the deposition, the coresponding particle location is calculated by</span>
<span 
class="ecrm-1000">using an arbitrary gyro-angle, which is of cource not the correct value of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">taken by that</span>
<span 
class="ecrm-1000">marker at that particular time since we do not follow the time evolution of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">and thus the</span>
<span 
class="ecrm-1000">correct value is not available to us. As a result, the particle location calculated by using the</span>
<span 
class="ecrm-1000">incorrect gyro-angle is also incorrect. However, statistically, this phase error of particle location</span>
<span 
class="ecrm-1000">does not matter in terms of evaluating the Monte-Carlo integral because the phase error</span>
<span 
class="ecrm-1000">will cancell each other when summing over particles. (Wrong! no reason to believe that</span>
<span 
class="ecrm-1000">the error will cancel each other) Statistically, we still obtain consistent estimation of the</span>
<span 
class="ecrm-1000">integral. To further reduce the possible error, we select several (rather than just one) possible</span>
<span 
class="ecrm-1000">gyro-angles for each marker and average all these over all markers, yeilding more accurate</span>
<span 
class="ecrm-1000">estimation.</span>
</p><!--l. 3238--><p class="indent" >   <span 
class="ecrm-1000">Another way to understand the gyrokinetic simulation is that the density calculated in</span>
<span 
class="ecrm-1000">simulations can be considered as the time average of integral (</span><a 
href="#x38-58001r261"><span 
class="ecrm-1000">261</span><!--tex4ht:ref: 19-3-23-1 --></a><span 
class="ecrm-1000">) over one typical gyro-period,</span>
<span 
class="ecrm-1000">i.e.,</span>
</p>
   <table 
class="equation"><tr><td><a 
 id="x38-58002r262"></a>
   <center class="math-display" >
<img 
src="nonlinear_gyrokinetic_equation291x.png" alt="                                             (                            )
--     -1∫ tn+δt        -1 ∫ tn+δt -1--∫      ∫ ∫          3
ni,j,k = δt t    dtni,j,k = δt t    dtVi,j,k  Ω         fg(X, v)δ(X − x + ρ)dvdX  dx,
           n                n             i,j,k
" class="math-display"  /></center></td><td class="equation-label">(262)</td></tr></table>
<!--l. 3247--><p class="nopar" >
<span 
class="ecrm-1000">where </span><span 
class="cmmi-10">δt </span><span 
class="ecrm-1000">is a typical gyro-period. In this small time inteval, marker’s </span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub>) <span 
class="ecrm-1000">can be considered to</span>
<span 
class="ecrm-1000">be constant and only </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">changes. Then the time average is equivalent to an average over the gyro-angle.</span>
<span 
class="ecrm-1000">The four point averaging in gyrokinetic simulations can be considered as the time descretization of this</span>
<span 
class="ecrm-1000">time averaging.</span>
</p><!--l. 3255--><p class="indent" >   <span 
class="ecrm-1000">Another way of understanding the four point gyro-averaging is that we do 4 separate sampling of</span>
<span 
class="ecrm-1000">the phase space and then average the each estimation to get a bettter estimation.</span>
</p><!--l. 3259--><p class="indent" >   <span 
class="ecrm-1000"> </span>
</p><!--l. 3261--><p class="indent" >   <span 
class="ecrm-1000">For a marker with coordinators </span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>)<span 
class="ecrm-1000">, where </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">is the gyro-angle, the corresponding particle</span>
<span 
class="ecrm-1000">position can be calculated by using the inverse guiding-center transformation (</span><a 
href="nonlinear_gyrokinetic_equationsu3.html#x6-5003r21"><span 
class="ecrm-1000">21</span><!--tex4ht:ref: 19-1-19-p2 --></a><span 
class="ecrm-1000">). Then we can deposit</span>
<span 
class="ecrm-1000">the marker weight to grids in the same way that we do in conventional PIC simulations. Looping over</span>
<span 
class="ecrm-1000">all markers, we build the particle density at grids.</span>
</p><!--l. 3268--><p class="indent" >   <span 
class="ecrm-1000"> </span>
</p><!--l. 3270--><p class="indent" >   <span 
class="ecrm-1000">Compared with conventional PIC methods, where particle positions are directly sampled, what is</span>
<span 
class="ecrm-1000">the beniﬁt of sampling guiding-center positions and then transform them back to the particle positions?</span>
<span 
class="ecrm-1000">More computations are involved since we need to numerically perform the inverse guiding-center</span>
<span 
class="ecrm-1000">transformation.</span>
</p><!--l. 3276--><p class="indent" >   <span 
class="ecrm-1000"> </span>
                                                                                

                                                                                
</p><!--l. 3278--><p class="indent" >   <span 
class="ecrm-1000">**to be clean up***The answer lies in the important fact that the distribution function</span>
<span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>) <span 
class="ecrm-1000">that needs to be numerically evolved in gyrokinetic simulation is actually independent</span>
<span 
class="ecrm-1000">of the gyro-angle </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">. Furthermore, we use a probability density function </span><span 
class="cmmi-10">P </span><span 
class="ecrm-1000">that is independent of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">to</span>
<span 
class="ecrm-1000">sample the 6D phase space </span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>)<span 
class="ecrm-1000">. Then the marker weight </span><span 
class="cmmi-10">w </span><span 
class="cmsy-10">≡ </span><span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">P</span>) <span 
class="ecrm-1000">is independent of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">,</span>
<span 
class="ecrm-1000">where </span><span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">p</span></sub> <span 
class="ecrm-1000">is number of markers loaded.</span>
</p><!--l. 3287--><p class="indent" >   <span 
class="ecrm-1000">Suppose we have a concrete sampling of </span><span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub> <span 
class="ecrm-1000">in the 6D phase-space </span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>)<span 
class="ecrm-1000">, i.e.,</span>
(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,w</span><sub><span 
class="cmmi-7">j</span></sub>) <span 
class="ecrm-1000">with </span><span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="ecrm-1000">, then we can do the inverse guiding-center transform and then</span>
<span 
class="ecrm-1000">deposit particles to the grids to obtain a moment (e.g. density).</span>
</p><!--l. 3293--><p class="indent" >   <span 
class="ecrm-1000">Since </span><span 
class="cmmi-10">P</span><span 
class="cmsy-10">𝒥</span><sub><span 
class="cmmi-7">rv</span></sub><span 
class="ecrm-1000">, where </span><span 
class="cmsy-10">𝒥</span><sub><span 
class="cmmi-7">rv</span></sub> = <span 
class="cmsy-10">𝒥</span><sub><span 
class="cmmi-7">r</span></sub><span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">⊥</span></sub> <span 
class="ecrm-1000">is the Jacobian of </span>(<span 
class="cmbx-10">X</span><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span></sub><span 
class="cmmi-10">,α</span>)<span 
class="ecrm-1000">, is independent of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">,</span>
<span 
class="ecrm-1000">the sampling </span><span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="ecrm-1000">with </span><span 
class="cmmi-10">j </span>= 0<span 
class="cmmi-10">,</span>1<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N</span><sub><span 
class="cmmi-7">p</span></sub> <span 
class="ecrm-1000">are uniform distributed random numbers. Therefore</span>
<span 
class="ecrm-1000">we can generate another sampling of </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">(denoted by </span><span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′ </span><span 
class="ecrm-1000">with </span><span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="ecrm-1000">) using random</span>
<span 
class="ecrm-1000">number generators and combine </span><span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′ </span><span 
class="ecrm-1000">with the old sampling </span>(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub>) <span 
class="ecrm-1000">to obtain a new</span>
<span 
class="ecrm-1000">sampling </span>(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′</span><span 
class="cmmi-10">,w</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′</span>)<span 
class="ecrm-1000">. </span><span 
class="ecrm-1000"> The values of </span><span 
class="cmmi-10">w </span><span 
class="ecrm-1000">at the new sampling points are equal to</span>
<span 
class="ecrm-1000">the original values, i.e., </span><span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′ </span>= <span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="ecrm-1000">since the particle weight </span><span 
class="cmmi-10">w </span>= <span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">P</span>) <span 
class="ecrm-1000">is independent</span>
<span 
class="ecrm-1000">of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">. </span><span 
class="ecrm-1000"> Using the new sampling and following the same procedures given above, we can</span>
<span 
class="ecrm-1000">estimate values of the moment at grids again, which will diﬀer from the estimation obtained</span>
<span 
class="ecrm-1000">using the old sampling. Taking the average of the two estimations will give a more accurate</span>
<span 
class="ecrm-1000">estimation.</span>
</p><!--l. 3308--><p class="indent" >   <span 
class="ecrm-1000">Note that even if </span><span 
class="cmmi-10">P</span><span 
class="cmsy-10">𝒥</span><sub><span 
class="cmmi-7">rv</span></sub> <span 
class="ecrm-1000">is dependent on </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">due to the possible dependence of </span><span 
class="cmsy-10">𝒥</span><sub><span 
class="cmmi-7">rv</span></sub> <span 
class="ecrm-1000">on </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">, we still can</span>
<span 
class="ecrm-1000">easily generate a new set of sampling which diﬀeres from the old sampling only in </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">, i.e.,</span>
(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′</span>)<span 
class="ecrm-1000">. Speciﬁcally, in the rejection method, we use the old sampling </span>(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub>) <span 
class="ecrm-1000">for each</span>
<span 
class="ecrm-1000">reject step and only adjust </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">to satisfy the acceptance criteria.</span>
</p><!--l. 3316--><p class="indent" >   <span 
class="ecrm-1000">The independence of </span><span 
class="cmmi-10">P </span><span 
class="ecrm-1000">on </span><span 
class="cmmi-10">α </span><span 
class="ecrm-1000">is the essential thing, because the combination </span>(<span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub><span 
class="cmmi-10">∕P</span>) <span 
class="ecrm-1000">must be</span>
<span 
class="ecrm-1000">independent of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">, where </span><span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub> <span 
class="ecrm-1000">is already independent of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">.</span>
</p><!--l. 3320--><p class="indent" >   <span 
class="ecrm-1000">We can also construct a new sampling by replacing </span><span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">j</span></sub> <span 
class="ecrm-1000">by </span><span 
class="cmmi-10">α</span><sub><span 
class="cmmi-7">j</span></sub> + <span 
class="cmmi-10">Δ</span><span 
class="ecrm-1000">, where </span><span 
class="cmmi-10">Δ </span><span 
class="ecrm-1000">is a constant.</span>
<span 
class="ecrm-1000">Then the new sampling is given by </span>(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmmi-7">j</span></sub> + <span 
class="cmmi-10">Δ,w</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′</span>) <span 
class="ecrm-1000">with </span><span 
class="cmmi-10">j </span>= 1<span 
class="cmmi-10">,</span><span 
class="cmmi-10">…</span><span 
class="cmmi-10">,N</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="ecrm-1000">. Since the</span>
<span 
class="ecrm-1000">original sampling probability function </span><span 
class="cmmi-10">P</span><span 
class="cmsy-10">𝒥</span><sub><span 
class="cmmi-7">r</span></sub><span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">⊥</span></sub> <span 
class="ecrm-1000">is independent of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">, then </span>(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,α</span><sub><span 
class="cmmi-7">j</span></sub> + <span 
class="cmmi-10">Δ</span>)
<span 
class="ecrm-1000">is still a consistent sampling that can be generated by the original probability function</span>
<span 
class="cmmi-10">P</span><span 
class="cmsy-10">𝒥</span><sub><span 
class="cmmi-7">r</span></sub><span 
class="cmmi-10">v</span><sub><span 
class="cmsy-7">⊥</span></sub><span 
class="ecrm-1000">. Furthermore, since the particle weight </span><span 
class="cmmi-10">w </span>= <span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">P</span>) <span 
class="ecrm-1000">is independent of </span><span 
class="cmmi-10">α</span><span 
class="ecrm-1000">, we</span>
<span 
class="ecrm-1000">infer that the values of </span><span 
class="cmmi-10">w </span><span 
class="ecrm-1000">at the new sampling points are equal to the original values, i.e.,</span>
<span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmsy-10">′ </span>= <span 
class="cmmi-10">w</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="ecrm-1000">.</span>
</p><!--l. 3331--><p class="indent" >   <span 
class="ecrm-1000"> </span>
</p><!--l. 3333--><p class="indent" >   <span 
class="ecrm-1000">In doing the deposition, each marker has a single gyro-angle (this is the result from the</span>
<span 
class="ecrm-1000">guiding-center transformation, where the gyro-angle must be determined before we can transform a</span>
<span 
class="ecrm-1000">particl location to a guiding-center location). Due to the independence of the weight </span>(<span 
class="cmmi-10">w </span>= <span 
class="cmmi-10">f</span><sub><span 
class="cmmi-7">g</span></sub><span 
class="cmmi-10">∕</span>(<span 
class="cmmi-10">N</span><sub><span 
class="cmmi-7">p</span></sub><span 
class="cmmi-10">P</span>))
<span 
class="ecrm-1000">of the gyro-angle, the resolution over the gyro-angle can be increased in a way that there can be several</span>
<span 
class="ecrm-1000">gyro-angles for a single </span>(<span 
class="cmbx-10">X</span><sub><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">⊥</span><span 
class="cmmi-7">j</span></sub><span 
class="cmmi-10">,v</span><sub><span 
class="cmsy-7">∥</span><span 
class="cmmi-7">j</span></sub>)<span 
class="ecrm-1000">. This gives the impression that the gyro-angle of a guiding-center</span>
<span 
class="ecrm-1000">marker is arbitrary. This is impression is incorrect. The correct understanding is that given above,</span>
<span 
class="ecrm-1000">i.e., we take several times of samplings and average the estimations resulting from each</span>
<span 
class="ecrm-1000">sampling.</span>
</p><!--l. 3344--><p class="indent" >   <span 
class="ecrm-1000">In the code, the gyro-angle is deﬁned relative to the direction </span><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ∕</span><span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">ψ</span><span 
class="cmsy-10">| </span><span 
class="ecrm-1000">at the guiding-center</span>
<span 
class="ecrm-1000">position. Speciﬁcly, the gyro-angle is deﬁned as the included angle between </span><span 
class="cmsy-10">∇</span><span 
class="cmmi-10">ψ∕</span><span 
class="cmsy-10">|∇</span><span 
class="cmmi-10">ψ</span><span 
class="cmsy-10">| </span><span 
class="ecrm-1000">and</span>
<span 
class="cmsy-10">−</span><span 
class="cmbx-10">v </span><span 
class="cmsy-10">× </span><span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">∥</span></sub>(<span 
class="cmbx-10">x</span>)<span 
class="cmmi-10">∕Ω</span>(<span 
class="cmbx-10">x</span>)<span 
class="ecrm-1000">, where </span><span 
class="cmbx-10">e</span><sub><span 
class="cmsy-7">∥</span></sub>(<span 
class="cmbx-10">x</span>)<span 
class="cmmi-10">∕Ω</span>(<span 
class="cmbx-10">x</span>) <span 
class="ecrm-1000">is approximated by the value at the guiding-center</span>
<span 
class="ecrm-1000">location.</span>
                                                                                

                                                                                
</p>
   <!--l. 3351--><div class="crosslinks"><p class="noindent"><span 
class="ecrm-1000">[</span><a 
href="nonlinear_gyrokinetic_equationsu29.html" ><span 
class="ecrm-1000">next</span></a><span 
class="ecrm-1000">] [</span><a 
href="nonlinear_gyrokinetic_equationsu27.html" ><span 
class="ecrm-1000">prev</span></a><span 
class="ecrm-1000">] [</span><a 
href="nonlinear_gyrokinetic_equationsu27.html#tailnonlinear_gyrokinetic_equationsu27.html" ><span 
class="ecrm-1000">prev-tail</span></a><span 
class="ecrm-1000">] [</span><a 
href="nonlinear_gyrokinetic_equationsu28.html" ><span 
class="ecrm-1000">front</span></a><span 
class="ecrm-1000">] [</span><a 
href="nonlinear_gyrokinetic_equationse9.html#nonlinear_gyrokinetic_equationsu28.html" ><span 
class="ecrm-1000">up</span></a><span 
class="ecrm-1000">] </span></p></div>
<!--l. 3351--><p class="indent" >   <a 
 id="tailnonlinear_gyrokinetic_equationsu28.html"></a> </p> 
</body></html> 
